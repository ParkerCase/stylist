"use strict";(self.webpackChunkStylistWidget=self.webpackChunkStylistWidget||[]).push([[9550],{7440:function(e,t,n){n.d(t,{K:function(){return r}});n(72505);var i=n(18811),s=n(33994),o=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};function r(e){const t=e.requestWithRetry.bind(e);return e.requestWithRetry=function(e,n,s,r){return o(this,void 0,void 0,(function*(){if(a(n,e))try{const t=Object.assign(Object.assign(Object.assign({},(null===r||void 0===r?void 0:r.params)?r.params:{}),s&&"object"===typeof s?s:{}),{url:n,method:e}),o=(0,i.Jt)(n,t);return yield c(),o}catch(o){}return t(e,n,s,r)}))},e}function a(e,t){return!!s.WW||(!!(0,i.JT)()||!(!s.ee||!(e.includes("/products")||e.includes("/inventory")||e.includes("/recommendations"))))}function c(){return o(this,void 0,void 0,(function*(){const e=100+400*Math.random();return new Promise((t=>setTimeout(t,e)))}))}},18634:function(e,t,n){n.r(t),n.d(t,{SyncProvider:function(){return l},useSyncContext:function(){return d}});var i=n(74848),s=n(96540),o=n(31040),r=n(13841),a=n(66175);const c=(0,s.createContext)(void 0),d=()=>{const e=(0,s.useContext)(c);if(void 0===e)throw new Error("useSyncContext must be used within a SyncProvider");return e},l=({children:e})=>{const t=(0,o.oy)(),n=(0,r.A)(),d=(0,a.k)(),[l,u]=(0,s.useState)(!1),h=(0,s.useRef)(!1),m=(0,s.useRef)(!1),f=(0,s.useRef)(null);(0,s.useEffect)((()=>{if(!l)return void u(!0);h.current||(h.current=!0,f.current=setTimeout((()=>{m.current||(m.current=!0,window&&"undefined"!==typeof window&&(window.__STYLIST_BACKGROUND_INIT_COMPLETE=!0))}),15e3));const e=setTimeout((()=>{d.user&&n.isOnline&&t.syncNow(),m.current||setTimeout((()=>{m.current||(m.current=!0,window&&"undefined"!==typeof window&&(window.__STYLIST_BACKGROUND_INIT_COMPLETE=!0))}),5e3)}),2e3);return()=>{clearTimeout(e),f.current&&clearTimeout(f.current)}}),[l,d.user,n.isOnline,t]),(0,s.useEffect)((()=>{if(n.isOnline&&d.user){const e=setTimeout((()=>{t.syncNow()}),2e3);return()=>{clearTimeout(e)}}}),[n.isOnline,d.user,t]),(0,s.useEffect)((()=>{const e=()=>{"visible"===document.visibilityState&&n.isOnline&&d.user&&t.syncNow()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[n.isOnline,d.user,t]);const g={syncState:t.state,syncNow:t.syncNow,isOnline:n.isOnline,isSlowConnection:n.isSlowConnection};return(0,s.useEffect)((()=>{const e=setTimeout((()=>{window&&"undefined"!==typeof window&&(window.__STYLIST_WIDGET_RENDER_COMPLETE=!0)}),5e3);return()=>{clearTimeout(e)}}),[]),(0,i.jsxs)(c.Provider,Object.assign({value:g},{children:[null,e,null]}))};t.default=l},24196:function(e,t,n){n.d(t,{JJ:function(){return i}});const i=(e,t,n,i,s,o)=>{let r=e,a=t;return n&&(r=n,a=t*n/e),i&&(a=i,n||(r=e*i/t)),s&&r>s&&(a=a*s/r,r=s),o&&a>o&&(r=r*o/a,a=o),{width:Math.round(r),height:Math.round(a)}}},31040:function(e,t,n){n.d(t,{oy:function(){return m}});var i=n(96540),s=n(66175),o=n(9055),r=n(15799),a=n(30769),c=n(33994),d=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const l="stylist_last_sync",u="stylist_sync_queue";var h;!function(e){e.ADD_CLOSET_ITEM="ADD_CLOSET_ITEM",e.REMOVE_CLOSET_ITEM="REMOVE_CLOSET_ITEM",e.UPDATE_CLOSET_ITEM="UPDATE_CLOSET_ITEM",e.TOGGLE_FAVORITE="TOGGLE_FAVORITE",e.UPDATE_PREFERENCES="UPDATE_PREFERENCES",e.SUBMIT_QUIZ="SUBMIT_QUIZ",e.ADD_LIKED_ITEM="ADD_LIKED_ITEM",e.ADD_DISLIKED_ITEM="ADD_DISLIKED_ITEM",e.REMOVE_LIKED_ITEM="REMOVE_LIKED_ITEM",e.REMOVE_DISLIKED_ITEM="REMOVE_DISLIKED_ITEM",e.SAVE_OUTFIT="SAVE_OUTFIT",e.REMOVE_OUTFIT="REMOVE_OUTFIT"}(h||(h={}));const m=()=>{const[e,t]=(0,i.useState)({isOnline:navigator.onLine,isSyncing:!1,lastSyncTimestamp:Number(localStorage.getItem(l))||null,pendingOperations:0,syncQueue:[]}),n=(0,s.k)(),m=((0,o.A)(),(0,i.useRef)(null)),f=(0,i.useRef)((()=>{const e=new a.O({baseURL:c.H$,timeout:c.dL,maxRetries:c.NX,getAuthHeader:()=>{const e=localStorage.getItem("stylist_auth_token");return e?{Authorization:`Bearer ${e}`}:{Authorization:""}}});return new r.i(e)})()),g=(0,i.useCallback)((()=>{const e=localStorage.getItem(u);if(!e)return[];try{return JSON.parse(e)}catch(t){return[]}}),[]),p=(0,i.useCallback)((e=>{try{localStorage.setItem(u,JSON.stringify(e))}catch(t){}}),[]);(0,i.useEffect)((()=>{const e=g();t((t=>Object.assign(Object.assign({},t),{syncQueue:e,pendingOperations:e.filter((e=>!e.resolved)).length})))}),[g]),(0,i.useEffect)((()=>{const e=()=>{t((e=>Object.assign(Object.assign({},e),{isOnline:!0}))),S()},n=()=>{t((e=>Object.assign(Object.assign({},e),{isOnline:!1})))};return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const y=(0,i.useCallback)(((e,n,i)=>{const s={id:`sync_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,timestamp:Date.now(),userId:i,operation:e,data:n,retryCount:0,resolved:!1};t((e=>{const t=[...e.syncQueue,s];return p(t),Object.assign(Object.assign({},e),{syncQueue:t,pendingOperations:t.filter((e=>!e.resolved)).length})})),navigator.onLine&&S()}),[p]),v=(0,i.useCallback)((e=>d(void 0,void 0,void 0,(function*(){const{operation:t,data:n,userId:i}=e;try{switch(t){case h.ADD_CLOSET_ITEM:yield f.current.addClosetItem(i,n);break;case h.REMOVE_CLOSET_ITEM:yield f.current.removeClosetItem(i,n.itemId);break;case h.UPDATE_CLOSET_ITEM:yield f.current.updateClosetItem(i,n.itemId,n.updates);break;case h.TOGGLE_FAVORITE:yield f.current.toggleFavoriteItem(i,n.itemId,n.favorite);break;case h.UPDATE_PREFERENCES:yield f.current.updatePreferences(i,n);break;case h.SUBMIT_QUIZ:yield f.current.submitStyleQuiz(i,n);break;case h.SAVE_OUTFIT:case h.REMOVE_OUTFIT:case h.ADD_LIKED_ITEM:case h.ADD_DISLIKED_ITEM:case h.REMOVE_LIKED_ITEM:case h.REMOVE_DISLIKED_ITEM:break;default:return!1}return!0}catch(s){return!1}}))),[]),w=(0,i.useCallback)(((e,t)=>{if(!e||!t)return t||e;const n=new Date(e.lastActive).getTime();let i=new Date(t.lastActive).getTime()>n?Object.assign({},t):Object.assign({},e);const s=new Map;t.closet.forEach((e=>{s.set(e.id,e)})),e.closet.forEach((e=>{const t=s.get(e.id);if(t){new Date(e.dateAdded).getTime()>new Date(t.dateAdded).getTime()&&s.set(e.id,e)}else s.set(e.id,e)})),i.closet=Array.from(s.values());const o=new Set([...t.feedback.likedItems,...e.feedback.likedItems]),r=new Set([...t.feedback.dislikedItems,...e.feedback.dislikedItems]),a=new Set([...t.feedback.viewedItems,...e.feedback.viewedItems]),c=[...t.feedback.savedOutfits];return e.feedback.savedOutfits.forEach((e=>{c.some((t=>t.length===e.length&&t.every((t=>e.includes(t)))))||c.push(e)})),i.feedback=Object.assign(Object.assign({},i.feedback),{likedItems:Array.from(o),dislikedItems:Array.from(r),viewedItems:Array.from(a),savedOutfits:c,lastInteraction:new Date(Math.max(new Date(e.feedback.lastInteraction).getTime(),new Date(t.feedback.lastInteraction).getTime()))}),i}),[]),I=(0,i.useCallback)((e=>d(void 0,void 0,void 0,(function*(){if(e)try{const i=yield f.current.getUserProfile(e),s=n.user;if(i&&s){const e=w(s,i);n.setUser(e)}else i&&n.setUser(i);const o=Date.now();localStorage.setItem(l,o.toString()),t((e=>Object.assign(Object.assign({},e),{lastSyncTimestamp:o})))}catch(i){}}))),[n,w]),S=(0,i.useCallback)((()=>d(void 0,void 0,void 0,(function*(){var i;if(!e.isSyncing&&navigator.onLine&&n.user){t((e=>Object.assign(Object.assign({},e),{isSyncing:!0})));try{const e=g(),s=e.filter((e=>!e.resolved));if(s.length>0){const n=[...e];for(const e of s){if(e.resolved)continue;if(yield v(e)){const t=n.findIndex((t=>t.id===e.id));-1!==t&&(n[t]=Object.assign(Object.assign({},n[t]),{resolved:!0}))}else{const t=n.findIndex((t=>t.id===e.id));if(-1!==t){const e=n[t].retryCount+1,i=e>=5;n[t]=Object.assign(Object.assign({},n[t]),{retryCount:e,resolved:i})}}}p(n),t((e=>Object.assign(Object.assign({},e),{syncQueue:n,pendingOperations:n.filter((e=>!e.resolved)).length})))}yield I((null===(i=n.user)||void 0===i?void 0:i.userId)||"")}catch(s){}finally{t((e=>Object.assign(Object.assign({},e),{isSyncing:!1})))}}}))),[e.isSyncing,n.user,g,v,p,I]);return(0,i.useEffect)((()=>(m.current&&window.clearInterval(m.current),m.current=window.setInterval((()=>{navigator.onLine&&n.user&&S()}),3e4),()=>{m.current&&window.clearInterval(m.current)})),[S,n.user]),{state:e,syncNow:S,addClosetItem:(e,t)=>{y(h.ADD_CLOSET_ITEM,e,t)},removeClosetItem:(e,t)=>{y(h.REMOVE_CLOSET_ITEM,{itemId:e},t)},updateClosetItem:(e,t,n)=>{y(h.UPDATE_CLOSET_ITEM,{itemId:e,updates:t},n)},toggleFavorite:(e,t,n)=>{y(h.TOGGLE_FAVORITE,{itemId:e,favorite:t},n)},updatePreferences:(e,t)=>{y(h.UPDATE_PREFERENCES,e,t)},submitQuiz:(e,t)=>{y(h.SUBMIT_QUIZ,e,t)},saveOutfit:(e,t)=>{y(h.SAVE_OUTFIT,e,t)},removeOutfit:(e,t)=>{y(h.REMOVE_OUTFIT,{outfitId:e},t)}}}},41071:function(e,t,n){n.d(t,{av:function(){return c},u:function(){return a},vX:function(){return o},yt:function(){return s},zM:function(){return r}});var i=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const s=e=>new Promise(((t,n)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{t(i)},i.onerror=e=>{n(new Error(`Failed to load image: ${e}`))},i.src=e})),o=e=>i(void 0,void 0,void 0,(function*(){const t=yield s(e);return{width:t.width,height:t.height}})),r=e=>new Promise(((t,n)=>{const i=new FileReader;i.onload=e=>{var i;(null===(i=e.target)||void 0===i?void 0:i.result)?t(e.target.result):n(new Error("Failed to convert file to data URL"))},i.onerror=e=>{n(e)},i.readAsDataURL(e)})),a=e=>e.type.startsWith("image/"),c=e=>e<1024?`${e} bytes`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`},50849:function(e,t,n){n.d(t,{m:function(){return c}});var i=n(22592),s=n(87187),o=n(86647),r=n(40311),a=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const c=new class{constructor(){this.syncIntervalId=null,this.syncInterval=6e4,this.isInitialized=!1,this.apiConfig=null}initialize(e){this.isInitialized||(this.apiConfig=e,this.isInitialized=!0,window.addEventListener("online",this.handleOnline.bind(this)),window.addEventListener("offline",this.handleOffline.bind(this)),setTimeout((()=>{navigator.onLine&&this.startSyncInterval()}),3e3))}startSyncInterval(){null===this.syncIntervalId&&(this.syncFeedback(),this.syncIntervalId=window.setInterval((()=>{this.syncFeedback()}),this.syncInterval))}stopSyncInterval(){null!==this.syncIntervalId&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=null)}handleOnline(){this.startSyncInterval()}handleOffline(){this.stopSyncInterval()}syncFeedback(){return a(this,void 0,void 0,(function*(){if(!this.isInitialized||!this.apiConfig)return;const e=s.k.getState(),t=e.getPendingSyncItems();if(0!==t.length&&!e.isSyncing)try{e.setIsSyncing(!0);const n=(0,o.F6)(),s=(0,i.zA)(this.apiConfig),a=yield s.feedback.syncFeedback({userId:n,feedbackItems:t});a.success&&a.syncedItemIds.length>0&&(e.markAsSynced(a.syncedItemIds),(0,r.s)(r.X.FEEDBACK_SYNCED,n,{count:a.syncedItemIds.length}))}catch(n){}finally{e.setIsSyncing(!1)}}))}cleanup(){this.stopSyncInterval(),window.removeEventListener("online",this.handleOnline.bind(this)),window.removeEventListener("offline",this.handleOffline.bind(this)),this.isInitialized=!1}}},57401:function(e,t,n){n.d(t,{Qb:function(){return d},VK:function(){return c},WZ:function(){return r},bj:function(){return a}});var i=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const s=(e,t,n,i=0,s=!1,o=!1)=>{e.save();const r=n.x+n.width/2,a=n.y+n.height/2;e.translate(r,a),0!==i&&e.rotate(i*Math.PI/180);const c=s?-1:1,d=o?-1:1;e.scale(c,d),e.drawImage(t,-n.width/2,-n.height/2,n.width,n.height),e.restore()},o=(e,t,n,i=0,o=!1,r=!1)=>{Math.abs(i)<5&&(i=0);const a={x:Math.round(n.x),y:Math.round(n.y),width:Math.round(n.width),height:Math.round(n.height)};s(e,t,a,i,o,r)},r=(e,t,n,o)=>i(void 0,void 0,void 0,(function*(){const i=e.getContext("2d");if(!i)return;i.clearRect(0,0,e.width,e.height),i.drawImage(t,0,0,e.width,e.height);const r=[...n].sort(((e,t)=>e.zIndex-t.zIndex));for(const t of r)try{const n=yield o(t.url),r=t.dimensions||{width:n.width,height:n.height},a=t.scale||1,c={width:r.width*a,height:r.height*a},d=t.offset||{x:0,y:0},l={x:(e.width-c.width)/2+d.x,y:(e.height-c.height)/2+d.y,width:c.width,height:c.height};s(i,n,l,t.rotation||0,t.flipHorizontal||!1,t.flipVertical||!1)}catch(a){}})),a=(e,t,n,r)=>i(void 0,void 0,void 0,(function*(){const i=e.getContext("2d",{alpha:!1});if(!i)return;const a=i;a.imageSmoothingQuality&&(a.imageSmoothingQuality="low");const c=e.width,d=e.height,l=.75;e.width=Math.round(c*l),e.height=Math.round(d*l),i.clearRect(0,0,e.width,e.height),i.drawImage(t,0,0,e.width,e.height);const u=[...n].sort(((e,t)=>e.zIndex-t.zIndex)),h=new Map;for(const t of u)try{let n;h.has(t.url)?n=h.get(t.url):(n=yield r(t.url),h.set(t.url,n));const s=t.dimensions||{width:n.width,height:n.height},a=(t.scale||1)*l,c={width:s.width*a,height:s.height*a},d=t.offset?{x:t.offset.x*l,y:t.offset.y*l}:{x:0,y:0},u={x:(e.width-c.width)/2+d.x,y:(e.height-c.height)/2+d.y,width:c.width,height:c.height};Object.keys(u).forEach((e=>{u[e]=Math.round(u[e])})),o(i,n,u,t.rotation||0,t.flipHorizontal||!1,t.flipVertical||!1)}catch(g){}const m=document.createElement("canvas");m.width=e.width,m.height=e.height;const f=m.getContext("2d");if(f)f.drawImage(e,0,0),e.width=c,e.height=d,i.drawImage(m,0,0,e.width,e.height);else{e.width=c,e.height=d,i.drawImage(t,0,0,e.width,e.height);for(const t of u)try{const n=h.get(t.url)||(yield r(t.url)),o=t.dimensions||{width:n.width,height:n.height},a=t.scale||1,c={width:o.width*a,height:o.height*a},d=t.offset||{x:0,y:0},l={x:(e.width-c.width)/2+d.x,y:(e.height-c.height)/2+d.y,width:c.width,height:c.height};s(i,n,l,t.rotation||0,t.flipHorizontal||!1,t.flipVertical||!1)}catch(g){}}})),c=e=>new Promise(((t,n)=>{try{t(e.toDataURL("image/png"))}catch(i){n(i)}})),d=(e,t="rgba(0, 0, 255, 0.2)",n=1)=>{const i=e.getContext("2d");if(i){i.save(),i.strokeStyle=t,i.lineWidth=n;for(let t=1;t<3;t++){const n=e.height/3*t;i.beginPath(),i.moveTo(0,n),i.lineTo(e.width,n),i.stroke()}for(let t=1;t<3;t++){const n=e.width/3*t;i.beginPath(),i.moveTo(n,0),i.lineTo(n,e.height),i.stroke()}i.beginPath(),i.moveTo(e.width/2,0),i.lineTo(e.width/2,e.height),i.moveTo(0,e.height/2),i.lineTo(e.width,e.height/2),i.stroke(),i.restore()}}},68884:function(e,t,n){n.d(t,{m:function(){return c}});var i=n(23918),s=n(25279),o=n(40311);var r=n(33994),a=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class c{constructor(e,t,n){this.conversationHistory=[],this.conversationContext=[],this.userContext={stylePreferences:{},closetItems:[],likedItems:[],dislikedItems:[],recentSearches:[],recentInteractions:[]},this.specialCommands=[],this.recommendationApi=e,this.userApi=n,this.userId=t,this.claudeConfig={apiKey:r.mU,baseUrl:r.UI,modelName:r.nt,fallbackMode:!r.mU||r.WW},this.conversationContext=[`You are an AI style assistant for a fashion recommendation platform called "The Stylist". \n      The current date is ${(new Date).toLocaleDateString()}.\n      You help users discover clothing items and outfits that match their personal style.\n      Keep responses concise, helpful, and focus on providing personalized fashion advice.\n      When you recommend items, focus on why they would work for the user.\n      If you don't know something specific about fashion, you can suggest general style principles.\n      \n      Remember to be conversational yet professional. Reference the user's past preferences and items in their closet when relevant.\n      You can handle multiple types of input including text, image uploads for finding similar items, and URL inputs for specific product lookups.\n      `],this.initializeSpecialCommands(),this.loadUserContext(),r.Ft,r.WW||r.mU}generateTrendInsights(e,t){const n=t.map((e=>e.brand)).filter(Boolean),i=[...new Set(n)],s=[];t.forEach((e=>{e.colors&&Array.isArray(e.colors)&&s.push(...e.colors)}));const o=[...new Set(s)];let r="";return r+=e?`Current ${e} trends are focused on `:"Current fashion trends are highlighting ",o.length>0?(r+=`${o.slice(0,3).join(", ")} colors`,i.length>0&&(r+=` with designers like ${i.slice(0,2).join(" and ")} leading the way`)):i.length>0?r+=`styles from ${i.slice(0,3).join(", ")}`:r+="innovative designs and fresh styles",r+=". These trends are expected to continue gaining popularity over the coming weeks.",r}initializeSpecialCommands(){this.specialCommands.push({pattern:/show\s+me\s+([\w\s]+)(?:\s+for\s+([\w\s]+))?/i,handler:(e,t)=>a(this,void 0,void 0,(function*(){var e,n;const s=(null===(e=t[1])||void 0===e?void 0:e.trim().toLowerCase())||"",o=(null===(n=t[2])||void 0===n?void 0:n.trim().toLowerCase())||"",r=o||s;this.userContext.recentSearches.push(r);const a=[];return a.push(this.createTextMessage(`I'd be happy to show you ${s}${o?` for ${o}`:""}! Here are some recommendations:`,i.D$.ASSISTANT)),yield this.addRecommendationMessage(a,r),a}))}),this.specialCommands.push({pattern:/match\s+this\s+with\s+my\s+closet/i,handler:()=>a(this,void 0,void 0,(function*(){const e=[];return 0===this.userContext.closetItems.length?(e.push(this.createTextMessage("I don't see any items in your closet yet. Would you like to add some items first? You can upload photos of your clothing to your closet.",i.D$.ASSISTANT)),e):(e.push(this.createTextMessage("Let me find items that would pair well with what's in your closet!",i.D$.ASSISTANT)),yield this.addRecommendationMessage(e,"closet_match"),e)}))}),this.specialCommands.push({pattern:/find\s+(?:items|clothes|clothing)?\s*under\s*\$?(\d+)/i,handler:(e,t)=>a(this,void 0,void 0,(function*(){const e=parseInt(t[1]||"0",10),n=[];return n.push(this.createTextMessage(`Here are some stylish options under $${e}:`,i.D$.ASSISTANT)),yield this.addRecommendationMessage(n,`under_${e}`),n}))}),this.specialCommands.push({pattern:/complete\s+this\s+outfit/i,handler:()=>a(this,void 0,void 0,(function*(){const e=[];e.push(this.createTextMessage("I'll help you complete your outfit with these complementary pieces:",i.D$.ASSISTANT));try{const t=yield this.recommendationApi.getRecommendations({userId:this.userId,context:"complete_outfit",includeOutfits:!0,limit:1});if(t.outfits.length>0){const n=t.outfits[0],i=this.convertRecommendationOutfitToChatOutfit(n);e.push(this.createOutfitMessage(i))}else yield this.addRecommendationMessage(e,"outfit_pieces")}catch(t){e.push(this.createTextMessage("I'm having trouble finding the perfect outfit pieces right now. Please try again.",i.D$.SYSTEM))}return e}))}),this.specialCommands.push({pattern:/what(?:'s|\s+is)\s+trending\s+(?:in\s+)([\w\s]+)/i,handler:(e,t)=>a(this,void 0,void 0,(function*(){var e;const n=(null===(e=t[1])||void 0===e?void 0:e.trim().toLowerCase())||"",s=[];return s.push(this.createTextMessage(`Here are the top trending ${n} items right now:`,i.D$.ASSISTANT)),yield this.addRecommendationMessage(s,`trending_${n}`),s}))}),this.specialCommands.push({pattern:/^\/outfit(?:\s+([\w\s]+))?$/i,handler:(e,t)=>a(this,void 0,void 0,(function*(){var e;const n=(null===(e=t[1])||void 0===e?void 0:e.trim().toLowerCase())||"",s=[];n?s.push(this.createTextMessage(`Creating a complete outfit based on ${n}. Here's what I recommend:`,i.D$.ASSISTANT)):s.push(this.createTextMessage("Let me create a complete outfit for you based on your style preferences:",i.D$.ASSISTANT));try{const e=yield this.recommendationApi.getRecommendations({userId:this.userId,context:n?`outfit_${n}`:"complete_outfit",includeOutfits:!0,limit:1});if(e.outfits.length>0){const t=e.outfits[0],n=this.convertRecommendationOutfitToChatOutfit(t);s.push(this.createOutfitMessage(n)),s.push(this.createTextMessage(`This outfit combines pieces that work well together based on color harmony, style consistency, and your preferences. Each item was selected to create a cohesive look that's appropriate for ${t.occasion||"everyday wear"}.`,i.D$.ASSISTANT))}else yield this.addRecommendationMessage(s,n?`items_${n}`:"outfit_pieces")}catch(o){s.push(this.createTextMessage("I'm having trouble generating a complete outfit right now. Please try again.",i.D$.SYSTEM))}return s}))}),this.specialCommands.push({pattern:/^\/trends(?:\s+([\w\s]+))?$/i,handler:(e,t)=>a(this,void 0,void 0,(function*(){var e;const n=(null===(e=t[1])||void 0===e?void 0:e.trim().toLowerCase())||"",s=[];n?s.push(this.createTextMessage(`Here are the trending ${n} items right now:`,i.D$.ASSISTANT)):s.push(this.createTextMessage("Here are the trending fashion items across all categories:",i.D$.ASSISTANT));try{const e=yield this.recommendationApi.getRecommendations({userId:this.userId,context:n?`trending_${n}`:"trending",trending:!0,category:n||void 0,limit:6});if(e.items.length>0){const t=this.generateTrendInsights(n,e.items);s.push(this.createTextMessage(t,i.D$.ASSISTANT));const o=this.convertRecommendationItemsToChatItems(e.items);s.push(this.createRecommendationMessage(o))}else s.push(this.createTextMessage("I couldn't find any trending items at the moment. Please try again later.",i.D$.SYSTEM))}catch(o){s.push(this.createTextMessage("I'm having trouble finding trending items right now. Please try again.",i.D$.SYSTEM))}return s}))}),this.specialCommands.push({pattern:/^\/quiz$/i,handler:()=>a(this,void 0,void 0,(function*(){const e=[];return e.push(this.createTextMessage("I've opened the style quiz for you! Complete it to help me understand your fashion preferences better.",i.D$.ASSISTANT)),e.push(this.createTextMessage("After completing the quiz, I'll be able to provide more personalized recommendations that match your unique style profile.",i.D$.ASSISTANT)),e}))}),this.specialCommands.push({pattern:/^\/find(?:\s+([\w\s]+))?$/i,handler:(e,t)=>a(this,void 0,void 0,(function*(){var e;const n=(null===(e=t[1])||void 0===e?void 0:e.trim())||"",s=[];if(!n)return s.push(this.createTextMessage("Please provide a search term after the /find command. For example: /find black dress",i.D$.SYSTEM)),s;s.push(this.createTextMessage(`Searching across all inventory for "${n}"...`,i.D$.ASSISTANT));try{const e=yield this.recommendationApi.getRecommendations({userId:this.userId,context:`search_${n}`,deepSearch:!0,limit:8});if(e.items.length>0){s.push(this.createTextMessage(`Here are the best matches for "${n}" from our complete inventory:`,i.D$.ASSISTANT));const t=this.convertRecommendationItemsToChatItems(e.items);s.push(this.createRecommendationMessage(t))}else s.push(this.createTextMessage(`I couldn't find any items matching "${n}". Try a different search term or browse our trending items instead.`,i.D$.ASSISTANT))}catch(o){s.push(this.createTextMessage("I'm having trouble searching our inventory right now. Please try again.",i.D$.SYSTEM))}return s}))})}processMessage(e){return a(this,void 0,void 0,(function*(){((e,t)=>{(0,o.s)(o.X.MESSAGE_SENT,e,{text:t})})(this.userId,e),this.userContext.recentSearches.push(e),this.userContext.recentSearches.length>5&&this.userContext.recentSearches.shift(),this.userContext.lastMessageTimestamp=new Date;const t=[],n={id:(0,s.A)(),type:i.Go.TEXT,sender:i.D$.USER,text:e,timestamp:new Date};this.conversationHistory.push(n);const r=yield this.processSpecialCommands(e);if(r.length>0)return this.conversationHistory.push(...r),r;const a=this.categorizeIntent(e);if(!this.claudeConfig.fallbackMode)try{const n=yield this.callClaudeAPI(e),s=this.createTextMessage(n,i.D$.ASSISTANT);if(this.conversationHistory.push(s),t.push(s),this.containsRecommendationIntent(n,e)){const n=yield this.addRecommendationMessage([],this.extractContext(e));this.conversationHistory.push(...n),t.push(...n)}return t}catch(d){}const c=this.getDemoResponse(a,e);if(c){const e=this.createTextMessage(c,i.D$.ASSISTANT);if(this.conversationHistory.push(e),t.push(e),"wedding_dress"===a){const e=yield this.addRecommendationMessage([],"wedding");this.conversationHistory.push(...e),t.push(...e)}return t}switch(a){case"recommendation":const n=this.createTextMessage("I found some items that match your style! Here are my recommendations:",i.D$.ASSISTANT);this.conversationHistory.push(n),t.push(n);const s=yield this.addRecommendationMessage([],this.extractContext(e));this.conversationHistory.push(...s),t.push(...s);break;case"style_quiz":const o=this.createTextMessage("Would you like to take our style quiz? It will help me understand your preferences better so I can make more personalized recommendations.",i.D$.ASSISTANT);this.conversationHistory.push(o),t.push(o);break;case"virtual_try_on":const r=this.createTextMessage('You can try on any clothing item by clicking the "Try On" button on a recommendation. Upload your photo, and see how the item looks on you!',i.D$.ASSISTANT);this.conversationHistory.push(r),t.push(r);break;case"greeting":let a="Hello! I'm your personal AI style assistant. I can help you discover clothing that matches your unique style. ";if(this.userContext.stylePreferences&&Object.keys(this.userContext.stylePreferences).length>0&&(a+="Based on your style preferences, I can give you personalized recommendations. "),this.userContext.lastMessageTimestamp){const e=this.userContext.lastMessageTimestamp;((new Date).getTime()-e.getTime())/36e5<24&&(a="Welcome back! Glad to see you again. ")}a+="Would you like some personalized recommendations?";const c=this.createTextMessage(a,i.D$.ASSISTANT);this.conversationHistory.push(c),t.push(c);break;case"help":const d=this.createTextMessage('I can help you with: \n- Finding clothing recommendations based on your style\n- Creating complete outfits\n- Virtual try-on of garments\n- Style advice and tips\n\nTry these special commands:\n- "Show me dresses for wedding"\n- "Match this with my closet"\n- "Find under $50"\n- "Complete this outfit"\n- "What\'s trending in shoes"\n- "/trends [category]" - Show trending items\n- "/quiz" - Start style quiz\n- "/find [item]" - Deep search our inventory\n- "/outfit [item]" - Create complete outfit\n\nJust let me know what you\'re looking for!',i.D$.ASSISTANT);this.conversationHistory.push(d),t.push(d);break;case"wedding_dress":const l=this.createTextMessage("I can help you find the perfect wedding dress! Here are some recommendations based on current trends:",i.D$.ASSISTANT);this.conversationHistory.push(l),t.push(l);const u=yield this.addRecommendationMessage([],"wedding");this.conversationHistory.push(...u),t.push(...u);break;default:const h=this.createTextMessage("I can help you discover fashion items that match your style. Would you like to see some personalized recommendations?",i.D$.ASSISTANT);this.conversationHistory.push(h),t.push(h)}return t}))}processImageUpload(e){return a(this,void 0,void 0,(function*(){const e=[];try{const t=this.createTextMessage("I've received your image and I'm analyzing it to find similar items...",i.D$.ASSISTANT);this.conversationHistory.push(t),e.push(t);const n=new Promise((e=>setTimeout(e,1500)));yield n;const s=this.createTextMessage("I found several items that match the style in your image. Here are the closest matches:",i.D$.ASSISTANT);this.conversationHistory.push(s),e.push(s);const o=yield this.addRecommendationMessage([],"image_match");this.conversationHistory.push(...o),e.push(...o)}catch(t){const n=this.createTextMessage("I'm sorry, I encountered an error while analyzing your image. Please try again or describe what you're looking for instead.",i.D$.SYSTEM);this.conversationHistory.push(n),e.push(n)}return e}))}processURLInput(e){return a(this,void 0,void 0,(function*(){const t=[];try{const n=this.createTextMessage(`I'm looking up the product at this URL: ${e}...`,i.D$.ASSISTANT);this.conversationHistory.push(n),t.push(n);const s=new Promise((e=>setTimeout(e,1e3)));yield s;const o=this.createTextMessage("I found the product! Here are the details and some items that would go well with it:",i.D$.ASSISTANT);this.conversationHistory.push(o),t.push(o);const r=yield this.addRecommendationMessage([],"product_url");this.conversationHistory.push(...r),t.push(...r)}catch(n){const e=this.createTextMessage("I'm sorry, I couldn't retrieve information about this product. The URL might be invalid or the product might not be available. Please try another URL or describe what you're looking for.",i.D$.SYSTEM);this.conversationHistory.push(e),t.push(e)}return t}))}processSpecialCommands(e){return a(this,void 0,void 0,(function*(){for(const n of this.specialCommands){const s=e.match(n.pattern);if(s)try{return yield n.handler(e,s)}catch(t){return[this.createTextMessage("I'm sorry, I had trouble processing that command. Please try again.",i.D$.SYSTEM)]}}return[]}))}loadUserContext(){return a(this,void 0,void 0,(function*(){try{if(this.userApi){const t=yield this.userApi.getUserProfile(this.userId);if(t){this.userContext.stylePreferences=t.preferences||{};try{const e={items:t.closet||[]};this.userContext.closetItems=(null===e||void 0===e?void 0:e.items)||[]}catch(e){}try{const e=t.feedback||{likedItems:[],dislikedItems:[]};this.userContext.likedItems=e.likedItems||[],this.userContext.dislikedItems=e.dislikedItems||[]}catch(e){}}}else try{const e=localStorage.getItem(`stylist_chat_context_${this.userId}`);if(e){const t=JSON.parse(e);this.userContext=Object.assign(Object.assign({},this.userContext),t)}}catch(e){}this.updateConversationContext()}catch(t){}}))}updateConversationContext(){const e=[];if(Object.keys(this.userContext.stylePreferences).length>0){const t=this.userContext.stylePreferences;let n="User style preferences: ";t.favoriteColors&&(n+=`Favorite colors: ${t.favoriteColors.join(", ")}. `),t.stylePersona&&(n+=`Style persona: ${t.stylePersona}. `),t.preferredFit&&(n+=`Preferred fit: ${t.preferredFit}. `),e.push(n)}if(this.userContext.closetItems.length>0){const t=`User has ${this.userContext.closetItems.length} items in their closet.`;e.push(t)}if(this.userContext.likedItems.length>0||this.userContext.dislikedItems.length>0){let t="User preferences based on feedback: ";this.userContext.likedItems.length>0&&(t+=`Liked ${this.userContext.likedItems.length} items. `),this.userContext.dislikedItems.length>0&&(t+=`Disliked ${this.userContext.dislikedItems.length} items. `),e.push(t)}if(this.userContext.recentSearches.length>0){const t=`Recent user searches: ${this.userContext.recentSearches.slice(-3).join(", ")}`;e.push(t)}e.length>0&&(this.conversationContext.length<=1?this.conversationContext.push(e.join("\n")):this.conversationContext[1]=e.join("\n"))}callClaudeAPI(e){return a(this,void 0,void 0,(function*(){try{if(this.conversationContext.push(e),this.updateConversationContext(),this.claudeConfig.apiKey)try{return yield this.callDirectClaudeAPI(e)}catch(t){}const n=this.recommendationApi.apiClient?`${this.recommendationApi.apiClient.baseURL||""}/chat`:"/api/chat",i=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.recommendationApi.apiClient.apiKey||""},body:JSON.stringify({userId:this.userId,message:e,context:this.conversationContext.slice(-5)})});if(!i.ok)return"I'm having trouble connecting to my backend services. Let me show you some recommendations based on your request.";const s=yield i.json();return this.conversationContext.push(s.response),s.response}catch(n){return"I'm having trouble connecting right now. Let me show you some recommendations instead."}}))}callDirectClaudeAPI(e){var t,n;return a(this,void 0,void 0,(function*(){if(!this.claudeConfig.apiKey)throw new Error("No Claude API key available");const i=this.claudeConfig.baseUrl||"https://api.anthropic.com",s=this.claudeConfig.modelName||"claude-3-haiku-20240307",o=this.conversationContext.slice(-5).map(((e,t)=>0===t?{role:"system",content:e}:{role:t%2===1?"user":"assistant",content:e}));o.push({role:"user",content:e});const r=yield fetch(`${i}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.claudeConfig.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:s,messages:o,max_tokens:1e3})});if(!r.ok){yield r.text();throw new Error(`Failed to get response from Claude API: ${r.statusText}`)}const a=yield r.json(),c=(null===(n=null===(t=a.content)||void 0===t?void 0:t[0])||void 0===n?void 0:n.text)||"";return this.conversationContext.push(c),c}))}containsRecommendationIntent(e,t){const n=e.toLowerCase(),i=t.toLowerCase(),s=["here are some recommendations","i recommend","would you like to see","i can show you","i'll show you some items","i can recommend","here's what i found","similar items","items that match"],o=["show me","recommend","what should i wear","find me","can you show","give me ideas","what would look good","similar to","like this","matching"];for(const r of s)if(n.includes(r))return!0;for(const r of o)if(i.includes(r))return!0;return!1}addRecommendationMessage(e,t){var n;return a(this,void 0,void 0,(function*(){const s=[];try{const o=yield this.recommendationApi.getRecommendations({userId:this.userId,context:t,limit:4});if(o.items.length>0){const e=this.convertRecommendationItemsToChatItems(o.items),t=this.createRecommendationMessage(e);s.push(t)}if((null===(n=o.outfits)||void 0===n?void 0:n.length)>0){const e=this.createTextMessage("I also created a complete outfit for you:",i.D$.ASSISTANT);s.push(e);const t=o.outfits[0],n=this.convertRecommendationOutfitToChatOutfit(t);s.push(this.createOutfitMessage(n))}e&&e.push(...s)}catch(o){const t=this.createTextMessage("Sorry, I had trouble getting recommendations. Please try again.",i.D$.SYSTEM);s.push(t),e&&e.push(t)}return s}))}convertRecommendationItemsToChatItems(e){return e.map((e=>{var t;return{id:e.id,name:e.name,brand:e.brand,category:e.category,price:e.price,salePrice:e.salePrice,imageUrl:(null===(t=e.imageUrls)||void 0===t?void 0:t[0])||"",url:e.url,matchScore:e.matchScore,matchReasons:e.matchReasons}}))}convertRecommendationOutfitToChatOutfit(e){return{id:e.id,name:e.name,occasion:e.occasion,matchScore:e.matchScore,matchReasons:e.matchReasons,items:this.convertRecommendationItemsToChatItems(e.items)}}categorizeIntent(e){const t=e.toLowerCase();return t.includes("wedding dress")||t.includes("bridal")||t.includes("wedding")&&t.includes("dress")?"wedding_dress":t.includes("recommend")||t.includes("suggestion")||t.includes("find")||t.includes("show me")?"recommendation":t.includes("quiz")||t.includes("style profile")||t.includes("preferences")?"style_quiz":t.includes("try on")||t.includes("virtual")||t.includes("how does it look")?"virtual_try_on":t.includes("hello")||t.includes("hi")||t.includes("hey")?"greeting":t.includes("help")||t.includes("what can you do")||t.includes("how does this work")?"help":"general"}getDemoResponse(e,t){switch(e){case"wedding_dress":return"I'd be happy to help you find the perfect wedding dress! Based on current trends and classic styles, here are some suggestions:\n\nFor a traditional look, A-line and ball gown silhouettes create a timeless, romantic appearance. If you prefer something more modern, consider a fitted mermaid or trumpet style that accentuates your curves.\n\nMaterial is important too - delicate lace creates a romantic feel, while silk or satin offers elegant simplicity. For spring/summer weddings, lighter fabrics like chiffon or organza are beautiful options.\n\nWould you like to see specific dress recommendations? I can show you some options across different styles and price points that might match what you're looking for.";case"greeting":let e="Hello! I'm your personal style assistant. I'm here to help you discover clothing that matches your unique style preferences. ";return Object.keys(this.userContext.stylePreferences).length>0&&(e+="Based on your style quiz results, I can provide tailored recommendations. "),this.userContext.closetItems.length>0&&(e+=`I can also suggest items that would coordinate well with the ${this.userContext.closetItems.length} items in your closet. `),e+="I can recommend outfits, help you find specific items, provide style advice, or even let you virtually try on clothes. What kind of fashion help are you looking for today?",e;case"help":return'I\'m your AI fashion assistant, and I can help you with:\n\n- Finding personalized clothing recommendations\n- Creating complete outfits for specific occasions\n- Virtually trying on garments with our try-on feature\n- Answering style questions and providing fashion advice\n- Helping you complete our style quiz to better understand your preferences\n\nYou can also use these special commands:\n- "Show me dresses for wedding"\n- "Match this with my closet"\n- "Find under $50"\n- "Complete this outfit"\n- "What\'s trending in shoes"\n\nJust let me know what you\'re looking for, and I\'ll guide you through the process!';default:return r.Ft?`I'd be happy to help you with "${t}". This is a simulated Claude response in demo mode. In a real implementation with an API key, you would get a personalized response from Claude based on your specific query. Would you like to see some clothing recommendations related to this topic?`:""}}extractContext(e){const t=e.toLowerCase(),n=["tops","shirts","t-shirts","blouses","bottoms","pants","jeans","shorts","skirts","dresses","gowns","outerwear","jackets","coats","shoes","sneakers","boots","heels","accessories"];for(const s of n)if(t.includes(s))return s;const i=["casual","formal","business","work","party","date","wedding","weekend","vacation","summer","winter","spring","fall"];for(const s of i)if(t.includes(s))return s}createTextMessage(e,t){return{id:(0,s.A)(),type:i.Go.TEXT,sender:t,text:e,timestamp:new Date}}createRecommendationMessage(e){return{id:(0,s.A)(),type:i.Go.RECOMMENDATION,sender:i.D$.ASSISTANT,items:e,timestamp:new Date}}createOutfitMessage(e){return{id:(0,s.A)(),type:i.Go.OUTFIT,sender:i.D$.ASSISTANT,outfit:e,timestamp:new Date}}}},80634:function(e,t,n){n.d(t,{Cg:function(){return S},FB:function(){return E},X3:function(){return f},XR:function(){return I},lb:function(){return w},s$:function(){return m}});var i=n(71751),s=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const o="stylist_pending_requests",r="stylist_offline_data",a="stylist_offline_mode";let c=navigator.onLine;const d=[],l={recommendations:[],userPreferences:null,recentItems:[],cachedProducts:{},lastUpdated:Date.now()},u=()=>{(0,i.cY)("Network connection restored"),c=!0,d.forEach((e=>e(!0))),w()},h=()=>{(0,i.cY)("Network connection lost"),c=!1,d.forEach((e=>e(!1)))},m=e=>(d.push(e),e(c),()=>{const t=d.indexOf(e);-1!==t&&d.splice(t,1)}),f=()=>c,g=(e,t)=>s(void 0,void 0,void 0,(function*(){try{const n=yield p();n[e]=t,n.lastUpdated=Date.now(),localStorage.setItem(r,JSON.stringify(n)),(0,i.cY)(`Saved offline data for key: ${e}`)}catch(n){}})),p=()=>s(void 0,void 0,void 0,(function*(){try{const e=localStorage.getItem(r);return e?JSON.parse(e):Object.assign({},l)}catch(e){return Object.assign({},l)}})),y=(e,t,n,r,a=5)=>s(void 0,void 0,void 0,(function*(){try{const s=`req_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,c={id:s,url:e,method:t,body:n,headers:r,timestamp:Date.now(),retryCount:0,maxRetries:a},d=yield v();return d.push(c),localStorage.setItem(o,JSON.stringify(d)),(0,i.cY)(`Queued request for later processing: ${t} ${e}`),s}catch(s){throw s}})),v=()=>s(void 0,void 0,void 0,(function*(){try{const e=localStorage.getItem(o);return e?JSON.parse(e):[]}catch(e){return[]}})),w=()=>s(void 0,void 0,void 0,(function*(){if(c)try{const e=yield v();if(0===e.length)return;(0,i.cY)(`Processing ${e.length} pending requests`);const t=(yield Promise.allSettled(e.map((e=>s(void 0,void 0,void 0,(function*(){try{const t=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body?JSON.stringify(e.body):void 0});if(!t.ok)throw new Error(`Request failed with status ${t.status}`);return e.id}catch(t){return e.retryCount<e.maxRetries?(e.retryCount++,null):e.id}})))))).map(((e,t)=>"fulfilled"===e.status&&null!==e.value?e.value:null)).filter(Boolean),n=e.filter((e=>!t.includes(e.id)));localStorage.setItem(o,JSON.stringify(n)),(0,i.cY)(`Processed ${t.length} pending requests successfully`)}catch(e){}else(0,i.cY)("Cannot process pending requests while offline")})),I=e=>{try{localStorage.setItem(a,JSON.stringify(e)),(0,i.cY)("Offline mode "+(e?"enabled":"disabled"))}catch(t){}},S=()=>{try{const e=localStorage.getItem(a);return!!e&&JSON.parse(e)}catch(e){return!1}},T=(e,t,n)=>s(void 0,void 0,void 0,(function*(){var i;if(null!==n)return new Response(JSON.stringify(n),{status:200,headers:{"Content-Type":"application/json"}});const s=new URL(e).pathname,o=yield p();if("GET"!==(null===(i=t.method)||void 0===i?void 0:i.toUpperCase()))return yield y(e,t.method||"GET",t.body,t.headers),new Response(JSON.stringify({queued:!0}),{status:202,headers:{"Content-Type":"application/json"}});if(s.includes("recommendations"))return new Response(JSON.stringify(o.recommendations),{status:200,headers:{"Content-Type":"application/json"}});if(s.includes("products")){const e=s.split("/").filter(Boolean),t=e[e.length-1];if(o.cachedProducts[t])return new Response(JSON.stringify(o.cachedProducts[t]),{status:200,headers:{"Content-Type":"application/json"}})}return null})),E={initOfflineService:()=>{(0,i.cY)("Initializing offline service"),window.addEventListener("online",u),window.addEventListener("offline",h),w()},cleanupOfflineService:()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),d.length=0},addNetworkStatusListener:m,getNetworkStatus:f,saveOfflineData:g,getOfflineData:p,queueRequest:y,processPendingRequests:w,setOfflineMode:I,isOfflineModeEnabled:S,clearOfflineData:()=>{try{localStorage.removeItem(r),localStorage.removeItem(o),localStorage.removeItem(a),(0,i.cY)("Cleared all offline data")}catch(e){}},offlineFetch:(e,t={},n)=>s(void 0,void 0,void 0,(function*(){var i,s;const{offlineable:o=!0,timeout:r=1e4,offlineData:a=null}=n||{};if(c)try{const n=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Request timed out"))),r)})),s=yield Promise.race([fetch(e,t),n]);if(s.ok&&o&&"GET"===(null===(i=t.method)||void 0===i?void 0:i.toUpperCase()))try{const t=s.clone(),n=yield t.json(),i=new URL(e).pathname,o=i.split("/").filter(Boolean);if(o.length>0)if(i.includes("recommendations"))yield g("recommendations",n);else if(i.includes("products")){const e=yield p(),t=o[o.length-1];e.cachedProducts[t]=n,yield g("cachedProducts",e.cachedProducts)}}catch(d){}return s}catch(d){o&&"GET"!==(null===(s=t.method)||void 0===s?void 0:s.toUpperCase())&&(yield y(e,t.method||"GET",t.body,t.headers))}if(o){const n=yield T(e,t,a);if(n)return n}throw new Error("Network request failed and no offline data available")}))}},86846:function(e,t,n){n.d(t,{CF:function(){return E},kd:function(){return b},hS:function(){return w}});var i=n(45639),s=n(33994),o=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};var r=n(16856),a=n(35137),c=(n(58044),n(93273),function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))});let d=null,l=!1;const u=[];let h=null;function m(){if(h)return h;const e={supported:!1,level:null,extensions:[],fullSupport:!1,fallbackOptions:{useCPUBackend:!1,useSimpleSegmentation:!1,useReducedPrecision:!1,useProgressiveLoading:!1}};try{const i=document.createElement("canvas");let s=i.getContext("webgl2");if(s?(e.supported=!0,e.level=2):(s=i.getContext("webgl",{failIfMajorPerformanceCaveat:!1})||i.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!1}),s&&(e.supported=!0,e.level=1)),e.supported&&s){const i=s.getSupportedExtensions()||[];e.extensions=i;const o=["OES_texture_float","WEBGL_color_buffer_float","OES_element_index_uint","OES_vertex_array_object","WEBGL_draw_buffers"].filter((e=>i.includes(e)));e.fullSupport=o.length>=3;try{const t=s.getExtension("WEBGL_debug_renderer_info");if(t){s.getParameter(t.UNMASKED_VENDOR_WEBGL);const n=s.getParameter(t.UNMASKED_RENDERER_WEBGL).toString().toLowerCase();(n.includes("swiftshader")||n.includes("software")||n.includes("intel"))&&(e.fallbackOptions.useCPUBackend=!0)}}catch(t){}try{const t=s.createShader(s.VERTEX_SHADER);t&&(s.shaderSource(t,"\n            attribute vec2 a_position;\n            void main() {\n              gl_Position = vec4(a_position, 0, 1);\n            }\n          "),s.compileShader(t),s.getShaderParameter(t,s.COMPILE_STATUS)||(e.fallbackOptions.useSimpleSegmentation=!0,e.fallbackOptions.useReducedPrecision=!0),s.deleteShader(t))}catch(n){e.fallbackOptions.useSimpleSegmentation=!0}e.fullSupport||(e.fallbackOptions.useReducedPrecision=!i.includes("OES_texture_float"),e.fallbackOptions.useSimpleSegmentation=!i.includes("WEBGL_color_buffer_float"),1===e.level&&o.length<2&&(e.fallbackOptions.useCPUBackend=!0),e.fallbackOptions.useProgressiveLoading=!0)}else e.fallbackOptions.useCPUBackend=!0,e.fallbackOptions.useSimpleSegmentation=!0,e.fallbackOptions.useReducedPrecision=!0,e.fallbackOptions.useProgressiveLoading=!0}catch(i){e.supported=!1,e.fallbackOptions.useCPUBackend=!0,e.fallbackOptions.useSimpleSegmentation=!0,e.fallbackOptions.useReducedPrecision=!0,e.fallbackOptions.useProgressiveLoading=!0}return h=e,e}function f(){const e=m();try{e.fallbackOptions.useCPUBackend?a.jh6("cpu").catch((e=>{})):a.jh6("webgl").catch((e=>{a.jh6("cpu").catch((e=>{}))})),e.fullSupport?(a._K2().set("WEBGL_FORCE_F16_TEXTURES",!0),a._K2().set("WEBGL_PACK",!0),a._K2().set("WEBGL_RENDER_FLOAT32_ENABLED",!0)):(a._K2().set("WEBGL_FORCE_F16_TEXTURES",e.fallbackOptions.useReducedPrecision),a._K2().set("WEBGL_PACK",!1),a._K2().set("WEBGL_RENDER_FLOAT32_ENABLED",!e.fallbackOptions.useReducedPrecision),a._K2().set("WEBGL_USE_SHAPES_UNIFORMS",!0),a._K2().set("WEBGL_PACK_DEPTHWISECONV",!1)),a.Gc4().then((()=>{})).catch((e=>{}))}catch(t){}}function g(){return c(this,void 0,void 0,(function*(){try{if(d)return d;if(l)return new Promise(((e,t)=>{u.push({resolve:e,reject:t})}));l=!0,f();const s=m(),o={architecture:"MobileNetV1",outputStride:s.fullSupport?16:32,multiplier:s.fullSupport?.75:.5,quantBytes:s.fallbackOptions.useReducedPrecision?1:2};if(s.fallbackOptions.useProgressiveLoading&&(yield a.Gc4(),s.fallbackOptions.useCPUBackend))try{yield a.jh6("cpu")}catch(e){}try{for(d=yield r.Hh(o);u.length>0;){const{resolve:e}=u.shift();e(d)}return d}catch(t){if(!s.fallbackOptions.useReducedPrecision)try{for(d=yield r.Hh({architecture:"MobileNetV1",outputStride:32,multiplier:.5,quantBytes:1});u.length>0;){const{resolve:e}=u.shift();e(d)}return d}catch(n){try{for(d=yield r.Hh({architecture:"MobileNetV1",outputStride:16,multiplier:.5,quantBytes:1});u.length>0;){const{resolve:e}=u.shift();e(d)}return d}catch(i){for(;u.length>0;){const{reject:e}=u.shift();e(i)}throw i}}for(;u.length>0;){const{reject:e}=u.shift();e(t)}throw t}finally{l=!1}}catch(s){throw l=!1,d=null,s}}))}function p(e,t={}){return c(this,void 0,void 0,(function*(){try{if(!d)try{yield g()}catch(n){return"string"===typeof e?e:URL.createObjectURL(e)}if(!d)throw new Error("Failed to load BodyPix model");const r=yield function(e){return c(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>t(i),i.onerror=e=>n(e),i.src="string"===typeof e?e:URL.createObjectURL(e)}))}))}(e);let a;try{a=yield d.segmentPerson(r,Object.assign({flipHorizontal:!1,internalResolution:"high",segmentationThreshold:t.threshold||.7},t.bodyPixOptions||{}))}catch(i){try{a=yield d.segmentPerson(r,Object.assign({flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:t.threshold||.7},t.bodyPixOptions||{}))}catch(s){try{a=yield d.segmentPerson(r,Object.assign({flipHorizontal:!1,internalResolution:"low",segmentationThreshold:t.threshold||.7},t.bodyPixOptions||{}))}catch(o){throw o}}}return function(e,t,n,i){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const o=s.getContext("2d");if(!o)throw new Error("Could not get canvas context");o.drawImage(e,0,0);const r=o.getImageData(0,0,s.width,s.height),{data:a}=r;for(let c=0;c<a.length;c+=4){const e=c/4;s.width,Math.floor(e/s.width);if(t.data[e]){if(i){const e=y(i);a[c]=Math.round((a[c]+e.r)/2),a[c+1]=Math.round((a[c+1]+e.g)/2),a[c+2]=Math.round((a[c+2]+e.b)/2)}}else if("transparent"===n)a[c+3]=0;else{const e=y(n);a[c]=e.r,a[c+1]=e.g,a[c+2]=e.b,a[c+3]=255}}return o.putImageData(r,0,0),s.toDataURL("image/png")}(r,a,t.backgroundColor||"transparent",t.foregroundColor)}catch(r){const t=String(r).toLowerCase();return t.includes("webgl")||t.includes("shader")||t.includes("compilation"),"string"===typeof e?e:URL.createObjectURL(e)}}))}function y(e){if(!e||"transparent"===e)return{r:0,g:0,b:0};3===(e=e.replace(/^#/,"")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);const t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}var v=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const w=(e,t)=>v(void 0,void 0,void 0,(function*(){let n;try{const d=t.apiKey||s.c6;switch(t.method){case i._n.REMOVE_BG_API:if(!d)throw new Error("API key is required for Remove.bg API");const a=yield function(){return o(this,void 0,void 0,(function*(){const e=s.c6;if(!e)return!1;try{return(yield fetch("https://api.remove.bg/v1.0/account",{method:"GET",headers:{"X-Api-Key":e,Accept:"application/json"}})).ok}catch(t){return!1}}))}();if(!a)throw new Error("Remove.bg API is not available or key is invalid");const c="string"===typeof e?yield T(e,"image.png"):e;try{const e=yield function(e,t={}){var n,i;return o(this,void 0,void 0,(function*(){const o=t.apiKey||s.c6;if(!o)throw new Error("No API key provided for remove.bg");const r=new FormData;r.append("image_file",e),t.size&&r.append("size",t.size),r.append("crop",t.crop?"true":"false"),t.scale&&r.append("scale",t.scale),t.format&&r.append("format",t.format);const a=yield fetch("https://api.remove.bg/v1.0/removebg",{method:"POST",headers:{"X-Api-Key":o},body:r});if(!a.ok){let e=`Remove.bg API error (${a.status})`;try{const t=yield a.json();e=`${e}: ${(null===(i=null===(n=t.errors)||void 0===n?void 0:n[0])||void 0===i?void 0:i.title)||"Unknown error"}`}catch(d){e=`${e}: ${a.statusText}`}throw new Error(e)}const c=yield a.blob();return new Promise(((e,t)=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.onerror=t,n.readAsDataURL(c)}))}))}(c,{apiKey:d,size:I(t.quality)});n={success:!0,imageUrl:e,method:i._n.REMOVE_BG_API}}catch(r){throw r}break;case i._n.TENSORFLOW:let l;if(l="string"===typeof e?e:yield S(e),t.optimizeOptions){const{width:e,height:n,quality:i}=t.optimizeOptions,s=document.createElement("canvas"),o=s.getContext("2d");if(!o)throw new Error("Could not get canvas context for image optimization");const r=new Image;r.src=l,yield new Promise((e=>{r.onload=()=>e()}));let a=e||r.width,c=n||r.height;e&&!n?c=r.height/r.width*e:n&&!e&&(a=r.width/r.height*n),s.width=a,s.height=c,o.drawImage(r,0,0,a,c);const d="low"===i?.6:"medium"===i?.8:.95;l=s.toDataURL("image/jpeg",d)}n={success:!0,imageUrl:yield p(l,{threshold:.7}),method:i._n.TENSORFLOW};break;case i._n.MANUAL:n={success:!1,error:"Manual background removal not implemented",method:i._n.MANUAL};break;default:n={success:!1,error:`Unknown removal method: ${t.method}`,method:t.method}}if(!(null===n||void 0===n?void 0:n.success)&&t.fallbackToTensorflow&&t.method!==i._n.TENSORFLOW)try{if(!(yield E()))throw new Error("TensorFlow.js not supported in this browser");let s;s="string"===typeof e?e:yield S(e);const o=t.optimizeOptions||{width:600,height:600,quality:"low"},{width:r,height:a,quality:c}=o,d=document.createElement("canvas"),l=d.getContext("2d");if(!l)throw new Error("Could not get canvas context for image optimization");const u=new Image;u.src=s,yield new Promise((e=>{u.onload=()=>e()}));let h=r||u.width,m=a||u.height;r&&!a?m=u.height/u.width*r:a&&!r&&(h=u.width/u.height*a),d.width=h,d.height=m,l.drawImage(u,0,0,h,m);const f="low"===c?.5:"medium"===c?.7:.9;s=d.toDataURL("image/jpeg",f);n={success:!0,imageUrl:yield p(s,{threshold:.65}),method:i._n.TENSORFLOW}}catch(a){}if(t.extractBodyMeasurements&&(null===n||void 0===n?void 0:n.success)&&n.imageUrl)try{n.bodyMeasurements={approximateSize:"M",bodyShape:"rectangle"}}catch(c){}return n||{success:!1,error:"Background removal failed with all methods",method:t.method}}catch(d){return{success:!1,error:d instanceof Error?d.message:String(d),method:t.method}}})),I=e=>{switch(e){case"preview":return"preview";case"high":return"hd";case"full":return"medium";default:return"auto"}},S=e=>new Promise(((t,n)=>{const i=new FileReader;i.onload=e=>{var i;(null===(i=e.target)||void 0===i?void 0:i.result)?t(e.target.result):n(new Error("Failed to convert file to data URL"))},i.onerror=e=>n(e),i.readAsDataURL(e)})),T=(e,t)=>fetch(e).then((e=>e.blob())).then((n=>{const i=e.split(",")[0].split(":")[1].split(";")[0];return new File([n],t,{type:i})})),E=function(){return c(this,void 0,void 0,(function*(){try{if(!m().supported&&!a.goy("cpu"))return!1;f();try{a.tGX([1,2,3]).dispose(),yield a.Gc4();return!!a.jz4()}catch(e){return!1}}catch(t){return!1}}))},b=g},97524:function(e,t,n){n.d(t,{IM:function(){return o},f8:function(){return s}});var i=n(45639);const s=e=>{switch(e){case i.Nu.TOP:return i.GT.UPPER_BODY;case i.Nu.BOTTOM:return i.GT.LOWER_BODY;case i.Nu.DRESS:return i.GT.FULL_BODY;case i.Nu.OUTERWEAR:return i.GT.UPPER_BODY;case i.Nu.SHOES:return i.GT.FEET;case i.Nu.ACCESSORY:return i.GT.HEAD;default:return i.GT.FULL_BODY}},o=e=>{switch(e){case i.Nu.TOP:return 10;case i.Nu.BOTTOM:return 5;case i.Nu.DRESS:return 10;case i.Nu.OUTERWEAR:return 15;case i.Nu.SHOES:return 5;case i.Nu.ACCESSORY:return 20;default:return 10}}}}]);
//# sourceMappingURL=stylist-main-f2578e20.434a84f1efbe91d29836.js.map