"use strict";(self.webpackChunkStylistWidget=self.webpackChunkStylistWidget||[]).push([[5559],{85244:function(t,s,n){n.d(s,{Eq:function(){return d},J5:function(){return h},dY:function(){return E}});var i,a=n(9495),o=n(15841),c=n(96681),e=n(44813);!function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(i||(i={}));class h{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,s){}async onEpochEnd(t,s){}async onBatchBegin(t,s){}async onBatchEnd(t,s){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class r{constructor(t,s=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=s}append(t){this.callbacks.push(t)}setParams(t){for(const s of this.callbacks)s.setParams(t)}setModel(t){for(const s of this.callbacks)s.setModel(t)}async onEpochBegin(t,s){null==s&&(s={});for(const n of this.callbacks)await n.onEpochBegin(t,s)}async onEpochEnd(t,s){null==s&&(s={});for(const n of this.callbacks)await n.onEpochEnd(t,s)}async onBatchBegin(t,s){null==s&&(s={});for(const n of this.callbacks)await n.onBatchBegin(t,s)}async onBatchEnd(t,s){null==s&&(s={});for(const n of this.callbacks)await n.onBatchEnd(t,s)}async onTrainBegin(t){null==t&&(t={});for(const s of this.callbacks)await s.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const s of this.callbacks)await s.onTrainEnd(t)}}class l extends h{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,s){null==s&&(s={});const n=null==s.size?0:s.size;this.seen+=n;for(const i in s){const t=s[i];if("number"===typeof t)this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+t*n;else{let s;i in this.totals?s=this.totals[i]:this.totals[i]=0;const o=(0,a.tidy)((()=>(0,a.add)(this.totals[i],(0,a.mul)(t,n))));this.totals[i]=o,null!=s&&s.dispose()}}}async onEpochEnd(t,s){if(null!=s)for(const n of this.params.metrics)null!=this.totals[n]&&("number"===typeof this.totals[n]?s[n]=this.totals[n]/this.seen:(0,a.tidy)((()=>{const t=(0,a.mul)((0,a.div)(1,this.seen),this.totals[n]);s[n]=t,this.totals[n].dispose(),(0,a.keep)(s[n])})))}}class u extends h{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,s){null==s&&(s={}),this.epoch.push(t);for(const n in s)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(s[n])}async syncData(){const t=[],s=[],n=[];for(const a in this.history){const i=this.history[a];for(let o=0;o<i.length;++o)if("number"!==typeof i[o]){const c=i[o];t.push(c.data()),s.push(a),n.push(o)}}const i=await Promise.all(t);for(let a=0;a<i.length;++a){this.history[s[a]][n[a]].dispose(),this.history[s[a]][n[a]]=i[a][0]}}}class y extends h{constructor(t,s){if(super(),this.currentEpoch=0,this.yieldEvery=s||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");a.util.isNumber(this.yieldEvery)&&(this.maybeWait=e.sg(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,s,n){const i=[];null!=this.yield&&(await(0,c.I)(n),i.push(this.yield(t,s,n))),i.push((0,a.nextFrame)()),await Promise.all(i)}async onEpochBegin(t,s){this.currentEpoch=t,null!=this.epochBegin&&(await(0,c.I)(s),await this.epochBegin(t,s))}async onEpochEnd(t,s){const n=[];null!=this.epochEnd&&(await(0,c.I)(s),n.push(this.epochEnd(t,s))),"epoch"===this.yieldEvery&&n.push((0,a.nextFrame)()),await Promise.all(n)}async onBatchBegin(t,s){null!=this.batchBegin&&(await(0,c.I)(s),await this.batchBegin(t,s))}async onBatchEnd(t,s){const n=[];null!=this.batchEnd&&(await(0,c.I)(s),n.push(this.batchEnd(t,s))),"batch"===this.yieldEvery?n.push((0,a.nextFrame)()):a.util.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,s)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await(0,c.I)(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await(0,c.I)(t),await this.trainEnd(t))}}function d(t,s){if(null==t&&(t={}),t instanceof h)return[t];if(Array.isArray(t)&&t[0]instanceof h)return t;return e.st(t).map((t=>new y(t,s)))}class p{constructor(){}static registerCallbackConstructor(t,s){a.util.assert(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),p.checkForDuplicate(s),null==p.constructors[t]&&(p.constructors[t]=[]),p.constructors[t].push(s)}static checkForDuplicate(t){for(const s in p.constructors){p.constructors[+s].forEach((s=>{if(s===t)throw new o.Qp("Duplicate callback constructor.")}))}}static clear(){p.constructors={}}static createCallbacks(t){const s=[];for(const n in p.constructors){const i=+n;t>=i&&s.push(...p.constructors[i])}return s.map((t=>new t))}}function E(t,s,n,i,a,o,c,e,h){const y=new u,d=[new l,...p.createCallbacks(s)];null!=t&&d.push(...t),d.push(y);const E=new r(d);return E.setParams({epochs:n,initialEpoch:i,samples:a,steps:o,batchSize:c,verbose:s,doValidation:e,metrics:h}),{callbackList:E,history:y}}p.constructors={}}}]);
//# sourceMappingURL=stylist-vendors-26e45b2b.59faeb717c7568fe2e3e.js.map