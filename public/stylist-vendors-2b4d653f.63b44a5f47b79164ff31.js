"use strict";(self.webpackChunkStylistWidget=self.webpackChunkStylistWidget||[]).push([[5309],{17890:function(e,t,n){n.r(t),n.d(t,{CompositeArrayBuffer:function(){return u.D},browserFiles:function(){return r.Y},browserHTTPRequest:function(){return o.aO},concatenateArrayBuffers:function(){return i.AQ},copyModel:function(){return c.xk},decodeWeights:function(){return i.CY},decodeWeightsStream:function(){return i.s5},encodeWeights:function(){return i.aG},fromMemory:function(){return s.aF},fromMemorySync:function(){return s.Ll},getLoadHandlers:function(){return a.C9},getModelArtifactsForJSON:function(){return i.Ej},getModelArtifactsForJSONSync:function(){return i.Rl},getModelArtifactsInfoForJSON:function(){return i.oR},getSaveHandlers:function(){return a.x3},getWeightSpecs:function(){return i.Xf},http:function(){return o.LV},isHTTPScheme:function(){return o.wO},listModels:function(){return c.D},loadWeights:function(){return l.Ic},moveModel:function(){return c.Vo},registerLoadRouter:function(){return a.R4},registerSaveRouter:function(){return a.Yd},removeModel:function(){return c.az},weightsLoaderFactory:function(){return l.j$},withSaveHandler:function(){return s.gF},withSaveHandlerSync:function(){return s.TM}});n(30522),n(76745);var r=n(4908),o=n(47894),i=n(77084),s=n(9250),a=n(46669),l=n(66519),u=n(56734),c=n(66235)},30522:function(e,t,n){n.d(t,{lQ:function(){return h},mn:function(){return d}});n(66652);var r=n(46574),o=n(77084),i=n(46669),s=n(56734);const a="tensorflowjs",l="models_store",u="model_info_store";function c(){if(!(0,r._K)().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function f(e){const t=e.result;t.createObjectStore(l,{keyPath:"modelPath"}),t.createObjectStore(u,{keyPath:"modelPath"})}class d{constructor(e){if(this.indexedDB=c(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const r=this.indexedDB.open(a,1);r.onupgradeneeded=()=>f(r),r.onsuccess=()=>{const i=r.result;if(null==t){const t=i.transaction(l,"readonly"),r=t.objectStore(l).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(i.close(),n(r.error)),t.oncomplete=()=>i.close()}else{t.weightData=s.D.join(t.weightData);const r=(0,o.oR)(t),c=i.transaction(u,"readwrite");let f,d,y=c.objectStore(u);try{f=y.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(a){return n(a)}f.onsuccess=()=>{d=i.transaction(l,"readwrite");const o=d.objectStore(l);let s;try{s=o.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r})}catch(a){return n(a)}s.onsuccess=()=>e({modelArtifactsInfo:r}),s.onerror=e=>{y=c.objectStore(u);const t=y.delete(this.modelPath);t.onsuccess=()=>(i.close(),n(s.error)),t.onerror=e=>(i.close(),n(s.error))}},f.onerror=e=>(i.close(),n(f.error)),c.oncomplete=()=>{null==d?i.close():d.oncomplete=()=>i.close()}}},r.onerror=e=>n(r.error)}))}}d.URL_SCHEME="indexeddb://";const y=e=>{return(0,r._K)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(d.URL_SCHEME)?(t=e.slice(d.URL_SCHEME.length),new d(t)):null;var t};i.bM.registerSaveRouter(y),i.bM.registerLoadRouter(y);class h{constructor(){this.indexedDB=c()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open(a,1);n.onupgradeneeded=()=>f(n),n.onsuccess=()=>{const r=n.result,o=r.transaction(u,"readonly"),i=o.objectStore(u).getAll();i.onsuccess=()=>{const t={};for(const e of i.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},i.onerror=e=>(r.close(),t(i.error)),o.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){var t;return e=(t=e).startsWith(d.URL_SCHEME)?t.slice(d.URL_SCHEME.length):t,new Promise(((t,n)=>{const r=this.indexedDB.open(a,1);r.onupgradeneeded=()=>f(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(u,"readwrite"),s=i.objectStore(u),a=s.get(e);let c;a.onsuccess=()=>{if(null==a.result)return o.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const r=s.delete(e),i=()=>{c=o.transaction(l,"readwrite");const r=c.objectStore(l).delete(e);r.onsuccess=()=>t(a.result.modelArtifactsInfo),r.onerror=e=>n(a.error)};r.onsuccess=i,r.onerror=e=>(i(),o.close(),n(a.error))}},a.onerror=e=>(o.close(),n(a.error)),i.oncomplete=()=>{null==c?o.close():c.oncomplete=()=>o.close()}},r.onerror=e=>n(r.error)}))}}},77084:function(e,t,n){n.d(t,{AQ:function(){return D},CY:function(){return y},Ej:function(){return z},P8:function(){return U},Rl:function(){return I},Xf:function(){return v},aG:function(){return d},jf:function(){return E},l3:function(){return B},oR:function(){return P},s5:function(){return m},zV:function(){return M}});var r=n(37148),o=n(74027),i=n(45119),s=n(15685),a=n(56734),l=n(35287),u=n(46574),c=n(48287).hp;const f=4;async function d(e,t){const n=[],r=[],o=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);for(let i=0;i<o.length;++i){const s=o[i],a=Array.isArray(e)?e[i].tensor:e[s];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${s}': ${a.dtype}`);const l={name:s,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const e=new Promise((async e=>{const t=await a.bytes(),n=t.reduce(((e,t)=>e+t.length),0)+f*t.length,r=new Uint8Array(n);let o=0;for(let i=0;i<t.length;i++){const e=t[i],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,o),o+=f,r.set(e,o),o+=e.length}e(r)}));r.push(e)}else r.push(a.data());null!=t&&(l.group=t),n.push(l)}return{data:b(await Promise.all(r)),specs:n}}function y(e,t){const n=new a.D(e),r={};let o=0;for(const i of t){const e=h(i,((e,t)=>n.slice(o+e,o+t)));r[i.name]=p(i,n.slice(o,o+e)),o+=e}return r}function h(e,t){const n=(0,i.Ze)(e.shape);let r;if("quantization"in e){const t=e.quantization;r=s.i[t.dtype]}else{if("string"===e.dtype){let e=0;for(let r=0;r<n;r++)e+=f+new Uint32Array(t(e,e+f))[0];return e}r=s.i[e.dtype]}return n*r}async function g(e,t){const n=(0,i.Ze)(e.shape);let r;if("quantization"in e){const t=e.quantization;r=s.i[t.dtype]}else{if("string"===e.dtype){let e=0;for(let r=0;r<n;r++)e+=f+new Uint32Array(await t(e,e+f))[0];return e}r=s.i[e.dtype]}return n*r}function p(e,t){const n=e.name,a=e.dtype,l=e.shape,u=(0,i.Ze)(l);let c,d=0;if("quantization"in e){const r=e.quantization;if("uint8"===r.dtype||"uint16"===r.dtype){if(!("min"in r)||!("scale"in r))throw new Error(`Weight ${e.name} with quantization ${r.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==r.dtype)throw new Error(`Weight ${e.name} has unknown quantization dtype ${r.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==a)throw new Error(`Weight ${e.name} is quantized with ${r.dtype} which only supports weights of type float32 not ${a}.`)}const o=s.i[r.dtype],i="uint8"===r.dtype?new Uint8Array(t):new Uint16Array(t);if("float32"===a)if("uint8"===r.dtype||"uint16"===r.dtype){c=new Float32Array(i.length);for(let e=0;e<i.length;e++){const t=i[e];c[e]=t*r.scale+r.min}}else{if("float16"!==r.dtype)throw new Error(`Unsupported quantization type ${r.dtype} for weight type float32.`);{const e=function(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0===(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){const o=r[s],a=e[n[o>>10]+(1023&o)]+t[o>>10];i[s]=a}return new Float32Array(o)}}();c=e(i)}}else{if("int32"!==a)throw new Error(`Unsupported dtype in weight '${n}': ${a}`);if("uint8"!==r.dtype&&"uint16"!==r.dtype)throw new Error(`Unsupported quantization type ${r.dtype} for weight type int32.`);c=new Int32Array(i.length);for(let e=0;e<i.length;e++){const t=i[e];c[e]=Math.round(t*r.scale+r.min)}}d+=u*o}else if("string"===a){const n=(0,i.Ze)(e.shape);c=[];for(let e=0;e<n;e++){const e=new Uint32Array(t.slice(d,d+f))[0];d+=f;const n=new Uint8Array(t.slice(d,d+e));c.push(n),d+=e}}else{const e=s.i[a];if("float32"===a)c=new Float32Array(t);else if("int32"===a)c=new Int32Array(t);else{if("bool"!==a){if("complex64"===a){c=new Float32Array(t);const e=new Float32Array(c.length/2),n=new Float32Array(c.length/2);for(let t=0;t<e.length;t++)e[t]=c[2*t],n[t]=c[2*t+1];const i=(0,o.O)(e,l,"float32"),s=(0,o.O)(n,l,"float32"),a=(0,r.f)(i,s);return i.dispose(),s.dispose(),a}throw new Error(`Unsupported dtype in weight '${n}': ${a}`)}c=new Uint8Array(t)}d+=u*e}return(0,o.O)(c,l,a)}async function w(e,t,n){let r=new Uint8Array(t);for(;r.byteLength<n;){const{done:t,value:o}=await e.read();if(t&&null==o){const e=n-r.byteLength;throw new Error(`Reader is done but ${e} bytes are still expected`)}const i=new Uint8Array(r.length+o.byteLength);i.set(r,0),i.set(new Uint8Array(o),r.length),r=i}return r.buffer}async function m(e,t){const n={},r=e.getReader();let o=new ArrayBuffer(0);for(const s of t){const e=await g(s,(async(e,t)=>(o=await w(r,o,t),o.slice(e,t))));o=await w(r,o,e);const t=o.slice(0,e);o=o.slice(e);const a=p(s,t);if(n[s.name]=a,"webgpu"===(0,l.jz)()){const e=(0,l.Hs)();"uploadToGPU"in e&&(0,i.Ze)(a.shape)>=(0,u._K)().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&e.uploadToGPU(a.dataId)}}return n}function b(e){if(null===e)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach((e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${e.constructor.name}`)}));const r=new Uint8Array(t);let o=0;return n.forEach((e=>{r.set(new Uint8Array(e.buffer),o),o+=e.byteLength})),r.buffer}const A="undefined"!==typeof c&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function S(e){return A?c.byteLength(e,"utf8"):new Blob([e]).size}function B(e){if(A)return c.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function E(e){if(A){const t=c.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function D(e){return a.D.join(e)}function U(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function M(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function I(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}async function z(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),I(e,n,r)}function P(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:S(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:S(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new a.D(e.weightData).byteLength}}function v(e){const t=[];for(const n of e)t.push(...n.weights);return t}}}]);
//# sourceMappingURL=stylist-vendors-2b4d653f.63b44a5f47b79164ff31.js.map