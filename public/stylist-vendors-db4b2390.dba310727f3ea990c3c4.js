"use strict";(self.webpackChunkStylistWidget=self.webpackChunkStylistWidget||[]).push([[3855],{16856:function(t,e,n){n.d(e,{Hh:function(){return wt}});var r=n(9495),o=n(65576),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function u(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function f(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function d(t){var e=t.shape[2],n=(0,r.argMax)(t,2),o=(0,r.reshape)(n,[-1]);return(0,r.oneHot)(o,e)}function l(t,e){return(0,r.tidy)((function(){return(0,r.cast)((0,r.greater)(t,(0,r.scalar)(e)),"int32")}))}function c(t,e){var n=e.shape,o=n[0],i=n[1],s=n[2];return(0,r.tidy)((function(){var n=d(e),a=(0,r.expandDims)((0,r.range)(0,s,1,"int32"),1),u=(0,r.cast)((0,r.matMul)(n,a),"int32"),f=(0,r.reshape)(u,[o,i]),l=(0,r.add)(f,(0,r.scalar)(1,"int32"));return(0,r.sub)(function(t,e){return(0,r.mul)(t,e)}(l,t),(0,r.scalar)(1,"int32"))}))}function p(t){var e=t.shape,n=e[0],o=e[1],i=e[2];return(0,r.tidy)((function(){var e=d(t),s=(0,r.expandDims)((0,r.range)(0,i,1,"int32"),1),a=(0,r.cast)((0,r.matMul)(e,s),"int32");return(0,r.reshape)(a,[n,o])}))}var h=function(){function t(t,e){this.model=t,this.outputStride=e;var n=this.model.inputs[0].shape;r.util.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}))}return t.prototype.predict=function(t){var e=this;return(0,r.tidy)((function(){var n=e.preprocessInput((0,r.cast)(t,"float32")),o=(0,r.expandDims)(n,0),i=e.model.predict(o).map((function(t){return(0,r.squeeze)(t,[0])})),s=e.nameOutputResults(i);return{heatmapScores:(0,r.sigmoid)(s.heatmap),offsets:s.offsets,displacementFwd:s.displacementFwd,displacementBwd:s.displacementBwd,segmentation:s.segmentation,partHeatmaps:s.partHeatmaps,longOffsets:s.longOffsets,partOffsets:s.partOffsets}}))},t.prototype.dispose=function(){this.model.dispose()},t}(),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.preprocessInput=function(t){return(0,r.tidy)((function(){return(0,r.sub)((0,r.div)(t,127.5),1)}))},e.prototype.nameOutputResults=function(t){return{offsets:t[0],segmentation:t[1],partHeatmaps:t[2],longOffsets:t[3],heatmap:t[4],displacementFwd:t[5],displacementBwd:t[6],partOffsets:t[7]}},e}(h),g=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],v=g.length,w=g.reduce((function(t,e,n){return t[e]=n,t}),{});[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(t){var e=t[0],n=t[1];return[w[e],w[n]]}));function y(t,e,n){var r=t[0],o=t[1],i=e[0],s=e[1],a=n.top,u=n.bottom;return[s/(n.left+n.right+o),i/(a+u+r)]}function b(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+v)}}function S(t,e,n){var r=b(t.heatmapY,t.heatmapX,t.id,n),o=r.y,i=r.x;return{x:t.heatmapX*e+i,y:t.heatmapY*e+o}}function x(t,e,n){return t<e?e:t>n?n:t}function O(t,e){return{x:t.x+e.x,y:t.y+e.y}}function E(t,e,n){void 0===n&&(n=.3);for(var r=0,o=0,i=0;i<t.length;i++)e.keypoints[i].score>n&&(o+=1,r+=Math.pow(t[i].x-e.keypoints[i].position.x,2)+Math.pow(t[i].y-e.keypoints[i].position.y,2));return 0===o?r=1/0:r/=o,r}function M(t,e,n,r,o,i,s){for(var a=s[0],u=s[1],f=n(t),d=f.y*r+f.x,l=o[v*(2*d)+e],c=o[v*(2*d+1)+e],p=t.y+l,h=t.x+c,m=0;m<i;m++){p=Math.min(p,a-1);var g=n({x:h=Math.min(h,u-1),y:p}),w=g.y*r+g.x;p+=l=o[v*(2*w)+e],h+=c=o[v*(2*w+1)+e]}return{x:h,y:p}}function R(t,e,n,r,o,i,s,a,u,f){for(var d=o[0],l=o[1],c=i[0],p=i[1],h=a[0],m=a[1],g=[],v=function(t){return function(t,e,n,r){var o=e[0],i=e[1],s=n[0],a=n[1],u=Math.round(((o+t.y+1)*a-1)/r);return{x:Math.round(((i+t.x+1)*s-1)/r),y:u}}(t,[d,l],[c,p],u)},w=0;w<r;w++){var y=M(t,w,v,s,e,f,[h,m]);g.push(y)}for(var b=-1,S=1/0,x=0;x<n.length;x++){var O=E(g,n[x]);O<S&&(b=x,S=O)}return b}function H(t,e){var n=t[0],r=t[1];return[Math.round((r-1)/e+1),Math.round((n-1)/e+1)]}function k(t,e,n,o,i,s,a,u,f,d,l){for(var c=a[0],p=a[1],h=t.shape,m=h[0],g=h[1],w=e.shape.slice(0,2),b=w[0],S=w[1],x=(0,r.reshape)(e,[b,S,2,v]),O=new Float32Array(l*v*3).fill(0),E=0;E<n.length;E++)for(var M=E*v*3,R=n[E],H=0;H<v;H++){var k=R.keypoints[H],P=M+3*H;O[P]=k.score,O[P+1]=k.position.y,O[P+2]=k.position.x}var F=y([o,i],[c,p],u),T=F[0],B=F[1],I=(0,r.tensor)(O,[l,v,3]),A=u.top,D=u.left,L={variableNames:["segmentation","longOffsets","poses"],outputShape:[m,g],userCode:"\n    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {\n      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));\n    }\n\n    float convertToPositionInOutputFloat(\n        int pos, int pad, float scale, int stride) {\n      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);\n    }\n\n    float dist(float x1, float y1, float x2, float y2) {\n      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);\n    }\n\n    float sampleLongOffsets(float h, float w, int d, int k) {\n      float fh = fract(h);\n      float fw = fract(w);\n      int clH = int(ceil(h));\n      int clW = int(ceil(w));\n      int flH = int(floor(h));\n      int flW = int(floor(w));\n      float o11 = getLongOffsets(flH, flW, d, k);\n      float o12 = getLongOffsets(flH, clW, d, k);\n      float o21 = getLongOffsets(clH, flW, d, k);\n      float o22 = getLongOffsets(clH, clW, d, k);\n      float o1 = mix(o11, o12, fw);\n      float o2 = mix(o21, o22, fw);\n      return mix(o1, o2, fh);\n    }\n\n    int findNearestPose(int h, int w) {\n      float prob = getSegmentation(h, w);\n      if (prob < 1.0) {\n        return -1;\n      }\n\n      // Done(Tyler): convert from output space h/w to strided space.\n      float stridedH = convertToPositionInOutputFloat(\n        h, "+A+", "+B+", "+s+");\n      float stridedW = convertToPositionInOutputFloat(\n        w, "+D+", "+T+", "+s+");\n\n      float minDist = 1000000.0;\n      int iMin = -1;\n      for (int i = 0; i < "+l+"; i++) {\n        float curDistSum = 0.0;\n        int numKpt = 0;\n        for (int k = 0; k < "+v+"; k++) {\n          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);\n          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);\n\n          float y = float(h) + dy;\n          float x = float(w) + dx;\n\n          for (int s = 0; s < "+f+"; s++) {\n            int yRounded = round(min(y, float("+(o-1)+")));\n            int xRounded = round(min(x, float("+(i-1)+")));\n\n            float yStrided = convertToPositionInOutputFloat(\n              yRounded, "+A+", "+B+", "+s+");\n            float xStrided = convertToPositionInOutputFloat(\n              xRounded, "+D+", "+T+", "+s+");\n\n            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);\n            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);\n\n            y = y + dy;\n            x = x + dx;\n          }\n\n          float poseScore = getPoses(i, k, 0);\n          float poseY = getPoses(i, k, 1);\n          float poseX = getPoses(i, k, 2);\n          if (poseScore > "+d+") {\n            numKpt = numKpt + 1;\n            curDistSum = curDistSum + dist(x, y, poseX, poseY);\n          }\n        }\n        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {\n          minDist = curDistSum / float(numKpt);\n          iMin = i;\n        }\n      }\n      return iMin;\n    }\n\n    void main() {\n        ivec2 coords = getOutputCoords();\n        int nearestPose = findNearestPose(coords[0], coords[1]);\n        setOutput(float(nearestPose));\n      }\n  "};return(0,r.backend)().compileAndRun(L,[t,x,I])}function P(){return"webgl"===(0,r.getBackend)()}function F(t,e,n,o,i,s,a,d,l,c,p,h){var m=a[0],g=a[1];return void 0===l&&(l=.2),void 0===c&&(c=8),void 0===p&&(p=.3),void 0===h&&(h=10),u(this,void 0,void 0,(function(){var a,u,v,w,b;return f(this,(function(f){switch(f.label){case 0:return a=n.filter((function(t){return t.score>=l})),P()?(v=(0,r.tidy)((function(){var n=k(t,e,a,o,i,s,[m,g],d,c,p,h),u=(0,r.engine)().makeTensorFromDataId(n.dataId,n.shape,n.dtype);return a.map((function(t,e){return function(t,e){return(0,r.tidy)((function(){return(0,r.cast)((0,r.equal)(t,(0,r.scalar)(e)),"int32")}))}(u,e)}))})),[4,Promise.all(v.map((function(t){return t.data()})))]):[3,2];case 1:return u=f.sent(),v.forEach((function(t){return t.dispose()})),[3,5];case 2:return[4,t.data()];case 3:return w=f.sent(),[4,e.data()];case 4:b=f.sent(),u=function(t,e,n,r,o,i,s,a,u,f){var d=s[0],l=s[1];void 0===f&&(f=5);for(var c=n.map((function(t){return new Uint8Array(r*o).fill(0)})),p=a.top,h=a.left,m=y([r,o],[d,l],a),g=m[0],v=m[1],w=H([d,l],i)[0],b=0;b<r;b+=1)for(var S=0;S<o;S+=1){var x=b*o+S;if(1===t[x]){var O=R({x:S,y:b},e,n,f,[p,h],[g,v],w,[r,o],i,u);O>=0&&(c[O][x]=1)}}return c}(w,b,a,o,i,s,[m,g],d,c),f.label=5;case 5:return[2,u.map((function(t,e){return{data:t,pose:a[e],width:i,height:o}}))]}}))}))}function T(t,e,n,o,i,s,a,d,l,c,p,h,m){var g=d[0],v=d[1];return void 0===c&&(c=.2),void 0===p&&(p=8),void 0===h&&(h=.3),void 0===m&&(m=10),u(this,void 0,void 0,(function(){var u,d,w,b,S,x;return f(this,(function(f){switch(f.label){case 0:return u=o.filter((function(t){return t.score>=c})),P()?(w=(0,r.tidy)((function(){var o=k(t,e,u,i,s,a,[g,v],l,p,h,m),f=(0,r.engine)().makeTensorFromDataId(o.dataId,o.shape,o.dtype);return u.map((function(t,e){return function(t,e,n){return(0,r.tidy)((function(){return(0,r.sub)((0,r.mul)((0,r.cast)((0,r.equal)(t,(0,r.scalar)(n)),"int32"),(0,r.add)(e,1)),1)}))}(f,n,e)}))})),[4,Promise.all(w.map((function(t){return t.data()})))]):[3,2];case 1:return d=f.sent(),w.forEach((function(t){return t.dispose()})),[3,6];case 2:return[4,t.data()];case 3:return b=f.sent(),[4,e.data()];case 4:return S=f.sent(),[4,n.data()];case 5:x=f.sent(),d=function(t,e,n,r,o,i,s,a,u,f,d){var l=a[0],c=a[1];void 0===d&&(d=5);for(var p=r.map((function(t){return new Int32Array(o*i).fill(-1)})),h=u.top,m=u.left,g=y([o,i],[l,c],u),v=g[0],w=g[1],b=H([l,c],s)[0],S=0;S<o;S+=1)for(var x=0;x<i;x+=1){var O=S*i+x;if(1===t[O]){var E=R({x:x,y:S},e,r,d,[h,m],[v,w],b,[o,i],s,f);E>=0&&(p[E][O]=n[O])}}return p}(b,S,x,u,i,s,a,[g,v],l,p),f.label=6;case 6:return[2,d.map((function(t,e){return{pose:u[e],data:t,height:i,width:s}}))]}}))}))}function B(t){return Math.floor(t/2)}var I=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(B(t),t);)this.exchange(t,B(t)),t=B(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function A(t,e,n,r,o,i){for(var s=i.shape,a=s[0],u=s[1],f=!0,d=Math.max(n-o,0),l=Math.min(n+o+1,a),c=d;c<l;++c){for(var p=Math.max(r-o,0),h=Math.min(r+o+1,u),m=p;m<h;++m)if(i.get(c,m,t)>e){f=!1;break}if(!f)break}return f}var D=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map((function(t){var e=t[0],n=t[1];return[w[e],w[n]]})),L=D.map((function(t){return t[1]})),W=D.map((function(t){return t[0]}));function q(t,e,n,r){return{y:x(Math.round(t.y/e),0,n-1),x:x(Math.round(t.x/e),0,r-1)}}function K(t,e,n,r,o,i,s,a){void 0===a&&(a=2);for(var u=r.shape,f=u[0],d=u[1],l=function(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}(t,q(e.position,i,f,d),s),c=O(e.position,l),p=0;p<a;p++){var h=q(c,i,f,d),m=b(h.y,h.x,n,o);c=O({x:h.x*i,y:h.y*i},{x:m.x,y:m.y})}var v=q(c,i,f,d),w=r.get(v.y,v.x,n);return{position:c,part:g[n],score:w}}function z(t,e,n,r,o,i){var s=e.shape[2],a=L.length,u=new Array(s),f=t.part,d=t.score,l=S(f,r,n);u[f.id]={score:d,part:g[f.id],position:l};for(var c=a-1;c>=0;--c){var p=L[c],h=W[c];u[p]&&!u[h]&&(u[h]=K(c,u[p],h,e,n,r,i))}for(c=0;c<a;++c)p=W[c],h=L[c],u[p]&&!u[h]&&(u[h]=K(c,u[p],h,e,n,r,o));return u}function j(t,e,n,r){var o=n.x,i=n.y;return t.some((function(t){var n=t.keypoints[r].position;return function(t,e,n,r){var o=n-t,i=r-e;return o*o+i*i}(i,o,n.y,n.x)<=e}))}function N(t,e,n){return n.reduce((function(n,r,o){var i=r.position,s=r.score;return j(t,e,i,o)||(n+=s),n}),0)/n.length}function V(t,e,n,r,o,i,s,a){void 0===s&&(s=.5),void 0===a&&(a=20);for(var u=[],f=function(t,e,n){for(var r=n.shape,o=r[0],i=r[1],s=r[2],a=new I(o*i*s,(function(t){return t.score})),u=0;u<o;++u)for(var f=0;f<i;++f)for(var d=0;d<s;++d){var l=n.get(u,f,d);l<t||A(d,l,u,f,e,n)&&a.enqueue({score:l,part:{heatmapY:u,heatmapX:f,id:d}})}return a}(s,1,t),d=a*a;u.length<i&&!f.empty();){var l=f.dequeue();if(!j(u,d,S(l.part,o,e),l.part.id)){var c=z(l,t,e,o,n,r),p=N(u,d,c);u.push({keypoints:c,score:p})}}return u}var Q,C=[-123.15,-115.9,-103.06],_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.preprocessInput=function(t){return(0,r.add)(t,C)},e.prototype.nameOutputResults=function(t){var e=t[0],n=t[1],r=t[2],o=t[3],i=t[4],s=t[5];return{offsets:i,segmentation:t[6],partHeatmaps:s,longOffsets:o,heatmap:r,displacementFwd:n,displacementBwd:e,partOffsets:t[7]}},e}(h),X="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",Y="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function U(t){if("undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)return function(t){if("offsetHeight"in t&&0!==t.offsetHeight&&"offsetWidth"in t&&0!==t.offsetWidth)return[t.offsetHeight,t.offsetWidth];if(null!=t.height&&null!=t.width)return[t.height,t.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(t);if("undefined"!=typeof ImageData&&t instanceof ImageData)return[t.height,t.width];if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)return function(t){return t.hasAttribute("height")&&t.hasAttribute("width")?[t.height,t.width]:[t.videoHeight,t.videoWidth]}(t);if(t instanceof r.Tensor)return[t.shape[0],t.shape[1]];throw new Error("error: Unknown input type: "+t+".")}function G(t,e){return function(t,e){return(t-1)%e==0}(t,e)?t:Math.floor(t/e)*e+1}var J={low:"low",medium:"medium",high:"high",full:"full"},Z=((Q={})[J.low]=.25,Q[J.medium]=.5,Q[J.high]=.75,Q[J.full]=1,Q);function $(t,e,n){var o=n[0],i=n[1],s=function(t){if("string"==typeof t){var e=Z[t];return r.util.assert("number"==typeof e,(function(){return"string value of inputResolution must be one of "+Object.values(J).join(",")+" but was "+t+"."})),e}return r.util.assert("number"==typeof t&&t<=2&&t>=.1,(function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+t})),t}(t);return[G(o*s,e),G(i*s,e)]}function tt(t,e,n,o,i){var s=e[0],a=e[1],u=n[0],f=n[1],d=o[0],l=d[0],c=d[1],p=o[1],h=p[0],m=p[1];return void 0===i&&(i=!1),(0,r.tidy)((function(){var e=r.image.resizeBilinear(t,[u,f],!0);return i&&(e=(0,r.sigmoid)(e)),function(t,e,n){var o=e[0],i=e[1],s=n[0],a=s[0],u=s[1],f=n[1],d=f[0],l=f[1];return(0,r.tidy)((function(){var e=(0,r.expandDims)(t);return(0,r.squeeze)(r.image.cropAndResize(e,[[a/(o+a+u-1),d/(i+d+l-1),(a+o-1)/(o+a+u-1),(d+i-1)/(i+d+l-1)]],[0],[o,i]),[0])}))}(e,[s,a],[[l,c],[h,m]])}))}function et(t,e){var n=e[0],o=e[1],i=U(t),s=i[0],a=i[1],u=o/n,f=[0,0,0,0],d=f[0],l=f[1],c=f[2],p=f[3];return a/s<u?(d=0,l=0,c=Math.round(.5*(u*s-a)),p=Math.round(.5*(u*s-a))):(d=Math.round(.5*(1/u*a-s)),l=Math.round(.5*(1/u*a-s)),c=0,p=0),{resized:(0,r.tidy)((function(){var e=function(t){return t instanceof r.Tensor?t:r.browser.fromPixels(t)}(t);return e=(0,r.pad3d)(e,[[d,l],[c,p],[0,0]]),r.image.resizeBilinear(e,[n,o])})),padding:{top:d,left:c,right:p,bottom:l}}}function nt(t){return u(this,void 0,void 0,(function(){return f(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function rt(t,e,n,r,o){var i=e[0],s=e[1],a=n[0],u=n[1],f=function(t,e,n,r,o){return void 0===r&&(r=0),void 0===o&&(o=0),1===n&&1===e&&0===r&&0===o?t:t.map((function(t){return function(t,e,n,r,o){return void 0===r&&(r=0),void 0===o&&(o=0),{score:t.score,keypoints:t.keypoints.map((function(t){var i=t.score,s=t.part,a=t.position;return{score:i,part:s,position:{x:a.x*n+o,y:a.y*e+r}}}))}}(t,e,n,r,o)}))}(t,(i+r.top+r.bottom)/a,(s+r.left+r.right)/u,-r.top,-r.left);return o?function(t,e){return e<=0?t:t.map((function(t){return function(t,e){return{score:t.score,keypoints:t.keypoints.map((function(t){var n=t.score,r=t.part,o=t.position;return{score:n,part:r,position:{x:e-1-o.x,y:o.y}}}))}}(t,e)}))}(f,s):f}var ot=!0,it=!1,st={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},at=["MobileNetV1","ResNet50"],ut={MobileNetV1:[8,16,32],ResNet50:[32,16]},ft={MobileNetV1:[.5,.75,1],ResNet50:[1]},dt=[1,2,4];var lt={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},ct={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function pt(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,o=t.nmsRadius;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(o<=0)throw new Error("Invalid nmsRadius "+o+".")}function ht(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,o=t.nmsRadius,i=t.minKeypointScore,s=t.refineSteps;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(o<=0)throw new Error("Invalid nmsRadius "+o+".");if(i<0||i>1)throw new Error("Invalid minKeypointScore "+i+".Should be in range [0.0, 1.0]");if(s<=0||s>20)throw new Error("Invalid refineSteps "+s+".Should be in range [1, 20]")}var mt=function(){function t(t){this.baseModel=t}return t.prototype.predictForPersonSegmentation=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForPersonSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,partHeatmapLogits:e.partHeatmaps,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,longOffsets:e.longOffsets,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd,partHeatmaps:e.partHeatmaps}},t.prototype.segmentPersonActivation=function(t,e,n){var o=this;void 0===n&&(n=.5);var i=U(t),s=i[0],a=i[1],u=$(e,this.baseModel.outputStride,[s,a]),f=et(t,u),d=f.resized,c=f.padding,p=(0,r.tidy)((function(){var t=o.predictForPersonSegmentation(d),e=t.segmentLogits,i=t.heatmapScores,u=t.offsets,f=t.displacementFwd,p=t.displacementBwd,h=d.shape,m=h[0],g=h[1],v=tt(e,[s,a],[m,g],[[c.top,c.bottom],[c.left,c.right]],ot);return{segmentation:l((0,r.squeeze)(v),n),heatmapScores:i,offsets:u,displacementFwd:f,displacementBwd:p}})),h=p.segmentation,m=p.heatmapScores,g=p.offsets,v=p.displacementFwd,w=p.displacementBwd;return d.dispose(),{segmentation:h,heatmapScores:m,offsets:g,displacementFwd:v,displacementBwd:w,padding:c,internalResolutionHeightAndWidth:u}},t.prototype.segmentPerson=function(t,e){return void 0===e&&(e=lt),u(this,void 0,void 0,(function(){var n,r,o,i,s,u,d,l,c,p,h,m,g,v,w,y,b,S;return f(this,(function(f){switch(f.label){case 0:return pt(e=a(a({},lt),e)),n=this.segmentPersonActivation(t,e.internalResolution,e.segmentationThreshold),r=n.segmentation,o=n.heatmapScores,i=n.offsets,s=n.displacementFwd,u=n.displacementBwd,d=n.padding,l=n.internalResolutionHeightAndWidth,c=r.shape,p=c[0],h=c[1],[4,r.data()];case 1:return m=f.sent(),r.dispose(),[4,nt([o,i,s,u])];case 2:return g=f.sent(),v=g[0],w=g[1],y=g[2],b=g[3],S=rt(S=V(v,w,y,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[p,h],l,d,it),o.dispose(),i.dispose(),s.dispose(),u.dispose(),[2,{height:p,width:h,data:m,allPoses:S}]}}))}))},t.prototype.segmentMultiPerson=function(t,e){return void 0===e&&(e=ct),u(this,void 0,void 0,(function(){var n,o,i,s,u,d,c,p,h,m,g,v,w,y,b,S,x,O,E,M,R,H=this;return f(this,(function(f){switch(f.label){case 0:return ht(e=a(a({},ct),e)),n=U(t),o=n[0],i=n[1],s=$(e.internalResolution,this.baseModel.outputStride,[o,i]),u=et(t,s),d=u.resized,c=u.padding,p=(0,r.tidy)((function(){var t,n=H.predictForMultiPersonInstanceSegmentationAndPart(d),a=n.segmentLogits,u=n.longOffsets,f=n.heatmapScores,p=n.offsets,h=n.displacementFwd,m=n.displacementBwd,g=tt(a,[o,i],s,[[c.top,c.bottom],[c.left,c.right]],ot);return t=u,{segmentation:l((0,r.squeeze)(g),e.segmentationThreshold),longOffsets:t,heatmapScoresRaw:f,offsetsRaw:p,displacementFwdRaw:h,displacementBwdRaw:m}})),h=p.segmentation,m=p.longOffsets,g=p.heatmapScoresRaw,v=p.offsetsRaw,w=p.displacementFwdRaw,y=p.displacementBwdRaw,[4,nt([g,v,w,y])];case 1:return b=f.sent(),S=b[0],x=b[1],O=b[2],E=b[3],M=rt(M=V(S,x,O,E,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[o,i],s,c,it),[4,F(h,m,M,o,i,this.baseModel.outputStride,s,c,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return R=f.sent(),d.dispose(),h.dispose(),m.dispose(),g.dispose(),v.dispose(),w.dispose(),y.dispose(),[2,R]}}))}))},t.prototype.segmentPersonPartsActivation=function(t,e,n){var o=this;void 0===n&&(n=.5);var i=U(t),s=i[0],a=i[1],u=$(e,this.baseModel.outputStride,[s,a]),f=et(t,u),d=f.resized,p=f.padding,h=(0,r.tidy)((function(){var t=o.predictForPersonSegmentationAndPart(d),e=t.segmentLogits,i=t.partHeatmapLogits,u=t.heatmapScores,f=t.offsets,h=t.displacementFwd,m=t.displacementBwd,g=d.shape,v=g[0],w=g[1],y=tt(e,[s,a],[v,w],[[p.top,p.bottom],[p.left,p.right]],ot),b=tt(i,[s,a],[v,w],[[p.top,p.bottom],[p.left,p.right]],ot);return{partSegmentation:c(l((0,r.squeeze)(y),n),b),heatmapScores:u,offsets:f,displacementFwd:h,displacementBwd:m}})),m=h.partSegmentation,g=h.heatmapScores,v=h.offsets,w=h.displacementFwd,y=h.displacementBwd;return d.dispose(),{partSegmentation:m,heatmapScores:g,offsets:v,displacementFwd:w,displacementBwd:y,padding:p,internalResolutionHeightAndWidth:u}},t.prototype.segmentPersonParts=function(t,e){return void 0===e&&(e=lt),u(this,void 0,void 0,(function(){var n,r,o,i,s,u,d,l,c,p,h,m,g,v,w,y,b,S;return f(this,(function(f){switch(f.label){case 0:return pt(e=a(a({},lt),e)),n=this.segmentPersonPartsActivation(t,e.internalResolution,e.segmentationThreshold),r=n.partSegmentation,o=n.heatmapScores,i=n.offsets,s=n.displacementFwd,u=n.displacementBwd,d=n.padding,l=n.internalResolutionHeightAndWidth,c=r.shape,p=c[0],h=c[1],[4,r.data()];case 1:return m=f.sent(),r.dispose(),[4,nt([o,i,s,u])];case 2:return g=f.sent(),v=g[0],w=g[1],y=g[2],b=g[3],S=rt(S=V(v,w,y,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[p,h],l,d,it),o.dispose(),i.dispose(),s.dispose(),u.dispose(),[2,{height:p,width:h,data:m,allPoses:S}]}}))}))},t.prototype.segmentMultiPersonParts=function(t,e){return void 0===e&&(e=ct),u(this,void 0,void 0,(function(){var n,o,i,s,u,d,c,h,m,g,v,w,y,b,S,x,O,E,M,R,H,k,P=this;return f(this,(function(f){switch(f.label){case 0:return ht(e=a(a({},ct),e)),n=U(t),o=n[0],i=n[1],s=$(e.internalResolution,this.baseModel.outputStride,[o,i]),u=et(t,s),d=u.resized,c=u.padding,h=(0,r.tidy)((function(){var t=P.predictForMultiPersonInstanceSegmentationAndPart(d),n=t.segmentLogits,a=t.longOffsets,u=t.heatmapScores,f=t.offsets,h=t.displacementFwd,m=t.displacementBwd,g=t.partHeatmaps,v=tt(n,[o,i],s,[[c.top,c.bottom],[c.left,c.right]],ot),w=tt(g,[o,i],s,[[c.top,c.bottom],[c.left,c.right]],ot),y=a;return{segmentation:l((0,r.squeeze)(v),e.segmentationThreshold),longOffsets:y,heatmapScoresRaw:u,offsetsRaw:f,displacementFwdRaw:h,displacementBwdRaw:m,partSegmentation:p(w)}})),m=h.segmentation,g=h.longOffsets,v=h.heatmapScoresRaw,w=h.offsetsRaw,y=h.displacementFwdRaw,b=h.displacementBwdRaw,S=h.partSegmentation,[4,nt([v,w,y,b])];case 1:return x=f.sent(),O=x[0],E=x[1],M=x[2],R=x[3],H=rt(H=V(O,E,M,R,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[o,i],s,c,it),[4,T(m,g,S,H,o,i,this.baseModel.outputStride,s,c,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return k=f.sent(),d.dispose(),m.dispose(),g.dispose(),v.dispose(),w.dispose(),y.dispose(),b.dispose(),S.dispose(),[2,k]}}))}))},t.prototype.dispose=function(){this.baseModel.dispose()},t}();function gt(t){return u(this,void 0,void 0,(function(){var e,n,i,s,a,u;return f(this,(function(f){switch(f.label){case 0:if(e=t.outputStride,n=t.quantBytes,i=t.multiplier,null==r)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return s=function(t,e,n){var r={1:"100",.75:"075",.5:"050"},o="model-stride"+t+".json";return 4===n?Y+"float/"+r[e]+"/"+o:Y+"quant"+n+"/"+r[e]+"/"+o}(e,i,n),[4,(0,o.ox)(t.modelUrl||s)];case 1:return a=f.sent(),u=new m(a,e),[2,new mt(u)]}}))}))}function vt(t){return u(this,void 0,void 0,(function(){var e,n,i,s,a;return f(this,(function(u){switch(u.label){case 0:if(e=t.outputStride,n=t.quantBytes,null==r)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return i=function(t,e){var n="model-stride"+t+".json";return 4===e?X+"float/"+n:X+"quant"+e+"/"+n}(e,n),[4,(0,o.ox)(t.modelUrl||i)];case 1:return s=u.sent(),a=new _(s,e),[2,new mt(a)]}}))}))}function wt(t){return void 0===t&&(t=st),u(this,void 0,void 0,(function(){return f(this,(function(e){return"ResNet50"===(t=function(t){if(null==(t=t||st).architecture&&(t.architecture="MobileNetV1"),at.indexOf(t.architecture)<0)throw new Error("Invalid architecture "+t.architecture+". Should be one of "+at);if(null==t.outputStride&&(t.outputStride=16),ut[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride "+t.outputStride+". Should be one of "+ut[t.architecture]+" for architecture "+t.architecture+".");if(null==t.multiplier&&(t.multiplier=1),ft[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier "+t.multiplier+". Should be one of "+ft[t.architecture]+" for architecture "+t.architecture+".");if(null==t.quantBytes&&(t.quantBytes=4),dt.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes "+t.quantBytes+". Should be one of "+dt+" for architecture "+t.architecture+".");return t}(t)).architecture?[2,vt(t)]:"MobileNetV1"===t.architecture?[2,gt(t)]:[2,null]}))}))}}}]);
//# sourceMappingURL=stylist-vendors-db4b2390.dba310727f3ea990c3c4.js.map