"use strict";(self.webpackChunkStylistWidget=self.webpackChunkStylistWidget||[]).push([[1418],{9250:function(e,t,n){n.d(t,{Ll:function(){return i},TM:function(){return c},aF:function(){return a},gF:function(){return l}});class o{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class r{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class s{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function a(e,t,n,o){return new s(i(...arguments))}function i(e,t,n,r){if(1===arguments.length){const t=null!=e.modelTopology||null!=e.weightSpecs;return new o(t?e:{modelTopology:e})}return new o({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function l(e){return new r(e)}function c(e){return new r(e)}},16121:function(e,t,n){n.d(t,{U:function(){return r}});var o=n(45119);function r(e,t,n,r){!function(e){(0,o.vA)(null!=e&&Array.isArray(e)&&e.length>0,(()=>"promises must be a none empty array"))}(e),function(e,t){(0,o.vA)(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${e}`)),(0,o.vA)(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${t}`)),(0,o.vA)(t>=e,(()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction ${t}`))}(n=null==n?0:n,r=null==r?1:r);let s=0;return Promise.all(e.map((o=>(o.then((o=>{const a=n+ ++s/e.length*(r-n);return t(a),o})),o))))}},46669:function(e,t,n){n.d(t,{C9:function(){return i},R4:function(){return s},Yd:function(){return r},bM:function(){return o},x3:function(){return a}});class o{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==o.instance&&(o.instance=new o),o.instance}static registerSaveRouter(e){o.getInstance().saveRouters.push(e)}static registerLoadRouter(e){o.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return o.getHandlers(e,"save")}static getLoadHandlers(e,t){return o.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?o.getInstance().loadRouters:o.getInstance().saveRouters).forEach((t=>{const o=t(e,n);null!==o&&r.push(o)})),r}}const r=e=>o.registerSaveRouter(e),s=e=>o.registerLoadRouter(e),a=e=>o.getSaveHandlers(e),i=(e,t)=>o.getLoadHandlers(e,t)},66235:function(e,t,n){n.d(t,{D:function(){return c},Vo:function(){return d},az:function(){return u},dy:function(){return a},xk:function(){return g}});var o=n(45119),r=n(46669);const s="://";class a{constructor(){this.managers={}}static getInstance(){return null==a.instance&&(a.instance=new a),a.instance}static registerManager(e,t){(0,o.vA)(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith(s)&&(e=e.slice(0,e.indexOf(s))),(0,o.vA)(e.length>0,(()=>"scheme must not be an empty string."));const n=a.getInstance();(0,o.vA)(null==n.managers[e],(()=>`A model store manager is already registered for scheme '${e}'.`)),n.managers[e]=t}static getManager(e){const t=a.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(a.getInstance().managers)}}function i(e){if(-1===e.indexOf(s))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${a.getSchemes().join(",")}`);return{scheme:e.split(s)[0],path:e.split(s)[1]}}async function l(e,t,n=!1){(0,o.vA)(e!==t,(()=>`Old path and new path are the same: '${e}'`));const s=r.bM.getLoadHandlers(e);(0,o.vA)(s.length>0,(()=>`Copying failed because no load handler is found for source URL ${e}.`)),(0,o.vA)(s.length<2,(()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${e}.`));const l=s[0],c=r.bM.getSaveHandlers(t);(0,o.vA)(c.length>0,(()=>`Copying failed because no save handler is found for destination URL ${t}.`)),(0,o.vA)(c.length<2,(()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${t}.`));const u=c[0],g=i(e).scheme,d=i(e).path,h=g===i(e).scheme,f=await l.load();n&&h&&await a.getManager(g).removeModel(d);const m=await u.save(f);return n&&!h&&await a.getManager(g).removeModel(d),m.modelArtifactsInfo}async function c(){const e=a.getSchemes(),t={};for(const n of e){const e=await a.getManager(n).listModels();for(const o in e){t[n+s+o]=e[o]}}return t}async function u(e){const t=i(e);return a.getManager(t.scheme).removeModel(t.path)}async function g(e,t){return l(e,t,!1)}async function d(e,t){return l(e,t,!0)}},76745:function(e,t,n){n.d(t,{Cd:function(){return v},ZT:function(){return p}});n(66652);var o=n(46574),r=n(45119),s=n(77084),a=n(56734),i=n(46669);const l="/",c="tensorflowjs_models",u="info",g="model_topology",d="weight_specs",h="weight_data",f="model_metadata";function m(e){return{info:[c,e,u].join(l),topology:[c,e,g].join(l),weightSpecs:[c,e,d].join(l),weightData:[c,e,h].join(l),modelMetadata:[c,e,f].join(l)}}function y(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function w(e){const t=e.split(l);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(l)}class p{constructor(e){if(!(0,o._K)().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=m(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),r=(0,s.oR)(e),i=a.D.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,(0,s.l3)(i));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:r}}catch(t){throw y(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==o)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=o;const r=this.LS.getItem(this.keys.modelMetadata);if(null!=r){const e=JSON.parse(r);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const a=this.LS.getItem(this.keys.weightData);if(null==a)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=(0,s.jf)(a),t}}p.URL_SCHEME="localstorage://";const S=e=>{return(0,o._K)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(p.URL_SCHEME)?(t=e.slice(p.URL_SCHEME.length),new p(t)):null;var t};i.bM.registerSaveRouter(S),i.bM.registerLoadRouter(S);class v{constructor(){(0,r.vA)((0,o._K)().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),(0,r.vA)("undefined"===typeof window||"undefined"!==typeof window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=c+l,n=l+u;for(let o=0;o<this.LS.length;++o){const r=this.LS.key(o);if(r.startsWith(t)&&r.endsWith(n)){e[w(r)]=JSON.parse(this.LS.getItem(r))}}return e}async removeModel(e){var t;const n=m(e=(t=e).startsWith(p.URL_SCHEME)?t.slice(p.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${e}'`);const o=JSON.parse(this.LS.getItem(n.info));return y(n),o}}}}]);
//# sourceMappingURL=stylist-vendors-e1a59295.4e58784ab0c3d0d420a7.js.map