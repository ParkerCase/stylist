"use strict";(self.webpackChunkStylistWidget=self.webpackChunkStylistWidget||[]).push([[3134],{22792:function(e,t,r){r.d(t,{Kz:function(){return s},Tb:function(){return f},Tw:function(){return a},ik:function(){return h},mB:function(){return l}});var n=r(9495),i=r(27575),o=r(88380);function s(e,t,r,s){const u=r.map(((e,r)=>{const n={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(n.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[r],shapeInfo:n}})),l=u.map((e=>e.shapeInfo)),f={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},h=i.yr(u,f,t),c=(0,o.yG)(e.gl,h),g=e.createProgram(c);return(0,n.env)().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:c,source:h,webGLProgram:g,inShapeInfos:l,outShapeInfo:f,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(g),Object.assign({program:t,fragmentShader:c,source:h,webGLProgram:g,inShapeInfos:l,outShapeInfo:f},a(e,t,g)))}function a(e,t,r){const i=[],o=[];let s,a,u,l=null,f=null;f=e.getUniformLocation(r,"NAN",!1),1===(0,n.env)().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(r,"INFINITY",!1));const h=!1;for(const n of t.variableNames){const o={name:n,uniform:e.getUniformLocation(r,n,h),offset:e.getUniformLocation(r,`offset${n}`,h)};t.enableShapeUniforms&&(o.shape=e.getUniformLocation(r,`${n}Shape`,h),o.texShape=e.getUniformLocation(r,`${n}TexShape`,h)),i.push(o)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(r,"outShape",h),u=e.getUniformLocation(r,"outShapeStrides",h),a=e.getUniformLocation(r,"outTexShape",h)),t.customUniforms)for(const n of t.customUniforms)o.push(e.getUniformLocation(r,n.name,h));return{variablesLocations:i,customUniformLocations:o,infLoc:l,nanLoc:f,outShapeLocation:s,outShapeStridesLocation:u,outTexShapeLocation:a}}function u(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,r)=>{const i=e.logicalShape,o=t[r],s=o.shape;if(!n.util.arraysEqual(i,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${s} must match`);if(e.isUniform&&o.isUniform)return;const a=e.texShape,u=o.isUniform?null:o.texData.texShape;if(!n.util.arraysEqual(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)}))}function l(e,t,r,o,s){t.program.enableShapeUniforms||(u(t.inShapeInfos,r),u([t.outShapeInfo],[o]));const a=o.texData.texture,l=o.texData.texShape;o.texData.isPacked?e.setOutputPackedMatrixTexture(a.texture,l[0],l[1]):e.setOutputMatrixTexture(a.texture,l[0],l[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===(0,n.env)().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<r.length;++u){const o=r[u],{uniform:s,offset:a,shape:l,texShape:f}=t.variablesLocations[u];if(l){const{uniformShape:r}=i.YE(t.program.packedInputs,o.shape,o.texData.texShape);switch(r.length){case 1:e.gl.uniform1iv(l,new Int32Array(r));break;case 2:e.gl.uniform2iv(l,new Int32Array(r));break;case 3:e.gl.uniform3iv(l,new Int32Array(r));break;case 4:e.gl.uniform4iv(l,new Int32Array(r))}}if(f&&e.gl.uniform2i(f,o.texData.texShape[0],o.texData.texShape[1]),null!=s)if(o.isUniform)if(n.util.sizeFromShape(o.shape)<2)e.gl.uniform1f(s,o.uniformValues[0]);else{let t=o.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(s,t)}else null!=o.texData.slice&&null!=a&&e.gl.uniform1i(a,o.texData.slice.flatOffset),e.setInputMatrixTexture(o.texData.texture.texture,s,u)}const f=t.outShapeLocation;if(f)switch(o.shape.length){case 1:e.gl.uniform1iv(f,new Int32Array(o.shape));break;case 2:e.gl.uniform2iv(f,new Int32Array(o.shape));break;case 3:e.gl.uniform3iv(f,new Int32Array(o.shape));break;case 4:e.gl.uniform4iv(f,new Int32Array(o.shape))}if(t.outShapeStridesLocation){const r=n.util.computeStrides(o.shape);switch(o.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(r));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(r));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(r))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,o.texData.texShape[0],o.texData.texShape[1]),t.program.customUniforms&&s)for(let n=0;n<t.program.customUniforms.length;++n){const r=t.program.customUniforms[n],i=t.customUniformLocations[n],o=s[n];if("float"===r.type)e.gl.uniform1fv(i,o);else if("vec2"===r.type)e.gl.uniform2fv(i,o);else if("vec3"===r.type)e.gl.uniform3fv(i,o);else if("vec4"===r.type)e.gl.uniform4fv(i,o);else if("int"===r.type)e.gl.uniform1iv(i,o);else if("ivec2"===r.type)e.gl.uniform2iv(i,o);else if("ivec3"===r.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==r.type)throw Error(`uniform type ${r.type} is not supported yet.`);e.gl.uniform4iv(i,o)}}e.executeProgram()}function f(e,t,r){let o="";t.concat(r).forEach((t=>{const s=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const a=t.texData.texShape,{useSqueezeShape:u,uniformShape:l,keptDims:f}=i.YE(e.packedInputs,t.shape,a);let h="",c="",g="";if(1===l.length&&e.packedInputs){const e=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];h=`${e[0]>1}_${e[1]>1}`}else if(2!==l.length||e.packedInputs){if(l.length>2&&!e.packedInputs){const e=n.util.computeStrides(l);g=`${e[0]===a[1]}_${e[e.length-1]===a[1]}`}}else c=`${l[0]>1}_${l[1]>1}`;const m=t.shape.length,E=2===l.length&&n.util.arraysEqual(t.shape,a),p=1===n.util.sizeFromShape(t.shape),d=n.backend_util.getBroadcastDims(t.shape,r.shape),x=!e.packedInputs&&m===r.shape.length&&n.util.arraysEqual(a,r.texData.texShape),T=e.packedInputs||l.length>2?"":`${a[0]>1}_${a[1]>1}`;o+=`${m}_${x}_${u?f:""}_${l.length}_${p}_${d}_${E}_${h}_${c}_${g}_${T}_${s}`}else{const e=t.isUniform?"uniform":t.texData.texShape;o+=`${t.shape}_${e}_${s}`}}));const s=e.userCode;let a=e.constructor.name;return a+="_"+o+"_"+s+`${(0,n.env)().getNumber("WEBGL_VERSION")}`,a}function h(e){return(0,n.env)().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}},47646:function(e,t,r){r.d(t,{$k:function(){return D},Hw:function(){return p},Ij:function(){return d},J$:function(){return g},Me:function(){return _},Ng:function(){return l},SD:function(){return A},WH:function(){return m},Z:function(){return S},b1:function(){return u},bG:function(){return x},cD:function(){return c},fj:function(){return h},ir:function(){return R},qg:function(){return b},uS:function(){return L},wM:function(){return E},y7:function(){return I},yr:function(){return a},z8:function(){return T},zP:function(){return y}});var n=r(9495),i=r(18765),o=r(28560),s=r(88380);function a(e){const t=(0,i.B)(),r=`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`;return s.yr(e,r)}function u(e){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return s.HW(e,t)}function l(e){const t=new Uint16Array([0,1,2,2,1,3]);return s.$e(e,t)}function f(e,t,r,i,o,a){s.ph(t,r);const u=s.sZ(e),l=e.TEXTURE_2D;return s.ul(e,(()=>e.bindTexture(l,u))),s.ul(e,(()=>e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),s.ul(e,(()=>e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),s.ul(e,(()=>e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.NEAREST))),s.ul(e,(()=>e.texParameteri(l,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===(0,n.env)().getNumber("WEBGL_VERSION")?s.ul(e,(()=>e.texImage2D(l,0,i,t,r,0,o,a,null))):s.ul(e,(()=>e.texStorage2D(l,1,i,t,r))),s.ul(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:u,texShape:[r,t]}}function h(e){return e.internalFormatFloat}function c(e,t,r,n){const[i,s]=o.Qn(t,r);return f(e,i,s,h(n),n.textureFormatFloat,e.FLOAT)}function g(e){return e.internalFormatHalfFloat}function m(e,t,r,n){const[i,s]=o.Qn(t,r);return f(e,i,s,g(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function E(e){return e.downloadTextureFormat}function p(e,t,r,n){const[i,s]=o.Qn(t,r);return f(e,i,s,E(n),e.RGBA,e.UNSIGNED_BYTE)}function d(e){return e.internalFormatPackedFloat}function x(e,t,r,n){const[i,s]=o.NO(t,r);return f(e,i,s,d(n),e.RGBA,e.FLOAT)}function T(e){return e.internalFormatPackedHalfFloat}function _(e,t,r,n){const[i,s]=o.NO(t,r);return f(e,i,s,T(n),e.RGBA,n.textureTypeHalfFloat)}function S(e,t,r){s.ul(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r)));return s.rw(e,t,"clipSpacePos",r,3,20,0)&&s.rw(e,t,"uv",r,2,20,12)}function I(e,t,r,i,o,a){let u,l,f;s.ul(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),o instanceof Uint8Array?(u=new Uint8Array(r*i*4),l=e.UNSIGNED_BYTE,f=e.RGBA):(u=new Float32Array(r*i*4),l=e.FLOAT,f=a.internalFormatPackedFloat),u.set(o),2===(0,n.env)().getNumber("WEBGL_VERSION")?s.ul(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,i,e.RGBA,l,u))):s.ul(e,(()=>e.texImage2D(e.TEXTURE_2D,0,f,r,i,0,e.RGBA,l,u))),s.ul(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function b(e,t,r){s.ul(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),r.data instanceof Uint8Array?2===(0,n.env)().getNumber("WEBGL_VERSION")?s.ul(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,e.RGBA,e.UNSIGNED_BYTE,r.data))):s.ul(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data))):2===(0,n.env)().getNumber("WEBGL_VERSION")?s.ul(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,r))):s.ul(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r))),s.ul(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function y(e,t,r,n){const i=e.createBuffer();s.ul(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i)));const o=16*t*r;return s.ul(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ))),s.ul(e,(()=>e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,0))),s.ul(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),i}function D(e,t,r){const n=e,i=new Float32Array(r);return n.bindBuffer(n.PIXEL_PACK_BUFFER,t),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function R(e,t,r,n){const[i,a]=o.Qn(t,r),u=new Uint8Array(o.EX(t*r,4));return s.ul(e,(()=>e.readPixels(0,0,i,a,n.downloadTextureFormat,e.UNSIGNED_BYTE,u))),new Float32Array(u.buffer)}function A(e,t,r,n,i,s,a,u){const l=e,f=new Float32Array(o.PM(s,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,f),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),f}function L(e,t,r){const n=new Float32Array(t*r*4);return s.ul(e,(()=>e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,n))),n}},58044:function(e,t,r){r.d(t,{$p:function(){return n.$p}});var n=r(86819);r(76202)},58638:function(e,t,r){r.d(t,{D:function(){return o}});var n=r(18765),i=r(22792);class o{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=(0,i.ik)(this.outputShape.length);const{dataFormat:r}=t,o=(0,n.B)(),s="channelsLast"===r,a=s?1:2,u=s?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let f="";for(let n=0;n<=1;n++)for(let e=0;e<=1;e++)f+=`\n          blockIndex = rc.z + ${e};\n          pos = rc.y + ${n};\n\n          ${l}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${a}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${u}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${s}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*n+e}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*n+e}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${f}\n\n        ${o.output} = result;\n      }\n    `}}},63839:function(e,t,r){r.d(t,{n:function(){return u}});var n=r(9495),i=r(597),o=r(47646),s=r(28560),a=r(88380);class u{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=(0,n.env)().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,(0,i.lj)(t,e)):this.gl=(0,i.bU)(t),e=this.gl,2===(0,n.env)().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>a.ul(t,(()=>t.createVertexArray())),this.bindVertexArray=e=>a.ul(t,(()=>t.bindVertexArray(e))),this.deleteVertexArray=e=>a.ul(t,(()=>t.deleteVertexArray(e))),this.getVertexArray=()=>a.ul(t,(()=>t.getParameter(t.VERTEX_ARRAY_BINDING)))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>a.ul(e,(()=>t.createVertexArrayOES())),this.bindVertexArray=r=>a.ul(e,(()=>t.bindVertexArrayOES(r))),this.deleteVertexArray=r=>a.ul(e,(()=>t.deleteVertexArrayOES(r))),this.getVertexArray=()=>a.ul(e,(()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES)))}let r="WEBGL_color_buffer_float";const u="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===(0,n.env)().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=a.HM(this.gl,e),a.Ql(this.gl,t))this.textureHalfFloatExtension=a.HM(this.gl,t);else if((0,n.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),a.Ql(this.gl,u))this.colorBufferHalfFloatExtension=a.HM(this.gl,u);else if((0,n.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",a.Ql(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!a.Ql(this.gl,u))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(u)}this.vertexBuffer=o.b1(this.gl),this.indexBuffer=o.Ng(this.gl),this.framebuffer=a.oN(this.gl),this.textureConfig=s.EZ(this.gl,this.textureHalfFloatExtension)}get debug(){return(0,n.env)().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program,this.outputTexture;const e=this.gl;a.ul(e,(()=>e.finish())),a.ul(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),a.ul(e,(()=>e.deleteFramebuffer(this.framebuffer))),a.ul(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),a.ul(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),a.ul(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),o.cD(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),o.WH(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),o.Hw(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),o.qg(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,n){this.throwIfDisposed(),o.y7(this.gl,e,t,r,n,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),o.Me(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),o.bG(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(a.sA(this.gl,this.framebuffer),this.outputTexture=null),a.ul(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,(()=>o.ir(this.gl,t,r,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,r,n,i,s){return o.SD(this.gl,e,t,r,n,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return o.$k(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const n=o.zP(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),n}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if((0,n.env)().getBool("WEBGL_FENCE_API_ENABLED")){const n=e,i=n.fenceSync(n.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const e=n.clientWaitSync(i,0,0);return e===n.ALREADY_SIGNALED||e===n.CONDITION_SATISFIED},t=i}else(0,n.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,(0,n.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,(()=>o.uS(this.gl,t,r)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=o.yr(t));const r=a.rC(t);a.ul(t,(()=>t.attachShader(r,this.vertexShader))),a.ul(t,(()=>t.attachShader(r,e))),a.R7(t,r);const n=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&a.bz(t,n),n}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;a.ul(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),o.Z(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(a.ul(this.gl,(()=>this.gl.deleteProgram(e))),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&a.bz(this.gl,this.program),a.ul(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?a.Rh(this.gl,e,t):a.Yn(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),a.ul(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),a.y_(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[n,i]=s.NO(t,r);this.setOutputMatrixTextureDriver(e,n,i)}setOutputMatrixWriteRegion(e,t,r,n){this.setOutputMatrixWriteRegionDriver(r,e,n,t)}setOutputPackedMatrixWriteRegion(e,t,r,n){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&a.bz(this.gl,this.program),a.s6(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){this.getVertexArray();this.debugValidate()}a.ul(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),a.ul(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=a.HM(this.gl,2===(0,n.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===(0,n.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===(0,n.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await n.util.repeatedTry((()=>this.disposed||this.isQueryAvailable(e,(0,n.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,(0,n.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,r=this.getQueryTimerExtensionWebGL2(),n=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),n&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),r=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in(0,n.env)().platform&&(r=(0,n.env)().platform.setTimeoutCustom.bind((0,n.env)().platform)),n.util.repeatedTry((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),a.SO(this.gl,e,this.framebuffer),this.debug&&a.s6(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(a.SO(this.gl,this.outputTexture,this.framebuffer),this.debug&&a.s6(this.gl)):a.sA(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const n=this.gl;a.SO(n,e,this.framebuffer),this.debug&&a.s6(n),this.outputTexture=e,a.ul(n,(()=>n.viewport(0,0,t,r))),a.ul(n,(()=>n.scissor(0,0,t,r)))}setOutputMatrixWriteRegionDriver(e,t,r,n){this.throwIfDisposed(),a.ul(this.gl,(()=>this.gl.scissor(e,t,r,n)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}}}]);
//# sourceMappingURL=stylist-vendors-de173762.d437bc7e65cc99ce00cb.js.map