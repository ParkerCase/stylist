{"version":3,"file":"stylist-main.js","mappings":"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","sources":["webpack://StylistWidget/webpack/universalModuleDefinition","webpack://StylistWidget/./src/api/recommendationApi.ts","webpack://StylistWidget/./src/api/feedbackApi.ts","webpack://StylistWidget/./src/api/index.ts","webpack://StylistWidget/./src/components/ItemCard/index.ts","webpack://StylistWidget/./src/components/ItemCard/ItemCard.tsx","webpack://StylistWidget/./src/utils/productMappings.ts","webpack://StylistWidget/./src/diagnosticHooks.tsx","webpack://StylistWidget/./src/services/syncService.ts","webpack://StylistWidget/./src/services/image-processing/fileUtils.ts","webpack://StylistWidget/./src/services/image-processing/canvasUtils.ts","webpack://StylistWidget/./src/components/TryOnCanvas/BodyGuide.tsx","webpack://StylistWidget/./src/components/TryOnCanvas/TryOnCanvas.tsx","webpack://StylistWidget/./src/components/TryOnCanvas/index.ts","webpack://StylistWidget/./src/components/TryOnControls/index.ts","webpack://StylistWidget/./src/components/TryOnControls/TryOnControls.tsx","webpack://StylistWidget/./src/components/TryOnFeedback/TryOnFeedback.tsx","webpack://StylistWidget/./src/components/ImageUploader/index.ts","webpack://StylistWidget/./src/components/ImageUploader/ImageUploader.tsx","webpack://StylistWidget/./src/services/background-removal/removeBackgroundApi.ts","webpack://StylistWidget/./src/services/background-removal/tfBackgroundRemoval.ts","webpack://StylistWidget/./src/services/background-removal/utils.ts","webpack://StylistWidget/./src/hooks/useBackgroundRemoval.ts","webpack://StylistWidget/./src/hooks/useImageProcessing.ts","webpack://StylistWidget/./src/services/image-processing/imageScaling.ts","webpack://StylistWidget/./src/hooks/useTryOn.ts","webpack://StylistWidget/./src/components/VirtualTryOn/VirtualTryOn.tsx","webpack://StylistWidget/./src/components/VirtualTryOn/index.ts","webpack://StylistWidget/./src/components/TryOnModal/index.ts","webpack://StylistWidget/./src/components/TryOnModal/TryOnModal.tsx","webpack://StylistWidget/./src/components/ChatWidget/FloatingButton.tsx","webpack://StylistWidget/./src/hooks/useNetworkStatus.ts","webpack://StylistWidget/./src/services/SyncProvider.tsx","webpack://StylistWidget/./src/components/common/SyncStatusIndicator.tsx","webpack://StylistWidget/./src/services/feedbackSyncService.ts","webpack://StylistWidget/./src/StylistWidget.tsx","webpack://StylistWidget/./src/storeMonitor.ts","webpack://StylistWidget/./src/index.tsx","webpack://StylistWidget/./src/components/TrendingItems/TrendingItems.tsx","webpack://StylistWidget/./src/components/SocialProofModal/SocialProofModal.tsx","webpack://StylistWidget/./src/components/WishlistTab/WishlistTab.tsx","webpack://StylistWidget/./src/components/Lookbook/Lookbook.tsx","webpack://StylistWidget/./src/integration/integrateTryOn.ts","webpack://StylistWidget/./src/utils/analytics.ts","webpack://StylistWidget/./src/components/common/AsyncComponentLoader.tsx","webpack://StylistWidget/./src/components/WishlistButton/index.ts","webpack://StylistWidget/./src/components/WishlistButton/WishlistButton.tsx","webpack://StylistWidget/./src/components/OutfitDisplay/index.ts","webpack://StylistWidget/./src/components/OutfitDisplay/OutfitDisplay.tsx","webpack://StylistWidget/./src/api/apiClient.ts","webpack://StylistWidget/./src/api/userApi.ts","webpack://StylistWidget/./src/utils/formatters.ts","webpack://StylistWidget/./src/components/FeedbackControls/ThumbsUpButton.tsx","webpack://StylistWidget/./src/components/FeedbackControls/index.ts","webpack://StylistWidget/./src/components/FeedbackControls/FeedbackControls.tsx","webpack://StylistWidget/./src/components/common/LoadingIndicator.tsx","webpack://StylistWidget/./src/components/WishlistNotification/WishlistNotification.tsx","webpack://StylistWidget/./src/components/ChatHeader/index.ts","webpack://StylistWidget/./src/components/ChatHeader/ChatHeader.tsx","webpack://StylistWidget/./src/components/MessageBubble/index.ts","webpack://StylistWidget/./src/components/MessageBubble/MessageBubble.tsx","webpack://StylistWidget/./src/components/StyleQuiz/index.ts","webpack://StylistWidget/./src/components/ChatBody/index.ts","webpack://StylistWidget/./src/components/ChatBody/ChatBody.tsx","webpack://StylistWidget/./src/components/ChatInput/index.ts","webpack://StylistWidget/./src/components/ChatInput/ChatInput.tsx","webpack://StylistWidget/./src/services/chatService.ts","webpack://StylistWidget/./src/services/analytics/analyticsService.ts","webpack://StylistWidget/./src/components/ChatWidget/ChatWidget.tsx","webpack://StylistWidget/./src/components/ChatWidget/index.ts","webpack://StylistWidget/./src/components/StyleQuiz/StyleQuiz.tsx","webpack://StylistWidget/./src/components/StyleQuiz/StyleQuizModal.tsx","webpack://StylistWidget/./src/hooks/useSyncedStore.ts","webpack://StylistWidget/./src/diagnostics.ts","webpack://StylistWidget/./src/utils/environment.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StylistWidget\"] = factory();\n\telse\n\t\troot[\"StylistWidget\"] = factory();\n})(self, function() {\nreturn ","// API client for recommendation-related endpoints\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport axios from 'axios';\n// Mock data for fallback when API is unavailable\nconst MOCK_RECOMMENDATIONS = {\n    items: [\n        {\n            id: 'mock1',\n            name: 'Classic White T-Shirt',\n            brand: 'Essentials',\n            category: 'Tops',\n            price: 24.99,\n            retailerId: 'demo_retailer',\n            colors: ['white'],\n            sizes: ['S', 'M', 'L', 'XL'],\n            imageUrls: ['https://via.placeholder.com/300?text=White+T-Shirt'],\n            url: '#',\n            matchScore: 0.95,\n            matchReasons: ['Versatile staple', 'Matches your style profile'],\n            inStock: true\n        },\n        {\n            id: 'mock2',\n            name: 'Slim Fit Jeans',\n            brand: 'DenimCo',\n            category: 'Bottoms',\n            price: 59.99,\n            retailerId: 'demo_retailer',\n            colors: ['blue'],\n            sizes: ['28', '30', '32', '34'],\n            imageUrls: ['https://via.placeholder.com/300?text=Slim+Jeans'],\n            url: '#',\n            matchScore: 0.92,\n            matchReasons: ['Versatile staple', 'Complements your wardrobe'],\n            inStock: true\n        },\n        {\n            id: 'mock3',\n            name: 'Casual Sneakers',\n            brand: 'UrbanStep',\n            category: 'Shoes',\n            price: 79.99,\n            retailerId: 'demo_retailer',\n            colors: ['white', 'black'],\n            sizes: ['8', '9', '10', '11'],\n            imageUrls: ['https://via.placeholder.com/300?text=Sneakers'],\n            url: '#',\n            matchScore: 0.89,\n            matchReasons: ['Comfortable', 'Versatile footwear'],\n            inStock: true\n        },\n        {\n            id: 'mock4',\n            name: 'Oversized Hoodie',\n            brand: 'Comfort+',\n            category: 'Tops',\n            price: 49.99,\n            retailerId: 'demo_retailer',\n            colors: ['gray', 'black', 'blue'],\n            sizes: ['S', 'M', 'L', 'XL'],\n            imageUrls: ['https://via.placeholder.com/300?text=Hoodie'],\n            url: '#',\n            matchScore: 0.87,\n            matchReasons: ['Casual comfort', 'Trending style'],\n            inStock: true\n        }\n    ],\n    outfits: [\n        {\n            id: 'outfit1',\n            name: 'Casual Weekend Look',\n            occasion: 'Casual',\n            matchScore: 0.93,\n            matchReasons: ['Perfect for weekends', 'Easy to style'],\n            items: [\n                {\n                    id: 'mock1',\n                    name: 'Classic White T-Shirt',\n                    brand: 'Essentials',\n                    category: 'Tops',\n                    price: 24.99,\n                    retailerId: 'demo_retailer',\n                    colors: ['white'],\n                    sizes: ['S', 'M', 'L', 'XL'],\n                    imageUrls: ['https://via.placeholder.com/300?text=White+T-Shirt'],\n                    url: '#',\n                    matchScore: 0.95,\n                    matchReasons: ['Versatile staple'],\n                    inStock: true\n                },\n                {\n                    id: 'mock2',\n                    name: 'Slim Fit Jeans',\n                    brand: 'DenimCo',\n                    category: 'Bottoms',\n                    price: 59.99,\n                    retailerId: 'demo_retailer',\n                    colors: ['blue'],\n                    sizes: ['28', '30', '32', '34'],\n                    imageUrls: ['https://via.placeholder.com/300?text=Slim+Jeans'],\n                    url: '#',\n                    matchScore: 0.92,\n                    matchReasons: ['Versatile staple'],\n                    inStock: true\n                },\n                {\n                    id: 'mock3',\n                    name: 'Casual Sneakers',\n                    brand: 'UrbanStep',\n                    category: 'Shoes',\n                    price: 79.99,\n                    retailerId: 'demo_retailer',\n                    colors: ['white', 'black'],\n                    sizes: ['8', '9', '10', '11'],\n                    imageUrls: ['https://via.placeholder.com/300?text=Sneakers'],\n                    url: '#',\n                    matchScore: 0.89,\n                    matchReasons: ['Comfortable'],\n                    inStock: true\n                }\n            ]\n        }\n    ]\n};\n// Add missing required fields for mock data\nconst completeMockRecommendations = Object.assign(Object.assign({}, MOCK_RECOMMENDATIONS), { userId: 'mock_user', timestamp: new Date(), items: MOCK_RECOMMENDATIONS.items || [], outfits: MOCK_RECOMMENDATIONS.outfits || [] });\nexport class RecommendationApi {\n    constructor(apiClient) {\n        this.apiClient = apiClient;\n    }\n    // Get personalized recommendations\n    getRecommendations(request) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                // Add timeouts and retries for production reliability\n                // Use the correct endpoint format to match backend structure - converting GET to POST\n                const response = yield this.apiClient.post(`/api/v1/recommendations`, {\n                    userId: request.userId,\n                    context: request.context,\n                    filterByRetailers: request.filterByRetailers,\n                    category: request.category\n                });\n                // If the response is valid, return it\n                if (response && Array.isArray(response.items)) {\n                    return response;\n                }\n                const apiResponse = response;\n                if (apiResponse && Array.isArray(apiResponse.recommended_items)) {\n                    return {\n                        userId: request.userId,\n                        timestamp: new Date(),\n                        items: apiResponse.recommended_items.map((item) => ({\n                            id: item.item_id,\n                            name: item.name || '',\n                            brand: item.brand || '',\n                            category: item.category || '',\n                            price: item.price || 0,\n                            retailerId: item.retailer_id ? item.retailer_id.split('_')[0] : '',\n                            colors: item.colors || [],\n                            sizes: item.sizes || [],\n                            imageUrls: item.image_urls || [],\n                            url: item.url || '#',\n                            matchScore: item.score || 0,\n                            matchReasons: item.match_reasons || [],\n                            inStock: item.in_stock !== false\n                        })),\n                        outfits: (apiResponse.recommended_outfits || []).map((outfit) => ({\n                            id: outfit.outfit_id,\n                            name: outfit.name || `Outfit for ${outfit.occasion || 'any occasion'}`,\n                            occasion: outfit.occasion || '',\n                            matchScore: outfit.score || 0,\n                            matchReasons: outfit.match_reasons || [],\n                            items: outfit.items.map((id) => {\n                                var _a;\n                                // Find the full item in the items array\n                                const item = (_a = apiResponse.recommended_items) === null || _a === void 0 ? void 0 : _a.find((i) => i.item_id === id);\n                                if (!item)\n                                    return {\n                                        id,\n                                        name: '',\n                                        brand: '',\n                                        category: '',\n                                        price: 0,\n                                        imageUrls: [''],\n                                        retailerId: '',\n                                        colors: [],\n                                        sizes: [],\n                                        url: '',\n                                        matchScore: 0,\n                                        matchReasons: [],\n                                        inStock: true\n                                    };\n                                return {\n                                    id: item.item_id,\n                                    name: item.name || '',\n                                    brand: item.brand || '',\n                                    category: item.category || '',\n                                    price: item.price || 0,\n                                    retailerId: item.retailer_id ? item.retailer_id.split('_')[0] : '',\n                                    colors: item.colors || [],\n                                    sizes: item.sizes || [],\n                                    imageUrls: item.image_urls || [],\n                                    url: item.url || '#',\n                                    matchScore: item.score || 0,\n                                    matchReasons: item.match_reasons || [],\n                                    inStock: item.in_stock !== false\n                                };\n                            })\n                        }))\n                    };\n                }\n                throw new Error('Invalid response format from API');\n            }\n            catch (error) {\n                console.warn('Failed to fetch recommendations from API, using mock data:', error);\n                // Add log for clean error message\n                if (axios.isAxiosError(error) && error.response) {\n                    console.error(`Recommendation API error: ${error.response.status} - ${error.response.statusText}`);\n                }\n                // Return mock data as fallback\n                return completeMockRecommendations;\n            }\n        });\n    }\n    // Get outfit recommendations\n    getOutfitRecommendations(userId, occasion, limit) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                const params = {};\n                if (occasion)\n                    params.occasion = occasion;\n                if (limit)\n                    params.limit = limit.toString();\n                return yield this.apiClient.get(`/api/v1/users/${userId}/outfits/recommendations`, {\n                    params\n                });\n            }\n            catch (error) {\n                console.warn('Failed to fetch outfit recommendations, using mock data:', error);\n                // Return mock outfit data as fallback\n                return completeMockRecommendations.outfits;\n            }\n        });\n    }\n    // Add item feedback (like/dislike)\n    addItemFeedback(feedback) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                return yield this.apiClient.post(`/api/v1/users/${feedback.userId}/feedback/items/${feedback.itemId}`, {\n                    liked: feedback.liked,\n                    context: feedback.context\n                });\n            }\n            catch (error) {\n                console.warn('Failed to add item feedback, ignoring:', error);\n                // Silently fail - UI will still update but backend won't persist\n            }\n        });\n    }\n    // Add outfit feedback (like/dislike)\n    addOutfitFeedback(feedback) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                return yield this.apiClient.post(`/api/v1/users/${feedback.userId}/feedback/outfits/${feedback.outfitId}`, {\n                    liked: feedback.liked,\n                    context: feedback.context\n                });\n            }\n            catch (error) {\n                console.warn('Failed to add outfit feedback, ignoring:', error);\n                // Silently fail - UI will still update but backend won't persist\n            }\n        });\n    }\n    // Save outfit to user's favorites\n    saveOutfit(outfit) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.apiClient.post(`/api/v1/users/${outfit.userId}/outfits`, {\n                outfitId: outfit.outfitId,\n                items: outfit.items,\n                name: outfit.name,\n                notes: outfit.notes\n            });\n        });\n    }\n    // Get saved outfits\n    getSavedOutfits(userId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.apiClient.get(`/api/v1/users/${userId}/outfits`);\n        });\n    }\n    // Delete saved outfit\n    deleteSavedOutfit(userId, outfitId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.apiClient.delete(`/api/v1/users/${userId}/outfits/${outfitId}`);\n        });\n    }\n    // Get similar items\n    getSimilarItems(request) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.apiClient.post('/api/v1/similar-items', request);\n        });\n    }\n    // Complete an outfit based on selected items\n    completeOutfit(request) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.apiClient.post('/api/v1/complete-outfit', request);\n        });\n    }\n    // Log item view\n    logItemView(userId, itemId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.apiClient.post(`/api/v1/users/${userId}/view-item/${itemId}`, {});\n        });\n    }\n}\n","// Feedback API client for synchronizing user feedback\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nexport class FeedbackApi {\n    constructor(apiClient) {\n        this.apiClient = apiClient;\n    }\n    /**\n     * Synchronize local feedback with the backend\n     */\n    syncFeedback(request) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                return yield this.apiClient.post(`/api/v1/users/${request.userId}/feedback/sync`, {\n                    feedbackItems: request.feedbackItems\n                });\n            }\n            catch (error) {\n                console.warn('Failed to sync feedback, will retry later:', error);\n                // Return a failed response\n                return {\n                    syncedItemIds: [],\n                    success: false,\n                    message: error instanceof Error ? error.message : 'Unknown error'\n                };\n            }\n        });\n    }\n}\n","// Export all API clients and create a configured instance\nimport { createApiClient } from './apiClient';\nimport { UserApi } from './userApi';\nimport { RecommendationApi } from './recommendationApi';\nimport { FeedbackApi } from './feedbackApi';\nimport { API_URL, API_TIMEOUT } from '@/utils/environment';\n// Default API configuration from environment\nconst DEFAULT_API_URL = API_URL;\nconst DEFAULT_TIMEOUT = API_TIMEOUT;\n// Create and configure API clients\nexport const createStylistApi = (config) => {\n    const apiClient = createApiClient({\n        baseURL: config.apiUrl || DEFAULT_API_URL,\n        apiKey: config.apiKey,\n        timeout: config.timeout || DEFAULT_TIMEOUT,\n        headers: {\n            'X-Retailer-ID': config.retailerId\n        }\n    });\n    return {\n        user: new UserApi(apiClient),\n        recommendation: new RecommendationApi(apiClient),\n        feedback: new FeedbackApi(apiClient)\n    };\n};\nexport { UserApi, RecommendationApi, FeedbackApi };\n","import ItemCard from './ItemCard';\nexport default ItemCard;\n","import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\n// Enhanced item card component for displaying product recommendations and closet items\nimport { useState } from 'react';\nimport './ItemCard.scss';\nimport { formatPrice } from '@/utils/formatters';\nimport FeedbackControls from '../FeedbackControls';\nimport { mapProductTypeToGarmentType } from '@/utils/productMappings';\nimport { GarmentType } from '@/types/tryOn';\nconst ItemCard = ({ item, onFeedback, onAddToWishlist, onAddToCart, onTryOn, onFavorite, onRemove, showDetails = false, primaryColor, onClick, isClosetItem = false, isFavorite = false }) => {\n    const id = item.id;\n    const name = item.name;\n    const brand = item.brand;\n    const price = item.price;\n    // These properties only exist on recommendation items\n    const salePrice = 'salePrice' in item ? item.salePrice : undefined;\n    const matchScore = 'matchScore' in item ? item.matchScore : undefined;\n    const matchReasons = 'matchReasons' in item ? item.matchReasons : [];\n    const category = 'category' in item ? item.category : undefined;\n    const [showFeedbackText, setShowFeedbackText] = useState(null);\n    const [animateItem, setAnimateItem] = useState(false);\n    const [isFavoriteState, setIsFavoriteState] = useState(isFavorite);\n    // Use the appropriate image URL based on item type\n    const imageUrl = isClosetItem\n        ? ('image' in item ? item.image : '')\n        : ('imageUrls' in item && item.imageUrls && item.imageUrls.length > 0 ? item.imageUrls[0] : '');\n    const handleItemClick = () => {\n        if (onClick) {\n            onClick(item);\n        }\n        else if (!isClosetItem && 'url' in item) {\n            // Open product details or navigate to product page\n            window.open(item.url, '_blank');\n        }\n    };\n    const handleFeedback = (liked) => {\n        if (onFeedback) {\n            onFeedback(id, liked);\n            // Show feedback text briefly with appropriate message\n            const feedbackMessage = liked\n                ? 'Added to your liked items'\n                : 'Noted - not your style';\n            setShowFeedbackText(feedbackMessage);\n            // Trigger animation\n            setAnimateItem(true);\n            setTimeout(() => {\n                setAnimateItem(false);\n                setTimeout(() => {\n                    setShowFeedbackText(null);\n                }, 300);\n            }, 1500);\n        }\n    };\n    const handleAddToWishlist = (e) => {\n        e.stopPropagation(); // Prevent item click\n        if (onAddToWishlist) {\n            onAddToWishlist(id);\n            // Show feedback text briefly\n            setShowFeedbackText('Added to wishlist');\n            setTimeout(() => {\n                setShowFeedbackText(null);\n            }, 1800);\n        }\n    };\n    const handleAddToCart = (e) => {\n        e.stopPropagation(); // Prevent item click\n        if (onAddToCart) {\n            onAddToCart(id);\n            // Show feedback text briefly\n            setShowFeedbackText('Added to cart');\n            setTimeout(() => {\n                setShowFeedbackText(null);\n            }, 1800);\n        }\n    };\n    const handleTryOn = (e) => {\n        e.stopPropagation(); // Prevent item click\n        if (onTryOn) {\n            onTryOn(item);\n        }\n    };\n    // Show discount percentage if on sale\n    const discountPercentage = salePrice && price > 0\n        ? Math.round(((price - salePrice) / price) * 100)\n        : null;\n    // Check if product is try-on compatible\n    const isTryOnCompatible = category ?\n        ['top', 'bottom', 'dress', 'outerwear', 'shoes', 'accessory'].includes(category.toLowerCase())\n        : false;\n    // Get garment type for try-on\n    const garmentType = category ? mapProductTypeToGarmentType(category) : GarmentType.TOP;\n    return (_jsxs(\"div\", Object.assign({ className: `stylist-item-card ${animateItem ? 'stylist-item-card--animate' : ''}` }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-item-card__image-container\", onClick: handleItemClick }, { children: [imageUrl ? (_jsx(\"img\", { src: imageUrl, alt: name, className: \"stylist-item-card__image\", loading: \"lazy\" })) : (_jsx(\"div\", Object.assign({ className: \"stylist-item-card__image-placeholder\" }, { children: \"No Image\" }))), discountPercentage && (_jsxs(\"div\", Object.assign({ className: \"stylist-item-card__discount\" }, { children: [discountPercentage, \"% OFF\"] }))), showFeedbackText && (_jsx(\"div\", Object.assign({ className: \"stylist-item-card__feedback-text\", style: { backgroundColor: `${primaryColor}ee` } }, { children: showFeedbackText }))), isTryOnCompatible && imageUrl && onTryOn && (_jsx(\"div\", Object.assign({ className: \"stylist-item-card__try-on-overlay\" }, { children: _jsxs(\"button\", Object.assign({ className: \"stylist-item-card__try-on-button\", onClick: handleTryOn, style: { backgroundColor: primaryColor } }, { children: [_jsx(\"span\", Object.assign({ className: \"stylist-item-card__try-on-icon\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"16\", height: \"16\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z\" }) })) })), _jsx(\"span\", Object.assign({ className: \"stylist-item-card__try-on-text\" }, { children: \"Try On\" }))] })) })))] })), _jsxs(\"div\", Object.assign({ className: \"stylist-item-card__content\", onClick: handleItemClick }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-item-card__brand\" }, { children: brand })), _jsx(\"div\", Object.assign({ className: \"stylist-item-card__name\" }, { children: name })), _jsx(\"div\", Object.assign({ className: \"stylist-item-card__price\" }, { children: salePrice ? (_jsxs(_Fragment, { children: [_jsx(\"span\", Object.assign({ className: \"stylist-item-card__price--sale\" }, { children: formatPrice(salePrice) })), _jsx(\"span\", Object.assign({ className: \"stylist-item-card__price--original\" }, { children: formatPrice(price) }))] })) : (_jsx(\"span\", { children: formatPrice(price) })) }))] })), showDetails && matchReasons && matchReasons.length > 0 && (_jsxs(\"div\", Object.assign({ className: \"stylist-item-card__match-reasons\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-item-card__match-score\", style: { color: primaryColor } }, { children: typeof matchScore === 'number' ? `${Math.round(matchScore * 100)}% Match` : 'Good Match' })), _jsx(\"ul\", Object.assign({ className: \"stylist-item-card__reason-list\" }, { children: matchReasons.map((reason, index) => (_jsx(\"li\", Object.assign({ className: \"stylist-item-card__reason-item\" }, { children: reason }), index))) }))] }))), _jsx(\"div\", Object.assign({ className: \"stylist-item-card__actions\" }, { children: isClosetItem ? (_jsxs(_Fragment, { children: [onFavorite && (_jsx(\"button\", Object.assign({ className: `stylist-item-card__favorite-btn ${isFavoriteState ? 'stylist-item-card__favorite-btn--active' : ''}`, onClick: (e) => {\n                                e.stopPropagation();\n                                const newFavoriteState = !isFavoriteState;\n                                setIsFavoriteState(newFavoriteState);\n                                onFavorite(newFavoriteState);\n                            }, \"aria-label\": isFavoriteState ? \"Remove from favorites\" : \"Add to favorites\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\" }) })) }))), onRemove && (_jsx(\"button\", Object.assign({ className: \"stylist-item-card__remove-btn\", onClick: (e) => {\n                                e.stopPropagation();\n                                onRemove();\n                            }, \"aria-label\": \"Remove from closet\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\" }) })) })))] })) : (_jsxs(_Fragment, { children: [_jsx(FeedbackControls, { itemId: id, onLike: () => handleFeedback(true), onDislike: () => handleFeedback(false), primaryColor: primaryColor }), isTryOnCompatible && imageUrl && onTryOn && (_jsxs(\"button\", Object.assign({ className: \"stylist-item-card__try-on-btn\", onClick: handleTryOn, \"aria-label\": \"Try on this item\", style: { backgroundColor: primaryColor } }, { children: [_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"16\", height: \"16\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z\" }) })), \"Try On\"] }))), onAddToWishlist && (_jsx(\"button\", Object.assign({ className: \"stylist-item-card__wishlist-btn\", onClick: handleAddToWishlist, \"aria-label\": \"Add to wishlist\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\" }) })) }))), onAddToCart && (_jsx(\"button\", Object.assign({ className: \"stylist-item-card__cart-btn\", onClick: handleAddToCart, \"aria-label\": \"Add to cart\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z\" }) })) })))] })) }))] })));\n};\nexport default ItemCard;\n","// src/utils/productMappings.ts\nimport { GarmentType } from '../types/tryOn';\n/**\n * Maps product type from various systems to internal GarmentType\n */\nexport const mapProductTypeToGarmentType = (productType) => {\n    const lcType = productType.toLowerCase();\n    if (lcType.includes('shirt') || lcType.includes('top') || lcType.includes('tee') || lcType.includes('blouse')) {\n        return GarmentType.TOP;\n    }\n    if (lcType.includes('pant') || lcType.includes('jean') || lcType.includes('bottom') || lcType.includes('skirt') || lcType.includes('short')) {\n        return GarmentType.BOTTOM;\n    }\n    if (lcType.includes('dress')) {\n        return GarmentType.DRESS;\n    }\n    if (lcType.includes('jacket') || lcType.includes('coat') || lcType.includes('sweater') || lcType.includes('cardigan') || lcType.includes('hoodie')) {\n        return GarmentType.OUTERWEAR;\n    }\n    if (lcType.includes('shoe') || lcType.includes('sneaker') || lcType.includes('boot') || lcType.includes('sandal')) {\n        return GarmentType.SHOES;\n    }\n    if (lcType.includes('accessory') || lcType.includes('hat') || lcType.includes('bag') || lcType.includes('jewelry') || lcType.includes('watch') || lcType.includes('scarf')) {\n        return GarmentType.ACCESSORY;\n    }\n    // Default to top if can't determine\n    return GarmentType.TOP;\n};\n","import { Fragment as _Fragment, jsx as _jsx } from \"react/jsx-runtime\";\n// React hooks for component lifecycle diagnostic monitoring\nimport React, { useEffect, useState, useRef, Suspense } from 'react';\nimport { logComponentRender, logSuspense, logLazyLoad, logErrorBoundary, logHook } from './diagnostics';\n/**\n * Hook to monitor component lifecycle\n * @param componentName The name of the component to monitor\n */\nexport const useDiagnosticLifecycle = (componentName) => {\n    // Tracking mount state\n    const mountedRef = useRef(false);\n    // Tracking render count\n    const renderCountRef = useRef(0);\n    // Timing render performance\n    const renderStartTimeRef = useRef(performance.now());\n    // Log the first render\n    if (!mountedRef.current) {\n        renderStartTimeRef.current = performance.now();\n        logComponentRender(componentName, 'mount', `${componentName} initial render starting`);\n    }\n    // Increment render count and log updates\n    renderCountRef.current += 1;\n    const isInitialRender = renderCountRef.current === 1;\n    if (!isInitialRender) {\n        logComponentRender(componentName, 'update', `${componentName} re-render #${renderCountRef.current - 1}`, { renderCount: renderCountRef.current });\n    }\n    // Log mount completion on first effect\n    useEffect(() => {\n        if (!mountedRef.current) {\n            const mountDuration = performance.now() - renderStartTimeRef.current;\n            mountedRef.current = true;\n            logComponentRender(componentName, 'mount', `${componentName} mounted`, {\n                renderCount: renderCountRef.current,\n                mountDuration: `${mountDuration.toFixed(2)}ms`\n            });\n        }\n        // Log unmount\n        return () => {\n            logComponentRender(componentName, 'unmount', `${componentName} unmounted`, {\n                totalRenderCount: renderCountRef.current\n            });\n        };\n    }, [componentName]);\n};\n/**\n * Hook to monitor effects\n * @param componentName The name of the component\n * @param effectName Name of the effect for identification\n * @param deps The dependency array\n * @param effectFn The effect function\n */\nexport const useDiagnosticEffect = (componentName, effectName, deps, effectFn) => {\n    const effectRunCountRef = useRef(0);\n    useEffect(() => {\n        // Log effect starting\n        effectRunCountRef.current += 1;\n        const runCount = effectRunCountRef.current;\n        logHook(componentName, effectName, 'update', `${effectName} effect triggered in ${componentName}`, {\n            runCount,\n            dependencies: deps ? `Dependencies array length: ${deps.length}` : 'No dependencies'\n        });\n        const startTime = performance.now();\n        // Run the effect\n        const cleanup = effectFn();\n        const duration = performance.now() - startTime;\n        logHook(componentName, effectName, 'update', `${effectName} effect completed in ${componentName}`, {\n            runCount,\n            duration: `${duration.toFixed(2)}ms`,\n            hasCleanup: !!cleanup\n        });\n        // Return cleanup function\n        return () => {\n            if (cleanup) {\n                logHook(componentName, effectName, 'cleanup', `${effectName} effect cleanup in ${componentName}`, { runCount });\n                cleanup();\n            }\n        };\n    }, deps);\n};\n/**\n * Hook to monitor state changes\n * @param componentName The name of the component\n * @param stateName Name of the state variable\n * @param initialValue The initial state value\n * @returns A tuple of [state, setState] just like useState\n */\nexport function useDiagnosticState(componentName, stateName, initialValue) {\n    const [state, setState] = useState(initialValue);\n    const updatesRef = useRef(0);\n    const initialRef = useRef(true);\n    if (initialRef.current) {\n        logHook(componentName, `state:${stateName}`, 'init', `${stateName} state initialized in ${componentName}`, {\n            initialValue: typeof initialValue === 'function'\n                ? '(function)'\n                : initialValue\n        });\n        initialRef.current = false;\n    }\n    const setStateWithLogging = React.useCallback((value) => {\n        const updateCount = updatesRef.current + 1;\n        updatesRef.current = updateCount;\n        const valueIsFunction = typeof value === 'function';\n        logHook(componentName, `state:${stateName}`, 'update', `${stateName} state update in ${componentName}`, {\n            updateCount,\n            setterType: valueIsFunction ? 'function' : 'value',\n            newValue: !valueIsFunction ? value : '(function)'\n        });\n        setState(value);\n    }, [componentName, stateName]);\n    return [state, setStateWithLogging];\n}\n/**\n * Creates a monitored lazy component\n * @param factory The component factory function\n * @param componentName Name of the component for logging\n * @returns A lazy component with monitoring\n */\nexport function monitoredLazy(factory, componentName) {\n    return React.lazy(() => {\n        logLazyLoad(componentName, 'start', `${componentName} lazy loading started`);\n        const startTime = performance.now();\n        return factory()\n            .then(module => {\n            const loadTime = performance.now() - startTime;\n            logLazyLoad(componentName, 'complete', `${componentName} lazy loading completed`, {\n                loadTime: `${loadTime.toFixed(2)}ms`\n            });\n            return module;\n        })\n            .catch(error => {\n            logLazyLoad(componentName, 'error', `${componentName} lazy loading error: ${error.message}`, {\n                error: error.message,\n                stack: error.stack\n            });\n            throw error;\n        });\n    });\n}\n/**\n * A diagnostic suspense component that logs suspense events\n */\nexport const DiagnosticSuspense = ({ children, fallback, componentName = 'unknown' }) => {\n    const suspendedRef = useRef(false);\n    const resolvedRef = useRef(false);\n    const suspenseNameRef = useRef(`Suspense[${componentName}]`);\n    // Use a wrapper to track when fallback is shown\n    const FallbackTracker = ({ children }) => {\n        useEffect(() => {\n            if (!suspendedRef.current) {\n                suspendedRef.current = true;\n                logSuspense(suspenseNameRef.current, 'fallback', `Suspense fallback shown for ${componentName}`);\n            }\n            return () => {\n                if (!resolvedRef.current) {\n                    resolvedRef.current = true;\n                    logSuspense(suspenseNameRef.current, 'resolved', `Suspense resolved for ${componentName}`);\n                }\n            };\n        }, []);\n        return _jsx(_Fragment, { children: children });\n    };\n    return (_jsx(Suspense, Object.assign({ fallback: _jsx(FallbackTracker, { children: fallback }) }, { children: children })));\n};\n/**\n * A diagnostic error boundary component that logs error boundary events\n */\nexport class DiagnosticErrorBoundary extends React.Component {\n    constructor() {\n        super(...arguments);\n        this.state = { hasError: false, error: null };\n        this.resetError = () => {\n            this.setState({ hasError: false, error: null });\n        };\n    }\n    static getDerivedStateFromError(error) {\n        return { hasError: true, error };\n    }\n    componentDidCatch(error, info) {\n        const { componentName = 'unknown', onError } = this.props;\n        logErrorBoundary(componentName, error, info);\n        if (onError) {\n            onError(error, info);\n        }\n    }\n    render() {\n        const { hasError, error } = this.state;\n        const { children, fallback, componentName = 'unknown' } = this.props;\n        if (hasError && error) {\n            return typeof fallback === 'function'\n                ? fallback(error, this.resetError)\n                : fallback;\n        }\n        return children;\n    }\n}\nexport default {\n    useDiagnosticLifecycle,\n    useDiagnosticEffect,\n    useDiagnosticState,\n    monitoredLazy,\n    DiagnosticSuspense,\n    DiagnosticErrorBoundary\n};\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n// Data synchronization service for handling online/offline state\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { useUserStore } from '../store/userStore';\nimport useRecommendationStore from '../store/recommendationStore';\nimport { UserApi } from '../api/userApi';\nimport { ApiClient } from '../api/apiClient';\nimport { getWithExpiry, setWithExpiry } from '../utils/localStorage';\n// Constants for sync operation\nconst SYNC_INTERVAL = 30000; // 30 seconds\nconst SYNC_STORAGE_PREFIX = 'stylist_sync_';\nconst SYNC_LAST_TIMESTAMP = 'stylist_last_sync';\nconst SYNC_QUEUE_KEY = 'stylist_sync_queue';\nconst SYNC_EXPIRY = 7 * 24 * 60 * 60; // 7 days in seconds\n// Sync operation types\nexport var SyncOperationType;\n(function (SyncOperationType) {\n    SyncOperationType[\"ADD_CLOSET_ITEM\"] = \"ADD_CLOSET_ITEM\";\n    SyncOperationType[\"REMOVE_CLOSET_ITEM\"] = \"REMOVE_CLOSET_ITEM\";\n    SyncOperationType[\"UPDATE_CLOSET_ITEM\"] = \"UPDATE_CLOSET_ITEM\";\n    SyncOperationType[\"TOGGLE_FAVORITE\"] = \"TOGGLE_FAVORITE\";\n    SyncOperationType[\"UPDATE_PREFERENCES\"] = \"UPDATE_PREFERENCES\";\n    SyncOperationType[\"SUBMIT_QUIZ\"] = \"SUBMIT_QUIZ\";\n    SyncOperationType[\"ADD_LIKED_ITEM\"] = \"ADD_LIKED_ITEM\";\n    SyncOperationType[\"ADD_DISLIKED_ITEM\"] = \"ADD_DISLIKED_ITEM\";\n    SyncOperationType[\"REMOVE_LIKED_ITEM\"] = \"REMOVE_LIKED_ITEM\";\n    SyncOperationType[\"REMOVE_DISLIKED_ITEM\"] = \"REMOVE_DISLIKED_ITEM\";\n    SyncOperationType[\"SAVE_OUTFIT\"] = \"SAVE_OUTFIT\";\n    SyncOperationType[\"REMOVE_OUTFIT\"] = \"REMOVE_OUTFIT\";\n})(SyncOperationType || (SyncOperationType = {}));\n// Create API client for sync operations\nimport { API_URL, API_TIMEOUT, MAX_RETRY_ATTEMPTS } from '@/utils/environment';\nconst createSyncApiClient = () => {\n    const apiClient = new ApiClient({\n        baseURL: API_URL,\n        timeout: API_TIMEOUT,\n        maxRetries: MAX_RETRY_ATTEMPTS,\n        getAuthHeader: () => {\n            const token = localStorage.getItem('stylist_auth_token');\n            return token ? { Authorization: `Bearer ${token}` } : { Authorization: '' };\n        }\n    });\n    return new UserApi(apiClient);\n};\n// Main sync service hook\nexport const useSyncService = () => {\n    const [state, setState] = useState({\n        isOnline: navigator.onLine,\n        isSyncing: false,\n        lastSyncTimestamp: Number(localStorage.getItem(SYNC_LAST_TIMESTAMP)) || null,\n        pendingOperations: 0,\n        syncQueue: []\n    });\n    const userStore = useUserStore();\n    const recommendationStore = useRecommendationStore();\n    const syncIntervalRef = useRef(null);\n    const apiClient = useRef(createSyncApiClient());\n    // Load sync queue from localStorage\n    const loadSyncQueue = useCallback(() => {\n        const queueStr = localStorage.getItem(SYNC_QUEUE_KEY);\n        if (!queueStr)\n            return [];\n        try {\n            return JSON.parse(queueStr);\n        }\n        catch (error) {\n            console.error('Failed to parse sync queue:', error);\n            return [];\n        }\n    }, []);\n    // Save sync queue to localStorage\n    const saveSyncQueue = useCallback((queue) => {\n        try {\n            localStorage.setItem(SYNC_QUEUE_KEY, JSON.stringify(queue));\n        }\n        catch (error) {\n            console.error('Failed to save sync queue:', error);\n        }\n    }, []);\n    // Initialize or update sync queue\n    useEffect(() => {\n        const queue = loadSyncQueue();\n        setState(prev => (Object.assign(Object.assign({}, prev), { syncQueue: queue, pendingOperations: queue.filter(item => !item.resolved).length })));\n    }, [loadSyncQueue]);\n    // Online/offline status detection\n    useEffect(() => {\n        const handleOnline = () => {\n            setState(prev => (Object.assign(Object.assign({}, prev), { isOnline: true })));\n            // Trigger immediate sync when coming back online\n            syncData();\n        };\n        const handleOffline = () => {\n            setState(prev => (Object.assign(Object.assign({}, prev), { isOnline: false })));\n        };\n        window.addEventListener('online', handleOnline);\n        window.addEventListener('offline', handleOffline);\n        return () => {\n            window.removeEventListener('online', handleOnline);\n            window.removeEventListener('offline', handleOffline);\n        };\n    }, []);\n    // Add an operation to the sync queue\n    const queueOperation = useCallback((operation, data, userId) => {\n        const newItem = {\n            id: `sync_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,\n            timestamp: Date.now(),\n            userId,\n            operation,\n            data,\n            retryCount: 0,\n            resolved: false\n        };\n        setState(prev => {\n            const updatedQueue = [...prev.syncQueue, newItem];\n            saveSyncQueue(updatedQueue);\n            return Object.assign(Object.assign({}, prev), { syncQueue: updatedQueue, pendingOperations: updatedQueue.filter(item => !item.resolved).length });\n        });\n        // If online, try to sync immediately\n        if (navigator.onLine) {\n            syncData();\n        }\n    }, [saveSyncQueue]);\n    // Execute a specific operation against the API\n    const executeOperation = useCallback((item) => __awaiter(void 0, void 0, void 0, function* () {\n        const { operation, data, userId } = item;\n        try {\n            switch (operation) {\n                case SyncOperationType.ADD_CLOSET_ITEM:\n                    yield apiClient.current.addClosetItem(userId, data);\n                    break;\n                case SyncOperationType.REMOVE_CLOSET_ITEM:\n                    yield apiClient.current.removeClosetItem(userId, data.itemId);\n                    break;\n                case SyncOperationType.UPDATE_CLOSET_ITEM:\n                    yield apiClient.current.updateClosetItem(userId, data.itemId, data.updates);\n                    break;\n                case SyncOperationType.TOGGLE_FAVORITE:\n                    yield apiClient.current.toggleFavoriteItem(userId, data.itemId, data.favorite);\n                    break;\n                case SyncOperationType.UPDATE_PREFERENCES:\n                    yield apiClient.current.updatePreferences(userId, data);\n                    break;\n                case SyncOperationType.SUBMIT_QUIZ:\n                    yield apiClient.current.submitStyleQuiz(userId, data);\n                    break;\n                case SyncOperationType.SAVE_OUTFIT:\n                    // Implement when server API is available\n                    console.log('Saving outfit to server:', data);\n                    break;\n                case SyncOperationType.REMOVE_OUTFIT:\n                    // Implement when server API is available\n                    console.log('Removing outfit from server:', data);\n                    break;\n                case SyncOperationType.ADD_LIKED_ITEM:\n                case SyncOperationType.ADD_DISLIKED_ITEM:\n                case SyncOperationType.REMOVE_LIKED_ITEM:\n                case SyncOperationType.REMOVE_DISLIKED_ITEM:\n                    // These are handled in the full profile sync\n                    console.log('Preference feedback will be synced with full profile');\n                    break;\n                default:\n                    console.warn('Unknown operation type:', operation);\n                    return false;\n            }\n            return true;\n        }\n        catch (error) {\n            console.error(`Error executing operation ${operation}:`, error);\n            return false;\n        }\n    }), []);\n    // Detect and resolve conflicts between local and server data\n    const resolveConflicts = useCallback((localUser, serverUser) => {\n        if (!localUser || !serverUser)\n            return serverUser || localUser;\n        // Use the most recent data\n        const localTimestamp = new Date(localUser.lastActive).getTime();\n        const serverTimestamp = new Date(serverUser.lastActive).getTime();\n        // If server data is newer, use it as the base\n        let mergedUser = serverTimestamp > localTimestamp ? Object.assign({}, serverUser) : Object.assign({}, localUser);\n        // Special handling for closet items - merge them intelligently\n        const closetMap = new Map();\n        // Add all server items to the map\n        serverUser.closet.forEach(item => {\n            closetMap.set(item.id, item);\n        });\n        // Merge or override with local items based on timestamp\n        localUser.closet.forEach(localItem => {\n            const serverItem = closetMap.get(localItem.id);\n            if (!serverItem) {\n                // Item exists only locally, add it\n                closetMap.set(localItem.id, localItem);\n            }\n            else {\n                // Item exists in both - use the newer one\n                const localItemTime = new Date(localItem.dateAdded).getTime();\n                const serverItemTime = new Date(serverItem.dateAdded).getTime();\n                if (localItemTime > serverItemTime) {\n                    closetMap.set(localItem.id, localItem);\n                }\n            }\n        });\n        // Convert map back to array\n        mergedUser.closet = Array.from(closetMap.values());\n        // Merge feedback data - use sets to avoid duplicates\n        const likedItems = new Set([...serverUser.feedback.likedItems, ...localUser.feedback.likedItems]);\n        const dislikedItems = new Set([...serverUser.feedback.dislikedItems, ...localUser.feedback.dislikedItems]);\n        const viewedItems = new Set([...serverUser.feedback.viewedItems, ...localUser.feedback.viewedItems]);\n        // For saved outfits, keep all from both sources (can refine this later)\n        // This is a simple approach, could be enhanced with more sophisticated merging\n        const savedOutfits = [...serverUser.feedback.savedOutfits];\n        localUser.feedback.savedOutfits.forEach(localOutfit => {\n            if (!savedOutfits.some(outfit => outfit.length === localOutfit.length &&\n                outfit.every(id => localOutfit.includes(id)))) {\n                savedOutfits.push(localOutfit);\n            }\n        });\n        // Update feedback with merged data\n        mergedUser.feedback = Object.assign(Object.assign({}, mergedUser.feedback), { likedItems: Array.from(likedItems), dislikedItems: Array.from(dislikedItems), viewedItems: Array.from(viewedItems), savedOutfits, lastInteraction: new Date(Math.max(new Date(localUser.feedback.lastInteraction).getTime(), new Date(serverUser.feedback.lastInteraction).getTime())) });\n        return mergedUser;\n    }, []);\n    // Pull latest data from the server and merge with local state\n    const syncWithServer = useCallback((userId) => __awaiter(void 0, void 0, void 0, function* () {\n        if (!userId)\n            return;\n        try {\n            // Get user profile from server\n            const serverUser = yield apiClient.current.getUserProfile(userId);\n            // Get local user profile from store\n            const localUser = userStore.user;\n            if (serverUser && localUser) {\n                // Resolve conflicts and update local state\n                const mergedUser = resolveConflicts(localUser, serverUser);\n                userStore.setUser(mergedUser);\n            }\n            else if (serverUser) {\n                // No local user, just use server data\n                userStore.setUser(serverUser);\n            }\n            else if (localUser) {\n                // No server user, upload local data\n                console.log('Server user not found, will upload local data on next sync');\n            }\n            // Update last sync timestamp\n            const now = Date.now();\n            localStorage.setItem(SYNC_LAST_TIMESTAMP, now.toString());\n            setState(prev => (Object.assign(Object.assign({}, prev), { lastSyncTimestamp: now })));\n        }\n        catch (error) {\n            console.error('Error syncing with server:', error);\n        }\n    }), [userStore, resolveConflicts]);\n    // Main sync function - processes the sync queue and syncs with server\n    const syncData = useCallback(() => __awaiter(void 0, void 0, void 0, function* () {\n        var _a;\n        // Skip if already syncing or offline\n        if (state.isSyncing || !navigator.onLine || !userStore.user)\n            return;\n        setState(prev => (Object.assign(Object.assign({}, prev), { isSyncing: true })));\n        try {\n            // Load the latest queue\n            const queue = loadSyncQueue();\n            const pendingItems = queue.filter(item => !item.resolved);\n            if (pendingItems.length > 0) {\n                // Process pending operations\n                const updatedQueue = [...queue];\n                for (const item of pendingItems) {\n                    // Skip if already resolved\n                    if (item.resolved)\n                        continue;\n                    // Try to execute the operation\n                    const success = yield executeOperation(item);\n                    if (success) {\n                        // Mark as resolved if successful\n                        const index = updatedQueue.findIndex(q => q.id === item.id);\n                        if (index !== -1) {\n                            updatedQueue[index] = Object.assign(Object.assign({}, updatedQueue[index]), { resolved: true });\n                        }\n                    }\n                    else {\n                        // Increment retry count if failed\n                        const index = updatedQueue.findIndex(q => q.id === item.id);\n                        if (index !== -1) {\n                            const retryCount = updatedQueue[index].retryCount + 1;\n                            // If retried too many times, mark as resolved to prevent endless retries\n                            const resolved = retryCount >= 5;\n                            updatedQueue[index] = Object.assign(Object.assign({}, updatedQueue[index]), { retryCount,\n                                resolved });\n                        }\n                    }\n                }\n                // Save updated queue\n                saveSyncQueue(updatedQueue);\n                // Update state\n                setState(prev => (Object.assign(Object.assign({}, prev), { syncQueue: updatedQueue, pendingOperations: updatedQueue.filter(item => !item.resolved).length })));\n            }\n            // Pull latest data from server and merge with local state\n            yield syncWithServer(((_a = userStore.user) === null || _a === void 0 ? void 0 : _a.userId) || '');\n        }\n        catch (error) {\n            console.error('Error during sync:', error);\n        }\n        finally {\n            setState(prev => (Object.assign(Object.assign({}, prev), { isSyncing: false })));\n        }\n    }), [state.isSyncing, userStore.user, loadSyncQueue, executeOperation, saveSyncQueue, syncWithServer]);\n    // Set up periodic sync\n    useEffect(() => {\n        if (syncIntervalRef.current) {\n            window.clearInterval(syncIntervalRef.current);\n        }\n        syncIntervalRef.current = window.setInterval(() => {\n            if (navigator.onLine && userStore.user) {\n                syncData();\n            }\n        }, SYNC_INTERVAL);\n        return () => {\n            if (syncIntervalRef.current) {\n                window.clearInterval(syncIntervalRef.current);\n            }\n        };\n    }, [syncData, userStore.user]);\n    // Public API for the hook\n    return {\n        state,\n        syncNow: syncData,\n        // Queue specific operations\n        addClosetItem: (item, userId) => {\n            queueOperation(SyncOperationType.ADD_CLOSET_ITEM, item, userId);\n        },\n        removeClosetItem: (itemId, userId) => {\n            queueOperation(SyncOperationType.REMOVE_CLOSET_ITEM, { itemId }, userId);\n        },\n        updateClosetItem: (itemId, updates, userId) => {\n            queueOperation(SyncOperationType.UPDATE_CLOSET_ITEM, { itemId, updates }, userId);\n        },\n        toggleFavorite: (itemId, favorite, userId) => {\n            queueOperation(SyncOperationType.TOGGLE_FAVORITE, { itemId, favorite }, userId);\n        },\n        updatePreferences: (preferences, userId) => {\n            queueOperation(SyncOperationType.UPDATE_PREFERENCES, preferences, userId);\n        },\n        submitQuiz: (answers, userId) => {\n            queueOperation(SyncOperationType.SUBMIT_QUIZ, answers, userId);\n        },\n        saveOutfit: (outfit, userId) => {\n            queueOperation(SyncOperationType.SAVE_OUTFIT, outfit, userId);\n        },\n        removeOutfit: (outfitId, userId) => {\n            queueOperation(SyncOperationType.REMOVE_OUTFIT, { outfitId }, userId);\n        }\n    };\n};\n// Utility function to check if data needs to be synced\nexport const needsSync = () => {\n    const lastSync = localStorage.getItem(SYNC_LAST_TIMESTAMP);\n    if (!lastSync)\n        return true;\n    const lastSyncTime = parseInt(lastSync, 10);\n    const now = Date.now();\n    // Sync if more than 15 minutes have passed\n    return now - lastSyncTime > 15 * 60 * 1000;\n};\n// Utility to get the status of the sync queue\nexport const getSyncStatus = () => {\n    const queueStr = localStorage.getItem(SYNC_QUEUE_KEY);\n    let pendingCount = 0;\n    if (queueStr) {\n        try {\n            const queue = JSON.parse(queueStr);\n            pendingCount = queue.filter((item) => !item.resolved).length;\n        }\n        catch (error) {\n            console.error('Error parsing sync queue:', error);\n        }\n    }\n    return {\n        pendingCount,\n        isOnline: navigator.onLine\n    };\n};\n// Utility to get sync data for specific user\nexport const getUserSyncData = (userId) => {\n    const key = `${SYNC_STORAGE_PREFIX}${userId}`;\n    return getWithExpiry(key);\n};\n// Utility to store sync data for specific user\nexport const storeUserSyncData = (userId, data) => {\n    const key = `${SYNC_STORAGE_PREFIX}${userId}`;\n    setWithExpiry(key, data, SYNC_EXPIRY);\n};\n","// Utilities for file handling and image loading\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/**\n * Load an image from a URL and get its dimensions\n */\nexport const loadImage = (url) => {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = 'anonymous'; // Enable CORS if possible\n        img.onload = () => {\n            resolve(img);\n        };\n        img.onerror = (error) => {\n            reject(new Error(`Failed to load image: ${error}`));\n        };\n        img.src = url;\n    });\n};\n/**\n * Get image dimensions\n */\nexport const getImageDimensions = (imageUrl) => __awaiter(void 0, void 0, void 0, function* () {\n    const img = yield loadImage(imageUrl);\n    return {\n        width: img.width,\n        height: img.height\n    };\n});\n/**\n * Convert a File to a data URL\n */\nexport const fileToDataUrl = (file) => {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            var _a;\n            if ((_a = e.target) === null || _a === void 0 ? void 0 : _a.result) {\n                resolve(e.target.result);\n            }\n            else {\n                reject(new Error('Failed to convert file to data URL'));\n            }\n        };\n        reader.onerror = (error) => {\n            reject(error);\n        };\n        reader.readAsDataURL(file);\n    });\n};\n/**\n * Check if a file is an image\n */\nexport const isImageFile = (file) => {\n    return file.type.startsWith('image/');\n};\n/**\n * Get the size of a file in a human-readable format\n */\nexport const getFormattedFileSize = (sizeInBytes) => {\n    if (sizeInBytes < 1024) {\n        return `${sizeInBytes} bytes`;\n    }\n    else if (sizeInBytes < 1024 * 1024) {\n        return `${(sizeInBytes / 1024).toFixed(1)} KB`;\n    }\n    else {\n        return `${(sizeInBytes / (1024 * 1024)).toFixed(1)} MB`;\n    }\n};\n/**\n * Create a blob URL from a data URL\n */\nexport const dataUrlToBlob = (dataUrl) => {\n    // Extract the base64 data\n    const base64Data = dataUrl.split(',')[1];\n    const contentType = dataUrl.split(',')[0].split(':')[1].split(';')[0];\n    // Decode base64 data\n    const byteCharacters = atob(base64Data);\n    const byteArrays = [];\n    for (let offset = 0; offset < byteCharacters.length; offset += 512) {\n        const slice = byteCharacters.slice(offset, offset + 512);\n        const byteNumbers = new Array(slice.length);\n        for (let i = 0; i < slice.length; i++) {\n            byteNumbers[i] = slice.charCodeAt(i);\n        }\n        const byteArray = new Uint8Array(byteNumbers);\n        byteArrays.push(byteArray);\n    }\n    const blob = new Blob(byteArrays, { type: contentType });\n    return URL.createObjectURL(blob);\n};\n/**\n * Get an image file's information\n */\nexport const getImageInfo = (file) => __awaiter(void 0, void 0, void 0, function* () {\n    const url = yield fileToDataUrl(file);\n    const img = yield loadImage(url);\n    return {\n        id: `img_${Date.now()}_${Math.floor(Math.random() * 1000)}`,\n        url,\n        file,\n        dimensions: {\n            width: img.width,\n            height: img.height\n        },\n        originalDimensions: {\n            width: img.width,\n            height: img.height\n        },\n        withoutBackground: false,\n        processed: false\n    };\n});\n","// Utilities for canvas manipulation\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/**\n * Draw an image onto a canvas with a specified position, scale, and rotation\n */\nexport const drawImageToCanvas = (ctx, image, rect, rotation = 0, flipHorizontal = false, flipVertical = false) => {\n    // Save the current state\n    ctx.save();\n    // Move to the center of where we want to draw the image\n    const centerX = rect.x + rect.width / 2;\n    const centerY = rect.y + rect.height / 2;\n    ctx.translate(centerX, centerY);\n    // Rotate if needed\n    if (rotation !== 0) {\n        ctx.rotate((rotation * Math.PI) / 180); // Convert degrees to radians\n    }\n    // Scale (and flip) if needed\n    const scaleX = flipHorizontal ? -1 : 1;\n    const scaleY = flipVertical ? -1 : 1;\n    ctx.scale(scaleX, scaleY);\n    // Draw the image centered\n    ctx.drawImage(image, -rect.width / 2, -rect.height / 2, rect.width, rect.height);\n    // Restore the context\n    ctx.restore();\n};\n/**\n * Compose multiple images onto a canvas in specified order\n */\nexport const compositeImages = (canvas, userImage, garments, loadImage) => __awaiter(void 0, void 0, void 0, function* () {\n    const ctx = canvas.getContext('2d');\n    if (!ctx)\n        return;\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    // Draw user image\n    ctx.drawImage(userImage, 0, 0, canvas.width, canvas.height);\n    // Sort garments by zIndex\n    const sortedGarments = [...garments].sort((a, b) => a.zIndex - b.zIndex);\n    // Draw each garment\n    for (const garment of sortedGarments) {\n        try {\n            const garmentImage = yield loadImage(garment.url);\n            // Calculate position and dimensions\n            const dimensions = garment.dimensions || {\n                width: garmentImage.width,\n                height: garmentImage.height\n            };\n            const scale = garment.scale || 1;\n            const scaledDimensions = {\n                width: dimensions.width * scale,\n                height: dimensions.height * scale\n            };\n            const offset = garment.offset || { x: 0, y: 0 };\n            const position = {\n                x: (canvas.width - scaledDimensions.width) / 2 + offset.x,\n                y: (canvas.height - scaledDimensions.height) / 2 + offset.y,\n                width: scaledDimensions.width,\n                height: scaledDimensions.height\n            };\n            // Draw the garment\n            drawImageToCanvas(ctx, garmentImage, position, garment.rotation || 0, garment.flipHorizontal || false, garment.flipVertical || false);\n        }\n        catch (error) {\n            console.error(`Failed to load or draw garment ${garment.id}:`, error);\n        }\n    }\n});\n/**\n * Create an image from a canvas\n */\nexport const canvasToImage = (canvas) => {\n    return new Promise((resolve, reject) => {\n        try {\n            // Convert canvas to data URL\n            const dataUrl = canvas.toDataURL('image/png');\n            resolve(dataUrl);\n        }\n        catch (error) {\n            reject(error);\n        }\n    });\n};\n/**\n * Fill canvas with color or pattern\n */\nexport const fillCanvas = (canvas, fillStyle) => {\n    const ctx = canvas.getContext('2d');\n    if (!ctx)\n        return;\n    ctx.fillStyle = fillStyle;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n};\n/**\n * Draw grid lines for positioning guidance\n */\nexport const drawGuidelines = (canvas, lineColor = 'rgba(0, 0, 255, 0.2)', lineWidth = 1) => {\n    const ctx = canvas.getContext('2d');\n    if (!ctx)\n        return;\n    ctx.save();\n    // Set line style\n    ctx.strokeStyle = lineColor;\n    ctx.lineWidth = lineWidth;\n    // Draw horizontal lines\n    for (let i = 1; i < 3; i++) {\n        const y = (canvas.height / 3) * i;\n        ctx.beginPath();\n        ctx.moveTo(0, y);\n        ctx.lineTo(canvas.width, y);\n        ctx.stroke();\n    }\n    // Draw vertical lines\n    for (let i = 1; i < 3; i++) {\n        const x = (canvas.width / 3) * i;\n        ctx.beginPath();\n        ctx.moveTo(x, 0);\n        ctx.lineTo(x, canvas.height);\n        ctx.stroke();\n    }\n    // Draw center cross\n    ctx.beginPath();\n    ctx.moveTo(canvas.width / 2, 0);\n    ctx.lineTo(canvas.width / 2, canvas.height);\n    ctx.moveTo(0, canvas.height / 2);\n    ctx.lineTo(canvas.width, canvas.height / 2);\n    ctx.stroke();\n    ctx.restore();\n};\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport './BodyGuide.scss';\nimport { BodyPosition } from '@/types/tryOn';\nconst BodyGuide = ({ width, height, activePosition }) => {\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-body-guide\", style: { width, height } }, { children: [_jsx(\"div\", Object.assign({ className: `stylist-body-guide__region stylist-body-guide__region--head ${activePosition === BodyPosition.HEAD ? 'stylist-body-guide__region--active' : ''}` }, { children: _jsx(\"span\", Object.assign({ className: \"stylist-body-guide__label\" }, { children: \"Head\" })) })), _jsx(\"div\", Object.assign({ className: `stylist-body-guide__region stylist-body-guide__region--neck ${activePosition === BodyPosition.NECK ? 'stylist-body-guide__region--active' : ''}` }, { children: _jsx(\"span\", Object.assign({ className: \"stylist-body-guide__label\" }, { children: \"Neck\" })) })), _jsx(\"div\", Object.assign({ className: `stylist-body-guide__region stylist-body-guide__region--upper-body ${activePosition === BodyPosition.UPPER_BODY ? 'stylist-body-guide__region--active' : ''}` }, { children: _jsx(\"span\", Object.assign({ className: \"stylist-body-guide__label\" }, { children: \"Upper Body\" })) })), _jsx(\"div\", Object.assign({ className: `stylist-body-guide__region stylist-body-guide__region--waist ${activePosition === BodyPosition.WAIST ? 'stylist-body-guide__region--active' : ''}` }, { children: _jsx(\"span\", Object.assign({ className: \"stylist-body-guide__label\" }, { children: \"Waist\" })) })), _jsx(\"div\", Object.assign({ className: `stylist-body-guide__region stylist-body-guide__region--lower-body ${activePosition === BodyPosition.LOWER_BODY ? 'stylist-body-guide__region--active' : ''}` }, { children: _jsx(\"span\", Object.assign({ className: \"stylist-body-guide__label\" }, { children: \"Lower Body\" })) })), _jsx(\"div\", Object.assign({ className: `stylist-body-guide__region stylist-body-guide__region--feet ${activePosition === BodyPosition.FEET ? 'stylist-body-guide__region--active' : ''}` }, { children: _jsx(\"span\", Object.assign({ className: \"stylist-body-guide__label\" }, { children: \"Feet\" })) })), _jsx(\"div\", Object.assign({ className: `stylist-body-guide__region stylist-body-guide__region--full-body ${activePosition === BodyPosition.FULL_BODY ? 'stylist-body-guide__region--active' : ''}` }, { children: _jsx(\"span\", Object.assign({ className: \"stylist-body-guide__label\" }, { children: \"Full Body\" })) }))] })));\n};\nexport default BodyGuide;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// src/components/TryOnCanvas/TryOnCanvas.tsx\nimport { useEffect, useRef, useState } from 'react';\nimport './TryOnCanvas.scss';\nimport { GarmentType } from '@/types/tryOn';\nimport { useTryOnStore } from '@/store/tryOnStore';\nimport { loadImage } from '@/services/image-processing/fileUtils';\nimport { compositeImages, drawGuidelines } from '@/services/image-processing/canvasUtils';\nimport { getDefaultBodyPosition } from '@/services/image-processing/imagePositioning';\nimport BodyGuide from './BodyGuide';\nconst TryOnCanvas = ({ outfit, userImage, setCanvasRef, onGarmentSelect, showBodyGuide = false }) => {\n    var _a;\n    const canvasRef = useRef(null);\n    const [activeGarmentId, setActiveGarmentId] = useState(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragStart, setDragStart] = useState(null);\n    const canvasWidth = useTryOnStore((state) => state.canvasWidth);\n    const canvasHeight = useTryOnStore((state) => state.canvasHeight);\n    const showGuidelines = useTryOnStore((state) => state.settings.showGuidelines);\n    const updateGarment = useTryOnStore((state) => state.updateGarment);\n    // Register canvas ref with parent component and store\n    useEffect(() => {\n        if (canvasRef.current) {\n            setCanvasRef(canvasRef.current);\n        }\n    }, [setCanvasRef]);\n    // Render canvas when outfit or user image changes\n    useEffect(() => {\n        const renderCanvas = () => __awaiter(void 0, void 0, void 0, function* () {\n            const canvas = canvasRef.current;\n            if (!canvas)\n                return;\n            const ctx = canvas.getContext('2d');\n            if (!ctx)\n                return;\n            // Clear canvas\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            // Draw guidelines if enabled and no user image\n            if (showGuidelines && !userImage) {\n                // Draw regular guidelines - body guide is shown as a separate component\n                drawGuidelines(canvas);\n                return;\n            }\n            // If no user image, show empty canvas\n            if (!userImage) {\n                return;\n            }\n            try {\n                // Load user image\n                const userImg = yield loadImage(userImage.url);\n                // Draw user image full canvas\n                ctx.drawImage(userImg, 0, 0, canvas.width, canvas.height);\n                // Draw garments if available\n                if (outfit === null || outfit === void 0 ? void 0 : outfit.garments.length) {\n                    yield compositeImages(canvas, userImg, outfit.garments, loadImage);\n                }\n            }\n            catch (error) {\n                console.error('Error rendering canvas:', error);\n            }\n        });\n        renderCanvas();\n    }, [outfit, userImage, canvasWidth, canvasHeight, showGuidelines, activeGarmentId, showBodyGuide]);\n    // Handle canvas click for garment selection\n    const handleCanvasClick = (e) => __awaiter(void 0, void 0, void 0, function* () {\n        if (!onGarmentSelect || !outfit || !outfit.garments.length)\n            return;\n        const canvas = canvasRef.current;\n        if (!canvas)\n            return;\n        // Get click coordinates\n        const rect = canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n        // Check if click is on a garment (from top to bottom in z-index order)\n        const sortedGarments = [...outfit.garments].sort((a, b) => b.zIndex - a.zIndex);\n        // Find the first garment that contains the click point\n        for (const garment of sortedGarments) {\n            try {\n                const { dimensions, offset, scale } = garment;\n                if (!dimensions || !offset)\n                    continue;\n                // Calculate garment position\n                const centerX = canvas.width / 2 + offset.x;\n                const centerY = canvas.height / 2 + offset.y;\n                // Calculate scaled dimensions\n                const scaledWidth = dimensions.width * (scale || 1);\n                const scaledHeight = dimensions.height * (scale || 1);\n                // Calculate garment bounding box\n                const left = centerX - scaledWidth / 2;\n                const top = centerY - scaledHeight / 2;\n                const right = left + scaledWidth;\n                const bottom = top + scaledHeight;\n                // Check if click is within bounding box\n                if (x >= left && x <= right && y >= top && y <= bottom) {\n                    onGarmentSelect(garment.id);\n                    setActiveGarmentId(garment.id);\n                    return;\n                }\n            }\n            catch (error) {\n                console.error('Error checking garment click:', error);\n            }\n        }\n        // If click is not on any garment, deselect\n        onGarmentSelect(null);\n        setActiveGarmentId(null);\n    });\n    // Handle mouse down for drag start\n    const handleMouseDown = (e) => {\n        if (!activeGarmentId)\n            return;\n        const canvas = canvasRef.current;\n        if (!canvas)\n            return;\n        const rect = canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n        setIsDragging(true);\n        setDragStart({ x, y });\n    };\n    // Handle mouse move for dragging\n    const handleMouseMove = (e) => {\n        if (!isDragging || !dragStart || !activeGarmentId || !outfit)\n            return;\n        const canvas = canvasRef.current;\n        if (!canvas)\n            return;\n        const rect = canvas.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n        const deltaX = x - dragStart.x;\n        const deltaY = y - dragStart.y;\n        // Update drag start for next move\n        setDragStart({ x, y });\n        // Find the active garment\n        const garment = outfit.garments.find(g => g.id === activeGarmentId);\n        if (!garment || !garment.offset)\n            return;\n        // Update garment offset\n        const newOffset = {\n            x: garment.offset.x + deltaX,\n            y: garment.offset.y + deltaY\n        };\n        // Update garment in store\n        updateGarment(activeGarmentId, { offset: newOffset });\n    };\n    // Handle mouse up to end dragging\n    const handleMouseUp = () => {\n        setIsDragging(false);\n        setDragStart(null);\n    };\n    // Ensure mouse up is captured even if outside canvas\n    useEffect(() => {\n        const handleGlobalMouseUp = () => {\n            setIsDragging(false);\n            setDragStart(null);\n        };\n        document.addEventListener('mouseup', handleGlobalMouseUp);\n        return () => {\n            document.removeEventListener('mouseup', handleGlobalMouseUp);\n        };\n    }, []);\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-canvas\" }, { children: [_jsx(\"canvas\", { ref: canvasRef, width: canvasWidth, height: canvasHeight, className: `stylist-try-on-canvas__canvas ${isDragging ? 'stylist-try-on-canvas__canvas--dragging' : ''}`, onClick: handleCanvasClick, onMouseDown: handleMouseDown, onMouseMove: handleMouseMove, onMouseUp: handleMouseUp }), showBodyGuide && !userImage && (_jsx(BodyGuide, { width: canvasWidth, height: canvasHeight, activePosition: activeGarmentId ? getDefaultBodyPosition(((_a = outfit === null || outfit === void 0 ? void 0 : outfit.garments.find(g => g.id === activeGarmentId)) === null || _a === void 0 ? void 0 : _a.type) || GarmentType.TOP) : undefined })), !userImage && (_jsx(\"div\", Object.assign({ className: \"stylist-try-on-canvas__placeholder\" }, { children: _jsx(\"div\", Object.assign({ className: \"stylist-try-on-canvas__placeholder-text\" }, { children: \"Upload a photo to start the virtual try-on\" })) })))] })));\n};\nexport default TryOnCanvas;\n","// src/components/TryOnCanvas/index.ts\nimport TryOnCanvas from './TryOnCanvas';\nexport default TryOnCanvas;\n","// src/components/TryOnControls/index.ts\nimport TryOnControls from './TryOnControls';\nexport default TryOnControls;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// TryOnControls component for adjusting garments\nimport { useState, useRef } from 'react';\nimport './TryOnControls.scss';\nimport { GarmentType } from '@/types/tryOn';\nconst TryOnControls = ({ outfit, activeGarmentId, onGarmentSelect, onGarmentRemove, onGarmentUpdate, onGarmentAdd, onChangePhoto, disabled = false }) => {\n    var _a, _b, _c, _d;\n    const [showGarments, setShowGarments] = useState(true);\n    const [showControls, setShowControls] = useState(true);\n    const [showAddGarment, setShowAddGarment] = useState(false);\n    const fileInputRef = useRef(null);\n    const [selectedGarmentType, setSelectedGarmentType] = useState(null);\n    // Get active garment details\n    const activeGarment = outfit === null || outfit === void 0 ? void 0 : outfit.garments.find(g => g.id === activeGarmentId);\n    // Handle file input change\n    const handleFileInputChange = (e) => {\n        var _a;\n        const file = (_a = e.target.files) === null || _a === void 0 ? void 0 : _a[0];\n        if (file && selectedGarmentType) {\n            onGarmentAdd(file, selectedGarmentType);\n            // Reset\n            setSelectedGarmentType(null);\n            setShowAddGarment(false);\n            // Clear the input\n            if (fileInputRef.current) {\n                fileInputRef.current.value = '';\n            }\n        }\n    };\n    // Open file dialog for the selected garment type\n    const handleAddGarment = (type) => {\n        setSelectedGarmentType(type);\n        if (fileInputRef.current) {\n            fileInputRef.current.click();\n        }\n    };\n    // Update scale value\n    const handleScaleChange = (e) => {\n        if (activeGarmentId) {\n            const scale = parseFloat(e.target.value);\n            onGarmentUpdate(activeGarmentId, { scale });\n        }\n    };\n    // Update position (offset)\n    const handlePositionChange = (axis, value) => {\n        if (activeGarmentId && (activeGarment === null || activeGarment === void 0 ? void 0 : activeGarment.offset)) {\n            const newOffset = Object.assign({}, activeGarment.offset);\n            newOffset[axis] = value;\n            onGarmentUpdate(activeGarmentId, { offset: newOffset });\n        }\n    };\n    // Update rotation\n    const handleRotationChange = (e) => {\n        if (activeGarmentId) {\n            const rotation = parseFloat(e.target.value);\n            onGarmentUpdate(activeGarmentId, { rotation });\n        }\n    };\n    // Toggle flip horizontal\n    const handleFlipHorizontal = () => {\n        if (activeGarmentId) {\n            onGarmentUpdate(activeGarmentId, {\n                flipHorizontal: !((activeGarment === null || activeGarment === void 0 ? void 0 : activeGarment.flipHorizontal) || false)\n            });\n        }\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__section\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__section-header\", onClick: () => setShowGarments(!showGarments) }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-try-on-controls__section-title\" }, { children: \"Garments\" })), _jsx(\"span\", Object.assign({ className: \"stylist-try-on-controls__section-toggle\" }, { children: showGarments ? '' : '+' }))] })), showGarments && (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__section-content\" }, { children: [(!(outfit === null || outfit === void 0 ? void 0 : outfit.garments) || outfit.garments.length === 0) ? (_jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__empty\" }, { children: \"No garments added yet. Add a garment below.\" }))) : (_jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__garment-list\" }, { children: outfit.garments.map(garment => (_jsxs(\"div\", Object.assign({ className: `stylist-try-on-controls__garment-thumbnail ${activeGarmentId === garment.id ? 'stylist-try-on-controls__garment-thumbnail--active' : ''}`, onClick: () => onGarmentSelect(garment.id) }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__garment-image\" }, { children: _jsx(\"img\", { src: garment.url, alt: garment.type }) })), _jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__garment-type\" }, { children: garment.type })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__garment-remove\", onClick: (e) => {\n                                                e.stopPropagation();\n                                                onGarmentRemove(garment.id);\n                                            }, \"aria-label\": \"Remove garment\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"16\", height: \"16\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z\" }) })) }))] }), garment.id))) }))), _jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__add-garment\" }, { children: [_jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button stylist-try-on-controls__button--full-width\", onClick: () => setShowAddGarment(!showAddGarment), disabled: disabled }, { children: showAddGarment ? 'Cancel' : '+ Add Garment' })), showAddGarment && (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__garment-types\", style: { marginTop: '8px' } }, { children: [_jsx(\"span\", Object.assign({ className: \"stylist-try-on-controls__label\" }, { children: \"Select garment type:\" })), _jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__button-group\" }, { children: [_jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button\", onClick: () => handleAddGarment(GarmentType.TOP), disabled: disabled }, { children: \"Top\" })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button\", onClick: () => handleAddGarment(GarmentType.BOTTOM), disabled: disabled }, { children: \"Bottom\" })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button\", onClick: () => handleAddGarment(GarmentType.DRESS), disabled: disabled }, { children: \"Dress\" })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button\", onClick: () => handleAddGarment(GarmentType.OUTERWEAR), disabled: disabled }, { children: \"Outerwear\" })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button\", onClick: () => handleAddGarment(GarmentType.SHOES), disabled: disabled }, { children: \"Shoes\" })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button\", onClick: () => handleAddGarment(GarmentType.ACCESSORY), disabled: disabled }, { children: \"Accessory\" }))] })), _jsx(\"input\", { ref: fileInputRef, type: \"file\", accept: \"image/*\", className: \"stylist-try-on-controls__input\", style: { display: 'none' }, onChange: handleFileInputChange, disabled: disabled })] })))] }))] })))] })), activeGarment && (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__section\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__section-header\", onClick: () => setShowControls(!showControls) }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-try-on-controls__section-title\" }, { children: \"Adjustments\" })), _jsx(\"span\", Object.assign({ className: \"stylist-try-on-controls__section-toggle\" }, { children: showControls ? '' : '+' }))] })), showControls && (_jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__section-content\" }, { children: _jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__garment-controls\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__control-group\" }, { children: [_jsxs(\"label\", Object.assign({ className: \"stylist-try-on-controls__label\" }, { children: [\"Size\", _jsxs(\"span\", Object.assign({ className: \"stylist-try-on-controls__value\" }, { children: [Math.round((activeGarment.scale || 1) * 100), \"%\"] }))] })), _jsx(\"input\", { type: \"range\", min: \"0.1\", max: \"2\", step: \"0.05\", value: activeGarment.scale || 1, onChange: handleScaleChange, className: \"stylist-try-on-controls__slider\", disabled: disabled })] })), _jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__control-group\" }, { children: [_jsxs(\"label\", Object.assign({ className: \"stylist-try-on-controls__label\" }, { children: [\"Position X\", _jsxs(\"span\", Object.assign({ className: \"stylist-try-on-controls__value\" }, { children: [((_a = activeGarment.offset) === null || _a === void 0 ? void 0 : _a.x) || 0, \"px\"] }))] })), _jsx(\"input\", { type: \"range\", min: \"-200\", max: \"200\", step: \"1\", value: ((_b = activeGarment.offset) === null || _b === void 0 ? void 0 : _b.x) || 0, onChange: (e) => handlePositionChange('x', parseInt(e.target.value)), className: \"stylist-try-on-controls__slider\", disabled: disabled })] })), _jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__control-group\" }, { children: [_jsxs(\"label\", Object.assign({ className: \"stylist-try-on-controls__label\" }, { children: [\"Position Y\", _jsxs(\"span\", Object.assign({ className: \"stylist-try-on-controls__value\" }, { children: [((_c = activeGarment.offset) === null || _c === void 0 ? void 0 : _c.y) || 0, \"px\"] }))] })), _jsx(\"input\", { type: \"range\", min: \"-200\", max: \"200\", step: \"1\", value: ((_d = activeGarment.offset) === null || _d === void 0 ? void 0 : _d.y) || 0, onChange: (e) => handlePositionChange('y', parseInt(e.target.value)), className: \"stylist-try-on-controls__slider\", disabled: disabled })] })), _jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__control-group\" }, { children: [_jsxs(\"label\", Object.assign({ className: \"stylist-try-on-controls__label\" }, { children: [\"Rotation\", _jsxs(\"span\", Object.assign({ className: \"stylist-try-on-controls__value\" }, { children: [activeGarment.rotation || 0, \"\\u00B0\"] }))] })), _jsx(\"input\", { type: \"range\", min: \"-180\", max: \"180\", step: \"1\", value: activeGarment.rotation || 0, onChange: handleRotationChange, className: \"stylist-try-on-controls__slider\", disabled: disabled })] })), _jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__control-group\" }, { children: _jsx(\"button\", Object.assign({ className: `stylist-try-on-controls__button ${activeGarment.flipHorizontal ? 'stylist-try-on-controls__button--active' : ''}`, onClick: handleFlipHorizontal, disabled: disabled }, { children: \"Flip Horizontal\" })) }))] })) })))] }))), _jsxs(\"div\", Object.assign({ className: \"stylist-try-on-controls__section\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__section-header\" }, { children: _jsx(\"h3\", Object.assign({ className: \"stylist-try-on-controls__section-title\" }, { children: \"Photo\" })) })), _jsx(\"div\", Object.assign({ className: \"stylist-try-on-controls__section-content\" }, { children: _jsx(\"button\", Object.assign({ className: \"stylist-try-on-controls__button stylist-try-on-controls__button--full-width\", onClick: onChangePhoto, disabled: disabled }, { children: \"Change Photo\" })) }))] }))] })));\n};\nexport default TryOnControls;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// TryOnFeedback component for providing feedback on virtual try-on\nimport { useState } from 'react';\nimport './TryOnFeedback.scss';\nimport { useRecommendationStore } from '@/store/index';\nconst TryOnFeedback = ({ garmentId, onLike, onDislike, onAddToWishlist, onAddToCart, onSaveNote, item, primaryColor }) => {\n    const [isLiked, setIsLiked] = useState(false);\n    const [showLikeOptions, setShowLikeOptions] = useState(false);\n    const [note, setNote] = useState('');\n    const [showNoteInput, setShowNoteInput] = useState(false);\n    const [addedToWishlist, setAddedToWishlist] = useState(false);\n    const [addedToCart, setAddedToCart] = useState(false);\n    const [noteSaved, setNoteSaved] = useState(false);\n    // Access the recommendation store\n    const { addToWishlist, addToCart } = useRecommendationStore();\n    // Handle like button click\n    const handleLike = () => {\n        setIsLiked(true);\n        onLike(garmentId);\n        setShowLikeOptions(true);\n    };\n    // Handle dislike button click\n    const handleDislike = () => {\n        onDislike(garmentId);\n    };\n    // Handle add to wishlist\n    const handleAddToWishlist = () => {\n        var _a;\n        // Create a wishlist item (even if item is not provided)\n        const wishlistItem = {\n            itemId: garmentId,\n            retailerId: (item === null || item === void 0 ? void 0 : item.retailerId) || 'demo_retailer',\n            addedAt: new Date(),\n            name: (item === null || item === void 0 ? void 0 : item.name) || `Item ${garmentId.slice(0, 6)}`,\n            brand: (item === null || item === void 0 ? void 0 : item.brand) || 'Unknown brand',\n            price: (item === null || item === void 0 ? void 0 : item.price) || 0,\n            imageUrl: ((_a = item === null || item === void 0 ? void 0 : item.imageUrls) === null || _a === void 0 ? void 0 : _a[0]) || ''\n        };\n        // Add to store\n        addToWishlist(wishlistItem);\n        // Call the prop callback\n        onAddToWishlist(garmentId);\n        // Show success state\n        setAddedToWishlist(true);\n        setShowLikeOptions(false);\n        // Reset success state after a delay\n        setTimeout(() => {\n            setAddedToWishlist(false);\n        }, 2000);\n    };\n    // Handle add to cart\n    const handleAddToCart = () => {\n        var _a, _b, _c;\n        // Create a cart item (even if item is not provided)\n        const cartItem = {\n            itemId: garmentId,\n            retailerId: (item === null || item === void 0 ? void 0 : item.retailerId) || 'demo_retailer',\n            quantity: 1,\n            size: ((_a = item === null || item === void 0 ? void 0 : item.sizes) === null || _a === void 0 ? void 0 : _a[0]) || 'M',\n            color: ((_b = item === null || item === void 0 ? void 0 : item.colors) === null || _b === void 0 ? void 0 : _b[0]) || 'default',\n            addedAt: new Date(),\n            name: (item === null || item === void 0 ? void 0 : item.name) || `Item ${garmentId.slice(0, 6)}`,\n            brand: (item === null || item === void 0 ? void 0 : item.brand) || 'Unknown brand',\n            price: (item === null || item === void 0 ? void 0 : item.price) || 0,\n            imageUrl: ((_c = item === null || item === void 0 ? void 0 : item.imageUrls) === null || _c === void 0 ? void 0 : _c[0]) || ''\n        };\n        // Add to store\n        addToCart(cartItem);\n        // Call the prop callback\n        onAddToCart(garmentId);\n        // Show success state\n        setAddedToCart(true);\n        setShowLikeOptions(false);\n        // Reset success state after a delay\n        setTimeout(() => {\n            setAddedToCart(false);\n        }, 2000);\n    };\n    // Handle save note\n    const handleSaveNote = () => {\n        if (note.trim()) {\n            onSaveNote(garmentId, note);\n            // Show success state\n            setNoteSaved(true);\n            setShowNoteInput(false);\n            setShowLikeOptions(false);\n            // Reset success state after a delay\n            setTimeout(() => {\n                setNoteSaved(false);\n                setNote('');\n            }, 2000);\n        }\n    };\n    // Custom style for primary color\n    const buttonStyle = primaryColor ? { backgroundColor: primaryColor } : undefined;\n    // Render success states\n    if (addedToWishlist) {\n        return (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-feedback__success\" }, { children: [_jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Added to Wishlist\" }, { children: \"\\u2764\\uFE0F\" })), \" Added to Wishlist!\"] })));\n    }\n    if (addedToCart) {\n        return (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-feedback__success\" }, { children: [_jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Added to Cart\" }, { children: \"\\uD83D\\uDED2\" })), \" Added to Cart!\"] })));\n    }\n    if (noteSaved) {\n        return (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-feedback__success\" }, { children: [_jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Note Saved\" }, { children: \"\\uD83D\\uDCDD\" })), \" Note Saved!\"] })));\n    }\n    return (_jsx(\"div\", Object.assign({ className: \"stylist-try-on-feedback\" }, { children: !isLiked ? (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-feedback__buttons\" }, { children: [_jsx(\"button\", Object.assign({ className: \"stylist-try-on-feedback__button stylist-try-on-feedback__button--like\", onClick: handleLike, style: buttonStyle }, { children: _jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Like\" }, { children: \"\\uD83D\\uDC4D\" })) })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-feedback__button stylist-try-on-feedback__button--dislike\", onClick: handleDislike }, { children: _jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Dislike\" }, { children: \"\\uD83D\\uDC4E\" })) }))] }))) : showLikeOptions ? (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-feedback__options\" }, { children: [_jsx(\"button\", Object.assign({ className: \"stylist-try-on-feedback__option-button\", onClick: handleAddToWishlist, style: buttonStyle }, { children: \"Add to Wishlist\" })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-feedback__option-button\", onClick: handleAddToCart, style: buttonStyle }, { children: \"Add to Cart\" })), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-feedback__option-button\", onClick: () => setShowNoteInput(true), style: buttonStyle }, { children: \"Just Save a Note\" }))] }))) : showNoteInput ? (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-feedback__note-input\" }, { children: [_jsx(\"input\", { type: \"text\", placeholder: \"What do you like about this item?\", value: note, onChange: (e) => setNote(e.target.value), autoFocus: true }), _jsx(\"button\", Object.assign({ className: \"stylist-try-on-feedback__note-save\", onClick: handleSaveNote, style: buttonStyle }, { children: \"Save\" }))] }))) : (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-feedback__liked\" }, { children: [_jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Liked\" }, { children: \"\\uD83D\\uDC96\" })), \" Liked!\"] }))) })));\n};\nexport default TryOnFeedback;\n","import ImageUploader from './ImageUploader';\nexport default ImageUploader;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\n// Image uploader component with webcam support for try-on functionality\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport './ImageUploader.scss';\nimport { getFormattedFileSize, isImageFile } from '@/services/image-processing/fileUtils';\nconst ImageUploader = ({ onUpload, maxSize = 10 * 1024 * 1024, // 10MB default\nacceptedTypes = ['image/jpeg', 'image/png', 'image/webp'], title = 'Upload your photo', description = 'Take a photo or upload one to try on clothes' }) => {\n    const [isDragging, setIsDragging] = useState(false);\n    const [error, setError] = useState(null);\n    const [selectedFile, setSelectedFile] = useState(null);\n    const [preview, setPreview] = useState(null);\n    const [isUsingWebcam, setIsUsingWebcam] = useState(false);\n    const [isCameraSupported, setIsCameraSupported] = useState(true);\n    const fileInputRef = useRef(null);\n    const videoRef = useRef(null);\n    const canvasRef = useRef(null);\n    // Check if webcam is supported\n    useEffect(() => {\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n            setIsCameraSupported(false);\n        }\n    }, []);\n    // Handle drag events\n    const handleDragOver = useCallback((e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n    }, []);\n    const handleDragLeave = useCallback((e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(false);\n    }, []);\n    // Handle file selection\n    const handleFileSelect = useCallback((file) => {\n        setError(null);\n        if (!file) {\n            setSelectedFile(null);\n            setPreview(null);\n            return;\n        }\n        // Validate file type\n        if (!isImageFile(file) || !acceptedTypes.includes(file.type)) {\n            setError(`Invalid file type. Accepted types: ${acceptedTypes.join(', ')}`);\n            return;\n        }\n        // Validate file size\n        if (file.size > maxSize) {\n            setError(`File size exceeds maximum allowed size of ${getFormattedFileSize(maxSize)}`);\n            return;\n        }\n        // Set selected file\n        setSelectedFile(file);\n        // Create preview\n        const reader = new FileReader();\n        reader.onload = () => {\n            setPreview(reader.result);\n        };\n        reader.readAsDataURL(file);\n    }, [acceptedTypes, maxSize]);\n    // Handle drop event\n    const handleDrop = useCallback((e) => {\n        var _a;\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(false);\n        const file = ((_a = e.dataTransfer.files) === null || _a === void 0 ? void 0 : _a[0]) || null;\n        handleFileSelect(file);\n    }, [handleFileSelect]);\n    // Handle file input change\n    const handleFileInputChange = useCallback((e) => {\n        var _a;\n        const file = ((_a = e.target.files) === null || _a === void 0 ? void 0 : _a[0]) || null;\n        handleFileSelect(file);\n    }, [handleFileSelect]);\n    // Open file dialog\n    const handleButtonClick = useCallback(() => {\n        if (fileInputRef.current) {\n            fileInputRef.current.click();\n        }\n    }, []);\n    // Upload the selected file\n    const handleUpload = useCallback(() => {\n        if (selectedFile) {\n            onUpload(selectedFile);\n        }\n    }, [selectedFile, onUpload]);\n    // Start webcam\n    const startWebcam = useCallback(() => __awaiter(void 0, void 0, void 0, function* () {\n        setError(null);\n        setIsUsingWebcam(true);\n        try {\n            const stream = yield navigator.mediaDevices.getUserMedia({\n                video: {\n                    facingMode: 'user',\n                    width: { ideal: 1280 },\n                    height: { ideal: 720 }\n                }\n            });\n            if (videoRef.current) {\n                videoRef.current.srcObject = stream;\n            }\n        }\n        catch (err) {\n            console.error('Error accessing webcam:', err);\n            setError('Could not access webcam. Please check permissions and try again.');\n            setIsUsingWebcam(false);\n        }\n    }), []);\n    // Stop webcam\n    const stopWebcam = useCallback(() => {\n        if (videoRef.current && videoRef.current.srcObject) {\n            const stream = videoRef.current.srcObject;\n            const tracks = stream.getTracks();\n            tracks.forEach(track => track.stop());\n            videoRef.current.srcObject = null;\n        }\n        setIsUsingWebcam(false);\n    }, []);\n    // Capture photo from webcam\n    const capturePhoto = useCallback(() => {\n        if (videoRef.current && canvasRef.current) {\n            const video = videoRef.current;\n            const canvas = canvasRef.current;\n            // Set canvas dimensions to match video\n            canvas.width = video.videoWidth;\n            canvas.height = video.videoHeight;\n            // Draw video frame to canvas\n            const context = canvas.getContext('2d');\n            if (context) {\n                context.drawImage(video, 0, 0, canvas.width, canvas.height);\n                // Convert canvas to blob\n                canvas.toBlob((blob) => {\n                    if (blob) {\n                        // Create File object from blob\n                        const file = new File([blob], `webcam-photo-${Date.now()}.jpg`, {\n                            type: 'image/jpeg'\n                        });\n                        setSelectedFile(file);\n                        setPreview(canvas.toDataURL('image/jpeg'));\n                        stopWebcam();\n                    }\n                }, 'image/jpeg', 0.95);\n            }\n        }\n    }, [stopWebcam]);\n    // Clean up webcam on unmount\n    useEffect(() => {\n        return () => {\n            if (isUsingWebcam) {\n                stopWebcam();\n            }\n        };\n    }, [isUsingWebcam, stopWebcam]);\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-image-uploader\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-image-uploader__header\" }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-image-uploader__title\" }, { children: title })), _jsx(\"p\", Object.assign({ className: \"stylist-image-uploader__description\" }, { children: description }))] })), isUsingWebcam ? (_jsxs(\"div\", Object.assign({ className: \"stylist-image-uploader__webcam\" }, { children: [_jsx(\"video\", { ref: videoRef, autoPlay: true, playsInline: true, className: \"stylist-image-uploader__video\" }), _jsx(\"canvas\", { ref: canvasRef, style: { display: 'none' } }), _jsxs(\"div\", Object.assign({ className: \"stylist-image-uploader__webcam-controls\" }, { children: [_jsx(\"button\", Object.assign({ type: \"button\", className: \"stylist-image-uploader__capture-btn\", onClick: capturePhoto }, { children: \"Take Photo\" })), _jsx(\"button\", Object.assign({ type: \"button\", className: \"stylist-image-uploader__cancel-btn\", onClick: stopWebcam }, { children: \"Cancel\" }))] }))] }))) : (_jsxs(\"div\", Object.assign({ className: `stylist-image-uploader__dropzone ${isDragging ? 'stylist-image-uploader__dropzone--active' : ''} ${preview ? 'stylist-image-uploader__dropzone--has-preview' : ''}`, onDragOver: handleDragOver, onDragLeave: handleDragLeave, onDrop: handleDrop, onClick: preview ? undefined : handleButtonClick }, { children: [preview ? (_jsx(\"div\", Object.assign({ className: \"stylist-image-uploader__preview\" }, { children: _jsx(\"img\", { src: preview, alt: \"Upload preview\" }) }))) : (_jsxs(\"div\", Object.assign({ className: \"stylist-image-uploader__placeholder\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-image-uploader__icon\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"48\", height: \"48\" }, { children: _jsx(\"path\", { d: \"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z\" }) })) })), _jsxs(\"p\", Object.assign({ className: \"stylist-image-uploader__message\" }, { children: [\"Drag & drop your photo here or\", ' ', _jsx(\"span\", Object.assign({ className: \"stylist-image-uploader__browse\" }, { children: \"browse\" }))] })), _jsxs(\"p\", Object.assign({ className: \"stylist-image-uploader__info\" }, { children: [\"Accepted formats: \", acceptedTypes.map(t => t.replace('image/', '.')).join(', '), _jsx(\"br\", {}), \"Max size: \", getFormattedFileSize(maxSize)] }))] }))), _jsx(\"input\", { ref: fileInputRef, type: \"file\", className: \"stylist-image-uploader__input\", accept: acceptedTypes.join(','), onChange: handleFileInputChange })] }))), error && _jsx(\"div\", Object.assign({ className: \"stylist-image-uploader__error\" }, { children: error })), _jsx(\"div\", Object.assign({ className: \"stylist-image-uploader__actions\" }, { children: !isUsingWebcam && (_jsxs(_Fragment, { children: [preview ? (_jsx(\"button\", Object.assign({ className: \"stylist-image-uploader__change-btn\", onClick: handleButtonClick }, { children: \"Change Photo\" }))) : isCameraSupported && (_jsx(\"button\", Object.assign({ className: \"stylist-image-uploader__webcam-btn\", onClick: startWebcam }, { children: \"Use Webcam\" }))), _jsx(\"button\", Object.assign({ className: \"stylist-image-uploader__upload-btn\", onClick: handleUpload, disabled: !selectedFile }, { children: selectedFile ? 'Continue' : 'Upload a Photo' }))] })) }))] })));\n};\nexport default ImageUploader;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/**\n * Service to remove background using remove.bg API\n */\nimport { REMOVE_BG_API_KEY } from '@/utils/environment';\n/**\n * Remove background from an image using remove.bg API\n * @param imageFile Image file to remove background from\n * @param options Configuration options\n * @returns DataURL of the processed image\n */\nexport function removeBackgroundApi(imageFile, options = {}) {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function* () {\n        // Get API key from options or environment\n        const apiKey = options.apiKey || REMOVE_BG_API_KEY;\n        if (!apiKey) {\n            throw new Error('No API key provided for remove.bg');\n        }\n        // Create FormData for API request\n        const formData = new FormData();\n        formData.append('image_file', imageFile);\n        // Add options to request\n        if (options.size)\n            formData.append('size', options.size);\n        formData.append('crop', options.crop ? 'true' : 'false');\n        if (options.scale)\n            formData.append('scale', options.scale);\n        if (options.format)\n            formData.append('format', options.format);\n        // Send request to remove.bg API\n        const response = yield fetch('https://api.remove.bg/v1.0/removebg', {\n            method: 'POST',\n            headers: {\n                'X-Api-Key': apiKey\n            },\n            body: formData\n        });\n        // Handle API errors\n        if (!response.ok) {\n            let errorMessage = `Remove.bg API error (${response.status})`;\n            try {\n                const errorData = yield response.json();\n                errorMessage = `${errorMessage}: ${((_b = (_a = errorData.errors) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.title) || 'Unknown error'}`;\n            }\n            catch (e) {\n                // If JSON parsing fails, use status text\n                errorMessage = `${errorMessage}: ${response.statusText}`;\n            }\n            throw new Error(errorMessage);\n        }\n        // Get binary image data from response\n        const imageBlob = yield response.blob();\n        // Convert to data URL\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onloadend = () => resolve(reader.result);\n            reader.onerror = reject;\n            reader.readAsDataURL(imageBlob);\n        });\n    });\n}\n/**\n * Check if remove.bg API is available with current API key\n * @returns Boolean indicating if API is available\n */\nexport function isRemoveBgAvailable() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const apiKey = REMOVE_BG_API_KEY;\n        if (!apiKey) {\n            return false;\n        }\n        try {\n            // Make a lightweight account API call to check key validity\n            const response = yield fetch('https://api.remove.bg/v1.0/account', {\n                method: 'GET',\n                headers: {\n                    'X-Api-Key': apiKey,\n                    'Accept': 'application/json'\n                }\n            });\n            return response.ok;\n        }\n        catch (error) {\n            console.error('Error checking remove.bg API availability:', error);\n            return false;\n        }\n    });\n}\n","/**\n * TensorFlow-based background removal service for virtual try-on\n * Fallback for when Remove.bg API is not available\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport * as bodyPix from '@tensorflow-models/body-pix';\nimport '@tensorflow/tfjs-backend-webgl';\nimport '@tensorflow/tfjs-backend-cpu';\n// Cache for the BodyPix model\nlet bodyPixModel = null;\n/**\n * Preload the BodyPix model to speed up initial segmentation\n */\nexport function preloadBodyPixModel() {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            if (!bodyPixModel) {\n                console.log('Loading BodyPix model...');\n                // First, check if WebGL is properly initialized\n                try {\n                    // Import TensorFlow directly\n                    const tf = require('@tensorflow/tfjs');\n                    if (tf) {\n                        yield tf.ready();\n                        // Check if WebGL backend was successfully initialized\n                        const backend = tf.getBackend();\n                        if (backend !== 'webgl') {\n                            console.log(`TensorFlow backend is ${backend}, attempting to set webgl backend`);\n                            try {\n                                yield tf.setBackend('webgl');\n                            }\n                            catch (err) {\n                                console.warn('Failed to set WebGL backend:', err);\n                            }\n                        }\n                        console.log(`TensorFlow using ${tf.getBackend()} backend`);\n                    }\n                }\n                catch (backendError) {\n                    console.warn('Error setting up TensorFlow backend:', backendError);\n                    // Continue with model loading attempt\n                }\n                // Try to load the model with conservative settings\n                bodyPixModel = yield bodyPix.load({\n                    architecture: 'MobileNetV1',\n                    outputStride: 16,\n                    multiplier: 0.75,\n                    quantBytes: 2\n                });\n                console.log('BodyPix model loaded successfully');\n            }\n        }\n        catch (error) {\n            console.error('Error preloading BodyPix model:', error);\n            // Reset model state on error\n            bodyPixModel = null;\n            throw error;\n        }\n    });\n}\n/**\n * Check if TensorFlow.js is supported in the current browser\n */\nexport function isTensorflowSupported() {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            // Try to access the WebGL context as a basic check\n            const canvas = document.createElement('canvas');\n            const gl = canvas.getContext('webgl', { failIfMajorPerformanceCaveat: false }) ||\n                canvas.getContext('experimental-webgl', { failIfMajorPerformanceCaveat: false });\n            if (!gl) {\n                console.warn('WebGL context not available');\n                return false;\n            }\n            // Cast to WebGLRenderingContext for proper access to WebGL methods\n            const webglContext = gl;\n            // Check for WebGL capabilities\n            try {\n                const debugInfo = webglContext.getExtension('WEBGL_debug_renderer_info');\n                if (debugInfo) {\n                    const vendor = webglContext.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);\n                    const renderer = webglContext.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n                    console.log(`WebGL vendor: ${vendor}, renderer: ${renderer}`);\n                }\n            }\n            catch (error) {\n                console.warn(\"Unable to get WebGL vendor information\", error);\n            }\n            // Check shader capabilities\n            try {\n                // Cast to WebGLRenderingContext for type safety\n                const webglContext = gl;\n                // A simple shader to verify WebGL capabilities\n                const vertexShader = webglContext.createShader(webglContext.VERTEX_SHADER);\n                if (!vertexShader) {\n                    console.warn('Failed to create vertex shader');\n                    return false;\n                }\n                webglContext.shaderSource(vertexShader, `\n        attribute vec2 a_position;\n        void main() {\n          gl_Position = vec4(a_position, 0, 1);\n        }\n      `);\n                webglContext.compileShader(vertexShader);\n                if (!webglContext.getShaderParameter(vertexShader, webglContext.COMPILE_STATUS)) {\n                    const info = webglContext.getShaderInfoLog(vertexShader);\n                    console.warn('Could not compile WebGL shader:', info);\n                    return false;\n                }\n                // Clean up resources\n                webglContext.deleteShader(vertexShader);\n            }\n            catch (shaderError) {\n                console.warn('WebGL shader test failed:', shaderError);\n                return false;\n            }\n            // Try to load a minimal model as a more thorough check\n            try {\n                yield preloadBodyPixModel();\n                return !!bodyPixModel;\n            }\n            catch (modelError) {\n                console.warn('Failed to load TensorFlow model:', modelError);\n                return false;\n            }\n        }\n        catch (error) {\n            console.error('TensorFlow support check failed:', error);\n            return false;\n        }\n    });\n}\n/**\n * Helper function to segment a person in an image\n * Used by background removal process and tests\n */\nexport function segmentImage(imageElement, options = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n        // Load the BodyPix model if not already loaded\n        if (!bodyPixModel) {\n            try {\n                yield preloadBodyPixModel();\n            }\n            catch (modelError) {\n                console.warn('Error loading BodyPix model during segmentation:', modelError);\n                throw new Error('Unable to load segmentation model');\n            }\n        }\n        if (!bodyPixModel) {\n            throw new Error('Failed to load BodyPix model');\n        }\n        // Default options\n        const segmentationOptions = {\n            flipHorizontal: options.flipHorizontal || false,\n            internalResolution: options.internalResolution || 'high',\n            segmentationThreshold: options.threshold || 0.7\n        };\n        // Try progressively lower resolutions if needed\n        try {\n            // Segment the person with specified options\n            return yield bodyPixModel.segmentPerson(imageElement, segmentationOptions);\n        }\n        catch (highResError) {\n            // If high resolution fails, try medium\n            if (segmentationOptions.internalResolution === 'high' || segmentationOptions.internalResolution === 'full') {\n                console.warn('High resolution segmentation failed, trying medium:', highResError);\n                try {\n                    return yield bodyPixModel.segmentPerson(imageElement, Object.assign(Object.assign({}, segmentationOptions), { internalResolution: 'medium' }));\n                }\n                catch (mediumResError) {\n                    // If medium fails, try low\n                    console.warn('Medium resolution segmentation failed, trying low:', mediumResError);\n                    try {\n                        return yield bodyPixModel.segmentPerson(imageElement, Object.assign(Object.assign({}, segmentationOptions), { internalResolution: 'low' }));\n                    }\n                    catch (lowResError) {\n                        console.error('All segmentation attempts failed:', lowResError);\n                        // Check if this is a WebGL error and provide a clearer message\n                        if (String(lowResError).toLowerCase().includes('webgl') ||\n                            String(lowResError).toLowerCase().includes('shader') ||\n                            String(lowResError).toLowerCase().includes('compilation')) {\n                            throw new Error('WebGL shader compilation error. Your browser may not fully support the required graphics features.');\n                        }\n                        throw lowResError;\n                    }\n                }\n            }\n            else {\n                // If not already using high resolution, rethrow the original error\n                throw highResError;\n            }\n        }\n    });\n}\n/**\n * Remove the background from an image using TensorFlow BodyPix\n * @param imageSource - Image file or URL to process\n * @param options - Configuration options\n * @returns URL to the processed image with background removed\n */\nexport function removeBackground(imageSource, options = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            // Load the BodyPix model if not already loaded\n            if (!bodyPixModel) {\n                try {\n                    yield preloadBodyPixModel();\n                }\n                catch (modelError) {\n                    console.warn('BodyPix model failed to load, falling back to original image:', modelError);\n                    if (typeof imageSource === 'string') {\n                        return imageSource;\n                    }\n                    else {\n                        return URL.createObjectURL(imageSource);\n                    }\n                }\n            }\n            if (!bodyPixModel) {\n                throw new Error('Failed to load BodyPix model');\n            }\n            // Create an image element from the source\n            const imageElement = yield createImageElement(imageSource);\n            // Try with different internal resolution options if needed\n            let segmentation;\n            try {\n                // Use bodyPix to segment the person with primary settings\n                segmentation = yield bodyPixModel.segmentPerson(imageElement, Object.assign({ flipHorizontal: false, internalResolution: 'high', segmentationThreshold: options.threshold || 0.7 }, (options.bodyPixOptions || {})));\n            }\n            catch (segmentationError) {\n                console.warn('High resolution segmentation failed, trying medium resolution:', segmentationError);\n                // Try with lower resolution\n                try {\n                    segmentation = yield bodyPixModel.segmentPerson(imageElement, Object.assign({ flipHorizontal: false, internalResolution: 'medium', segmentationThreshold: options.threshold || 0.7 }, (options.bodyPixOptions || {})));\n                }\n                catch (mediumError) {\n                    console.warn('Medium resolution segmentation failed, trying low resolution:', mediumError);\n                    // Last attempt with lowest resolution\n                    try {\n                        segmentation = yield bodyPixModel.segmentPerson(imageElement, Object.assign({ flipHorizontal: false, internalResolution: 'low', segmentationThreshold: options.threshold || 0.7 }, (options.bodyPixOptions || {})));\n                    }\n                    catch (lowError) {\n                        console.error('All segmentation attempts failed:', lowError);\n                        throw lowError;\n                    }\n                }\n            }\n            // Process the segmentation to extract key body parts\n            return processSegmentation(imageElement, segmentation, options.backgroundColor || 'transparent', options.foregroundColor);\n        }\n        catch (error) {\n            console.error('Error in TF background removal:', error);\n            // Check for specific WebGL errors\n            const errorMsg = String(error).toLowerCase();\n            if (errorMsg.includes('webgl') || errorMsg.includes('shader') || errorMsg.includes('compilation')) {\n                console.warn('WebGL/shader error detected. WebGL may not be fully supported on this device.');\n            }\n            // Return original image URL as fallback\n            if (typeof imageSource === 'string') {\n                return imageSource;\n            }\n            else {\n                return URL.createObjectURL(imageSource);\n            }\n        }\n    });\n}\n/**\n * Process segmentation data to create a masked image\n */\nfunction processSegmentation(imageElement, segmentation, backgroundColor, foregroundColor) {\n    // Create a canvas for the output\n    const canvas = document.createElement('canvas');\n    canvas.width = imageElement.width;\n    canvas.height = imageElement.height;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('Could not get canvas context');\n    }\n    // Draw the original image\n    ctx.drawImage(imageElement, 0, 0);\n    // Get image data\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    const { data } = imageData;\n    // For each pixel\n    for (let i = 0; i < data.length; i += 4) {\n        // Get pixel position\n        const pixelIndex = i / 4;\n        const x = pixelIndex % canvas.width;\n        const y = Math.floor(pixelIndex / canvas.width);\n        // Check if this pixel is part of a person\n        if (!segmentation.data[pixelIndex]) {\n            if (backgroundColor === 'transparent') {\n                // Make pixel transparent\n                data[i + 3] = 0;\n            }\n            else {\n                // Set to background color\n                const bgColor = hexToRgb(backgroundColor);\n                data[i] = bgColor.r; // R\n                data[i + 1] = bgColor.g; // G\n                data[i + 2] = bgColor.b; // B\n                data[i + 3] = 255; // A\n            }\n        }\n        else if (foregroundColor) {\n            // If foreground color is provided, tint the person\n            const fgColor = hexToRgb(foregroundColor);\n            // Blend original with foreground color\n            data[i] = Math.round((data[i] + fgColor.r) / 2); // R\n            data[i + 1] = Math.round((data[i + 1] + fgColor.g) / 2); // G\n            data[i + 2] = Math.round((data[i + 2] + fgColor.b) / 2); // B\n        }\n    }\n    // Put the modified image data back\n    ctx.putImageData(imageData, 0, 0);\n    // Convert to data URL and return\n    return canvas.toDataURL('image/png');\n}\n/**\n * Extract body measurements from a segmented image\n * @param segmentation - BodyPix segmentation result\n * @param imageWidth - Width of the original image\n * @param imageHeight - Height of the original image\n */\nexport function extractBodyMeasurements(segmentation, imageWidth, imageHeight) {\n    // Initialize bounds\n    let minX = imageWidth;\n    let maxX = 0;\n    let minY = imageHeight;\n    let maxY = 0;\n    // Shoulders Y position\n    let shouldersY = 0;\n    let shouldersCount = 0;\n    // Waist tracking\n    let waistY = Math.floor(imageHeight * 0.5); // Approximate middle\n    let waistLeft = imageWidth;\n    let waistRight = 0;\n    // Hips tracking (lower third of body)\n    let hipsY = Math.floor(imageHeight * 0.7);\n    let hipsLeft = imageWidth;\n    let hipsRight = 0;\n    // Process the segmentation data\n    for (let y = 0; y < imageHeight; y++) {\n        for (let x = 0; x < imageWidth; x++) {\n            const index = y * imageWidth + x;\n            if (segmentation.data[index]) {\n                // Update bounds\n                minX = Math.min(minX, x);\n                maxX = Math.max(maxX, x);\n                minY = Math.min(minY, y);\n                maxY = Math.max(maxY, y);\n                // Check for shoulders (upper part)\n                if (y <= imageHeight * 0.3) {\n                    shouldersY += y;\n                    shouldersCount++;\n                }\n                // Check for waist points\n                if (Math.abs(y - waistY) < imageHeight * 0.05) {\n                    waistLeft = Math.min(waistLeft, x);\n                    waistRight = Math.max(waistRight, x);\n                }\n                // Check for hips points\n                if (Math.abs(y - hipsY) < imageHeight * 0.05) {\n                    hipsLeft = Math.min(hipsLeft, x);\n                    hipsRight = Math.max(hipsRight, x);\n                }\n            }\n        }\n    }\n    // Calculate measurements\n    const bodyWidth = maxX - minX;\n    const bodyHeight = maxY - minY;\n    const shouldersAvgY = shouldersCount > 0 ? shouldersY / shouldersCount : 0;\n    const waistWidth = waistRight - waistLeft;\n    const hipsWidth = hipsRight - hipsLeft;\n    // Return normalized measurements (as ratios of image dimensions)\n    return {\n        width: bodyWidth / imageWidth,\n        height: bodyHeight / imageHeight,\n        shouldersY: shouldersAvgY / imageHeight,\n        waistWidth: waistWidth / imageWidth,\n        hipsWidth: hipsWidth / imageWidth,\n        // Approximate sizing category based on proportions\n        approximateSize: calculateApproximateSize(waistWidth / hipsWidth, bodyWidth, bodyHeight),\n        // Body shape classification\n        bodyShape: classifyBodyShape(waistWidth / hipsWidth)\n    };\n}\n/**\n * Calculate approximate clothing size based on proportions\n */\nfunction calculateApproximateSize(waistToHipRatio, bodyWidth, bodyHeight) {\n    // Very simple approximation - would need calibration data for accuracy\n    if (bodyWidth < 100)\n        return 'XS';\n    if (bodyWidth < 150)\n        return 'S';\n    if (bodyWidth < 200)\n        return 'M';\n    if (bodyWidth < 250)\n        return 'L';\n    return 'XL';\n}\n/**\n * Classify body shape based on measurements\n * This is a very simplified version - a real implementation would be more nuanced\n */\nfunction classifyBodyShape(waistToHipRatio) {\n    if (waistToHipRatio < 0.75)\n        return 'hourglass';\n    if (waistToHipRatio < 0.85)\n        return 'pear';\n    if (waistToHipRatio > 0.95)\n        return 'apple';\n    return 'rectangle';\n}\n/**\n * Create an image element from a file or URL\n */\nfunction createImageElement(source) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return new Promise((resolve, reject) => {\n            const img = new Image();\n            img.crossOrigin = 'anonymous';\n            img.onload = () => resolve(img);\n            img.onerror = (error) => reject(error);\n            if (typeof source === 'string') {\n                img.src = source;\n            }\n            else {\n                img.src = URL.createObjectURL(source);\n            }\n        });\n    });\n}\n/**\n * Convert hex color to RGB object\n */\nfunction hexToRgb(hex) {\n    // Default to black if invalid\n    if (!hex || hex === 'transparent') {\n        return { r: 0, g: 0, b: 0 };\n    }\n    // Remove # if present\n    hex = hex.replace(/^#/, '');\n    // Handle shorthand hex\n    if (hex.length === 3) {\n        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n    }\n    // Parse the hex values\n    const bigint = parseInt(hex, 16);\n    return {\n        r: (bigint >> 16) & 255,\n        g: (bigint >> 8) & 255,\n        b: bigint & 255\n    };\n}\n","// Background removal utility functions\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { BackgroundRemovalMethod } from '@/types/tryOn';\nimport { removeBackgroundApi, isRemoveBgAvailable } from './removeBackgroundApi';\nimport { removeBackground as removeBackgroundTensorflow, isTensorflowSupported as isTfSupported, preloadBodyPixModel as preloadModel } from './tfBackgroundRemoval';\nimport { REMOVE_BG_API_KEY } from '@/utils/environment';\n/**\n * Remove background from an image using the specified method\n */\nexport const removeBackground = (imageData, options) => __awaiter(void 0, void 0, void 0, function* () {\n    let result;\n    try {\n        // Use the API key from options or environment\n        const apiKey = options.apiKey || REMOVE_BG_API_KEY;\n        switch (options.method) {\n            case BackgroundRemovalMethod.REMOVE_BG_API:\n                if (!apiKey) {\n                    throw new Error('API key is required for Remove.bg API');\n                }\n                // Check if the API key is valid\n                const isApiAvailable = yield isRemoveBgAvailable();\n                if (!isApiAvailable) {\n                    throw new Error('Remove.bg API is not available or key is invalid');\n                }\n                // File object required for API call\n                const imageFile = typeof imageData === 'string'\n                    ? yield dataUrlToFile(imageData, 'image.png')\n                    : imageData;\n                // Call the Remove.bg API\n                try {\n                    const resultUrl = yield removeBackgroundApi(imageFile, {\n                        apiKey: apiKey,\n                        size: mapQualityToSize(options.quality)\n                    });\n                    result = {\n                        success: true,\n                        imageUrl: resultUrl,\n                        method: BackgroundRemovalMethod.REMOVE_BG_API\n                    };\n                }\n                catch (apiError) {\n                    console.error('Remove.bg API error:', apiError);\n                    throw apiError;\n                }\n                break;\n            case BackgroundRemovalMethod.TENSORFLOW:\n                if (typeof imageData === 'string') {\n                    // Use TensorFlow to remove background\n                    const resultUrl = yield removeBackgroundTensorflow(imageData, {\n                        threshold: 0.7 // Adjust threshold for better results\n                    });\n                    result = {\n                        success: true,\n                        imageUrl: resultUrl,\n                        method: BackgroundRemovalMethod.TENSORFLOW\n                    };\n                }\n                else {\n                    // Convert File to data URL first\n                    const dataUrl = yield fileToDataUrl(imageData);\n                    const resultUrl = yield removeBackgroundTensorflow(dataUrl, {\n                        threshold: 0.7\n                    });\n                    result = {\n                        success: true,\n                        imageUrl: resultUrl,\n                        method: BackgroundRemovalMethod.TENSORFLOW\n                    };\n                }\n                break;\n            case BackgroundRemovalMethod.MANUAL:\n                result = {\n                    success: false,\n                    error: 'Manual background removal not implemented',\n                    method: BackgroundRemovalMethod.MANUAL\n                };\n                break;\n            default:\n                result = {\n                    success: false,\n                    error: `Unknown removal method: ${options.method}`,\n                    method: options.method\n                };\n        }\n        // If primary method failed and fallback is enabled, try TensorFlow.js\n        if (!(result === null || result === void 0 ? void 0 : result.success) && options.fallbackToTensorflow && options.method !== BackgroundRemovalMethod.TENSORFLOW) {\n            console.log(`Falling back to TensorFlow.js background removal after ${options.method} failed`);\n            try {\n                // Check TensorFlow support first\n                const tfSupported = yield isTensorflowSupported();\n                if (!tfSupported) {\n                    throw new Error('TensorFlow.js not supported in this browser');\n                }\n                if (typeof imageData === 'string') {\n                    const resultUrl = yield removeBackgroundTensorflow(imageData, {\n                        threshold: 0.7\n                    });\n                    result = {\n                        success: true,\n                        imageUrl: resultUrl,\n                        method: BackgroundRemovalMethod.TENSORFLOW\n                    };\n                }\n                else {\n                    // Convert File to data URL first\n                    const dataUrl = yield fileToDataUrl(imageData);\n                    const resultUrl = yield removeBackgroundTensorflow(dataUrl, {\n                        threshold: 0.7\n                    });\n                    result = {\n                        success: true,\n                        imageUrl: resultUrl,\n                        method: BackgroundRemovalMethod.TENSORFLOW\n                    };\n                }\n            }\n            catch (tfError) {\n                console.error('TensorFlow fallback error:', tfError);\n                // If fallback also fails, keep the original error\n            }\n        }\n        // Add body measurements if requested and operation succeeded\n        if (options.extractBodyMeasurements && (result === null || result === void 0 ? void 0 : result.success) && result.imageUrl) {\n            try {\n                // This will be implemented using the extractBodyMeasurements function\n                // For now, set a placeholder\n                result.bodyMeasurements = {\n                    approximateSize: 'M',\n                    bodyShape: 'rectangle'\n                };\n            }\n            catch (measureError) {\n                console.error('Error extracting body measurements:', measureError);\n            }\n        }\n        return result || {\n            success: false,\n            error: 'Background removal failed with all methods',\n            method: options.method\n        };\n    }\n    catch (error) {\n        console.error('Background removal error:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : String(error),\n            method: options.method\n        };\n    }\n});\n/**\n * Convert quality option to Remove.bg size parameter\n */\nconst mapQualityToSize = (quality) => {\n    switch (quality) {\n        case 'preview':\n            return 'preview';\n        case 'high':\n            return 'hd';\n        case 'full':\n            return 'medium';\n        default:\n            return 'auto';\n    }\n};\n/**\n * Helper function to convert File to data URL\n */\nconst fileToDataUrl = (file) => {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            var _a;\n            if ((_a = e.target) === null || _a === void 0 ? void 0 : _a.result) {\n                resolve(e.target.result);\n            }\n            else {\n                reject(new Error('Failed to convert file to data URL'));\n            }\n        };\n        reader.onerror = (error) => reject(error);\n        reader.readAsDataURL(file);\n    });\n};\n/**\n * Convert data URL to File object\n */\nconst dataUrlToFile = (dataUrl, filename) => {\n    return fetch(dataUrl)\n        .then(res => res.blob())\n        .then(blob => {\n        // Extract mime type from data URL\n        const mimeType = dataUrl.split(',')[0].split(':')[1].split(';')[0];\n        return new File([blob], filename, { type: mimeType });\n    });\n};\n/**\n * Check if the browser supports the WebGL backend for TensorFlow.js\n */\nexport const isTensorflowSupported = isTfSupported;\n/**\n * Preload the BodyPix model to reduce initial latency\n */\nexport const preloadBodyPixModel = preloadModel;\n","// Hook for background removal functionality\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useState, useCallback, useEffect } from 'react';\nimport { BackgroundRemovalMethod, ProcessingStatus } from '@/types/tryOn';\nimport { removeBackground, isTensorflowSupported, preloadBodyPixModel } from '@/services/background-removal/utils';\nimport { useTryOnStore } from '@/store/tryOnStore';\nexport const useBackgroundRemoval = (options) => {\n    const [isProcessing, setIsProcessing] = useState(false);\n    const [progress, setProgress] = useState(0);\n    const [error, setError] = useState(null);\n    const settings = useTryOnStore((state) => state.settings);\n    const updateUserImage = useTryOnStore((state) => state.updateUserImage);\n    // Check if TensorFlow.js is supported\n    const [tensorflowSupported, setTensorflowSupported] = useState(null);\n    // Check TensorFlow.js support on mount\n    useEffect(() => {\n        const checkSupport = () => __awaiter(void 0, void 0, void 0, function* () {\n            try {\n                const supported = yield isTensorflowSupported();\n                setTensorflowSupported(supported);\n                // If supported, preload the model\n                if (supported) {\n                    preloadBodyPixModel();\n                }\n            }\n            catch (error) {\n                console.warn('Error checking TensorFlow support:', error);\n                setTensorflowSupported(false);\n            }\n        });\n        checkSupport();\n    }, []);\n    // Process image to remove background\n    const removeImageBackground = useCallback((image) => __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            setIsProcessing(true);\n            setProgress(10);\n            setError(null);\n            // Update image status\n            updateUserImage({\n                processingStatus: ProcessingStatus.REMOVING_BACKGROUND\n            });\n            // Determine removal method\n            let method = settings.preferredBackgroundRemovalMethod;\n            // If TensorFlow.js is not supported but selected, fall back to API\n            if (method === BackgroundRemovalMethod.TENSORFLOW &&\n                tensorflowSupported === false) {\n                console.log('TensorFlow.js not supported, falling back to Remove.bg API');\n                method = BackgroundRemovalMethod.REMOVE_BG_API;\n            }\n            setProgress(25);\n            // Track start time for timeout detection\n            const startTime = Date.now();\n            const TIMEOUT_MS = 10000; // 10 seconds timeout\n            // Use Promise.race to add timeout handling\n            const removalPromise = removeBackground(image.url, {\n                method,\n                apiKey: settings.apiKey,\n                fallbackToTensorflow: method === BackgroundRemovalMethod.REMOVE_BG_API && tensorflowSupported === true\n            });\n            // Proceed with background removal with timeout handling\n            const timeoutPromise = new Promise((_, reject) => {\n                setTimeout(() => {\n                    reject(new Error('Background removal timed out'));\n                }, TIMEOUT_MS);\n            });\n            const result = yield Promise.race([\n                removalPromise,\n                timeoutPromise\n            ]);\n            setProgress(90);\n            // Check if result is successful\n            if (!result || !result.success || !result.imageUrl) {\n                // If background removal failed but there's a partial result with imageUrl, use it\n                if (result && result.imageUrl) {\n                    // Update with partial result\n                    const partialImage = Object.assign(Object.assign({}, image), { url: result.imageUrl, backgroundRemoved: true, processingStatus: ProcessingStatus.COMPLETED, processingWarning: result.error || 'Background removal partially succeeded' });\n                    updateUserImage(partialImage);\n                    setProgress(100);\n                    return partialImage;\n                }\n                throw new Error((result === null || result === void 0 ? void 0 : result.error) || 'Failed to remove background');\n            }\n            // Update image with background removed\n            const updatedImage = Object.assign(Object.assign({}, image), { url: result.imageUrl, backgroundRemoved: true, processingStatus: ProcessingStatus.COMPLETED, bodyMeasurements: result.bodyMeasurements });\n            // Update user image in store\n            updateUserImage(updatedImage);\n            setProgress(100);\n            // Call success callback if provided\n            if (options === null || options === void 0 ? void 0 : options.onSuccess) {\n                options.onSuccess(updatedImage);\n            }\n            return updatedImage;\n        }\n        catch (error) {\n            console.error('Background removal error:', error);\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            setError(errorMessage);\n            // Check for WebGL shader error patterns\n            const isWebGLError = errorMessage.toLowerCase().includes('webgl') ||\n                errorMessage.toLowerCase().includes('shader') ||\n                errorMessage.toLowerCase().includes('compilation');\n            // Create a user-friendly error message\n            const userFriendlyError = isWebGLError\n                ? 'Your browser may not fully support 3D graphics required for background removal. Using original image instead.'\n                : errorMessage;\n            // For WebGL errors, use a completed status with the original image\n            if (isWebGLError) {\n                const fallbackImage = Object.assign(Object.assign({}, image), { processingStatus: ProcessingStatus.COMPLETED, backgroundRemoved: false, processingWarning: 'WebGL not fully supported. Using original image.' });\n                // Update user image in store\n                updateUserImage(fallbackImage);\n                return fallbackImage;\n            }\n            else {\n                // Standard error handling for non-WebGL errors\n                updateUserImage({\n                    processingStatus: ProcessingStatus.FAILED,\n                    processingError: userFriendlyError\n                });\n                // Call error callback if provided\n                if (options === null || options === void 0 ? void 0 : options.onError) {\n                    options.onError(userFriendlyError);\n                }\n                // Return original image with error status\n                return Object.assign(Object.assign({}, image), { processingStatus: ProcessingStatus.FAILED, processingError: userFriendlyError });\n            }\n        }\n        finally {\n            setIsProcessing(false);\n        }\n    }), [settings, tensorflowSupported, updateUserImage, options]);\n    return {\n        removeImageBackground,\n        isProcessing,\n        progress,\n        error,\n        tensorflowSupported,\n        reset: () => {\n            setError(null);\n            setProgress(0);\n        }\n    };\n};\n","// Hook for image processing functionality\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useState, useCallback } from 'react';\nimport { ProcessingStatus } from '@/types/tryOn';\nimport { useTryOnStore } from '@/store/tryOnStore';\nimport { fileToDataUrl, getImageDimensions } from '@/services/image-processing/fileUtils';\nimport { calculateAspectRatioDimensions } from '@/services/image-processing/imageScaling';\nimport { useBackgroundRemoval } from './useBackgroundRemoval';\nexport const useImageProcessing = (options) => {\n    const [isProcessing, setIsProcessing] = useState(false);\n    const [progress, setProgress] = useState(0);\n    const [error, setError] = useState(null);\n    // Get state and actions from store\n    const settings = useTryOnStore((state) => state.settings);\n    const setUserImage = useTryOnStore((state) => state.setUserImage);\n    const updateUserImage = useTryOnStore((state) => state.updateUserImage);\n    // Background removal hook\n    const { removeImageBackground } = useBackgroundRemoval({\n        onError: (errorMsg) => setError(errorMsg)\n    });\n    // Process image (load, resize, and optionally remove background)\n    const processImage = useCallback((file) => __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            setIsProcessing(true);\n            setProgress(0);\n            setError(null);\n            // Check if file is an image\n            if (!file.type.startsWith('image/')) {\n                throw new Error('File is not an image');\n            }\n            // Create initial user image object\n            const userImage = {\n                id: `img_${Date.now()}`,\n                url: '',\n                file,\n                processingStatus: ProcessingStatus.UPLOADING\n            };\n            // Store initial state\n            setUserImage(userImage);\n            // Convert to data URL\n            setProgress(10);\n            const dataUrl = yield fileToDataUrl(file);\n            // Get image dimensions\n            setProgress(20);\n            const dimensions = yield getImageDimensions(dataUrl);\n            // Resize if needed\n            const processedUrl = dataUrl;\n            let processedDimensions = dimensions;\n            const maxWidth = (options === null || options === void 0 ? void 0 : options.maxWidth) || 1200;\n            const maxHeight = (options === null || options === void 0 ? void 0 : options.maxHeight) || 1600;\n            if (dimensions.width > maxWidth || dimensions.height > maxHeight) {\n                setProgress(30);\n                processedDimensions = calculateAspectRatioDimensions(dimensions.width, dimensions.height, undefined, undefined, maxWidth, maxHeight);\n                // Resize image (will happen when drawing to canvas)\n                // processedUrl remains the same for now\n            }\n            // Update user image with URL and dimensions\n            const updatedImage = Object.assign(Object.assign({}, userImage), { url: processedUrl, dimensions: processedDimensions, originalDimensions: dimensions, processingStatus: ProcessingStatus.PROCESSING });\n            setUserImage(updatedImage);\n            setProgress(40);\n            // Optionally remove background\n            const autoRemoveBackground = (options === null || options === void 0 ? void 0 : options.autoRemoveBackground) !== undefined\n                ? options.autoRemoveBackground\n                : settings.removeBackgroundAutomatically;\n            let finalImage = updatedImage;\n            if (autoRemoveBackground) {\n                // Update status\n                updateUserImage({\n                    processingStatus: ProcessingStatus.REMOVING_BACKGROUND\n                });\n                // Process with background removal\n                finalImage = yield removeImageBackground(updatedImage);\n            }\n            else {\n                // Mark as completed without background removal\n                finalImage = Object.assign(Object.assign({}, updatedImage), { processingStatus: ProcessingStatus.COMPLETED });\n                updateUserImage(finalImage);\n            }\n            setProgress(100);\n            // Call completion callback if provided\n            if (options === null || options === void 0 ? void 0 : options.onProcessingComplete) {\n                options.onProcessingComplete(finalImage);\n            }\n            return finalImage;\n        }\n        catch (error) {\n            console.error('Image processing error:', error);\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            setError(errorMessage);\n            // Update image status to failed\n            updateUserImage({\n                processingStatus: ProcessingStatus.FAILED,\n                processingError: errorMessage\n            });\n            return null;\n        }\n        finally {\n            setIsProcessing(false);\n        }\n    }), [\n        options,\n        settings.removeBackgroundAutomatically,\n        setUserImage,\n        updateUserImage,\n        removeImageBackground\n    ]);\n    return {\n        processImage,\n        isProcessing,\n        progress,\n        error,\n        reset: () => {\n            setError(null);\n            setProgress(0);\n        }\n    };\n};\n","// Utilities for scaling images proportionally\n/**\n * Calculate new dimensions while maintaining aspect ratio\n */\nexport const calculateAspectRatioDimensions = (originalWidth, originalHeight, targetWidth, targetHeight, maxWidth, maxHeight) => {\n    let width = originalWidth;\n    let height = originalHeight;\n    // Apply target width if specified\n    if (targetWidth) {\n        width = targetWidth;\n        height = (originalHeight * targetWidth) / originalWidth;\n    }\n    // Apply target height if specified\n    if (targetHeight) {\n        height = targetHeight;\n        // Only recalculate width if target width wasn't specified\n        if (!targetWidth) {\n            width = (originalWidth * targetHeight) / originalHeight;\n        }\n    }\n    // Apply maximum width constraint if needed\n    if (maxWidth && width > maxWidth) {\n        height = (height * maxWidth) / width;\n        width = maxWidth;\n    }\n    // Apply maximum height constraint if needed\n    if (maxHeight && height > maxHeight) {\n        width = (width * maxHeight) / height;\n        height = maxHeight;\n    }\n    return {\n        width: Math.round(width),\n        height: Math.round(height)\n    };\n};\n/**\n * Scale dimensions by a factor\n */\nexport const scaleDimensions = (dimensions, scaleFactor) => {\n    return {\n        width: Math.round(dimensions.width * scaleFactor),\n        height: Math.round(dimensions.height * scaleFactor)\n    };\n};\n/**\n * Scale a point by a factor\n */\nexport const scalePoint = (point, scaleFactor) => {\n    return {\n        x: point.x * scaleFactor,\n        y: point.y * scaleFactor\n    };\n};\n/**\n * Calculate the scale factor needed to fit source dimensions into target dimensions\n */\nexport const calculateScaleFactor = (sourceDimensions, targetDimensions, contain = true) => {\n    const sourceRatio = sourceDimensions.width / sourceDimensions.height;\n    const targetRatio = targetDimensions.width / targetDimensions.height;\n    // If contain is true, the entire source must fit within target\n    // If contain is false, the source must cover the entire target\n    if ((contain && sourceRatio > targetRatio) || (!contain && sourceRatio < targetRatio)) {\n        // Width limited\n        return targetDimensions.width / sourceDimensions.width;\n    }\n    else {\n        // Height limited\n        return targetDimensions.height / sourceDimensions.height;\n    }\n};\n","// Main hook for virtual try-on functionality\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { useState, useCallback, useEffect } from 'react';\nimport { useTryOnStore } from '@/store/tryOnStore';\nimport { useImageProcessing } from './useImageProcessing';\nimport { canvasToImage } from '@/services/image-processing/canvasUtils';\nimport { getImageDimensions } from '@/services/image-processing/fileUtils';\nimport { getDefaultBodyPosition, getDefaultZIndex } from '@/services/image-processing/imagePositioning';\nexport const useTryOn = () => {\n    const { currentOutfit, userImage, settings, isLoading, error, canvasWidth, canvasHeight, setCurrentOutfit, addGarmentToOutfit, removeGarmentFromOutfit, updateGarment, \n    /* setUserImage and updateUserImage are defined but not used directly */\n    clearUserImage, setLoading, setError, saveResult, openTryOnModal, closeTryOnModal } = useTryOnStore();\n    const { processImage } = useImageProcessing();\n    const [canvasRef, setCanvasRef] = useState(null);\n    // Initialize a new outfit if none exists\n    useEffect(() => {\n        if (!currentOutfit) {\n            setCurrentOutfit({\n                id: `outfit_${Date.now()}`,\n                garments: [],\n                createdAt: new Date()\n            });\n        }\n    }, [currentOutfit, setCurrentOutfit]);\n    // Upload user image for try-on\n    const uploadUserImage = useCallback((file) => __awaiter(void 0, void 0, void 0, function* () {\n        setLoading(true);\n        setError(null);\n        try {\n            yield processImage(file);\n        }\n        catch (error) {\n            console.error('Error uploading user image:', error);\n            setError(error instanceof Error ? error.message : String(error));\n        }\n        finally {\n            setLoading(false);\n        }\n    }), [processImage, setLoading, setError]);\n    // Add a garment to the current outfit\n    const addGarment = useCallback((garmentImage, type) => __awaiter(void 0, void 0, void 0, function* () {\n        setLoading(true);\n        try {\n            let url;\n            let dimensions;\n            // If a file was provided, convert to data URL\n            if (typeof garmentImage === 'string') {\n                url = garmentImage;\n                dimensions = yield getImageDimensions(url);\n            }\n            else {\n                // Convert file to data URL\n                const reader = new FileReader();\n                url = yield new Promise((resolve, reject) => {\n                    reader.onload = () => resolve(reader.result);\n                    reader.onerror = reject;\n                    reader.readAsDataURL(garmentImage);\n                });\n                dimensions = yield getImageDimensions(url);\n            }\n            // Create garment info\n            const garment = {\n                id: `garment_${Date.now()}_${Math.floor(Math.random() * 1000)}`,\n                url,\n                type,\n                bodyPosition: getDefaultBodyPosition(type),\n                zIndex: getDefaultZIndex(type),\n                layerIndex: (currentOutfit === null || currentOutfit === void 0 ? void 0 : currentOutfit.garments.length) || 0,\n                dimensions,\n                originalDimensions: dimensions,\n                scale: settings.defaultGarmentScale[type],\n                offset: settings.defaultGarmentOffset[type]\n            };\n            // Add to outfit\n            addGarmentToOutfit(garment);\n        }\n        catch (error) {\n            console.error('Error adding garment:', error);\n            setError(error instanceof Error ? error.message : String(error));\n        }\n        finally {\n            setLoading(false);\n        }\n    }), [\n        currentOutfit === null || currentOutfit === void 0 ? void 0 : currentOutfit.garments.length,\n        settings.defaultGarmentScale,\n        settings.defaultGarmentOffset,\n        addGarmentToOutfit,\n        setLoading,\n        setError\n    ]);\n    // Remove a garment from the current outfit\n    const removeGarment = useCallback((garmentId) => {\n        removeGarmentFromOutfit(garmentId);\n    }, [removeGarmentFromOutfit]);\n    // Update a garment's properties\n    const updateGarmentProperties = useCallback((garmentId, properties) => {\n        updateGarment(garmentId, properties);\n    }, [updateGarment]);\n    // Save the current try-on result\n    const saveTryOnResult = useCallback(() => __awaiter(void 0, void 0, void 0, function* () {\n        if (!canvasRef || !currentOutfit || !userImage) {\n            return;\n        }\n        try {\n            setLoading(true);\n            // Convert canvas to image\n            const resultImageUrl = yield canvasToImage(canvasRef);\n            // Create result object\n            const result = {\n                id: `result_${Date.now()}`,\n                outfitId: currentOutfit.id,\n                userId: 'current_user',\n                userImageUrl: userImage.url,\n                resultImageUrl,\n                garmentIds: currentOutfit.garments.map((g) => g.id),\n                createdAt: new Date()\n            };\n            // Save result\n            saveResult(result);\n            return result;\n        }\n        catch (error) {\n            console.error('Error saving try-on result:', error);\n            setError(error instanceof Error ? error.message : String(error));\n            return null;\n        }\n        finally {\n            setLoading(false);\n        }\n    }), [canvasRef, currentOutfit, userImage, setLoading, setError, saveResult]);\n    // Start new try-on session\n    const startNewTryOn = useCallback((garmentImage, garmentType) => {\n        // Create a new outfit\n        const newOutfit = {\n            id: `outfit_${Date.now()}`,\n            garments: [],\n            createdAt: new Date()\n        };\n        setCurrentOutfit(newOutfit);\n        // Add garment if provided\n        if (garmentImage && garmentType) {\n            addGarment(garmentImage, garmentType);\n        }\n        // Open try-on modal\n        openTryOnModal();\n    }, [setCurrentOutfit, addGarment, openTryOnModal]);\n    // Try on a specific outfit\n    const tryOnOutfit = useCallback((outfit) => {\n        setCurrentOutfit(outfit);\n        openTryOnModal();\n    }, [setCurrentOutfit, openTryOnModal]);\n    return {\n        // State\n        currentOutfit,\n        userImage,\n        isLoading,\n        error,\n        canvasWidth,\n        canvasHeight,\n        showGuidelines: settings.showGuidelines,\n        // Canvas ref\n        canvasRef,\n        setCanvasRef,\n        // Actions\n        uploadUserImage,\n        addGarment,\n        removeGarment,\n        updateGarmentProperties,\n        clearUserImage,\n        saveTryOnResult,\n        startNewTryOn,\n        tryOnOutfit,\n        closeTryOnModal\n    };\n};\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Main virtual try-on component\nimport React, { useEffect, useState } from 'react';\nimport './VirtualTryOn.scss';\nimport TryOnCanvas from '@/components/TryOnCanvas';\nimport TryOnControls from '@/components/TryOnControls';\nimport TryOnFeedback from '@/components/TryOnFeedback';\nimport ImageUploader from '@/components/ImageUploader';\nimport { useTryOn } from '@/hooks/useTryOn';\nimport { ProcessingStatus } from '@/types/tryOn';\nimport { preloadBodyPixModel } from '@/services/background-removal/utils';\nimport { useRecommendationStore } from '@/store/recommendationStore';\nconst VirtualTryOn = ({ onClose, onSave, onAddToLookbook, primaryColor = '#3f51b5' }) => {\n    var _a;\n    const { currentOutfit, userImage, isLoading, error, canvasRef, setCanvasRef, uploadUserImage, addGarment, removeGarment, updateGarmentProperties, clearUserImage, saveTryOnResult, closeTryOnModal } = useTryOn();\n    // Get recommendation store functions\n    const { addToWishlist, addToCart } = useRecommendationStore();\n    const [activeGarmentId, setActiveGarmentId] = useState(null);\n    const [showUploader, setShowUploader] = useState(!userImage);\n    const [savingToLookbook, setSavingToLookbook] = useState(false);\n    const [saveSuccess, setSaveSuccess] = useState(false);\n    // Track visibility to optimize model loading\n    const [isVisible, setIsVisible] = useState(false);\n    // Use a ref to ensure we only load the model once\n    const modelLoaded = React.useRef(false);\n    const [webglSupported, setWebglSupported] = useState(null);\n    // Check WebGL support on mount\n    useEffect(() => {\n        // Function to check WebGL support\n        const checkWebGLSupport = () => {\n            try {\n                const canvas = document.createElement('canvas');\n                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n                if (!gl) {\n                    console.warn('WebGL not supported');\n                    setWebglSupported(false);\n                    return false;\n                }\n                // Simple basic check - if we got a context, we have WebGL\n                setWebglSupported(true);\n                return true;\n            }\n            catch (e) {\n                console.warn('Error checking WebGL support:', e);\n                setWebglSupported(false);\n                return false;\n            }\n        };\n        checkWebGLSupport();\n    }, []);\n    // Create an observer to detect when the component is visible\n    useEffect(() => {\n        if (!userImage)\n            return;\n        // Set component as visible\n        setIsVisible(true);\n        // Only preload the model if it hasn't been loaded yet, the component is visible, and WebGL is supported\n        if (isVisible && !modelLoaded.current && webglSupported !== false) {\n            modelLoaded.current = true;\n            // Preload with error handling\n            preloadBodyPixModel().catch(err => {\n                console.warn('Error preloading BodyPix model:', err);\n                // No need to set an error state here as the background removal process\n                // will handle errors gracefully\n            });\n        }\n    }, [userImage, isVisible, webglSupported]);\n    // Focus on the active garment when it changes\n    useEffect(() => {\n        if (activeGarmentId && currentOutfit) {\n            const garment = currentOutfit.garments.find(g => g.id === activeGarmentId);\n            if (garment) {\n                // Highlight the active garment in the controls\n                const garmentElement = document.getElementById(`garment-${activeGarmentId}`);\n                if (garmentElement) {\n                    garmentElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n                }\n            }\n        }\n    }, [activeGarmentId, currentOutfit]);\n    // Show uploader if no user image is available\n    useEffect(() => {\n        if (!userImage) {\n            setShowUploader(true);\n        }\n    }, [userImage]);\n    // Handle image upload\n    const handleImageUpload = (file) => __awaiter(void 0, void 0, void 0, function* () {\n        yield uploadUserImage(file);\n        setShowUploader(false);\n    });\n    // Handle garment upload\n    const handleGarmentUpload = (file, type) => __awaiter(void 0, void 0, void 0, function* () {\n        yield addGarment(file, type);\n    });\n    // Handle save to lookbook\n    const handleSaveToLookbook = () => __awaiter(void 0, void 0, void 0, function* () {\n        var _b;\n        if (!canvasRef || !currentOutfit)\n            return;\n        try {\n            setSavingToLookbook(true);\n            const result = yield saveTryOnResult();\n            if (result) {\n                // Call onSave if provided\n                if (onSave) {\n                    onSave(result.resultImageUrl);\n                }\n                if (onAddToLookbook) {\n                    // Convert try-on result to saved outfit format\n                    const savedOutfit = {\n                        userId: 'current_user',\n                        outfitId: result.id,\n                        id: result.id,\n                        name: `Try-On Result ${new Date().toLocaleDateString()}`,\n                        items: ((_b = currentOutfit === null || currentOutfit === void 0 ? void 0 : currentOutfit.garments) === null || _b === void 0 ? void 0 : _b.map(g => g.id)) || [],\n                        savedAt: new Date(),\n                        imageUrl: result.resultImageUrl || '',\n                        createdAt: new Date()\n                    };\n                    onAddToLookbook(savedOutfit);\n                }\n                setSaveSuccess(true);\n                // Close modal after successful save with a delay\n                setTimeout(() => {\n                    if (onClose) {\n                        onClose();\n                    }\n                    else {\n                        closeTryOnModal();\n                    }\n                }, 1500);\n            }\n        }\n        catch (err) {\n            console.error('Error saving to lookbook:', err);\n        }\n        finally {\n            setSavingToLookbook(false);\n        }\n    });\n    // Handle close\n    const handleClose = () => {\n        if (onClose) {\n            onClose();\n        }\n        else {\n            closeTryOnModal();\n        }\n    };\n    // Reset function to start over\n    const handleReset = () => {\n        clearUserImage();\n        setShowUploader(true);\n        setActiveGarmentId(null);\n        setSaveSuccess(false);\n    };\n    // Convert garment to wishlist item\n    const handleAddToWishlist = (garmentId) => {\n        if (!currentOutfit || !currentOutfit.garments)\n            return;\n        const garment = currentOutfit.garments.find(g => g.id === garmentId);\n        if (!garment)\n            return;\n        // Create a wishlist item from garment\n        const wishlistItem = {\n            itemId: garment.id,\n            retailerId: 'default_retailer_id',\n            name: garment.type || 'Garment',\n            addedAt: new Date(),\n            imageUrl: garment.url || '',\n            price: 0 // Mock price, would come from product data\n        };\n        // Add to wishlist\n        addToWishlist(wishlistItem);\n        alert('Item added to wishlist!');\n    };\n    // Convert garment to cart item\n    const handleAddToCart = (garmentId) => {\n        if (!currentOutfit || !currentOutfit.garments)\n            return;\n        const garment = currentOutfit.garments.find(g => g.id === garmentId);\n        if (!garment)\n            return;\n        // Create a cart item from garment\n        const cartItem = {\n            itemId: garment.id,\n            retailerId: 'default_retailer_id',\n            name: garment.type || 'Garment',\n            price: 0,\n            quantity: 1,\n            imageUrl: garment.url || '',\n            addedAt: new Date() // Add required addedAt field\n        };\n        // Add to cart\n        addToCart(cartItem);\n        alert('Item added to cart!');\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on__header\", style: { backgroundColor: primaryColor } }, { children: [_jsx(\"h2\", Object.assign({ className: \"stylist-virtual-try-on__title\" }, { children: \"Virtual Try-On\" })), _jsx(\"button\", Object.assign({ className: \"stylist-virtual-try-on__close-btn\", onClick: handleClose, \"aria-label\": \"Close\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"24\", height: \"24\" }, { children: _jsx(\"path\", { d: \"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\" }) })) }))] })), _jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on__content\" }, { children: [showUploader ? (_jsx(ImageUploader, { onUpload: handleImageUpload, title: \"Upload or Take a Photo\", description: \"Upload a photo or use your webcam to try on clothes\" })) : (_jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on__canvas-container\" }, { children: [_jsx(TryOnCanvas, { outfit: currentOutfit, userImage: userImage, setCanvasRef: setCanvasRef, onGarmentSelect: setActiveGarmentId, showBodyGuide: !userImage }), (userImage === null || userImage === void 0 ? void 0 : userImage.processingStatus) === ProcessingStatus.REMOVING_BACKGROUND && (_jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on__processing\" }, { children: [_jsx(\"div\", { className: \"stylist-virtual-try-on__spinner\" }), _jsx(\"p\", { children: \"Removing background...\" })] }))), webglSupported === false && userImage && (_jsx(\"div\", Object.assign({ className: \"stylist-virtual-try-on__warning\" }, { children: _jsxs(\"p\", { children: [_jsx(\"strong\", { children: \"Note:\" }), \" 3D graphics acceleration (WebGL) may not be fully supported in your browser. Background removal might use the original image.\"] }) }))), error && (_jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on__error\" }, { children: [_jsx(\"p\", { children: error }), _jsx(\"button\", Object.assign({ className: \"stylist-virtual-try-on__retry-btn\", onClick: handleReset }, { children: \"Try Again\" }))] }))), (userImage === null || userImage === void 0 ? void 0 : userImage.processingStatus) === ProcessingStatus.COMPLETED &&\n                                (currentOutfit === null || currentOutfit === void 0 ? void 0 : currentOutfit.garments) && currentOutfit.garments.length > 0 &&\n                                activeGarmentId && (_jsx(TryOnFeedback, { garmentId: activeGarmentId, onLike: (garmentId) => {\n                                    var _a;\n                                    // Find the garment in the outfit\n                                    const garment = (_a = currentOutfit === null || currentOutfit === void 0 ? void 0 : currentOutfit.garments) === null || _a === void 0 ? void 0 : _a.find(g => g.id === garmentId);\n                                    if (garment) {\n                                        // Log a positive feedback to AI model\n                                        console.log('Liked garment:', garmentId);\n                                        alert('Thanks for your feedback!');\n                                    }\n                                }, onDislike: (garmentId) => {\n                                    var _a;\n                                    // Find the garment in the outfit\n                                    const garment = (_a = currentOutfit === null || currentOutfit === void 0 ? void 0 : currentOutfit.garments) === null || _a === void 0 ? void 0 : _a.find(g => g.id === garmentId);\n                                    if (garment) {\n                                        // Remove from try-on queue\n                                        removeGarment(garmentId);\n                                        // Log a negative feedback to AI model\n                                        console.log('Disliked garment:', garmentId);\n                                        alert('Item removed. We\\'ll note your preference.');\n                                    }\n                                }, onAddToWishlist: handleAddToWishlist, onAddToCart: handleAddToCart, onSaveNote: (garmentId, note) => {\n                                    // Add note to garment for AI learning\n                                    console.log('Save note for garment:', garmentId, note);\n                                    alert('Note saved! We\\'ll use this feedback to improve recommendations.');\n                                }, primaryColor: primaryColor }))] }))), !showUploader && userImage && (_jsx(TryOnControls, { outfit: currentOutfit, activeGarmentId: activeGarmentId, onGarmentSelect: setActiveGarmentId, onGarmentRemove: removeGarment, onGarmentUpdate: updateGarmentProperties, onGarmentAdd: handleGarmentUpload, onChangePhoto: handleReset, disabled: isLoading }))] })), saveSuccess && (_jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on__success\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-virtual-try-on__success-icon\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"24\", height: \"24\" }, { children: _jsx(\"path\", { d: \"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\" }) })) })), _jsx(\"p\", Object.assign({ className: \"stylist-virtual-try-on__success-message\" }, { children: \"Saved to your Lookbook!\" }))] }))), _jsxs(\"div\", Object.assign({ className: \"stylist-virtual-try-on__footer\" }, { children: [_jsx(\"button\", Object.assign({ className: \"stylist-virtual-try-on__secondary-btn\", onClick: handleClose }, { children: \"Close\" })), _jsx(\"button\", Object.assign({ className: \"stylist-virtual-try-on__primary-btn\", onClick: handleSaveToLookbook, disabled: isLoading ||\n                            !userImage ||\n                            userImage.processingStatus !== ProcessingStatus.COMPLETED ||\n                            !((_a = currentOutfit === null || currentOutfit === void 0 ? void 0 : currentOutfit.garments) === null || _a === void 0 ? void 0 : _a.length) ||\n                            savingToLookbook ||\n                            saveSuccess, style: { backgroundColor: primaryColor } }, { children: savingToLookbook ? 'Saving...' : (saveSuccess ? 'Saved!' : 'Save to Lookbook') }))] }))] })));\n};\nexport default VirtualTryOn;\n","import VirtualTryOn from './VirtualTryOn';\nexport default VirtualTryOn;\n","// src/components/TryOnModal/index.ts\nimport TryOnModal from './TryOnModal';\nexport default TryOnModal;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Modal component for virtual try-on\nimport React, { useEffect } from 'react';\nimport './TryOnModal.scss';\nimport VirtualTryOn from '@/components/VirtualTryOn';\nimport { useTryOnStore } from '@/store/tryOnStore';\nconst TryOnModal = ({ onClose, onSave }) => {\n    const isTryOnModalOpen = useTryOnStore((state) => state.isTryOnModalOpen);\n    const closeTryOnModal = useTryOnStore((state) => state.closeTryOnModal);\n    // Handle closing - using useCallback to avoid dependency issues\n    const handleClose = React.useCallback(() => {\n        if (onClose) {\n            onClose();\n        }\n        else {\n            closeTryOnModal();\n        }\n    }, [onClose, closeTryOnModal]);\n    // Handle escape key\n    useEffect(() => {\n        const handleEscapeKey = (e) => {\n            if (e.key === 'Escape' && isTryOnModalOpen) {\n                handleClose();\n            }\n        };\n        document.addEventListener('keydown', handleEscapeKey);\n        return () => {\n            document.removeEventListener('keydown', handleEscapeKey);\n        };\n    }, [isTryOnModalOpen, handleClose]);\n    // Prevent body scrolling when modal is open\n    useEffect(() => {\n        if (isTryOnModalOpen) {\n            document.body.style.overflow = 'hidden';\n        }\n        else {\n            document.body.style.overflow = '';\n        }\n        return () => {\n            document.body.style.overflow = '';\n        };\n    }, [isTryOnModalOpen]);\n    if (!isTryOnModalOpen) {\n        return null;\n    }\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-try-on-modal\" }, { children: [_jsx(\"div\", { className: \"stylist-try-on-modal__overlay\", onClick: handleClose }), _jsx(\"div\", Object.assign({ className: \"stylist-try-on-modal__container\" }, { children: _jsx(VirtualTryOn, { onClose: handleClose, onSave: onSave }) }))] })));\n};\nexport default TryOnModal;\n","import { jsx as _jsx } from \"react/jsx-runtime\";\n// Floating button component for chat widget activation\nimport { useState, useEffect } from 'react';\nconst FloatingButton = ({ position, onClick, primaryColor, isOpen = false }) => {\n    const [animateState, setAnimateState] = useState('animate-in');\n    // Position classes for the button\n    const positionClasses = {\n        'bottom-right': 'stylist-floating-button--bottom-right',\n        'bottom-left': 'stylist-floating-button--bottom-left',\n        'top-right': 'stylist-floating-button--top-right',\n        'top-left': 'stylist-floating-button--top-left'\n    };\n    // Custom style for primary color\n    const buttonStyle = primaryColor ? { backgroundColor: primaryColor } : undefined;\n    // Handle animation states when opening/closing\n    useEffect(() => {\n        if (isOpen) {\n            setAnimateState('animate-out');\n        }\n        else {\n            setAnimateState('animate-in');\n        }\n    }, [isOpen]);\n    // Don't render the button if the chat widget is open\n    if (isOpen)\n        return null;\n    return (_jsx(\"div\", Object.assign({ className: `stylist-floating-button ${positionClasses[position]} ${animateState}`, onClick: onClick, style: buttonStyle, \"data-testid\": \"stylist-floating-button\", \"aria-label\": \"Open chat assistant\" }, { children: _jsx(\"div\", Object.assign({ className: \"stylist-floating-button__icon\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"24\", height: \"24\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12zM7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z\" }) })) })) })));\n};\nexport default FloatingButton;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n// Hook for detecting and managing network connectivity status\nimport { useState, useEffect, useCallback } from 'react';\nexport const useNetworkStatus = () => {\n    const [status, setStatus] = useState({\n        isOnline: navigator.onLine,\n        isSlowConnection: false,\n        effectiveType: null,\n        lastChecked: Date.now()\n    });\n    // Update connection quality information if available\n    const updateConnectionQuality = useCallback(() => {\n        if ('connection' in navigator) {\n            const connection = navigator.connection;\n            setStatus(prev => (Object.assign(Object.assign({}, prev), { isSlowConnection: connection.effectiveType === 'slow-2g' ||\n                    connection.effectiveType === '2g' ||\n                    connection.saveData === true, effectiveType: connection.effectiveType, lastChecked: Date.now() })));\n        }\n    }, []);\n    // Handle online status change\n    const handleOnline = useCallback(() => {\n        setStatus(prev => (Object.assign(Object.assign({}, prev), { isOnline: true, lastChecked: Date.now() })));\n        updateConnectionQuality();\n    }, [updateConnectionQuality]);\n    // Handle offline status change\n    const handleOffline = useCallback(() => {\n        setStatus(prev => (Object.assign(Object.assign({}, prev), { isOnline: false, lastChecked: Date.now() })));\n    }, []);\n    // Handle connection change events\n    const handleConnectionChange = useCallback(() => {\n        updateConnectionQuality();\n    }, [updateConnectionQuality]);\n    // Set up event listeners for network status changes\n    useEffect(() => {\n        // Initial check\n        updateConnectionQuality();\n        // Add event listeners\n        window.addEventListener('online', handleOnline);\n        window.addEventListener('offline', handleOffline);\n        // Add connection change listener if available\n        if ('connection' in navigator) {\n            const connection = navigator.connection;\n            connection.addEventListener('change', handleConnectionChange);\n        }\n        // Clean up event listeners\n        return () => {\n            window.removeEventListener('online', handleOnline);\n            window.removeEventListener('offline', handleOffline);\n            if ('connection' in navigator) {\n                const connection = navigator.connection;\n                connection.removeEventListener('change', handleConnectionChange);\n            }\n        };\n    }, [handleOnline, handleOffline, handleConnectionChange, updateConnectionQuality]);\n    // Manual check function\n    const checkConnection = useCallback(() => __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            // Try to fetch a tiny resource to verify connectivity\n            // This is more reliable than just checking navigator.onLine\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(), 5000);\n            const response = yield fetch('/api/ping', {\n                method: 'HEAD',\n                signal: controller.signal\n            });\n            clearTimeout(timeoutId);\n            const isConnected = response.ok;\n            setStatus(prev => (Object.assign(Object.assign({}, prev), { isOnline: isConnected, lastChecked: Date.now() })));\n            return isConnected;\n        }\n        catch (_) {\n            // If fetch fails, we're likely offline\n            setStatus(prev => (Object.assign(Object.assign({}, prev), { isOnline: false, lastChecked: Date.now() })));\n            return false;\n        }\n    }), []);\n    return Object.assign(Object.assign({}, status), { checkConnection });\n};\nexport default useNetworkStatus;\n","import { jsxs as _jsxs } from \"react/jsx-runtime\";\n// Provider for data synchronization across the application\nimport { createContext, useContext, useEffect, useState, useRef } from 'react';\nimport { useSyncService } from './syncService';\nimport useNetworkStatus from '../hooks/useNetworkStatus';\nimport { useUserStore } from '../store/userStore';\n// Initialize lifecycle log\nconsole.log('[LIFECYCLE:SyncProvider] Module load started');\nconst SyncContext = createContext(undefined);\nexport const useSyncContext = () => {\n    const context = useContext(SyncContext);\n    if (context === undefined) {\n        throw new Error('useSyncContext must be used within a SyncProvider');\n    }\n    return context;\n};\n// Provider component\nexport const SyncProvider = ({ children }) => {\n    console.log('[LIFECYCLE:SyncProvider] Provider component rendering');\n    const syncService = useSyncService();\n    const network = useNetworkStatus();\n    const userStore = useUserStore();\n    const [isMounted, setIsMounted] = useState(false);\n    // Add diagnostic task tracking\n    const backgroundTasksStarted = useRef(false);\n    const backgroundTasksCompleted = useRef(false);\n    const maxSyncTimeout = useRef(null);\n    console.log('[LIFECYCLE:SyncProvider] Initial state:', {\n        isMounted,\n        isOnline: network.isOnline,\n        hasUser: !!userStore.user,\n        syncState: syncService.state\n    });\n    // Initial sync when the component mounts and user is available\n    useEffect(() => {\n        console.log('[LIFECYCLE:SyncProvider] Initial sync effect running', {\n            isMounted,\n            isOnline: network.isOnline,\n            hasUser: !!userStore.user\n        });\n        if (!isMounted) {\n            console.log('[LIFECYCLE:SyncProvider] First mount detected, setting isMounted true');\n            setIsMounted(true);\n            return;\n        }\n        // Start tracking background initialization tasks\n        if (!backgroundTasksStarted.current) {\n            backgroundTasksStarted.current = true;\n            console.log('[TASK:START] Background initialization tasks starting');\n            // Set an absolute maximum timeout to ensure background tasks always complete\n            maxSyncTimeout.current = setTimeout(() => {\n                if (!backgroundTasksCompleted.current) {\n                    console.warn('[LIFECYCLE:SyncProvider] Maximum timeout reached, forcing background tasks completion');\n                    backgroundTasksCompleted.current = true;\n                    console.log('[TASK:COMPLETE] Background initialization tasks completed (forced by timeout)');\n                    // Set a global flag to indicate background initialization is complete\n                    if (window && typeof window !== 'undefined') {\n                        window.__STYLIST_BACKGROUND_INIT_COMPLETE = true;\n                    }\n                }\n            }, 15000); // 15 seconds absolute maximum\n        }\n        // Defer sync operation to avoid blocking initial render\n        console.log('[LIFECYCLE:SyncProvider] Setting initial sync timeout (2000ms)');\n        const timer = setTimeout(() => {\n            console.log('[LIFECYCLE:SyncProvider] Initial sync timeout fired, checking conditions');\n            if (userStore.user && network.isOnline) {\n                console.log('[LIFECYCLE:SyncProvider] Conditions met, triggering initial sync');\n                syncService.syncNow();\n            }\n            else {\n                console.log('[LIFECYCLE:SyncProvider] Initial sync skipped - offline or no user', {\n                    isOnline: network.isOnline,\n                    hasUser: !!userStore.user\n                });\n            }\n            // After sync attempt, mark background tasks as complete if not already done\n            if (!backgroundTasksCompleted.current) {\n                setTimeout(() => {\n                    if (!backgroundTasksCompleted.current) {\n                        console.log('[LIFECYCLE:SyncProvider] Marking background tasks as complete after sync attempt');\n                        backgroundTasksCompleted.current = true;\n                        console.log('[TASK:COMPLETE] Background initialization tasks completed after sync');\n                        // Set a global flag to indicate background initialization is complete\n                        if (window && typeof window !== 'undefined') {\n                            window.__STYLIST_BACKGROUND_INIT_COMPLETE = true;\n                        }\n                    }\n                }, 5000); // 5 seconds after sync attempt\n            }\n        }, 2000); // 2-second delay to ensure other components load first\n        return () => {\n            console.log('[LIFECYCLE:SyncProvider] Cleaning up initial sync timer');\n            clearTimeout(timer);\n            if (maxSyncTimeout.current) {\n                clearTimeout(maxSyncTimeout.current);\n            }\n        };\n    }, [isMounted, userStore.user, network.isOnline, syncService]);\n    // Perform sync when coming back online\n    useEffect(() => {\n        console.log('[LIFECYCLE:SyncProvider] Network status change effect', {\n            isOnline: network.isOnline,\n            hasUser: !!userStore.user\n        });\n        if (network.isOnline && userStore.user) {\n            // Slight delay to ensure stable connection\n            console.log('[LIFECYCLE:SyncProvider] Online detected, setting sync timeout (2000ms)');\n            const timer = setTimeout(() => {\n                console.log('[LIFECYCLE:SyncProvider] Online sync timeout fired, triggering sync');\n                syncService.syncNow();\n            }, 2000);\n            return () => {\n                console.log('[LIFECYCLE:SyncProvider] Cleaning up online sync timer');\n                clearTimeout(timer);\n            };\n        }\n    }, [network.isOnline, userStore.user, syncService]);\n    // Perform sync on page visibility change (user returns to tab)\n    useEffect(() => {\n        console.log('[LIFECYCLE:SyncProvider] Setting up visibility change listener');\n        const handleVisibilityChange = () => {\n            console.log('[LIFECYCLE:SyncProvider] Visibility changed', {\n                visibilityState: document.visibilityState,\n                isOnline: network.isOnline,\n                hasUser: !!userStore.user\n            });\n            if (document.visibilityState === 'visible' && network.isOnline && userStore.user) {\n                console.log('[LIFECYCLE:SyncProvider] Tab became visible while online, triggering sync');\n                syncService.syncNow();\n            }\n        };\n        document.addEventListener('visibilitychange', handleVisibilityChange);\n        return () => {\n            console.log('[LIFECYCLE:SyncProvider] Removing visibility change listener');\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\n        };\n    }, [network.isOnline, userStore.user, syncService]);\n    // Provide sync service to children\n    const value = {\n        syncState: syncService.state,\n        syncNow: syncService.syncNow,\n        isOnline: network.isOnline,\n        isSlowConnection: network.isSlowConnection\n    };\n    console.log('[LIFECYCLE:SyncProvider] Rendering provider with sync state:', {\n        isSyncing: syncService.state.isSyncing,\n        pendingOperations: syncService.state.pendingOperations,\n        isOnline: network.isOnline,\n        lastSyncTimestamp: syncService.state.lastSyncTimestamp ?\n            new Date(syncService.state.lastSyncTimestamp).toISOString() : null\n    });\n    // Add effect to set render complete flag\n    useEffect(() => {\n        // Ensure we set the render complete flag after component has mounted\n        const timer = setTimeout(() => {\n            console.log('[LIFECYCLE:SyncProvider] Setting widget render complete flag');\n            // Set global flag to indicate widget is fully rendered\n            if (window && typeof window !== 'undefined') {\n                window.__STYLIST_WIDGET_RENDER_COMPLETE = true;\n                // Log a diagnostic message\n                console.log('[RENDER:COMPLETE] Widget rendering completed');\n            }\n        }, 5000);\n        return () => {\n            clearTimeout(timer);\n        };\n    }, []);\n    return (_jsxs(SyncContext.Provider, Object.assign({ value: value }, { children: [(() => {\n                console.log('[LIFECYCLE:SyncProvider] Before rendering children');\n                return null;\n            })(), children, (() => {\n                console.log('[LIFECYCLE:SyncProvider] After rendering children');\n                return null;\n            })()] })));\n};\nexport default SyncProvider;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useSyncContext } from '../../services/SyncProvider';\nimport './SyncStatusIndicator.scss';\nexport const SyncStatusIndicator = () => {\n    const { syncState, isOnline, isSlowConnection } = useSyncContext();\n    // Don't show anything if there are no pending operations\n    if (syncState.pendingOperations === 0 && !syncState.isSyncing) {\n        return null;\n    }\n    // Determine the indicator state\n    let status = 'syncing';\n    let message = 'Syncing...';\n    if (!isOnline) {\n        status = 'offline';\n        message = `${syncState.pendingOperations} change${syncState.pendingOperations !== 1 ? 's' : ''} pending`;\n    }\n    else if (syncState.isSyncing) {\n        status = 'syncing';\n        message = 'Syncing...';\n    }\n    else if (syncState.pendingOperations > 0) {\n        status = 'pending';\n        message = `${syncState.pendingOperations} change${syncState.pendingOperations !== 1 ? 's' : ''} pending`;\n    }\n    return (_jsxs(\"div\", Object.assign({ className: `sync-status-indicator sync-status-${status}` }, { children: [_jsxs(\"div\", Object.assign({ className: \"sync-status-icon\" }, { children: [status === 'syncing' && (_jsx(\"svg\", Object.assign({ className: \"sync-spinner\", viewBox: \"0 0 24 24\" }, { children: _jsx(\"circle\", { className: \"sync-spinner-path\", cx: \"12\", cy: \"12\", r: \"10\", fill: \"none\", stroke: \"currentColor\", strokeWidth: \"4\" }) }))), status === 'pending' && _jsx(\"span\", { children: \"\\u23F1\\uFE0F\" }), status === 'offline' && _jsx(\"span\", { children: \"\\uD83D\\uDCF4\" })] })), _jsx(\"span\", Object.assign({ className: \"sync-status-message\" }, { children: message }))] })));\n};\nexport default SyncStatusIndicator;\n","// Feedback synchronization service\n// This service periodically syncs locally stored feedback with the backend\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { createStylistApi } from '@/api';\nimport { useFeedbackStore } from '@/store/feedbackStore';\nimport { getUserId } from '@/utils/localStorage';\nimport { trackEvent, AnalyticsEventType } from '@/utils/analytics';\n// Initialize lifecycle log\nconsole.log('[LIFECYCLE:FeedbackSync] Module load started');\nexport class FeedbackSyncService {\n    constructor() {\n        this.syncIntervalId = null;\n        this.syncInterval = 60000; // 1 minute\n        this.isInitialized = false;\n        this.apiConfig = null;\n    }\n    /**\n     * Initialize the feedback sync service\n     */\n    initialize(apiConfig) {\n        console.log('[LIFECYCLE:FeedbackSync] Initialize called', {\n            isAlreadyInitialized: this.isInitialized,\n            apiKeyProvided: !!(apiConfig === null || apiConfig === void 0 ? void 0 : apiConfig.apiKey),\n            retailerIdProvided: !!(apiConfig === null || apiConfig === void 0 ? void 0 : apiConfig.retailerId)\n        });\n        if (this.isInitialized) {\n            console.log('[LIFECYCLE:FeedbackSync] Already initialized, skipping');\n            return;\n        }\n        console.log('[LIFECYCLE:FeedbackSync] Setting up service with config');\n        this.apiConfig = apiConfig;\n        this.isInitialized = true;\n        // Register with the network online/offline events\n        console.log('[LIFECYCLE:FeedbackSync] Adding online/offline event listeners');\n        window.addEventListener('online', this.handleOnline.bind(this));\n        window.addEventListener('offline', this.handleOffline.bind(this));\n        // Delay sync initialization to avoid blocking initial render\n        console.log('[LIFECYCLE:FeedbackSync] Setting initialization delay timeout (3000ms)');\n        setTimeout(() => {\n            console.log('[LIFECYCLE:FeedbackSync] Initialization delay completed, checking online status');\n            // Check if currently online and start sync if needed\n            if (navigator.onLine) {\n                console.log('[LIFECYCLE:FeedbackSync] Device is online, starting sync interval');\n                this.startSyncInterval();\n            }\n            else {\n                console.log('[LIFECYCLE:FeedbackSync] Device is offline, deferring sync');\n            }\n        }, 3000); // 3-second delay to ensure widget loads smoothly\n    }\n    /**\n     * Start the sync interval\n     */\n    startSyncInterval() {\n        console.log('[LIFECYCLE:FeedbackSync] startSyncInterval called', {\n            hasExistingInterval: this.syncIntervalId !== null\n        });\n        if (this.syncIntervalId !== null) {\n            console.log('[LIFECYCLE:FeedbackSync] Sync interval already active, skipping');\n            return;\n        }\n        // Perform initial sync\n        console.log('[LIFECYCLE:FeedbackSync] Performing initial feedback sync');\n        this.syncFeedback();\n        // Set up recurring sync\n        console.log(`[LIFECYCLE:FeedbackSync] Setting up recurring sync every ${this.syncInterval}ms`);\n        this.syncIntervalId = window.setInterval(() => {\n            console.log('[LIFECYCLE:FeedbackSync] Recurring sync interval triggered');\n            this.syncFeedback();\n        }, this.syncInterval);\n    }\n    /**\n     * Stop the sync interval\n     */\n    stopSyncInterval() {\n        console.log('[LIFECYCLE:FeedbackSync] stopSyncInterval called', {\n            hasActiveInterval: this.syncIntervalId !== null\n        });\n        if (this.syncIntervalId === null) {\n            console.log('[LIFECYCLE:FeedbackSync] No active sync interval to stop');\n            return;\n        }\n        console.log('[LIFECYCLE:FeedbackSync] Clearing sync interval');\n        window.clearInterval(this.syncIntervalId);\n        this.syncIntervalId = null;\n        console.log('[LIFECYCLE:FeedbackSync] Sync interval stopped');\n    }\n    /**\n     * Handle online event\n     */\n    handleOnline() {\n        console.log('[LIFECYCLE:FeedbackSync] Online event detected');\n        this.startSyncInterval();\n    }\n    /**\n     * Handle offline event\n     */\n    handleOffline() {\n        console.log('[LIFECYCLE:FeedbackSync] Offline event detected');\n        this.stopSyncInterval();\n    }\n    /**\n     * Sync feedback with the backend\n     */\n    syncFeedback() {\n        var _a;\n        return __awaiter(this, void 0, void 0, function* () {\n            console.log('[LIFECYCLE:FeedbackSync] syncFeedback called', {\n                isInitialized: this.isInitialized,\n                hasApiConfig: !!this.apiConfig\n            });\n            if (!this.isInitialized || !this.apiConfig) {\n                console.log('[LIFECYCLE:FeedbackSync] Cannot sync - not initialized or missing config');\n                return;\n            }\n            const feedbackStore = useFeedbackStore.getState();\n            const pendingItems = feedbackStore.getPendingSyncItems();\n            console.log('[LIFECYCLE:FeedbackSync] Pending feedback items:', pendingItems.length);\n            // No items to sync\n            if (pendingItems.length === 0) {\n                console.log('[LIFECYCLE:FeedbackSync] No pending items to sync');\n                return;\n            }\n            // Don't try to sync if already syncing\n            if (feedbackStore.isSyncing) {\n                console.log('[LIFECYCLE:FeedbackSync] Already syncing, skipping');\n                return;\n            }\n            try {\n                console.log('[LIFECYCLE:FeedbackSync] Starting sync process');\n                feedbackStore.setIsSyncing(true);\n                const userId = getUserId();\n                console.log('[LIFECYCLE:FeedbackSync] Creating API client for sync');\n                const api = createStylistApi(this.apiConfig);\n                console.log('[LIFECYCLE:FeedbackSync] Sending sync request to API', {\n                    userId,\n                    itemCount: pendingItems.length\n                });\n                const response = yield api.feedback.syncFeedback({\n                    userId,\n                    feedbackItems: pendingItems\n                });\n                console.log('[LIFECYCLE:FeedbackSync] Sync response received', {\n                    success: response.success,\n                    syncedCount: ((_a = response.syncedItemIds) === null || _a === void 0 ? void 0 : _a.length) || 0\n                });\n                if (response.success && response.syncedItemIds.length > 0) {\n                    // Mark items as synced\n                    console.log('[LIFECYCLE:FeedbackSync] Marking items as synced');\n                    feedbackStore.markAsSynced(response.syncedItemIds);\n                    // Track successful sync\n                    console.log('[LIFECYCLE:FeedbackSync] Tracking sync event');\n                    trackEvent(AnalyticsEventType.FEEDBACK_SYNCED, userId, {\n                        count: response.syncedItemIds.length\n                    });\n                }\n            }\n            catch (error) {\n                console.error('[LIFECYCLE:FeedbackSync] Error syncing feedback:', error);\n            }\n            finally {\n                console.log('[LIFECYCLE:FeedbackSync] Completing sync process');\n                feedbackStore.setIsSyncing(false);\n            }\n        });\n    }\n    /**\n     * Clean up resources\n     */\n    cleanup() {\n        console.log('[LIFECYCLE:FeedbackSync] Cleanup called');\n        this.stopSyncInterval();\n        console.log('[LIFECYCLE:FeedbackSync] Removing event listeners');\n        window.removeEventListener('online', this.handleOnline.bind(this));\n        window.removeEventListener('offline', this.handleOffline.bind(this));\n        this.isInitialized = false;\n        console.log('[LIFECYCLE:FeedbackSync] Service marked as uninitialized');\n    }\n}\n// Create singleton instance\nexport const feedbackSyncService = new FeedbackSyncService();\n","import { jsxs as _jsxs, jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { createElement as _createElement } from \"react\";\n// The Stylist Widget main component\nimport { useRef, useState } from 'react';\nimport FloatingButton from '@/components/ChatWidget/FloatingButton';\nimport SyncStatusIndicator from '@/components/common/SyncStatusIndicator';\nimport { useChatStore } from '@/store/index';\nimport { SyncProvider } from '@/services/SyncProvider';\nimport { feedbackSyncService } from '@/services/feedbackSyncService';\nimport AsyncComponentLoader from '@/components/common/AsyncComponentLoader';\nimport { USE_LAZY_LOADING, USE_PARALLEL_INIT } from './index';\nimport './styles/global.scss';\n// Import diagnostics tools\nimport { logComponentRender, logGlobalFlag } from './diagnostics';\nimport { useDiagnosticLifecycle, useDiagnosticEffect, monitoredLazy, DiagnosticErrorBoundary, DiagnosticSuspense } from './diagnosticHooks';\n// Initialize widget lifecycle log\nconsole.log('[LIFECYCLE:StylistWidget] Module load started');\nlogComponentRender('StylistWidget', 'render', 'Module load started');\n// Always import the non-lazy version\nimport ChatWidgetRegular from '@/components/ChatWidget';\n// Global initialization tracker to prevent double initialization\n// This works across component instances and rehydration\nif (typeof window !== 'undefined') {\n    window.__STYLIST_WIDGET_INITIALIZED = window.__STYLIST_WIDGET_INITIALIZED || false;\n}\n// Create lazy-loaded version that will be conditionally used\nconst ChatWidgetLazy = monitoredLazy(() => {\n    console.log('[LIFECYCLE:StylistWidget] ChatWidgetLazy import starting');\n    return import('@/components/ChatWidget')\n        .then(module => {\n        console.log('[LIFECYCLE:StylistWidget] ChatWidgetLazy successfully loaded');\n        return module;\n    })\n        .catch(error => {\n        console.error('[LIFECYCLE:StylistWidget] Failed to load ChatWidget component:', error);\n        // Return a module-like object with a default export to prevent crashes\n        return { default: ChatWidgetRegular };\n    });\n}, 'ChatWidget');\nconst StylistWidget = (props) => {\n    var _a, _b;\n    // Log component lifecycle\n    useDiagnosticLifecycle('StylistWidget');\n    // Create a store initialization state to prevent rendering before stores are ready\n    const [storesReady, setStoresReady] = useState(false);\n    const [initAttempted, setInitAttempted] = useState(false);\n    const chatStore = useChatStore();\n    // Log render with store status\n    logComponentRender('StylistWidget', 'render', `StylistWidget rendering with store status: ${chatStore ? 'available' : 'unavailable'}`, { storesReady, initAttempted });\n    // Safe store access with default values\n    const isOpen = (_a = chatStore === null || chatStore === void 0 ? void 0 : chatStore.isOpen) !== null && _a !== void 0 ? _a : false;\n    const toggleOpen = (_b = chatStore === null || chatStore === void 0 ? void 0 : chatStore.toggleOpen) !== null && _b !== void 0 ? _b : (() => console.warn('Chat store not initialized'));\n    // Create a component instance initialization ref\n    const componentInitializedRef = useRef(false);\n    // Handle button click with store safety check\n    const handleOpenWidget = () => {\n        if (chatStore && typeof chatStore.toggleOpen === 'function') {\n            toggleOpen();\n        }\n        else {\n            console.warn('Cannot toggle widget - chat store not initialized');\n        }\n    };\n    // Initialize stores and mark as ready with safety timeout\n    useDiagnosticEffect('StylistWidget', 'storeInitialization', [chatStore, initAttempted], () => {\n        console.log('[LIFECYCLE:StylistWidget] Store initialization effect running', {\n            initAttempted,\n            chatStoreExists: !!chatStore\n        });\n        // Mark init as attempted to prevent multiple attempts\n        if (!initAttempted) {\n            setInitAttempted(true);\n            console.log('[LIFECYCLE:StylistWidget] First initialization attempt marked');\n            logGlobalFlag('STYLIST_INIT_ATTEMPTED', true, 'First initialization attempt marked');\n            // Check if store is available immediately\n            if (chatStore) {\n                console.log('[LIFECYCLE:StylistWidget] Store ready immediately');\n                logGlobalFlag('STYLIST_STORES_READY', true, 'Store ready immediately');\n                setStoresReady(true);\n                return;\n            }\n            // Set a safety timeout to prevent infinite waiting\n            console.log('[LIFECYCLE:StylistWidget] Setting store safety timeout (2s)');\n            const safetyTimeout = setTimeout(() => {\n                console.warn('[LIFECYCLE:StylistWidget] Store initialization timeout - forcing ready state');\n                logGlobalFlag('STYLIST_STORES_READY', true, 'Store initialization timeout - forcing ready state', {\n                    timedOut: true\n                });\n                setStoresReady(true);\n            }, 2000); // 2 second safety timeout\n            return () => {\n                console.log('[LIFECYCLE:StylistWidget] Clearing store safety timeout');\n                clearTimeout(safetyTimeout);\n            };\n        }\n    });\n    // Secondary effect to mark store as ready if it becomes available\n    useDiagnosticEffect('StylistWidget', 'secondaryStoreCheck', [chatStore, storesReady], () => {\n        console.log('[LIFECYCLE:StylistWidget] Secondary store check effect running', {\n            storesReady,\n            chatStoreExists: !!chatStore\n        });\n        if (!storesReady && chatStore) {\n            console.log('[LIFECYCLE:StylistWidget] Store now available, marking as ready');\n            logGlobalFlag('STYLIST_STORES_READY', true, 'Store now available, marking as ready');\n            setStoresReady(true);\n        }\n    });\n    // Prevent double initialization with global flag\n    useDiagnosticEffect('StylistWidget', 'mainInitialization', [], () => {\n        console.log('[LIFECYCLE:StylistWidget] Main initialization effect running', {\n            alreadyInitialized: window.__STYLIST_WIDGET_INITIALIZED,\n            locallyInitialized: componentInitializedRef.current,\n            parallelInit: USE_PARALLEL_INIT\n        });\n        // Skip if already initialized\n        if (window.__STYLIST_WIDGET_INITIALIZED) {\n            console.log('[LIFECYCLE:StylistWidget] Already mounted, skipping initialization');\n            logGlobalFlag('__STYLIST_WIDGET_INITIALIZED', true, 'Widget already initialized, skipping');\n            return;\n        }\n        // Mark as initialized both locally and globally\n        componentInitializedRef.current = true;\n        window.__STYLIST_WIDGET_INITIALIZED = true;\n        logGlobalFlag('__STYLIST_WIDGET_INITIALIZED', true, 'Widget marked as initialized');\n        console.log('[LIFECYCLE:StylistWidget] Initializing widget instance');\n        // Initialize critical paths immediately, defer non-critical operations\n        if (USE_PARALLEL_INIT) {\n            console.log('[LIFECYCLE:StylistWidget] Using parallel initialization strategy');\n            logGlobalFlag('USE_PARALLEL_INIT', true, 'Using parallel initialization strategy');\n            // Original parallel initialization behavior\n            console.log('[LIFECYCLE:StylistWidget] Initializing feedbackSyncService immediately');\n            feedbackSyncService.initialize({\n                apiKey: props.apiKey,\n                retailerId: props.retailerId,\n                apiUrl: props.apiUrl\n            });\n        }\n        else {\n            // Only register the feedback service for later background initialization\n            // The actual initialization will be triggered by the ChatWidget's onFirstPaint callback\n            console.log('[LIFECYCLE:StylistWidget] Deferring feedback sync service initialization until first paint');\n            logGlobalFlag('USE_PARALLEL_INIT', false, 'Using optimized initialization with delayed services');\n            // Make TypeScript happy by using type assertion\n            window.__STYLIST_PENDING_INITIALIZATIONS = Object.assign(Object.assign({}, (window.__STYLIST_PENDING_INITIALIZATIONS || {})), { feedbackSync: {\n                    apiKey: props.apiKey,\n                    retailerId: props.retailerId,\n                    apiUrl: props.apiUrl\n                } });\n            logGlobalFlag('__STYLIST_PENDING_INITIALIZATIONS', true, 'Pending initializations registered', {\n                services: ['feedbackSync']\n            });\n        }\n        // Clean up on unmount, but don't reset initialization flag\n        // This prevents re-initialization if we're transitioning views\n        return () => {\n            console.log('[LIFECYCLE:StylistWidget] Cleaning up feedbackSyncService');\n            feedbackSyncService.cleanup();\n        };\n    });\n    // Inject CSS variables for theme colors\n    useDiagnosticEffect('StylistWidget', 'themeColors', [props.primaryColor], () => {\n        console.log('[LIFECYCLE:StylistWidget] Theme color effect running', {\n            primaryColor: props.primaryColor\n        });\n        if (props.primaryColor) {\n            console.log('[LIFECYCLE:StylistWidget] Setting theme CSS variables');\n            document.documentElement.style.setProperty('--stylist-primary-color', props.primaryColor);\n            // Generate lighter and darker variants\n            document.documentElement.style.setProperty('--stylist-primary-color-light', lightenColor(props.primaryColor, 0.2));\n            document.documentElement.style.setProperty('--stylist-primary-color-dark', darkenColor(props.primaryColor, 0.2));\n        }\n    });\n    // Helper function to lighten a color\n    const lightenColor = (color, amount) => {\n        try {\n            // Remove the # if present\n            color = color.replace('#', '');\n            // Parse the color\n            const r = parseInt(color.substring(0, 2), 16);\n            const g = parseInt(color.substring(2, 4), 16);\n            const b = parseInt(color.substring(4, 6), 16);\n            // Lighten each component\n            const newR = Math.min(255, Math.floor(r + (255 - r) * amount));\n            const newG = Math.min(255, Math.floor(g + (255 - g) * amount));\n            const newB = Math.min(255, Math.floor(b + (255 - b) * amount));\n            // Convert back to hex\n            return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;\n        }\n        catch (_a) {\n            return color;\n        }\n    };\n    // Helper function to darken a color\n    const darkenColor = (color, amount) => {\n        try {\n            // Remove the # if present\n            color = color.replace('#', '');\n            // Parse the color\n            const r = parseInt(color.substring(0, 2), 16);\n            const g = parseInt(color.substring(2, 4), 16);\n            const b = parseInt(color.substring(4, 6), 16);\n            // Darken each component\n            const newR = Math.max(0, Math.floor(r * (1 - amount)));\n            const newG = Math.max(0, Math.floor(g * (1 - amount)));\n            const newB = Math.max(0, Math.floor(b * (1 - amount)));\n            // Convert back to hex\n            return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;\n        }\n        catch (_a) {\n            return color;\n        }\n    };\n    // Conditionally render either the lazy-loaded or regular ChatWidget\n    const ChatWidgetComponent = USE_LAZY_LOADING ? ChatWidgetLazy : ChatWidgetRegular;\n    // Create a handler for first paint/mount callback from ChatWidget\n    const handleFirstPaint = () => {\n        console.log('[LIFECYCLE:StylistWidget] First paint callback triggered from ChatWidget');\n        if (!USE_PARALLEL_INIT && window.__STYLIST_PENDING_INITIALIZATIONS) {\n            console.log('[LIFECYCLE:StylistWidget] Scheduling background initialization tasks with 1s delay');\n            // Delay background tasks to ensure UI is responsive\n            setTimeout(() => {\n                var _a;\n                console.log('[LIFECYCLE:StylistWidget] Background initialization tasks starting now');\n                // Initialize feedback sync service\n                if ((_a = window.__STYLIST_PENDING_INITIALIZATIONS) === null || _a === void 0 ? void 0 : _a.feedbackSync) {\n                    console.log('[LIFECYCLE:StylistWidget] Initializing feedback sync service in background');\n                    try {\n                        feedbackSyncService.initialize(window.__STYLIST_PENDING_INITIALIZATIONS.feedbackSync);\n                        console.log('[LIFECYCLE:StylistWidget] Feedback sync service initialized successfully');\n                    }\n                    catch (error) {\n                        console.error('[LIFECYCLE:StylistWidget] Error initializing feedback sync service:', error);\n                    }\n                }\n                // Mark background initialization as complete\n                // Use type assertion to avoid TypeScript errors\n                window.__STYLIST_BACKGROUND_INIT_COMPLETE = true;\n                console.log('[LIFECYCLE:StylistWidget] Background initialization marked as complete');\n            }, 1000); // 1 second delay to ensure UI paint is complete\n        }\n    };\n    // Conditionally wrap in SyncProvider based on initialization strategy\n    const widgetContent = (_jsx(DiagnosticErrorBoundary, Object.assign({ componentName: \"StylistWidget\", fallback: _jsxs(\"div\", Object.assign({ className: \"stylist-error-container\", style: {\n                padding: '1rem',\n                textAlign: 'center',\n                color: '#721c24',\n                backgroundColor: '#f8d7da',\n                borderRadius: '4px',\n                margin: '1rem'\n            } }, { children: [_jsx(\"h3\", { children: \"Widget Error\" }), _jsx(\"p\", { children: \"The widget encountered an error during loading.\" }), _jsx(\"button\", Object.assign({ onClick: () => window.location.reload(), style: {\n                        marginTop: '1rem',\n                        padding: '0.5rem 1rem',\n                        backgroundColor: 'var(--stylist-primary-color, #4361ee)',\n                        color: 'white',\n                        border: 'none',\n                        borderRadius: '4px',\n                        cursor: 'pointer'\n                    } }, { children: \"Reload\" }))] })) }, { children: _jsxs(_Fragment, { children: [_jsx(DiagnosticSuspense, Object.assign({ componentName: \"StylistWidget\", fallback: _jsxs(\"div\", Object.assign({ className: \"stylist-loading-container\", style: {\n                            display: 'flex',\n                            flexDirection: 'column',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: '2rem',\n                            height: '100%'\n                        } }, { children: [_jsx(\"div\", { className: \"stylist-loading-spinner\" }), _jsx(\"p\", Object.assign({ style: { marginTop: '1rem' } }, { children: \"Loading Stylist Widget...\" }))] })) }, { children: _jsxs(AsyncComponentLoader, Object.assign({ loadingMessage: \"Loading Stylist Widget...\", onLoadStart: () => console.log('[LIFECYCLE:StylistWidget] AsyncComponentLoader started loading ChatWidget'), onLoadComplete: () => console.log('[LIFECYCLE:StylistWidget] AsyncComponentLoader finished loading ChatWidget') }, { children: [(() => {\n                                console.log('[LIFECYCLE:StylistWidget] Before ChatWidget render');\n                                return null;\n                            })(), _createElement(ChatWidgetComponent, Object.assign({}, props, { key: \"stylist-chat-widget-singleton\", onFirstPaint: handleFirstPaint })), (() => {\n                                console.log('[LIFECYCLE:StylistWidget] After ChatWidget render');\n                                return null;\n                            })()] })) })), storesReady && (_jsx(FloatingButton, { position: props.position || 'bottom-right', onClick: handleOpenWidget, primaryColor: props.primaryColor, isOpen: isOpen })), _jsx(SyncStatusIndicator, {})] }) })));\n    // With parallel init, wrap in SyncProvider normally\n    // With optimized init, only use SyncProvider if needed immediately\n    return USE_PARALLEL_INIT ? (_jsx(SyncProvider, { children: widgetContent })) : (\n    // In optimized mode, we'll handle SyncProvider init later\n    widgetContent);\n};\nexport default StylistWidget;\n","// Store monitoring utilities for diagnostics\nimport { logStore } from './diagnostics';\n/**\n * Monitors an existing Zustand store\n * Simplified version that avoids complex type issues\n */\nexport function monitorExistingStore(storeName, store) {\n    // Log that we're monitoring an existing store\n    logStore(storeName, 'init', `Monitoring existing ${storeName} store`);\n    // The original store is already created, so we just need to\n    // monitor state changes by subscribing to it\n    if (store && typeof store.subscribe === 'function') {\n        store.subscribe((state) => {\n            logStore(storeName, 'update', `${storeName} updated`, { newState: state });\n        });\n    }\n    return store;\n}\n/**\n * Creates a middleware function for Zustand stores\n * This allows logging of state changes\n */\nexport function createDiagnosticsMiddleware(storeName) {\n    return function middleware(config) {\n        return function (set, get, api) {\n            // Wrap the set function to log all state changes\n            const wrappedSet = (...args) => {\n                // Log before the update\n                logStore(storeName, 'update', `${storeName} state update starting`);\n                // Call the original set function\n                const result = set(...args);\n                // Log after the update\n                logStore(storeName, 'update', `${storeName} state updated`, {\n                    newState: get(),\n                    updateType: typeof args[0] === 'function' ? 'function' : 'object',\n                });\n                return result;\n            };\n            // Return the config with the wrapped set function\n            return config(wrappedSet, get, api);\n        };\n    };\n}\nexport default {\n    monitorExistingStore,\n    createDiagnosticsMiddleware\n};\n","import { jsx as _jsx } from \"react/jsx-runtime\";\n// Main entry point for the widget\nimport React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport StylistWidget from './StylistWidget';\nimport { useChatStore, useRecommendationStore, useUserStore } from './store/index';\nimport { logGlobalFlag, logComponentRender, logStore, logPerformance } from './diagnostics';\nimport { monitorExistingStore } from './storeMonitor';\n// Feature flag for lazy loading - set to false to disable lazy loading\nexport const USE_LAZY_LOADING = true;\n// Feature flag for controlling parallel vs sequential initialization\n// Set to true for parallel initialization (original behavior)\n// Set to false for optimized background initialization\nexport const USE_PARALLEL_INIT = true;\n// Create safe store selectors that won't crash if the store isn't initialized\nconst getSafeStoreValue = (store, selector, defaultValue) => {\n    var _a;\n    try {\n        // First check if store exists and has getState method\n        if (store && typeof store.getState === 'function') {\n            const state = store.getState();\n            // Then check if selector can be safely applied\n            return (_a = selector(state)) !== null && _a !== void 0 ? _a : defaultValue;\n        }\n        return defaultValue;\n    }\n    catch (error) {\n        console.warn('Error accessing store:', error);\n        return defaultValue;\n    }\n};\n// Initialize stores early to prevent race conditions\n// This ensures stores are ready before any UI renders\nconst initializeStores = () => {\n    try {\n        // Prevent duplicate initialization\n        if (window.__STYLIST_STORES_INITIALIZING) {\n            console.log('Store initialization already in progress, skipping');\n            logStore('global', 'init', 'Store initialization already in progress, skipping');\n            return false;\n        }\n        // Performance tracking for store initialization\n        const initStartTime = performance.now();\n        logPerformance('storeInitialization:start', 0, { phase: 'start' });\n        // Set initializing flag to prevent concurrent initialization\n        window.__STYLIST_STORES_INITIALIZING = true;\n        logGlobalFlag('__STYLIST_STORES_INITIALIZING', true, 'Setting store initialization flag');\n        // Touch each store to initialize it - with proper error handling for each\n        try {\n            const chatInitialState = useChatStore.getState();\n            console.log('Chat store initialized');\n            // Monitor the chat store\n            monitorExistingStore('chatStore', useChatStore);\n            logStore('chatStore', 'init', 'Chat store successfully initialized', {\n                isOpen: chatInitialState.isOpen,\n                hasMessages: chatInitialState.messages.length > 0,\n                currentView: chatInitialState.currentView\n            });\n        }\n        catch (e) {\n            console.error('Failed to initialize chat store:', e);\n            logStore('chatStore', 'init', 'Failed to initialize chat store', {\n                error: e instanceof Error ? e.message : String(e)\n            });\n        }\n        try {\n            const userInitialState = useUserStore.getState();\n            console.log('User store initialized');\n            // Monitor the user store\n            monitorExistingStore('userStore', useUserStore);\n            logStore('userStore', 'init', 'User store successfully initialized', {\n                hasUser: !!userInitialState.user\n            });\n        }\n        catch (e) {\n            console.error('Failed to initialize user store:', e);\n            logStore('userStore', 'init', 'Failed to initialize user store', {\n                error: e instanceof Error ? e.message : String(e)\n            });\n        }\n        try {\n            const recInitialState = useRecommendationStore.getState();\n            console.log('Recommendation store initialized');\n            // Monitor the recommendation store\n            monitorExistingStore('recommendationStore', useRecommendationStore);\n            logStore('recommendationStore', 'init', 'Recommendation store successfully initialized', {\n                itemCount: recInitialState.recommendedItems.length,\n                outfitCount: recInitialState.recommendedOutfits.length\n            });\n        }\n        catch (e) {\n            console.error('Failed to initialize recommendation store:', e);\n            logStore('recommendationStore', 'init', 'Failed to initialize recommendation store', {\n                error: e instanceof Error ? e.message : String(e)\n            });\n        }\n        // Performance tracking for completion\n        const initDuration = performance.now() - initStartTime;\n        logPerformance('storeInitialization:complete', initDuration, {\n            phase: 'complete',\n            duration: `${initDuration.toFixed(2)}ms`\n        });\n        // Log successful initialization\n        console.log('Store initialization completed');\n        logStore('global', 'init', 'All stores initialized successfully', {\n            initDuration: `${initDuration.toFixed(2)}ms`\n        });\n        // Add a global flag to indicate stores are ready\n        window.__STYLIST_STORES_INITIALIZED = true;\n        window.__STYLIST_STORES_INITIALIZING = false;\n        logGlobalFlag('__STYLIST_STORES_INITIALIZED', true, 'Stores successfully initialized');\n        logGlobalFlag('__STYLIST_STORES_INITIALIZING', false, 'Cleared store initialization flag');\n        return true;\n    }\n    catch (error) {\n        console.error('Critical error during store initialization:', error);\n        logStore('global', 'init', 'Critical error during store initialization', {\n            error: error instanceof Error ? error.message : String(error),\n            stack: error instanceof Error ? error.stack : undefined\n        });\n        window.__STYLIST_STORES_INITIALIZING = false;\n        logGlobalFlag('__STYLIST_STORES_INITIALIZING', false, 'Cleared store initialization flag after error');\n        return false;\n    }\n};\n// Initialize stores immediately, but with safety timeout\nconst initTimeout = setTimeout(() => {\n    if (!window.__STYLIST_STORES_INITIALIZED) {\n        console.warn('Store initialization taking too long, forcing completion');\n        logStore('global', 'init', 'Store initialization timeout - forcing completion', {\n            timeoutDuration: '5000ms'\n        });\n        window.__STYLIST_STORES_INITIALIZED = true;\n        window.__STYLIST_STORES_INITIALIZING = false;\n        logGlobalFlag('__STYLIST_STORES_INITIALIZED', true, 'Forced store initialization to complete due to timeout');\n        logGlobalFlag('__STYLIST_STORES_INITIALIZING', false, 'Cleared store initialization flag after timeout');\n    }\n}, 5000); // 5 second safety timeout\n// Start initialization\nlogComponentRender('index', 'mount', 'Main entry point initialized');\ninitializeStores();\n// Use a self-invoking function to encapsulate the widget creation and prevent duplication\n(function mountWidgetOnce() {\n    // Track performance for widget mounting\n    const mountStartTime = performance.now();\n    logPerformance('widgetMount:start', 0, { phase: 'start' });\n    // Check if widget is already mounted\n    if (window.__STYLIST_WIDGET_DOM_MOUNTED === true) {\n        console.log('Widget DOM already mounted, skipping render');\n        logComponentRender('index', 'render', 'Widget DOM already mounted, skipping render');\n        return;\n    }\n    // Get or create a container for the widget\n    let stylistContainer = document.getElementById('stylist-widget-container');\n    // Only create a new container if one doesn't exist\n    if (!stylistContainer) {\n        console.log('Creating widget container as it does not exist');\n        logComponentRender('index', 'render', 'Creating widget container');\n        stylistContainer = createWidgetContainer();\n    }\n    else {\n        console.log('Using existing widget container');\n        logComponentRender('index', 'render', 'Using existing widget container');\n    }\n    // Set mounting flag BEFORE creating root to prevent any race conditions\n    window.__STYLIST_WIDGET_DOM_MOUNTED = true;\n    logGlobalFlag('__STYLIST_WIDGET_DOM_MOUNTED', true, 'Setting widget DOM mounted flag');\n    // Set a safety timeout to clear the widget mounted flag if rendering fails\n    // This allows a future retry if the initial attempt fails\n    const safetyTimeout = setTimeout(() => {\n        if (!window.__STYLIST_WIDGET_RENDER_COMPLETE) {\n            console.warn('Stylist Widget render did not complete within the timeout period, resetting initialization flags');\n            logGlobalFlag('__STYLIST_WIDGET_DOM_MOUNTED', false, 'Resetting DOM mounted flag after render timeout', {\n                timeoutDuration: '10000ms',\n                elapsedTime: `${((performance.now() - mountStartTime) / 1000).toFixed(1)}s`\n            });\n            // Reset the mount flag to allow another initialization attempt\n            window.__STYLIST_WIDGET_DOM_MOUNTED = false;\n        }\n    }, 10000); // 10 second safety timeout\n    try {\n        // Create root for React rendering\n        const root = createRoot(stylistContainer);\n        logComponentRender('index', 'render', 'Created React root for rendering');\n        // Get configuration from the global object with fallback\n        const config = window.__StylistWidgetConfig || {\n            apiKey: 'demo_key',\n            retailerId: 'demo_retailer'\n        };\n        logComponentRender('index', 'render', 'Using widget configuration', {\n            hasConfig: !!window.__StylistWidgetConfig,\n            apiKey: config.apiKey === 'demo_key' ? 'demo_key' : 'custom_key',\n            retailerId: config.retailerId === 'demo_retailer' ? 'demo_retailer' : 'custom_retailer'\n        });\n        // Render the widget\n        root.render(_jsx(React.StrictMode, { children: _jsx(StylistWidget, Object.assign({}, config)) }));\n        // Mark render as complete\n        window.__STYLIST_WIDGET_RENDER_COMPLETE = true;\n        clearTimeout(safetyTimeout);\n        console.log('Widget root rendered successfully');\n        const mountDuration = performance.now() - mountStartTime;\n        logGlobalFlag('__STYLIST_WIDGET_RENDER_COMPLETE', true, 'Widget render completed successfully');\n        logPerformance('widgetMount:complete', mountDuration, {\n            phase: 'complete',\n            duration: `${mountDuration.toFixed(2)}ms`\n        });\n    }\n    catch (error) {\n        console.error('Error mounting Stylist Widget:', error);\n        logComponentRender('index', 'error', 'Error mounting Stylist Widget', {\n            error: error instanceof Error ? error.message : String(error),\n            stack: error instanceof Error ? error.stack : undefined\n        });\n        // Only keep the DOM mounted flag if render actually succeeded\n        window.__STYLIST_WIDGET_RENDER_COMPLETE = false;\n        clearTimeout(safetyTimeout);\n        logGlobalFlag('__STYLIST_WIDGET_RENDER_COMPLETE', false, 'Widget render failed', {\n            error: error instanceof Error ? error.message : String(error)\n        });\n    }\n})();\n// Helper function to create the widget container\nfunction createWidgetContainer() {\n    const container = document.createElement('div');\n    container.id = 'stylist-widget-container';\n    document.body.appendChild(container);\n    return container;\n}\n// Export the StylistWidget component for direct use\nexport default StylistWidget;\n// Create a widget API with safe store access\nconst widgetAPI = {\n    init: (config) => {\n        logComponentRender('API', 'init', 'StylistWidget API initialization', {\n            hasApiKey: !!(config === null || config === void 0 ? void 0 : config.apiKey),\n            hasRetailerId: !!(config === null || config === void 0 ? void 0 : config.retailerId)\n        });\n        window.__StylistWidgetConfig = Object.assign(Object.assign({}, window.__StylistWidgetConfig), config);\n        logGlobalFlag('__StylistWidgetConfig', true, 'Widget configuration set via API', {\n            hasApiKey: !!(config === null || config === void 0 ? void 0 : config.apiKey),\n            hasRetailerId: !!(config === null || config === void 0 ? void 0 : config.retailerId)\n        });\n        // Ensure root is present\n        if (!document.getElementById('stylist-widget-container')) {\n            logComponentRender('API', 'init', 'Creating widget container via API');\n            createWidgetContainer();\n        }\n        // Ensure stores are initialized\n        logComponentRender('API', 'init', 'Initializing stores via API');\n        const initResult = initializeStores();\n        logComponentRender('API', 'init', 'Store initialization result', { success: initResult });\n        return {\n            success: true,\n            message: 'Stylist Widget initialized successfully'\n        };\n    },\n    open: () => {\n        logComponentRender('API', 'action', 'Open widget requested via API');\n        // Safely get isOpen and use toggleOpen only if needed\n        const isOpen = getSafeStoreValue(useChatStore, state => state.isOpen, false);\n        if (!isOpen) {\n            const chatStore = useChatStore.getState();\n            if (chatStore && typeof chatStore.toggleOpen === 'function') {\n                logComponentRender('API', 'action', 'Opening widget via store action');\n                chatStore.toggleOpen();\n                return true;\n            }\n            else {\n                logComponentRender('API', 'error', 'Failed to open widget - store not available', {\n                    error: 'Chat store not available or toggleOpen not a function'\n                });\n                return false;\n            }\n        }\n        else {\n            logComponentRender('API', 'action', 'Widget already open, no action needed');\n            return true;\n        }\n    },\n    close: () => {\n        logComponentRender('API', 'action', 'Close widget requested via API');\n        // Safely get isOpen and use toggleOpen only if needed\n        const isOpen = getSafeStoreValue(useChatStore, state => state.isOpen, false);\n        if (isOpen) {\n            const chatStore = useChatStore.getState();\n            if (chatStore && typeof chatStore.toggleOpen === 'function') {\n                logComponentRender('API', 'action', 'Closing widget via store action');\n                chatStore.toggleOpen();\n                return true;\n            }\n            else {\n                logComponentRender('API', 'error', 'Failed to close widget - store not available', {\n                    error: 'Chat store not available or toggleOpen not a function'\n                });\n                return false;\n            }\n        }\n        else {\n            logComponentRender('API', 'action', 'Widget already closed, no action needed');\n            return true;\n        }\n    },\n    minimize: () => {\n        logComponentRender('API', 'action', 'Minimize widget requested via API');\n        const chatStore = useChatStore.getState();\n        if (chatStore && typeof chatStore.toggleMinimize === 'function') {\n            logComponentRender('API', 'action', 'Minimizing widget via store action');\n            chatStore.toggleMinimize();\n            return true;\n        }\n        else {\n            logComponentRender('API', 'error', 'Failed to minimize widget - store not available', {\n                error: 'Chat store not available or toggleMinimize not a function'\n            });\n            return false;\n        }\n    },\n    switchView: (view) => {\n        logComponentRender('API', 'action', 'Switch view requested via API', { view });\n        const chatStore = useChatStore.getState();\n        if (chatStore && typeof chatStore.setCurrentView === 'function') {\n            logComponentRender('API', 'action', `Switching to ${view} view via store action`);\n            chatStore.setCurrentView(view);\n            return true;\n        }\n        else {\n            logComponentRender('API', 'error', 'Failed to switch view - store not available', {\n                error: 'Chat store not available or setCurrentView not a function',\n                requestedView: view\n            });\n            return false;\n        }\n    },\n    openStyleQuiz: () => {\n        logComponentRender('API', 'action', 'Open style quiz requested via API');\n        // Set the global flag to show style quiz\n        window.__StylistShowStyleQuiz = true;\n        logGlobalFlag('__StylistShowStyleQuiz', true, 'Style quiz flag set via API');\n        // Make sure the widget is open - with safety checks\n        const chatStore = useChatStore.getState();\n        if (chatStore && typeof chatStore.setIsOpen === 'function') {\n            logComponentRender('API', 'action', 'Opening widget for style quiz');\n            chatStore.setIsOpen(true);\n            return true;\n        }\n        else {\n            logComponentRender('API', 'warning', 'Style quiz flag set but widget could not be opened', {\n                error: 'Chat store not available or setIsOpen not a function'\n            });\n            return false;\n        }\n    },\n    openVirtualTryOn: () => {\n        logComponentRender('API', 'action', 'Open virtual try-on requested via API');\n        // Set the global flag to show virtual try-on\n        window.__StylistShowVirtualTryOn = true;\n        logGlobalFlag('__StylistShowVirtualTryOn', true, 'Virtual try-on flag set via API');\n        // Make sure the widget is open - with safety checks\n        const chatStore = useChatStore.getState();\n        if (chatStore && typeof chatStore.setIsOpen === 'function') {\n            logComponentRender('API', 'action', 'Opening widget for virtual try-on');\n            chatStore.setIsOpen(true);\n            return true;\n        }\n        else {\n            logComponentRender('API', 'warning', 'Virtual try-on flag set but widget could not be opened', {\n                error: 'Chat store not available or setIsOpen not a function'\n            });\n            return false;\n        }\n    },\n    __debug: {\n        addMockItems: () => {\n            logComponentRender('API', 'debug', 'Adding mock items via debug API');\n            try {\n                const recStore = useRecommendationStore.getState();\n                if (!recStore || typeof recStore.setRecommendedItems !== 'function') {\n                    console.warn('Recommendation store not initialized');\n                    logComponentRender('API', 'error', 'Failed to add mock items - store not initialized');\n                    return {\n                        success: false,\n                        message: 'Recommendation store not initialized'\n                    };\n                }\n                // Create properly typed mock items\n                const mockItems = [\n                    {\n                        id: 'mock1',\n                        name: 'Stylish Jeans',\n                        brand: 'DenimCo',\n                        category: 'Pants',\n                        price: 79.99,\n                        retailerId: 'demo',\n                        imageUrls: ['https://via.placeholder.com/150'],\n                        colors: [],\n                        sizes: [],\n                        url: '#',\n                        matchScore: 0.95,\n                        matchReasons: ['Based on your style profile'],\n                        inStock: true\n                    },\n                    {\n                        id: 'mock2',\n                        name: 'Casual T-Shirt',\n                        brand: 'Basics',\n                        category: 'Tops',\n                        price: 24.99,\n                        retailerId: 'demo',\n                        imageUrls: ['https://via.placeholder.com/150'],\n                        colors: [],\n                        sizes: [],\n                        url: '#',\n                        matchScore: 0.92,\n                        matchReasons: ['Matches your preferences'],\n                        inStock: true\n                    },\n                    {\n                        id: 'mock3',\n                        name: 'Leather Boots',\n                        brand: 'Footwear',\n                        category: 'Shoes',\n                        price: 129.99,\n                        retailerId: 'demo',\n                        imageUrls: ['https://via.placeholder.com/150'],\n                        colors: [],\n                        sizes: [],\n                        url: '#',\n                        matchScore: 0.88,\n                        matchReasons: ['Complements your style'],\n                        inStock: true\n                    }\n                ];\n                // Create properly typed mock outfit\n                const mockOutfit = {\n                    id: 'outfit1',\n                    name: 'Casual Weekend Look',\n                    occasion: 'Casual',\n                    items: mockItems,\n                    matchScore: 0.93,\n                    matchReasons: ['Perfect for weekends']\n                };\n                logComponentRender('API', 'debug', 'Setting mock items in recommendation store');\n                recStore.setRecommendedItems(mockItems);\n                if (typeof recStore.setRecommendedOutfits === 'function') {\n                    logComponentRender('API', 'debug', 'Setting mock outfits in recommendation store');\n                    recStore.setRecommendedOutfits([mockOutfit]);\n                }\n                return {\n                    success: true,\n                    message: 'Mock items and outfit added successfully',\n                    data: {\n                        itemCount: mockItems.length,\n                        outfitCount: 1\n                    }\n                };\n            }\n            catch (error) {\n                console.error('Error adding mock items:', error);\n                logComponentRender('API', 'error', 'Error adding mock items', {\n                    error: error instanceof Error ? error.message : String(error),\n                    stack: error instanceof Error ? error.stack : undefined\n                });\n                return {\n                    success: false,\n                    message: 'Error adding mock items',\n                    error: error instanceof Error ? error.message : String(error)\n                };\n            }\n        },\n        getDiagnostics: () => {\n            // Export diagnostic logs to the consumer\n            if (typeof window !== 'undefined' && window.__STYLIST_DIAGNOSTICS) {\n                logComponentRender('API', 'debug', 'Getting diagnostics via debug API');\n                return {\n                    logs: window.__STYLIST_DIAGNOSTICS.logs || [],\n                    flags: {\n                        initialized: !!window.__STYLIST_WIDGET_INITIALIZED,\n                        mounted: !!window.__STYLIST_WIDGET_DOM_MOUNTED,\n                        renderComplete: !!window.__STYLIST_WIDGET_RENDER_COMPLETE,\n                        storesInitialized: !!window.__STYLIST_STORES_INITIALIZED,\n                        backgroundInitComplete: !!window.__STYLIST_BACKGROUND_INIT_COMPLETE\n                    }\n                };\n            }\n            else {\n                return {\n                    logs: [],\n                    flags: {\n                        initialized: false,\n                        mounted: false,\n                        renderComplete: false,\n                        storesInitialized: false,\n                        backgroundInitComplete: false\n                    }\n                };\n            }\n        },\n        clearDiagnostics: () => {\n            logComponentRender('API', 'debug', 'Clearing diagnostics via debug API');\n            // If we have the diagnostics module, use it to clear logs\n            if (typeof window !== 'undefined' && window.__STYLIST_DIAGNOSTICS) {\n                window.__STYLIST_DIAGNOSTICS.logs = [];\n                // Also try to remove from localStorage\n                try {\n                    localStorage.removeItem('__STYLIST_DIAGNOSTICS_LOGS');\n                }\n                catch (e) {\n                    // Silently fail if localStorage is not available\n                }\n                return { success: true, message: 'Diagnostics cleared successfully' };\n            }\n            return { success: false, message: 'Diagnostics module not initialized' };\n        }\n    }\n};\n// Add to global window object\n// Use type assertion to ensure TypeScript knows this is a valid operation\nwindow.StylistWidget = widgetAPI;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// TrendingItems component displays popular items based on user activity\nimport React, { useState, useEffect } from 'react';\nimport { createStylistApi } from '@/api/index';\nimport { useUserStore } from '@/store/userStore';\nimport ItemCard from '@/components/ItemCard';\nimport LoadingIndicator from '@/components/common/LoadingIndicator';\nimport './TrendingItems.scss';\nconst TrendingItems = ({ apiKey, retailerId, apiUrl, onItemFeedback, onAddToWishlist, onAddToCart, onItemClick, primaryColor }) => {\n    const [trendingItems, setTrendingItems] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState(null);\n    const [filterCategory, setFilterCategory] = useState('all');\n    const { user } = useUserStore();\n    // Get trending items on component mount\n    useEffect(() => {\n        if (user) {\n            fetchTrendingItems();\n        }\n    }, [user === null || user === void 0 ? void 0 : user.userId]);\n    // Fetch trending items from API\n    const fetchTrendingItems = () => __awaiter(void 0, void 0, void 0, function* () {\n        var _a, _b, _c, _d, _e, _f;\n        if (!user)\n            return;\n        setIsLoading(true);\n        setError(null);\n        try {\n            const api = createStylistApi({ apiKey, retailerId, apiUrl });\n            // Fetch trending items with user's size and style profile\n            const response = yield api.recommendation.getRecommendations({\n                userId: user.userId,\n                limit: 100,\n                filters: {\n                    trending: true,\n                    size: (_c = (_b = (_a = user.preferences) === null || _a === void 0 ? void 0 : _a.sizePreferences) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.size,\n                    style: (_f = (_e = (_d = user.preferences) === null || _d === void 0 ? void 0 : _d.stylePreferences) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.style\n                }\n            });\n            // Ensure we have items\n            if (!response || !response.items || response.items.length === 0) {\n                if (response.message) {\n                    // API returned an explanation message\n                    setError(response.message);\n                }\n                else {\n                    setError('No trending items found. Please check back later.');\n                }\n                setTrendingItems([]);\n                return;\n            }\n            // Sort by match score if available\n            const sortedItems = [...response.items].sort((a, b) => {\n                // Sort by trending flag first (if available)\n                if (a.trending && !b.trending)\n                    return -1;\n                if (!a.trending && b.trending)\n                    return 1;\n                // Then by match score\n                return (b.matchScore || 0) - (a.matchScore || 0);\n            });\n            // Transform the response for consistent property naming\n            const items = sortedItems.map(item => ({\n                id: item.id,\n                retailerId: item.retailerId || retailerId,\n                name: item.name || 'Unnamed Item',\n                brand: item.brand || '',\n                category: item.category || '',\n                price: item.price || 0,\n                salePrice: item.salePrice,\n                colors: item.colors || [],\n                sizes: item.sizes || [],\n                imageUrls: Array.isArray(item.imageUrls) ? item.imageUrls :\n                    (item.imageUrl ? [item.imageUrl] : []),\n                url: item.url || '#',\n                matchScore: item.matchScore || 0,\n                matchReasons: item.matchReasons || [],\n                inStock: item.inStock !== false,\n                trending: true\n            }));\n            setTrendingItems(items);\n            // Log success for debugging\n            console.log(`Loaded ${items.length} trending items from API`);\n        }\n        catch (error) {\n            console.error('Error fetching trending items:', error);\n            setError('Failed to fetch trending items. Please try again later.');\n        }\n        finally {\n            setIsLoading(false);\n        }\n    });\n    // Filter items by category\n    const filteredItems = () => {\n        if (filterCategory === 'all') {\n            return trendingItems;\n        }\n        return trendingItems.filter(item => item.category === filterCategory);\n    };\n    // Get unique categories\n    const categories = React.useMemo(() => {\n        const uniqueCategories = new Set(trendingItems.map(item => item.category));\n        return ['all', ...Array.from(uniqueCategories)];\n    }, [trendingItems]);\n    // Handle item feedback\n    const handleItemFeedback = (itemId, liked) => {\n        if (onItemFeedback) {\n            onItemFeedback(itemId, liked);\n        }\n    };\n    // Handle adding item to wishlist\n    const handleAddToWishlist = (item) => {\n        if (onAddToWishlist) {\n            onAddToWishlist(item);\n        }\n    };\n    // Handle adding item to cart\n    const handleAddToCart = (item) => {\n        if (onAddToCart) {\n            onAddToCart(item);\n        }\n    };\n    // Handle clicking an item\n    const handleItemClick = (item) => {\n        if (onItemClick) {\n            onItemClick(item);\n        }\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-trending-items\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-trending-items__header\" }, { children: [_jsx(\"h2\", Object.assign({ className: \"stylist-trending-items__title\" }, { children: \"Trending Items\" })), _jsx(\"div\", Object.assign({ className: \"stylist-trending-items__filter\" }, { children: _jsxs(\"select\", Object.assign({ value: filterCategory, onChange: (e) => setFilterCategory(e.target.value), className: \"stylist-trending-items__filter-select\" }, { children: [_jsx(\"option\", Object.assign({ value: \"all\" }, { children: \"All Categories\" })), categories.filter(cat => cat !== 'all').map(category => (_jsx(\"option\", Object.assign({ value: category }, { children: category.charAt(0).toUpperCase() + category.slice(1) }), category)))] })) }))] })), isLoading ? (_jsxs(\"div\", Object.assign({ className: \"stylist-trending-items__loading\" }, { children: [_jsx(LoadingIndicator, {}), _jsx(\"p\", { children: \"Loading trending items...\" })] }))) : error ? (_jsxs(\"div\", Object.assign({ className: \"stylist-trending-items__error\" }, { children: [_jsx(\"p\", { children: error }), _jsx(\"button\", Object.assign({ className: \"stylist-trending-items__retry-btn\", onClick: fetchTrendingItems }, { children: \"Retry\" }))] }))) : filteredItems().length === 0 ? (_jsx(\"div\", Object.assign({ className: \"stylist-trending-items__empty\" }, { children: _jsx(\"p\", { children: \"No trending items found. Check back later!\" }) }))) : (_jsx(\"div\", Object.assign({ className: \"stylist-trending-items__grid\" }, { children: filteredItems().map(item => (_jsxs(\"div\", Object.assign({ className: \"stylist-trending-items__item\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-trending-items__trending-badge\" }, { children: \"\\uD83D\\uDD25 Trending\" })), _jsx(ItemCard, { item: {\n                                id: item.id,\n                                name: item.name,\n                                brand: item.brand,\n                                price: item.price,\n                                salePrice: item.salePrice,\n                                image: item.imageUrls[0] || ''\n                            }, onFavorite: (liked) => handleItemFeedback(item.id, liked), onAddToWishlist: () => handleAddToWishlist(item), onAddToCart: () => handleAddToCart(item), onClick: () => handleItemClick(item), primaryColor: primaryColor })] }), item.id))) })))] })));\n};\nexport default TrendingItems;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// SocialProofModal component for displaying celebrity outfit inspiration\nimport { useState, useEffect } from 'react';\nimport './SocialProofModal.scss';\nimport { createStylistApi } from '@/api/index';\nimport ItemCard from '@/components/ItemCard';\nimport LoadingIndicator from '@/components/common/LoadingIndicator';\nconst SocialProofModal = ({ isOpen, onClose, outfitData, apiKey, retailerId, apiUrl, onItemFeedback, onAddToWishlist, onAddToCart, primaryColor }) => {\n    const [matchingItems, setMatchingItems] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState(null);\n    // Fetch matching items when the modal opens\n    useEffect(() => {\n        if (isOpen) {\n            fetchMatchingItems();\n        }\n    }, [isOpen, outfitData === null || outfitData === void 0 ? void 0 : outfitData.id]);\n    // Fetch items that match the celebrity outfit\n    const fetchMatchingItems = () => __awaiter(void 0, void 0, void 0, function* () {\n        setIsLoading(true);\n        setError(null);\n        try {\n            const api = createStylistApi({ apiKey, retailerId, apiUrl });\n            // Fetch matching items\n            // Note: In a real app, this would be an API call to get similar items\n            // For this demo, we'll simulate with a timeout\n            yield new Promise(resolve => setTimeout(resolve, 1000));\n            // Simulate API response with matching items\n            const mockItems = Array.from({ length: 6 }, (_, i) => ({\n                id: `similar-${outfitData.id}-${i}`,\n                retailerId: retailerId,\n                name: `Similar Item ${i + 1}`,\n                brand: ['Fashion Brand', 'Luxury Designer', 'Style Co.'][i % 3],\n                category: ['tops', 'bottoms', 'dresses', 'shoes', 'accessories'][i % 5],\n                price: 59.99 + (i * 20),\n                salePrice: i % 3 === 0 ? 59.99 + (i * 20) * 0.8 : undefined,\n                colors: ['black', 'white', 'blue'],\n                sizes: ['S', 'M', 'L', 'XL'],\n                imageUrls: [\n                    `https://via.placeholder.com/300x400?text=Similar+Item+${i + 1}`\n                ],\n                url: '#',\n                matchScore: 90 - (i * 5),\n                matchReasons: ['Similar style', 'Matches color palette', 'As seen on celebrity'],\n                inStock: true\n            }));\n            setMatchingItems(mockItems);\n        }\n        catch (error) {\n            console.error('Error fetching matching items:', error);\n            setError('Failed to load matching items. Please try again.');\n        }\n        finally {\n            setIsLoading(false);\n        }\n    });\n    // Handle closing the modal\n    const handleClose = (e) => {\n        if (e.target === e.currentTarget) {\n            onClose();\n        }\n    };\n    // Handle ESC key to close modal\n    useEffect(() => {\n        const handleEscKey = (e) => {\n            if (e.key === 'Escape' && isOpen) {\n                onClose();\n            }\n        };\n        document.addEventListener('keydown', handleEscKey);\n        return () => {\n            document.removeEventListener('keydown', handleEscKey);\n        };\n    }, [isOpen, onClose]);\n    // Prevent scrolling of the body when modal is open\n    useEffect(() => {\n        if (isOpen) {\n            document.body.style.overflow = 'hidden';\n        }\n        else {\n            document.body.style.overflow = '';\n        }\n        return () => {\n            document.body.style.overflow = '';\n        };\n    }, [isOpen]);\n    if (!isOpen) {\n        return null;\n    }\n    return (_jsx(\"div\", Object.assign({ className: \"stylist-social-proof-modal\", onClick: handleClose }, { children: _jsxs(\"div\", Object.assign({ className: \"stylist-social-proof-modal__content\" }, { children: [_jsx(\"button\", Object.assign({ className: \"stylist-social-proof-modal__close\", onClick: onClose, \"aria-label\": \"Close\" }, { children: \"\\u00D7\" })), _jsx(\"div\", Object.assign({ className: \"stylist-social-proof-modal__header\" }, { children: _jsxs(\"h2\", Object.assign({ className: \"stylist-social-proof-modal__title\" }, { children: [\"Get the Look: \", outfitData.celebrityName] })) })), _jsxs(\"div\", Object.assign({ className: \"stylist-social-proof-modal__celebrity-outfit\" }, { children: [_jsx(\"img\", { src: outfitData.imageUrl, alt: `${outfitData.celebrityName} outfit`, className: \"stylist-social-proof-modal__celebrity-image\" }), _jsx(\"p\", Object.assign({ className: \"stylist-social-proof-modal__description\" }, { children: outfitData.description }))] })), _jsxs(\"div\", Object.assign({ className: \"stylist-social-proof-modal__similar-items-section\" }, { children: [_jsx(\"h3\", { children: \"Shop Similar Items\" }), isLoading ? (_jsxs(\"div\", Object.assign({ className: \"stylist-social-proof-modal__loading\" }, { children: [_jsx(LoadingIndicator, {}), _jsx(\"p\", { children: \"Finding similar items...\" })] }))) : error ? (_jsxs(\"div\", Object.assign({ className: \"stylist-social-proof-modal__error\" }, { children: [_jsx(\"p\", { children: error }), _jsx(\"button\", Object.assign({ className: \"stylist-social-proof-modal__retry-btn\", onClick: fetchMatchingItems, style: { backgroundColor: primaryColor } }, { children: \"Retry\" }))] }))) : (_jsx(\"div\", Object.assign({ className: \"stylist-social-proof-modal__similar-items\" }, { children: matchingItems.map((item) => (_jsxs(\"div\", Object.assign({ className: \"stylist-social-proof-modal__item\" }, { children: [_jsx(ItemCard, { item: {\n                                            id: item.id,\n                                            name: item.name,\n                                            brand: item.brand,\n                                            price: item.price,\n                                            salePrice: item.salePrice,\n                                            image: item.imageUrls[0] || ''\n                                        }, onFavorite: (liked) => onItemFeedback && onItemFeedback(item.id, liked), onAddToWishlist: () => onAddToWishlist && onAddToWishlist(item), onAddToCart: () => onAddToCart && onAddToCart(item), primaryColor: primaryColor }), _jsxs(\"div\", Object.assign({ className: \"stylist-social-proof-modal__match-score\" }, { children: [item.matchScore, \"% match\"] }))] }), item.id))) })))] }))] })) })));\n};\nexport default SocialProofModal;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// WishlistTab component for displaying and managing wishlisted items\nimport { useState, useEffect } from 'react';\nimport { useRecommendationStore, useUserStore } from '@/store/index';\nimport ItemCard from '@/components/ItemCard';\nimport LoadingIndicator from '@/components/common/LoadingIndicator';\nimport './WishlistTab.scss';\nconst WishlistTab = ({ onAddToCart, onRemoveFromWishlist, onMoveToCloset, onItemClick, primaryColor }) => {\n    const { wishlistItems } = useRecommendationStore();\n    const { user } = useUserStore();\n    const [wishlistProducts, setWishlistProducts] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    // Get full product details for wishlist items\n    useEffect(() => {\n        const getWishlistDetails = () => __awaiter(void 0, void 0, void 0, function* () {\n            setIsLoading(true);\n            try {\n                // In a real application, you would fetch product details from the API\n                // For this demo, we'll simulate by creating dummy product details\n                // Create objects with product details for each wishlist item\n                const products = wishlistItems.map(item => {\n                    return {\n                        id: item.itemId,\n                        retailerId: item.retailerId,\n                        name: item.name || `Product ${item.itemId.substring(0, 6)}`,\n                        brand: item.brand || 'Brand Name',\n                        category: item.category || 'Clothing',\n                        price: item.price || 99.99,\n                        salePrice: item.salePrice,\n                        colors: [],\n                        sizes: [],\n                        imageUrls: [item.imageUrl || ''],\n                        url: item.url || '#',\n                        matchScore: 0,\n                        matchReasons: [],\n                        inStock: true,\n                        addedToWishlistAt: item.addedAt\n                    };\n                });\n                setWishlistProducts(products);\n            }\n            catch (error) {\n                console.error('Error fetching wishlist details:', error);\n            }\n            finally {\n                setIsLoading(false);\n            }\n        });\n        getWishlistDetails();\n    }, [wishlistItems]);\n    // Handle add to cart\n    const handleAddToCart = (item) => {\n        if (onAddToCart) {\n            onAddToCart(item);\n        }\n    };\n    // Handle remove from wishlist\n    const handleRemoveFromWishlist = (itemId) => {\n        if (onRemoveFromWishlist) {\n            onRemoveFromWishlist(itemId);\n        }\n    };\n    // Handle move to closet\n    const handleMoveToCloset = (item) => {\n        if (onMoveToCloset) {\n            onMoveToCloset(item);\n            // After moving to closet, remove from wishlist\n            handleRemoveFromWishlist(item.id);\n        }\n    };\n    // Handle item click\n    const handleItemClick = (item) => {\n        if (onItemClick) {\n            onItemClick(item);\n        }\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-tab\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-wishlist-tab__header\" }, { children: _jsx(\"h2\", Object.assign({ className: \"stylist-wishlist-tab__title\" }, { children: \"My Wishlist\" })) })), isLoading ? (_jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-tab__loading\" }, { children: [_jsx(LoadingIndicator, {}), _jsx(\"p\", { children: \"Loading your wishlist...\" })] }))) : wishlistProducts.length === 0 ? (_jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-tab__empty\" }, { children: [_jsx(\"p\", { children: \"Your wishlist is empty.\" }), _jsx(\"p\", { children: \"Items you like will be saved here for later.\" })] }))) : (_jsx(\"div\", Object.assign({ className: \"stylist-wishlist-tab__grid\" }, { children: wishlistProducts.map(item => (_jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-tab__item\" }, { children: [_jsx(ItemCard, { item: {\n                                id: item.id,\n                                name: item.name || '',\n                                brand: item.brand || '',\n                                price: item.price || 0,\n                                salePrice: item.salePrice,\n                                image: item.imageUrls[0] || ''\n                            }, onFavorite: () => { }, isFavorite: true, onRemove: () => handleRemoveFromWishlist(item.id), onClick: () => handleItemClick(item), primaryColor: primaryColor }), _jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-tab__item-actions\" }, { children: [_jsx(\"button\", Object.assign({ className: \"stylist-wishlist-tab__action-btn stylist-wishlist-tab__action-btn--cart\", onClick: () => handleAddToCart(item) }, { children: \"Add to Cart\" })), _jsx(\"button\", Object.assign({ className: \"stylist-wishlist-tab__action-btn stylist-wishlist-tab__action-btn--closet\", onClick: () => handleMoveToCloset(item) }, { children: \"Move to Closet\" }))] }))] }), item.id))) })))] })));\n};\nexport default WishlistTab;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Lookbook component for displaying saved outfits and recommendations\nimport { useState } from 'react';\nimport './Lookbook.scss';\nimport ItemCard from '@/components/ItemCard';\nimport OutfitDisplay from '@/components/OutfitDisplay';\nimport { useChatStore } from '@/store/index';\nimport TryOnModal from '@/components/TryOnModal';\nimport { GarmentType } from '@/types/tryOn';\nimport { startTryOn, openTryOnModal } from '@/integration/integrateTryOn';\nimport TrendingItems from '@/components/TrendingItems';\nimport SocialProofModal from '@/components/SocialProofModal';\nimport WishlistTab from '@/components/WishlistTab';\nconst Lookbook = ({ items, outfits, savedOutfits, tryOnResults = [], onItemFeedback, onOutfitFeedback, onAddToWishlist, onAddToCart, onSaveOutfit, onSaveTryOnResult, primaryColor }) => {\n    const { addTextMessage } = useChatStore();\n    const [activeTab, setActiveTab] = useState('items');\n    const [isTryOnModalOpen, setIsTryOnModalOpen] = useState(false);\n    const [selectedTryOnItem, setSelectedTryOnItem] = useState(null);\n    const [isSocialProofModalOpen, setIsSocialProofModalOpen] = useState(false);\n    const [selectedCelebrityOutfit, setSelectedCelebrityOutfit] = useState(null);\n    // Combine saved outfits and try-on results\n    const allSavedItems = [...savedOutfits];\n    // Filter try-on results\n    const tryOnItems = tryOnResults || [];\n    // Example celebrity outfits data\n    const celebrityOutfits = [\n        {\n            id: 'celeb-1',\n            celebrityName: 'Celebrity Name 1',\n            imageUrl: 'https://via.placeholder.com/400x600?text=Celebrity+Outfit+1',\n            description: 'Spotted on the red carpet wearing a stunning ensemble that combines elegance with modern trends.'\n        },\n        {\n            id: 'celeb-2',\n            celebrityName: 'Celebrity Name 2',\n            imageUrl: 'https://via.placeholder.com/400x600?text=Celebrity+Outfit+2',\n            description: 'A casual yet stylish look perfect for everyday wear, showing how to combine comfort with fashion.'\n        }\n    ];\n    const handleSaveOutfit = (outfitId) => {\n        if (onSaveOutfit) {\n            const outfit = outfits.find(o => o.id === outfitId);\n            if (outfit) {\n                onSaveOutfit(outfit);\n                addTextMessage(`I've saved this outfit to your lookbook! You can access it anytime.`, 'assistant');\n            }\n        }\n    };\n    const handleItemClick = (item) => {\n        // Add chat message about the selected item\n        addTextMessage(`${item.name} by ${item.brand} is a great choice! Would you like to know more about this item or see similar styles?`, 'assistant');\n    };\n    const handleTryOn = (item) => {\n        var _a;\n        // Store selected item\n        setSelectedTryOnItem(item);\n        // Map item category to GarmentType\n        let garmentType = GarmentType.TOP;\n        if (item.category) {\n            const category = item.category.toLowerCase();\n            if (category.includes('dress')) {\n                garmentType = GarmentType.DRESS;\n            }\n            else if (category.includes('bottom') ||\n                category.includes('pant') ||\n                category.includes('short') ||\n                category.includes('skirt')) {\n                garmentType = GarmentType.BOTTOM;\n            }\n            else if (category.includes('jacket') ||\n                category.includes('coat')) {\n                garmentType = GarmentType.OUTERWEAR;\n            }\n            else if (category.includes('shoes')) {\n                garmentType = GarmentType.SHOES;\n            }\n            else if (category.includes('accessory')) {\n                garmentType = GarmentType.ACCESSORY;\n            }\n        }\n        // Start try-on with the item's image\n        const imageUrl = ((_a = item.imageUrls) === null || _a === void 0 ? void 0 : _a[0]) || '';\n        if (imageUrl) {\n            startTryOn(imageUrl, garmentType);\n            openTryOnModal();\n        }\n    };\n    const handleSaveTryOnResult = (resultUrl) => {\n        if (onSaveTryOnResult && selectedTryOnItem) {\n            const tryOnResult = {\n                id: `tryon-${Date.now()}`,\n                imageUrl: resultUrl,\n                name: `Try-on: ${selectedTryOnItem.name}`\n            };\n            onSaveTryOnResult(tryOnResult);\n            setActiveTab('try-on');\n            // Reset selected item\n            setSelectedTryOnItem(null);\n        }\n    };\n    // Handle opening the social proof modal\n    const handleOpenSocialProofModal = (celebrityOutfit) => {\n        setSelectedCelebrityOutfit(celebrityOutfit);\n        setIsSocialProofModalOpen(true);\n    };\n    const renderTabContent = () => {\n        switch (activeTab) {\n            case 'items':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__items\" }, { children: items.length > 0 ? (items.map(item => (_jsx(ItemCard, { item: item, onFeedback: onItemFeedback, onAddToWishlist: () => onAddToWishlist && onAddToWishlist(item), onAddToCart: () => onAddToCart && onAddToCart(item), showDetails: true, primaryColor: primaryColor, onClick: () => handleItemClick(item), onTryOn: () => handleTryOn(item) }, item.id)))) : (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__empty\" }, { children: [_jsx(\"p\", { children: \"No recommended items yet.\" }), _jsx(\"p\", { children: \"Ask me for recommendations to see items here!\" })] }))) })));\n            case 'outfits':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__outfits\" }, { children: outfits.length > 0 ? (outfits.map(outfit => {\n                        // Convert Recommendation.Outfit to ChatTypes.Outfit for OutfitDisplay\n                        const chatOutfit = {\n                            id: outfit.id,\n                            name: outfit.name || '',\n                            occasion: outfit.occasion,\n                            matchScore: outfit.matchScore,\n                            matchReasons: outfit.matchReasons,\n                            items: outfit.items.map(item => {\n                                var _a;\n                                return ({\n                                    id: item.id,\n                                    name: item.name,\n                                    brand: item.brand,\n                                    category: item.category || '',\n                                    price: item.price,\n                                    salePrice: item.salePrice,\n                                    imageUrl: ((_a = item.imageUrls) === null || _a === void 0 ? void 0 : _a[0]) || '',\n                                    url: item.url || '',\n                                    matchScore: item.matchScore || 0,\n                                    matchReasons: item.matchReasons || []\n                                });\n                            })\n                        };\n                        return (_jsx(OutfitDisplay, { outfit: chatOutfit, onFeedback: onOutfitFeedback, onSaveOutfit: handleSaveOutfit, primaryColor: primaryColor }, outfit.id));\n                    })) : (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__empty\" }, { children: [_jsx(\"p\", { children: \"No outfit recommendations yet.\" }), _jsx(\"p\", { children: \"Ask me to create outfits for you!\" })] }))) })));\n            case 'saved':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__saved\" }, { children: allSavedItems.length > 0 ? (_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__saved-items\" }, { children: allSavedItems.map(item => (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__saved-item\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__saved-image\" }, { children: _jsx(\"img\", { src: item.imageUrl, alt: item.name }) })), _jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__saved-details\" }, { children: [_jsx(\"h4\", { children: item.name }), _jsx(\"p\", { children: item.createdAt ? new Date(item.createdAt).toLocaleDateString() : new Date(item.savedAt).toLocaleDateString() })] }))] }), item.id))) }))) : (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__empty\" }, { children: [_jsx(\"p\", { children: \"No saved outfits yet.\" }), _jsx(\"p\", { children: \"Save outfits you like to access them later!\" })] }))) })));\n            case 'try-on':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__try-on\" }, { children: tryOnItems.length > 0 ? (_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__try-on-items\" }, { children: tryOnItems.map(item => (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__try-on-item\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__try-on-image\" }, { children: _jsx(\"img\", { src: item.imageUrl, alt: item.name }) })), _jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__try-on-details\" }, { children: [_jsx(\"h4\", { children: item.name }), _jsx(\"p\", { children: item.createdAt ? new Date(item.createdAt).toLocaleDateString() : new Date(item.savedAt).toLocaleDateString() })] }))] }), item.id))) }))) : (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__empty\" }, { children: [_jsx(\"p\", { children: \"No try-on results yet.\" }), _jsx(\"p\", { children: \"Use the try-on feature on items to see them here!\" })] }))) })));\n            case 'trending':\n                return (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__trending\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__celebrity-section\" }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-lookbook__section-title\" }, { children: \"Celebrity Inspiration\" })), _jsx(\"div\", Object.assign({ className: \"stylist-lookbook__celebrity-outfits\" }, { children: celebrityOutfits.map(outfit => (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__celebrity-outfit\", onClick: () => handleOpenSocialProofModal(outfit) }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__celebrity-image\" }, { children: _jsx(\"img\", { src: outfit.imageUrl, alt: outfit.celebrityName }) })), _jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__celebrity-details\" }, { children: [_jsx(\"h4\", { children: outfit.celebrityName }), _jsx(\"p\", Object.assign({ className: \"stylist-lookbook__celebrity-description\" }, { children: outfit.description })), _jsx(\"button\", Object.assign({ className: \"stylist-lookbook__get-the-look-btn\", style: { backgroundColor: primaryColor } }, { children: \"Get the Look\" }))] }))] }), outfit.id))) }))] })), _jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__trending-section\" }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-lookbook__section-title\" }, { children: \"Trending Now\" })), _jsx(TrendingItems, { apiKey: process.env.REACT_APP_API_KEY || '', retailerId: process.env.REACT_APP_RETAILER_ID || '', apiUrl: process.env.REACT_APP_API_URL || '', onItemFeedback: onItemFeedback, onAddToWishlist: onAddToWishlist, onAddToCart: onAddToCart, primaryColor: primaryColor })] }))] })));\n            case 'wishlist':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-lookbook__wishlist\" }, { children: _jsx(WishlistTab, { onAddToCart: onAddToCart, onRemoveFromWishlist: (itemId) => {\n                            // This would trigger the remove from wishlist action\n                            console.log('Remove from wishlist:', itemId);\n                        }, onMoveToCloset: (item) => {\n                            // This would trigger adding to closet\n                            console.log('Move to closet:', item);\n                        }, primaryColor: primaryColor }) })));\n            default:\n                return null;\n        }\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__header\" }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-lookbook__title\" }, { children: \"Your Lookbook\" })), _jsxs(\"div\", Object.assign({ className: \"stylist-lookbook__tabs\" }, { children: [_jsxs(\"button\", Object.assign({ className: `stylist-lookbook__tab ${activeTab === 'items' ? 'stylist-lookbook__tab--active' : ''}`, onClick: () => setActiveTab('items'), style: activeTab === 'items' && primaryColor ? { borderBottomColor: primaryColor } : undefined }, { children: [\"Items (\", items.length, \")\"] })), _jsxs(\"button\", Object.assign({ className: `stylist-lookbook__tab ${activeTab === 'outfits' ? 'stylist-lookbook__tab--active' : ''}`, onClick: () => setActiveTab('outfits'), style: activeTab === 'outfits' && primaryColor ? { borderBottomColor: primaryColor } : undefined }, { children: [\"Outfits (\", outfits.length, \")\"] })), _jsxs(\"button\", Object.assign({ className: `stylist-lookbook__tab ${activeTab === 'trending' ? 'stylist-lookbook__tab--active' : ''}`, onClick: () => setActiveTab('trending'), style: activeTab === 'trending' && primaryColor ? { borderBottomColor: primaryColor } : undefined }, { children: [_jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Fire\" }, { children: \"\\uD83D\\uDD25\" })), \" Trending\"] })), _jsxs(\"button\", Object.assign({ className: `stylist-lookbook__tab ${activeTab === 'wishlist' ? 'stylist-lookbook__tab--active' : ''}`, onClick: () => setActiveTab('wishlist'), style: activeTab === 'wishlist' && primaryColor ? { borderBottomColor: primaryColor } : undefined }, { children: [_jsx(\"span\", Object.assign({ role: \"img\", \"aria-label\": \"Heart\" }, { children: \"\\uD83D\\uDC96\" })), \" Wishlist\"] })), _jsxs(\"button\", Object.assign({ className: `stylist-lookbook__tab ${activeTab === 'saved' ? 'stylist-lookbook__tab--active' : ''}`, onClick: () => setActiveTab('saved'), style: activeTab === 'saved' && primaryColor ? { borderBottomColor: primaryColor } : undefined }, { children: [\"Saved (\", allSavedItems.length, \")\"] })), _jsxs(\"button\", Object.assign({ className: `stylist-lookbook__tab ${activeTab === 'try-on' ? 'stylist-lookbook__tab--active' : ''}`, onClick: () => setActiveTab('try-on'), style: activeTab === 'try-on' && primaryColor ? { borderBottomColor: primaryColor } : undefined }, { children: [\"Try-On (\", tryOnItems.length, \")\"] }))] }))] })), _jsx(\"div\", Object.assign({ className: \"stylist-lookbook__content\" }, { children: renderTabContent() })), _jsx(TryOnModal, { onSave: handleSaveTryOnResult }), isSocialProofModalOpen && selectedCelebrityOutfit && (_jsx(SocialProofModal, { isOpen: isSocialProofModalOpen, onClose: () => setIsSocialProofModalOpen(false), outfitData: selectedCelebrityOutfit, apiKey: process.env.REACT_APP_API_KEY || '', retailerId: process.env.REACT_APP_RETAILER_ID || '', apiUrl: process.env.REACT_APP_API_URL || '', onItemFeedback: onItemFeedback, onAddToWishlist: onAddToWishlist, onAddToCart: onAddToCart, primaryColor: primaryColor }))] })));\n};\nexport default Lookbook;\n","import { useTryOnStore } from '@/store/tryOnStore';\n/**\n * Initialize the try-on feature with a product\n * @param productImage URL or File of the product image\n * @param productType Type of the product (top, bottom, etc.)\n */\nexport const startTryOn = (productImage, productType) => {\n    const { startNewTryOn } = useTryOnStore.getState();\n    startNewTryOn(productImage, productType);\n};\n/**\n * Try on a complete outfit\n * @param outfit Outfit to try on\n */\nexport const tryOnOutfit = (outfit) => {\n    const { tryOnOutfit } = useTryOnStore.getState();\n    tryOnOutfit(outfit);\n};\n/**\n * Open the try-on modal\n */\nexport const openTryOnModal = () => {\n    const { openTryOnModal } = useTryOnStore.getState();\n    openTryOnModal();\n};\n/**\n * Close the try-on modal\n */\nexport const closeTryOnModal = () => {\n    const { closeTryOnModal } = useTryOnStore.getState();\n    closeTryOnModal();\n};\n/**\n * Get the current try-on state\n * @returns Current state of the try-on feature\n */\nexport const getTryOnState = () => {\n    const { currentOutfit, userImage, isLoading, error, savedResults } = useTryOnStore.getState();\n    return {\n        currentOutfit,\n        userImage,\n        isLoading,\n        error,\n        savedResults,\n        hasUserImage: !!userImage,\n        hasOutfit: !!currentOutfit && currentOutfit.garments.length > 0\n    };\n};\n// Usage example for React components:\n// \n// import { startTryOn, openTryOnModal } from '@/integration/integrateTryOn';\n// import { GarmentType } from '@/types/tryOn';\n//\n// // In a product detail component:\n// const handleTryOnClick = () => {\n//   startTryOn(product.imageUrl, GarmentType.TOP);\n//   openTryOnModal();\n// };\n//\n// // Button in the component:\n// <button onClick={handleTryOnClick}>Virtual Try-On</button>\n","// Analytics utilities for tracking user interactions\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n// Define event types\nexport var AnalyticsEventType;\n(function (AnalyticsEventType) {\n    AnalyticsEventType[\"WIDGET_OPEN\"] = \"widget_open\";\n    AnalyticsEventType[\"WIDGET_CLOSE\"] = \"widget_close\";\n    AnalyticsEventType[\"WIDGET_MINIMIZE\"] = \"widget_minimize\";\n    AnalyticsEventType[\"MESSAGE_SENT\"] = \"message_sent\";\n    AnalyticsEventType[\"ITEM_VIEW\"] = \"item_view\";\n    AnalyticsEventType[\"ITEM_LIKE\"] = \"item_like\";\n    AnalyticsEventType[\"ITEM_DISLIKE\"] = \"item_dislike\";\n    AnalyticsEventType[\"OUTFIT_VIEW\"] = \"outfit_view\";\n    AnalyticsEventType[\"OUTFIT_LIKE\"] = \"outfit_like\";\n    AnalyticsEventType[\"OUTFIT_DISLIKE\"] = \"outfit_dislike\";\n    AnalyticsEventType[\"OUTFIT_SAVE\"] = \"outfit_save\";\n    AnalyticsEventType[\"ADD_TO_WISHLIST\"] = \"add_to_wishlist\";\n    AnalyticsEventType[\"ADD_TO_CART\"] = \"add_to_cart\";\n    AnalyticsEventType[\"STYLE_QUIZ_START\"] = \"style_quiz_start\";\n    AnalyticsEventType[\"STYLE_QUIZ_COMPLETE\"] = \"style_quiz_complete\";\n    AnalyticsEventType[\"STYLE_QUIZ_PARTIAL\"] = \"style_quiz_partial\";\n    AnalyticsEventType[\"STYLE_QUIZ_ABANDON\"] = \"style_quiz_abandon\";\n    AnalyticsEventType[\"TRY_ON_START\"] = \"try_on_start\";\n    AnalyticsEventType[\"TRY_ON_COMPLETE\"] = \"try_on_complete\";\n    AnalyticsEventType[\"TRY_ON_SAVED\"] = \"try_on_saved\";\n    AnalyticsEventType[\"VIEW_LOOKBOOK\"] = \"view_lookbook\";\n    AnalyticsEventType[\"ERROR\"] = \"error\";\n    // New feedback-related events\n    AnalyticsEventType[\"MESSAGE_THUMBS_UP\"] = \"message_thumbs_up\";\n    AnalyticsEventType[\"RECOMMENDATION_THUMBS_UP\"] = \"recommendation_thumbs_up\";\n    AnalyticsEventType[\"FEEDBACK_SYNCED\"] = \"feedback_synced\";\n})(AnalyticsEventType || (AnalyticsEventType = {}));\n// Generate a unique session ID\nconst generateSessionId = () => {\n    return `session_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n};\n// Get or create a session ID\nconst getSessionId = () => {\n    let sessionId = sessionStorage.getItem('stylist_session_id');\n    if (!sessionId) {\n        sessionId = generateSessionId();\n        sessionStorage.setItem('stylist_session_id', sessionId);\n    }\n    return sessionId;\n};\n// Track an analytics event\nexport const trackEvent = (type, userId, data) => {\n    const event = {\n        type,\n        timestamp: new Date(),\n        userId,\n        sessionId: getSessionId(),\n        data\n    };\n    // Log event to console in development\n    // Only log in development \n    if (process.env.NODE_ENV !== 'production') {\n        console.log('[Analytics Event]:', event);\n    }\n    // Queue event for sending to backend\n    queueEvent(event);\n};\n// Queue of events to send\nlet eventQueue = [];\nlet isSending = false;\n// Queue an event for sending\nconst queueEvent = (event) => {\n    eventQueue.push(event);\n    // Start sending if not already in progress\n    if (!isSending) {\n        sendQueuedEvents();\n    }\n};\n// Send queued events to backend\nconst sendQueuedEvents = () => __awaiter(void 0, void 0, void 0, function* () {\n    if (eventQueue.length === 0) {\n        isSending = false;\n        return;\n    }\n    isSending = true;\n    // Take a batch of events to send\n    const batch = eventQueue.slice(0, 10);\n    try {\n        // Send events to backend\n        const response = yield fetch('https://api.thestylist.ai/api/v1/analytics/events', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                events: batch\n            })\n        });\n        if (response.ok) {\n            // Remove sent events from queue\n            eventQueue = eventQueue.slice(batch.length);\n        }\n        else {\n            // Wait before retrying on error\n            yield new Promise(resolve => setTimeout(resolve, 5000));\n        }\n    }\n    catch (err) {\n        // Only log in non-production environments\n        if (process.env.NODE_ENV !== 'production') {\n            console.error('Failed to send analytics events:', err);\n        }\n        // Wait before retrying on error\n        yield new Promise(resolve => setTimeout(resolve, 5000));\n    }\n    // Continue with remaining events\n    sendQueuedEvents();\n});\n","import { Fragment as _Fragment, jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useEffect, useState, useRef } from 'react';\nimport LoadingIndicator from './LoadingIndicator';\nimport { USE_LAZY_LOADING } from '../../index';\nimport { logComponentRender, logSuspense, logHook, logPerformance, logErrorBoundary } from '../../diagnostics';\nimport { useDiagnosticLifecycle, useDiagnosticEffect, DiagnosticSuspense, DiagnosticErrorBoundary } from '../../diagnosticHooks';\n// Define a separate component for the suspense fallback to handle logging\nconst LoggingSuspenseFallback = ({ fallback, componentId }) => {\n    // Track render time for performance metrics\n    const renderStartTime = useRef(performance.now());\n    useEffect(() => {\n        const renderDuration = performance.now() - renderStartTime.current;\n        console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Suspense fallback rendering`);\n        // Log the suspense fallback rendering\n        logSuspense(`AsyncLoader:${componentId}`, 'fallback', `Suspense fallback rendering for ${componentId}`, { renderDuration: `${renderDuration.toFixed(2)}ms` });\n        // Log performance mark\n        logPerformance(`SuspenseFallback:${componentId}`, renderDuration, { component: componentId });\n        return () => {\n            const totalDuration = performance.now() - renderStartTime.current;\n            logSuspense(`AsyncLoader:${componentId}`, 'resolved', `Suspense resolved for ${componentId}`, {\n                totalDuration: `${totalDuration.toFixed(2)}ms`,\n                component: componentId\n            });\n        };\n    }, [componentId]);\n    return _jsx(_Fragment, { children: fallback });\n};\n/**\n * A utility component that wraps lazy-loaded components with Suspense\n * and provides a consistent loading state.\n *\n * Only applies Suspense if USE_LAZY_LOADING is true.\n * Includes error boundary functionality and timeouts to prevent infinite suspense.\n *\n * Fixed version to avoid deadlocks by using shorter timeouts and more defensive coding.\n */\nconst AsyncComponentLoader = ({ children, loadingMessage = 'Loading...', fallback, onLoadStart, onLoadComplete, onLoadError }) => {\n    // Add diagnostic lifecycle logging\n    useDiagnosticLifecycle('AsyncComponentLoader');\n    // Track if component is actually loaded to help detect Suspense issues\n    const [isLoaded, setIsLoaded] = useState(false);\n    const [hasTimeout, setHasTimeout] = useState(false);\n    const suspenseTimeoutRef = useRef(null);\n    const safeRenderTimeoutRef = useRef(null);\n    // Add a key to force remount if needed\n    const [componentKey, setComponentKey] = useState(0);\n    // Track mount state to avoid state updates after unmount\n    const isMountedRef = useRef(true);\n    // Log component ID for tracing\n    const componentId = useRef(`async-${Math.random().toString(36).substring(2, 9)}`).current;\n    // Track load start time for performance metrics\n    const loadStartTimeRef = useRef(performance.now());\n    console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Component initialized`);\n    logComponentRender('AsyncComponentLoader', 'mount', `AsyncLoader:${componentId} initialized`, { componentId });\n    // Call onLoadStart if provided\n    useDiagnosticEffect('AsyncComponentLoader', 'loadStart', [onLoadStart], () => {\n        if (onLoadStart && USE_LAZY_LOADING) {\n            console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Calling onLoadStart callback`);\n            logHook('AsyncComponentLoader', 'onLoadStart', 'init', `Calling onLoadStart callback for ${componentId}`);\n            onLoadStart();\n        }\n    });\n    // Handle errors from the error boundary\n    const handleError = (error) => {\n        if (!isMountedRef.current)\n            return;\n        console.warn(`[LIFECYCLE:AsyncLoader:${componentId}] Error loading component:`, error.message);\n        logErrorBoundary('AsyncComponentLoader', error, { componentStack: `AsyncLoader:${componentId}` });\n        if (onLoadError) {\n            console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Calling onLoadError callback`);\n            onLoadError(error);\n        }\n        setIsLoaded(true); // Mark as loaded to avoid further timeouts\n        // Force remount of the component in case of error by changing key\n        setTimeout(() => {\n            if (isMountedRef.current) {\n                console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Forcing remount after error`);\n                logComponentRender('AsyncComponentLoader', 'render', `Forcing remount after error for ${componentId}`, { error: error.message });\n                setComponentKey(prevKey => prevKey + 1);\n            }\n        }, 100);\n    };\n    // Set a timeout to force-resolve suspense if it takes too long\n    useDiagnosticEffect('AsyncComponentLoader', 'suspenseTimeouts', [isLoaded, USE_LAZY_LOADING, componentId], () => {\n        if (!USE_LAZY_LOADING)\n            return;\n        console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Setting up suspense timeouts`);\n        logHook('AsyncComponentLoader', 'suspenseTimeouts', 'init', `Setting up suspense timeouts for ${componentId}`, { isLoaded });\n        // Set mounted state on mount\n        isMountedRef.current = true;\n        if (!isLoaded) {\n            // Primary timeout (2 seconds) - warning and state update (reduced even more to ensure resolution)\n            suspenseTimeoutRef.current = setTimeout(() => {\n                if (!isLoaded && isMountedRef.current) {\n                    console.warn(`[LIFECYCLE:AsyncLoader:${componentId}] Component load timed out after 2s, forcing render`);\n                    logHook('AsyncComponentLoader', 'suspenseTimeouts', 'update', `Component load timed out after 2s, forcing render for ${componentId}`, { timeoutLevel: 'primary', timeoutDuration: '2s' });\n                    setHasTimeout(true);\n                    setIsLoaded(true);\n                }\n            }, 2000);\n            // Safety timeout (3 seconds) - force release suspense by remounting (reduced to guarantee display)\n            safeRenderTimeoutRef.current = setTimeout(() => {\n                if (!isLoaded && isMountedRef.current) {\n                    console.warn(`[LIFECYCLE:AsyncLoader:${componentId}] Final timeout reached after 3s, forcing component remount`);\n                    logHook('AsyncComponentLoader', 'suspenseTimeouts', 'update', `Final timeout reached after 3s, forcing component remount for ${componentId}`, {\n                        timeoutLevel: 'final',\n                        timeoutDuration: '3s',\n                        loadDuration: `${((performance.now() - loadStartTimeRef.current) / 1000).toFixed(1)}s`\n                    });\n                    setHasTimeout(true);\n                    setIsLoaded(true);\n                    // Force remount component by changing key\n                    setComponentKey(prevKey => prevKey + 1);\n                    // Force create diagnostic log to ensure render complete is marked\n                    logSuspense(`AsyncLoader:${componentId}`, 'resolved', `Suspense forcibly resolved for ${componentId} after timeout`, {\n                        totalDuration: `${((performance.now() - loadStartTimeRef.current) / 1000).toFixed(1)}s`,\n                        component: componentId,\n                        forcedResolution: true\n                    });\n                }\n            }, 3000);\n        }\n        // Cleanup function\n        return () => {\n            console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Cleaning up suspense timeouts`);\n            logHook('AsyncComponentLoader', 'suspenseTimeouts', 'cleanup', `Cleaning up suspense timeouts for ${componentId}`);\n            isMountedRef.current = false;\n            if (suspenseTimeoutRef.current)\n                clearTimeout(suspenseTimeoutRef.current);\n            if (safeRenderTimeoutRef.current)\n                clearTimeout(safeRenderTimeoutRef.current);\n        };\n    });\n    // Effect to mark component as loaded after first render - with extra safety\n    useDiagnosticEffect('AsyncComponentLoader', 'postRenderLoad', [isLoaded, USE_LAZY_LOADING, onLoadComplete, componentId], () => {\n        if (!USE_LAZY_LOADING)\n            return;\n        if (!isLoaded && isMountedRef.current) {\n            console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Setting up post-render timer to mark as loaded`);\n            logHook('AsyncComponentLoader', 'postRenderLoad', 'init', `Setting up post-render timer for ${componentId}`);\n            // Use setTimeout to ensure we're after initial render (reduced from 50ms)\n            const timer = setTimeout(() => {\n                if (isMountedRef.current) {\n                    console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Post-render timer fired, marking as loaded`);\n                    logHook('AsyncComponentLoader', 'postRenderLoad', 'update', `Post-render timer fired for ${componentId}`, { loadTime: `${((performance.now() - loadStartTimeRef.current)).toFixed(2)}ms` });\n                    setIsLoaded(true);\n                    if (onLoadComplete) {\n                        console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Calling onLoadComplete callback`);\n                        onLoadComplete();\n                    }\n                    // Log a performance mark for the total load time\n                    logPerformance('AsyncComponentLoader:complete', performance.now() - loadStartTimeRef.current, {\n                        componentId,\n                        hasTimeout\n                    });\n                }\n            }, 30);\n            return () => clearTimeout(timer);\n        }\n    });\n    // Logging for child rendering\n    useDiagnosticEffect('AsyncComponentLoader', 'childrenRendering', [hasTimeout, componentKey, USE_LAZY_LOADING, componentId], () => {\n        if (USE_LAZY_LOADING) {\n            console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Children rendering ${hasTimeout ? '(timeout mode)' : '(suspense mode)'}`);\n            logComponentRender('AsyncComponentLoader', 'render', `Children rendering for ${componentId}`, {\n                mode: hasTimeout ? 'timeout' : 'suspense',\n                componentKey\n            });\n        }\n    });\n    // If lazy loading is disabled, render children directly\n    if (!USE_LAZY_LOADING) {\n        return _jsx(_Fragment, { children: children });\n    }\n    // Default fallback if none provided\n    const defaultFallback = (_jsxs(\"div\", Object.assign({ className: \"stylist-loading-container\", style: {\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '2rem',\n            height: '100%'\n        } }, { children: [_jsx(LoadingIndicator, {}), _jsx(\"p\", Object.assign({ style: { marginTop: '1rem' } }, { children: loadingMessage }))] })));\n    // Custom fallback for error state\n    const errorFallback = (_jsxs(\"div\", Object.assign({ className: \"stylist-error-container\", style: {\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '2rem',\n            height: '100%'\n        } }, { children: [_jsx(\"p\", Object.assign({ style: { marginTop: '1rem' } }, { children: \"Unable to load component\" })), _jsx(\"button\", Object.assign({ onClick: () => isMountedRef.current && setComponentKey(prevKey => prevKey + 1), style: {\n                    marginTop: '1rem',\n                    padding: '0.5rem 1rem',\n                    backgroundColor: 'var(--stylist-primary-color, #4361ee)',\n                    color: 'white',\n                    border: 'none',\n                    borderRadius: '4px',\n                    cursor: 'pointer'\n                } }, { children: \"Try Again\" }))] })));\n    // If we had a timeout, render the component directly with an error boundary\n    if (hasTimeout) {\n        console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Rendering with timeout fallback`);\n        logComponentRender('AsyncComponentLoader', 'render', `Rendering with timeout fallback for ${componentId}`, {\n            mode: 'timeout',\n            timeElapsed: `${((performance.now() - loadStartTimeRef.current)).toFixed(2)}ms`\n        });\n        return (_jsx(DiagnosticErrorBoundary, Object.assign({ componentName: `AsyncLoader:${componentId}`, onError: handleError, fallback: errorFallback }, { children: children }), `timeout-fallback-${componentKey}`));\n    }\n    console.log(`[LIFECYCLE:AsyncLoader:${componentId}] Rendering with suspense`);\n    logComponentRender('AsyncComponentLoader', 'render', `Rendering with suspense for ${componentId}`, {\n        mode: 'suspense',\n        timeElapsed: `${((performance.now() - loadStartTimeRef.current)).toFixed(2)}ms`\n    });\n    // Prepare the fallback content\n    const finalFallback = fallback || defaultFallback;\n    return (_jsx(DiagnosticErrorBoundary, Object.assign({ componentName: `AsyncLoader:${componentId}`, onError: handleError, fallback: errorFallback }, { children: _jsx(DiagnosticSuspense, Object.assign({ componentName: `AsyncLoader:${componentId}`, fallback: _jsx(LoggingSuspenseFallback, { fallback: finalFallback, componentId: componentId }) }, { children: children })) }), `error-boundary-${componentKey}`));\n};\nexport default AsyncComponentLoader;\n","import WishlistButton from './WishlistButton';\nexport default WishlistButton;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport './WishlistButton.scss';\nconst WishlistButton = ({ onClick, isSaved = false, label = 'Save', primaryColor }) => {\n    const buttonStyle = primaryColor ? { backgroundColor: primaryColor } : undefined;\n    return (_jsxs(\"button\", Object.assign({ className: `stylist-wishlist-button ${isSaved ? 'stylist-wishlist-button--saved' : ''}`, onClick: onClick, style: isSaved ? undefined : buttonStyle }, { children: [_jsx(\"span\", Object.assign({ className: \"stylist-wishlist-button__icon\" }, { children: isSaved ? (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\" }) }))) : (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z\" }) }))) })), _jsx(\"span\", Object.assign({ className: \"stylist-wishlist-button__label\" }, { children: isSaved ? 'Saved' : label }))] })));\n};\nexport default WishlistButton;\n","import OutfitDisplay from './OutfitDisplay';\nexport default OutfitDisplay;\n","import { jsxs as _jsxs, jsx as _jsx } from \"react/jsx-runtime\";\nimport './OutfitDisplay.scss';\nimport FeedbackControls from '../FeedbackControls';\nimport WishlistButton from '../WishlistButton';\nconst OutfitDisplay = ({ outfit, onFeedback, onSaveOutfit, onItemClick, primaryColor }) => {\n    const { id, items, occasion, matchScore, matchReasons } = outfit;\n    const handleFeedback = (liked) => {\n        if (onFeedback) {\n            onFeedback(id, liked);\n        }\n    };\n    const handleSaveOutfit = () => {\n        if (onSaveOutfit) {\n            onSaveOutfit(id);\n        }\n    };\n    const handleItemClick = (itemId) => {\n        if (onItemClick) {\n            onItemClick(itemId);\n        }\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display__header\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display__title\" }, { children: [\"Complete Outfit for \", occasion] })), _jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display__score\", style: { color: primaryColor } }, { children: [Math.round(matchScore * 100), \"% Match\"] }))] })), _jsx(\"div\", Object.assign({ className: \"stylist-outfit-display__items\" }, { children: items.map((item) => (_jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display__item\", onClick: () => handleItemClick(item.id) }, { children: [item.imageUrl ? (_jsx(\"img\", { src: item.imageUrl, alt: item.name, className: \"stylist-outfit-display__item-image\" })) : (_jsx(\"div\", Object.assign({ className: \"stylist-outfit-display__item-placeholder\" }, { children: item.category }))), _jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display__item-info\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-outfit-display__item-brand\" }, { children: item.brand })), _jsx(\"div\", Object.assign({ className: \"stylist-outfit-display__item-name\" }, { children: item.name }))] }))] }), item.id))) })), matchReasons.length > 0 && (_jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display__reasons\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-outfit-display__reasons-title\" }, { children: \"Why this outfit works:\" })), _jsx(\"ul\", Object.assign({ className: \"stylist-outfit-display__reasons-list\" }, { children: matchReasons.map((reason, index) => (_jsx(\"li\", Object.assign({ className: \"stylist-outfit-display__reason-item\" }, { children: reason }), index))) }))] }))), _jsxs(\"div\", Object.assign({ className: \"stylist-outfit-display__actions\" }, { children: [_jsx(FeedbackControls, { onLike: () => handleFeedback(true), onDislike: () => handleFeedback(false), primaryColor: primaryColor }), _jsx(WishlistButton, { onClick: handleSaveOutfit, primaryColor: primaryColor, label: \"Save Outfit\" })] }))] })));\n};\nexport default OutfitDisplay;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n// Enhanced API client with better error handling and retry logic\nimport axios from 'axios';\nexport class ApiClient {\n    constructor(config) {\n        this.maxRetries = config.maxRetries || 3;\n        // Store the auth header getter function if provided\n        this.getAuthHeader = config.getAuthHeader;\n        // Create basic axios config\n        const axiosConfig = {\n            baseURL: config.baseURL,\n            timeout: config.timeout || 15000,\n        };\n        // Add headers safely\n        const headersConfig = {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n        };\n        if (config.apiKey) {\n            headersConfig['X-API-Key'] = config.apiKey;\n        }\n        // Add custom headers\n        if (config.headers) {\n            Object.assign(headersConfig, config.headers);\n        }\n        // Create instance with proper types\n        this.client = axios.create(Object.assign(Object.assign({}, axiosConfig), { headers: headersConfig }));\n        // Add request interceptor for logging\n        this.client.interceptors.request.use((config) => {\n            // Remove API key from logs for security\n            const logConfig = Object.assign({}, config);\n            if (logConfig.headers && 'X-API-Key' in logConfig.headers) {\n                // First cast to unknown, then to AxiosRequestHeaders to ensure type safety\n                logConfig.headers = Object.assign(Object.assign({}, logConfig.headers), { 'X-API-Key': '[REDACTED]' });\n            }\n            // Always log requests in development mode\n            console.debug('API Request:', logConfig);\n            return config;\n        }, (error) => {\n            // Always log errors in development mode\n            console.error('API Request Error:', error);\n            return Promise.reject(error);\n        });\n        // Add response interceptor for logging\n        this.client.interceptors.response.use((response) => {\n            // Always log in development mode\n            console.debug('API Response:', {\n                status: response.status,\n                statusText: response.statusText,\n                data: response.data,\n            });\n            return response;\n        }, (error) => {\n            // Always log errors\n            console.error('API Response Error:', {\n                message: error.message,\n                response: error.response ? {\n                    status: error.response.status,\n                    statusText: error.response.statusText,\n                    data: error.response.data,\n                } : null,\n            });\n            return Promise.reject(error);\n        });\n    }\n    get(url, config) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.requestWithRetry('get', url, undefined, config);\n        });\n    }\n    post(url, data, config) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.requestWithRetry('post', url, data, config);\n        });\n    }\n    put(url, data, config) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.requestWithRetry('put', url, data, config);\n        });\n    }\n    delete(url, config) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.requestWithRetry('delete', url, undefined, config);\n        });\n    }\n    requestWithRetry(method, url, data, config) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let retries = 0;\n            let lastError = null;\n            // Add authentication headers if available\n            let requestConfig = Object.assign({}, config);\n            if (this.getAuthHeader) {\n                requestConfig.headers = Object.assign(Object.assign({}, requestConfig.headers), this.getAuthHeader());\n            }\n            while (retries <= this.maxRetries) {\n                try {\n                    let response;\n                    switch (method) {\n                        case 'get':\n                            response = yield this.client.get(url, requestConfig);\n                            break;\n                        case 'post':\n                            response = yield this.client.post(url, data, requestConfig);\n                            break;\n                        case 'put':\n                            response = yield this.client.put(url, data, requestConfig);\n                            break;\n                        case 'delete':\n                            response = yield this.client.delete(url, requestConfig);\n                            break;\n                    }\n                    return response.data;\n                }\n                catch (err) {\n                    lastError = err;\n                    // Check if error is retryable\n                    if (this.isRetryableError(err) && retries < this.maxRetries) {\n                        retries++;\n                        // Wait with exponential backoff\n                        const delay = Math.pow(2, retries) * 1000;\n                        // Always log retry attempts\n                        console.log(`Retrying request (${retries}/${this.maxRetries}) after ${delay}ms`);\n                        yield new Promise(resolve => setTimeout(resolve, delay));\n                    }\n                    else {\n                        break;\n                    }\n                }\n            }\n            // Handle specific error cases\n            this.handleError(lastError);\n            // This should never be reached due to error handling, but required for TypeScript\n            throw lastError;\n        });\n    }\n    isRetryableError(error) {\n        // Network errors or 5xx errors are retryable\n        return !error.response || (error.response && error.response.status >= 500);\n    }\n    handleError(error) {\n        if (error.response) {\n            // The request was made and the server responded with a status code\n            // outside of the range of 2xx\n            const status = error.response.status;\n            if (status === 401) {\n                throw new Error('Unauthorized: Please check your API key or log in again');\n            }\n            else if (status === 403) {\n                throw new Error('Forbidden: You do not have permission to access this resource');\n            }\n            else if (status === 404) {\n                throw new Error('Resource not found');\n            }\n            else if (status >= 500) {\n                throw new Error('Server error, please try again later');\n            }\n            else {\n                const responseData = error.response.data || {};\n                throw new Error(`API Error: ${responseData.message || error.message}`);\n            }\n        }\n        else if (error.request) {\n            // The request was made but no response was received\n            throw new Error('No response received from server. Please check your connection');\n        }\n        else {\n            // Something happened in setting up the request that triggered an Error\n            throw new Error(`Request setup error: ${error.message}`);\n        }\n    }\n}\n// Create and export a function to create an API client with default configuration\nexport const createApiClient = (config) => {\n    return new ApiClient(config);\n};\n","// API client for user-related endpoints\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nexport class UserApi {\n    constructor(apiClient) {\n        this.client = apiClient;\n    }\n    // Get user profile\n    getUserProfile(userId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.get(`/api/v1/users/${userId}`);\n        });\n    }\n    // Create user profile (anonymous or with email)\n    createUser(email) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.post('/api/v1/users', { email });\n        });\n    }\n    // Update user preferences\n    updatePreferences(userId, preferences) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.put(`/api/v1/users/${userId}/preferences`, preferences);\n        });\n    }\n    // Get style quiz questions\n    getStyleQuiz() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.get('/api/v1/style-quiz');\n        });\n    }\n    // Submit style quiz answers\n    submitStyleQuiz(userId, answers) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.post(`/api/v1/users/${userId}/style-quiz`, { answers });\n        });\n    }\n    // Add item to user's closet\n    addClosetItem(userId, item) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.post(`/api/v1/users/${userId}/closet`, item);\n        });\n    }\n    // Remove item from user's closet\n    removeClosetItem(userId, itemId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.delete(`/api/v1/users/${userId}/closet/${itemId}`);\n        });\n    }\n    // Update closet item\n    updateClosetItem(userId, itemId, updates) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.put(`/api/v1/users/${userId}/closet/${itemId}`, updates);\n        });\n    }\n    // Mark item as favorite\n    toggleFavoriteItem(userId, itemId, favorite) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.client.put(`/api/v1/users/${userId}/closet/${itemId}/favorite`, { favorite });\n        });\n    }\n}\n","// Utility functions for formatting data\nimport { format } from 'date-fns';\n// Format price with currency symbol\nexport const formatPrice = (price, currency = 'USD', locale = 'en-US') => {\n    return new Intl.NumberFormat(locale, {\n        style: 'currency',\n        currency: currency\n    }).format(price);\n};\n// Format date in readable format\nexport const formatDate = (date, formatString = 'MMM d, yyyy') => {\n    const dateObj = typeof date === 'string' ? new Date(date) : date;\n    return format(dateObj, formatString);\n};\n// Format percentage\nexport const formatPercentage = (value, decimals = 0) => {\n    return `${value.toFixed(decimals)}%`;\n};\n// Truncate text to a specific length with ellipsis\nexport const truncateText = (text, maxLength) => {\n    if (text.length <= maxLength)\n        return text;\n    return `${text.substring(0, maxLength)}...`;\n};\n// Convert hex color to RGB\nexport const hexToRgb = (hex) => {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result\n        ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        }\n        : null;\n};\n// Add opacity to color\nexport const withOpacity = (color, opacity) => {\n    const rgb = hexToRgb(color);\n    if (!rgb)\n        return color;\n    return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${opacity})`;\n};\n// Get readable text color based on background\nexport const getReadableTextColor = (bgColor) => {\n    const rgb = hexToRgb(bgColor);\n    if (!rgb)\n        return '#000000';\n    // Calculate luminance\n    const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;\n    // Return white for dark backgrounds, black for light backgrounds\n    return luminance > 0.5 ? '#000000' : '#FFFFFF';\n};\n// Convert snake_case or kebab-case to camelCase\nexport const toCamelCase = (str) => {\n    return str\n        .replace(/[-_](.)/g, (_, char) => char.toUpperCase())\n        .replace(/^(.)/, (_, char) => char.toLowerCase());\n};\n// Format file size\nexport const formatFileSize = (bytes) => {\n    if (bytes === 0)\n        return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;\n};\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// ThumbsUpButton.tsx - Thumbs up button for recommendations\nimport { useState, useEffect } from 'react';\nimport './FeedbackControls.scss';\nimport { useFeedbackStore } from '@/store/feedbackStore';\nconst ThumbsUpButton = ({ messageId, onThumbsUp, primaryColor }) => {\n    // Local state for UI responsiveness\n    const [isActive, setIsActive] = useState(false);\n    // Get feedback state and actions from the store\n    const { addMessageThumbsUp, isMessageThumbedUp } = useFeedbackStore();\n    // Sync with store on initial render\n    useEffect(() => {\n        setIsActive(isMessageThumbedUp(messageId));\n    }, [messageId, isMessageThumbedUp]);\n    const handleThumbsUp = () => {\n        // Update local state\n        setIsActive(true);\n        // Call the callback\n        onThumbsUp();\n        // Update store\n        addMessageThumbsUp(messageId);\n    };\n    const buttonStyle = isActive && primaryColor\n        ? { color: primaryColor, borderColor: primaryColor }\n        : undefined;\n    return (_jsx(\"div\", Object.assign({ className: \"stylist-feedback-controls stylist-feedback-controls--thumbs-up\" }, { children: _jsxs(\"button\", Object.assign({ className: `stylist-feedback-controls__button ${isActive ? 'stylist-feedback-controls__button--active' : ''}`, onClick: handleThumbsUp, style: buttonStyle, \"aria-label\": \"This was helpful\", disabled: isActive }, { children: [_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z\" }) })), _jsx(\"span\", Object.assign({ className: \"stylist-feedback-controls__button-text\" }, { children: isActive ? 'Thanks for your feedback!' : 'Was this helpful?' }))] })) })));\n};\nexport default ThumbsUpButton;\n","// Export all feedback-related components\nimport FeedbackControls from './FeedbackControls';\nimport ThumbsUpButton from './ThumbsUpButton';\nexport { FeedbackControls, ThumbsUpButton };\nexport default FeedbackControls;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Feedback controls component for like/dislike\nimport { useState, useEffect } from 'react';\nimport './FeedbackControls.scss';\nimport { useFeedbackStore } from '@/store/feedbackStore';\nconst FeedbackControls = ({ onLike, onDislike, itemId, outfitId, liked: propLiked = false, disliked: propDisliked = false, primaryColor }) => {\n    // Use local state to immediately reflect user interactions\n    const [liked, setLiked] = useState(propLiked);\n    const [disliked, setDisliked] = useState(propDisliked);\n    // Get feedback state and actions from the store\n    const feedbackStore = useFeedbackStore();\n    const addItemFeedback = feedbackStore.addItemFeedback;\n    const addOutfitFeedback = feedbackStore.addOutfitFeedback;\n    const getItemFeedbackStatus = feedbackStore.getItemFeedbackStatus;\n    const getOutfitFeedbackStatus = feedbackStore.getOutfitFeedbackStatus;\n    // Sync with store on initial render if we have an ID\n    useEffect(() => {\n        if (itemId) {\n            const status = getItemFeedbackStatus(itemId);\n            setLiked(status.liked);\n            setDisliked(status.disliked);\n        }\n        else if (outfitId) {\n            const status = getOutfitFeedbackStatus(outfitId);\n            setLiked(status.liked);\n            setDisliked(status.disliked);\n        }\n        else {\n            // If no ID, use props\n            setLiked(propLiked);\n            setDisliked(propDisliked);\n        }\n    }, [itemId, outfitId, propLiked, propDisliked, getItemFeedbackStatus, getOutfitFeedbackStatus]);\n    const handleLike = () => {\n        // Update local state immediately for responsive UI\n        setLiked(true);\n        setDisliked(false);\n        // Call the passed onLike handler\n        onLike();\n        // Update persistent feedback state if we have an ID\n        if (itemId) {\n            addItemFeedback(itemId, 'like');\n        }\n        else if (outfitId) {\n            addOutfitFeedback(outfitId, 'like');\n        }\n    };\n    const handleDislike = () => {\n        // Update local state immediately for responsive UI\n        setLiked(false);\n        setDisliked(true);\n        // Call the passed onDislike handler\n        onDislike();\n        // Update persistent feedback state if we have an ID\n        if (itemId) {\n            addItemFeedback(itemId, 'dislike');\n        }\n        else if (outfitId) {\n            addOutfitFeedback(outfitId, 'dislike');\n        }\n    };\n    const likeStyle = liked && primaryColor\n        ? { color: primaryColor, borderColor: primaryColor }\n        : undefined;\n    const dislikeStyle = disliked && primaryColor\n        ? { color: primaryColor, borderColor: primaryColor }\n        : undefined;\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-feedback-controls\" }, { children: [_jsx(\"button\", Object.assign({ className: `stylist-feedback-controls__button ${liked ? 'stylist-feedback-controls__button--active' : ''}`, onClick: handleLike, style: likeStyle, \"aria-label\": \"Like\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z\" }) })) })), _jsx(\"button\", Object.assign({ className: `stylist-feedback-controls__button ${disliked ? 'stylist-feedback-controls__button--active' : ''}`, onClick: handleDislike, style: dislikeStyle, \"aria-label\": \"Dislike\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v1.91l.01.01L1 14c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z\" }) })) }))] })));\n};\nexport default FeedbackControls;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport './LoadingIndicator.scss';\nconst LoadingIndicator = ({ size = 'medium', text, primaryColor }) => {\n    const sizeClass = `stylist-loading-indicator--${size}`;\n    const spinnerStyle = primaryColor ? { borderTopColor: primaryColor } : undefined;\n    return (_jsxs(\"div\", Object.assign({ className: `stylist-loading-indicator ${sizeClass}` }, { children: [_jsx(\"div\", { className: \"stylist-loading-indicator__spinner\", style: spinnerStyle }), text && _jsx(\"div\", Object.assign({ className: \"stylist-loading-indicator__text\" }, { children: text }))] })));\n};\nexport default LoadingIndicator;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// WishlistNotification component for showing alerts about wishlisted items\nimport { useState, useEffect } from 'react';\nimport { useRecommendationStore } from '@/store/index';\nimport './WishlistNotification.scss';\nconst WishlistNotification = ({ onClickNotification }) => {\n    const { wishlistItems } = useRecommendationStore();\n    const [notifications, setNotifications] = useState([]);\n    const [isOpen, setIsOpen] = useState(false);\n    const [hasUnread, setHasUnread] = useState(false);\n    // Check for notifications on component mount and when wishlist changes\n    useEffect(() => {\n        // In a real application, you would fetch this data from an API\n        // For this demo, we'll generate random notifications for wishlisted items\n        // Clear existing timer if component is unmounted\n        const timerId = setTimeout(() => {\n            if (wishlistItems.length > 0) {\n                // Simulate getting notifications for random wishlist items\n                const randomItem = wishlistItems[Math.floor(Math.random() * wishlistItems.length)];\n                if (randomItem) {\n                    // Create a notification for the item\n                    const newNotification = {\n                        id: `notification_${Date.now()}`,\n                        itemId: randomItem.itemId,\n                        itemName: randomItem.name || `Product ${randomItem.itemId.slice(0, 6)}`,\n                        type: Math.random() > 0.5 ? 'sale' : 'low_stock',\n                        date: new Date(),\n                        read: false\n                    };\n                    // Add the notification to the list\n                    setNotifications(prev => [...prev, newNotification]);\n                    setHasUnread(true);\n                }\n            }\n        }, 5000); // Show notification after 5 seconds\n        return () => clearTimeout(timerId);\n    }, [wishlistItems]);\n    // Toggle notification panel\n    const toggleNotificationPanel = () => {\n        setIsOpen(!isOpen);\n        // Mark all as read when opening\n        if (!isOpen) {\n            setNotifications(prev => prev.map(notif => (Object.assign(Object.assign({}, notif), { read: true }))));\n            setHasUnread(false);\n        }\n    };\n    // Handle clicking a notification\n    const handleNotificationClick = () => {\n        if (onClickNotification) {\n            onClickNotification();\n        }\n        setIsOpen(false);\n    };\n    // Clear all notifications\n    const clearAllNotifications = () => {\n        setNotifications([]);\n        setHasUnread(false);\n        setIsOpen(false);\n    };\n    // If no notifications, don't render anything\n    if (notifications.length === 0) {\n        return null;\n    }\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-notification\" }, { children: [_jsxs(\"button\", Object.assign({ className: `stylist-wishlist-notification__bell ${hasUnread ? 'has-unread' : ''}`, onClick: toggleNotificationPanel, \"aria-label\": \"Notifications\" }, { children: [_jsx(\"span\", Object.assign({ className: \"stylist-wishlist-notification__icon\" }, { children: \"\\uD83D\\uDD14\" })), hasUnread && (_jsx(\"span\", { className: \"stylist-wishlist-notification__badge\" }))] })), isOpen && (_jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-notification__panel\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-notification__header\" }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-wishlist-notification__title\" }, { children: \"Notifications\" })), _jsx(\"button\", Object.assign({ className: \"stylist-wishlist-notification__close\", onClick: () => setIsOpen(false), \"aria-label\": \"Close notifications\" }, { children: \"\\u00D7\" }))] })), _jsx(\"div\", Object.assign({ className: \"stylist-wishlist-notification__list\" }, { children: notifications.length === 0 ? (_jsx(\"div\", Object.assign({ className: \"stylist-wishlist-notification__empty\" }, { children: \"No notifications\" }))) : (notifications.map(notification => (_jsx(\"div\", Object.assign({ className: `stylist-wishlist-notification__item ${notification.read ? 'read' : 'unread'}`, onClick: handleNotificationClick }, { children: _jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-notification__content\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-wishlist-notification__item-icon\" }, { children: notification.type === 'sale' ? '' : '' })), _jsxs(\"div\", Object.assign({ className: \"stylist-wishlist-notification__item-text\" }, { children: [_jsx(\"p\", Object.assign({ className: \"stylist-wishlist-notification__item-message\" }, { children: notification.type === 'sale'\n                                                    ? `${notification.itemName} is now on sale!`\n                                                    : `${notification.itemName} is running low in stock!` })), _jsx(\"span\", Object.assign({ className: \"stylist-wishlist-notification__item-time\" }, { children: new Date(notification.date).toLocaleTimeString([], {\n                                                    hour: '2-digit',\n                                                    minute: '2-digit'\n                                                }) }))] }))] })) }), notification.id)))) })), notifications.length > 0 && (_jsx(\"div\", Object.assign({ className: \"stylist-wishlist-notification__footer\" }, { children: _jsx(\"button\", Object.assign({ className: \"stylist-wishlist-notification__clear\", onClick: clearAllNotifications }, { children: \"Clear all\" })) })))] })))] })));\n};\nexport default WishlistNotification;\n","import ChatHeader from './ChatHeader';\nexport default ChatHeader;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport './ChatHeader.scss';\nimport { useChatStore } from '@store/index';\nimport WishlistNotification from '@/components/WishlistNotification';\nconst ChatHeader = ({ title = 'The Stylist', logo, primaryColor, currentView = 'chat', onSwitchView }) => {\n    const { toggleMinimize, toggleOpen, isMinimized } = useChatStore();\n    const handleMinimize = () => {\n        toggleMinimize();\n    };\n    const handleClose = () => {\n        toggleOpen();\n    };\n    const handleSwitchView = () => {\n        if (onSwitchView) {\n            onSwitchView(currentView === 'chat' ? 'lookbook' : 'chat');\n        }\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-chat-header\", style: { backgroundColor: primaryColor } }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-chat-header__logo\" }, { children: logo ? (_jsx(\"img\", { src: logo, alt: title, className: \"stylist-chat-header__logo-img\" })) : (_jsx(\"div\", Object.assign({ className: \"stylist-chat-header__logo-placeholder\" }, { children: currentView === 'chat' ? (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"24\", height: \"24\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 1a9 9 0 019 9c0 4.56-3.37 8.33-7.76 8.95l-.19-.47a7.99 7.99 0 002.93-10.57A8.02 8.02 0 004.06 13.1A9 9 0 0112 1zm7.12 13.93l.37.37-.36.36.01-.73zm1.36-1.55a2.83 2.83 0 00-.5-.31l.36-.74c.28.12.54.29.78.48l-.64.57zm-14.81.19l.36.73c-.29.16-.57.35-.8.57l-.57-.64c.31-.3.65-.54 1.01-.66zM6.66 22l1.93-3.1c-.47-.55-.85-1.16-1.14-1.8L2.8 19.13V22h3.86zm10.46-2.91L19 21.99v-2.86l-1.14-.93c.12-.39.19-.8.19-1.22l.08-.04A8.96 8.96 0 0022 10 10 10 0 002 10a9 9 0 003.34 7.03L1.94 20.5A1 1 0 002.86 22h16.28a1 1 0 00.92-1.5l-2.94-3.41z\" }) }))) : (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"24\", height: \"24\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-3 2v5l-1-.75L15 9V4h2zm3 12H8V4h5v9l3-2.25L19 13V4h1v12z\" }) }))) }))) })), _jsx(\"div\", Object.assign({ className: \"stylist-chat-header__title\" }, { children: title })), _jsxs(\"div\", Object.assign({ className: \"stylist-chat-header__controls\" }, { children: [!isMinimized && (_jsx(WishlistNotification, { onClickNotification: () => {\n                            if (onSwitchView) {\n                                // Switch to lookbook first, then to wishlist tab\n                                if (currentView !== 'lookbook') {\n                                    onSwitchView('lookbook');\n                                }\n                                // Set wishlist tab as active\n                                // This would require connecting to the Lookbook component,\n                                // which is beyond the scope of this inline edit\n                                // We could use a global event or store for this\n                                // For demonstration, we'll just log this action\n                                console.log('Switch to wishlist tab');\n                            }\n                        } })), onSwitchView && !isMinimized && (_jsx(\"button\", Object.assign({ className: \"stylist-chat-header__button stylist-chat-header__button--switch\", onClick: handleSwitchView, \"aria-label\": currentView === 'chat' ? 'View Lookbook' : 'Return to Chat' }, { children: currentView === 'chat' ? (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"18\", height: \"18\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-3 2v5l-1-.75L15 9V4h2zm3 12H8V4h5v9l3-2.25L19 13V4h1v12z\" }) }))) : (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"18\", height: \"18\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z\" }) }))) }))), _jsx(\"button\", Object.assign({ className: \"stylist-chat-header__button stylist-chat-header__button--minimize\", onClick: handleMinimize, \"aria-label\": isMinimized ? \"Maximize\" : \"Minimize\" }, { children: isMinimized ? (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"18\", height: \"18\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\" }) }))) : (_jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"18\", height: \"18\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M19 13H5v-2h14v2z\" }) }))) })), _jsx(\"button\", Object.assign({ className: \"stylist-chat-header__button stylist-chat-header__button--close\", onClick: handleClose, \"aria-label\": \"Close\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"18\", height: \"18\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z\" }) })) }))] }))] })));\n};\nexport default ChatHeader;\n","import MessageBubble from './MessageBubble';\nexport default MessageBubble;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Message bubble component for text messages\nimport React, { useState } from 'react';\nimport classNames from 'classnames';\nimport './MessageBubble.scss';\nimport { MessageSender } from '../../types/index';\nimport { formatDate } from '../../utils/formatters';\nimport { ThumbsUpButton } from '@/components/FeedbackControls';\nimport { trackEvent, AnalyticsEventType } from '@/utils/analytics';\nimport { getUserId } from '@/utils/localStorage';\nconst MessageBubble = ({ message, primaryColor, onFeedback }) => {\n    const { id, sender, text, timestamp } = message;\n    const [feedbackGiven, setFeedbackGiven] = useState(false);\n    const isUser = sender === MessageSender.USER;\n    const isAssistant = sender === MessageSender.ASSISTANT;\n    const isSystem = sender === MessageSender.SYSTEM;\n    // Only show feedback for assistant messages that are long enough to be meaningful\n    const shouldShowFeedback = isAssistant &&\n        text.length > 20 &&\n        !text.includes('Would you like') &&\n        onFeedback;\n    const bubbleClasses = classNames('stylist-message-bubble', {\n        'stylist-message-bubble--user': isUser,\n        'stylist-message-bubble--assistant': isAssistant,\n        'stylist-message-bubble--system': isSystem,\n        'stylist-message-bubble--with-feedback': shouldShowFeedback\n    });\n    const contentStyle = isUser && primaryColor\n        ? { backgroundColor: primaryColor }\n        : undefined;\n    const handleThumbsUp = () => {\n        setFeedbackGiven(true);\n        if (onFeedback) {\n            onFeedback(id, true);\n            // Track the event\n            trackEvent(AnalyticsEventType.MESSAGE_THUMBS_UP, getUserId(), {\n                messageId: id,\n                messageContent: text.substring(0, 100) // First 100 chars for context\n            });\n        }\n    };\n    return (_jsxs(\"div\", Object.assign({ className: bubbleClasses }, { children: [!isUser && (_jsx(\"div\", Object.assign({ className: \"stylist-message-bubble__avatar\" }, { children: isAssistant ? (_jsx(\"div\", Object.assign({ className: \"stylist-message-bubble__avatar-icon\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 1a9 9 0 019 9c0 4.56-3.37 8.33-7.76 8.95l-.19-.47a7.99 7.99 0 002.93-10.57A8.02 8.02 0 004.06 13.1 9 9 0 0112 1zm7.12 13.93l.37.37-.36.36.01-.73zm1.36-1.55a2.83 2.83 0 00-.5-.31l.36-.74c.28.12.54.29.78.48l-.64.57zm-14.81.19l.36.73c-.29.16-.57.35-.8.57l-.57-.64c.31-.3.65-.54 1.01-.66zM6.66 22l1.93-3.1c-.47-.55-.85-1.16-1.14-1.8L2.8 19.13V22h3.86zm10.46-2.91L19 21.99v-2.86l-1.14-.93c.12-.39.19-.8.19-1.22l.08-.04A8.96 8.96 0 0022 10 10 10 0 002 10a9 9 0 003.34 7.03L1.94 20.5A1 1 0 002.86 22h16.28a1 1 0 00.92-1.5l-2.94-3.41z\" }) })) }))) : (_jsx(\"div\", Object.assign({ className: \"stylist-message-bubble__avatar-info\" }, { children: \"i\" }))) }))), _jsxs(\"div\", Object.assign({ className: \"stylist-message-bubble__content\", style: contentStyle }, { children: [text.split('\\n').map((line, i) => (_jsxs(React.Fragment, { children: [line, i < text.split('\\n').length - 1 && _jsx(\"br\", {})] }, i))), shouldShowFeedback && (_jsx(\"div\", Object.assign({ className: \"stylist-message-bubble__feedback\" }, { children: _jsx(ThumbsUpButton, { messageId: id, onThumbsUp: handleThumbsUp, primaryColor: primaryColor }) })))] })), _jsx(\"div\", Object.assign({ className: \"stylist-message-bubble__time\" }, { children: formatDate(timestamp, 'h:mm a') }))] })));\n};\nexport default MessageBubble;\n","import StyleQuiz from './StyleQuiz';\nexport default StyleQuiz;\n","import ChatBody from './ChatBody';\nexport default ChatBody;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Chat body component - displays messages\nimport { useRef, useEffect } from 'react';\nimport './ChatBody.scss';\nimport MessageBubble from '@/components/MessageBubble';\nimport ItemCard from '@/components/ItemCard';\nimport OutfitDisplay from '@/components/OutfitDisplay';\nimport StyleQuiz from '@/components/StyleQuiz';\nconst ChatBody = ({ messages, onItemFeedback, onOutfitFeedback, onMessageFeedback, onQuizSubmit, isLoading = false, primaryColor }) => {\n    const messagesEndRef = useRef(null);\n    const scrollContainerRef = useRef(null);\n    // Auto-scroll to bottom on new messages\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n    const scrollToBottom = () => {\n        if (messagesEndRef.current) {\n            messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n        }\n    };\n    // Render a message based on its type\n    const renderMessage = (message) => {\n        switch (message.type) {\n            case 'text':\n                return (_jsx(MessageBubble, { message: message, primaryColor: primaryColor, onFeedback: onMessageFeedback }, message.id));\n            case 'recommendation':\n                return (_jsxs(\"div\", Object.assign({ className: \"stylist-chat-body__recommendation\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-chat-body__recommendation-title\" }, { children: \"Here are some recommendations for you:\" })), _jsx(\"div\", Object.assign({ className: \"stylist-chat-body__recommendation-items\" }, { children: message.items.map((item) => {\n                                // Convert Chat.RecommendationItem to Recommendation.RecommendationItem\n                                const recommendationItem = {\n                                    id: item.id,\n                                    retailerId: 'default',\n                                    name: item.name,\n                                    brand: item.brand,\n                                    category: item.category,\n                                    price: item.price,\n                                    salePrice: item.salePrice,\n                                    colors: [],\n                                    sizes: [],\n                                    imageUrls: [item.imageUrl],\n                                    url: item.url,\n                                    matchScore: item.matchScore,\n                                    matchReasons: item.matchReasons,\n                                    inStock: true\n                                };\n                                return (_jsx(ItemCard, { item: recommendationItem, onFeedback: onItemFeedback, primaryColor: primaryColor }, item.id));\n                            }) }))] }), message.id));\n            case 'outfit':\n                return (_jsx(OutfitDisplay, { outfit: message.outfit, onFeedback: onOutfitFeedback, primaryColor: primaryColor }, message.id));\n            case 'quiz':\n                return (_jsx(StyleQuiz, { quizId: message.quizId, title: message.title, description: message.description, onSubmit: onQuizSubmit || (() => { }), primaryColor: primaryColor }, message.id));\n            case 'loading':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-chat-body__loading\" }, { children: _jsxs(\"div\", Object.assign({ className: \"stylist-chat-body__loading-dots\" }, { children: [_jsx(\"span\", {}), _jsx(\"span\", {}), _jsx(\"span\", {})] })) }), message.id));\n            case 'error':\n                return (_jsxs(\"div\", Object.assign({ className: \"stylist-chat-body__error\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-chat-body__error-icon\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"24\", height: \"24\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\" }) })) })), _jsx(\"div\", Object.assign({ className: \"stylist-chat-body__error-message\" }, { children: message.error }))] }), message.id));\n            default:\n                return null;\n        }\n    };\n    return (_jsx(\"div\", Object.assign({ className: \"stylist-chat-body\", ref: scrollContainerRef }, { children: _jsxs(\"div\", Object.assign({ className: \"stylist-chat-body__messages\" }, { children: [messages.map((message) => renderMessage(message)), isLoading && (_jsx(\"div\", Object.assign({ className: \"stylist-chat-body__loading\" }, { children: _jsxs(\"div\", Object.assign({ className: \"stylist-chat-body__loading-dots\" }, { children: [_jsx(\"span\", {}), _jsx(\"span\", {}), _jsx(\"span\", {})] })) }))), _jsx(\"div\", { ref: messagesEndRef })] })) })));\n};\nexport default ChatBody;\n","import ChatInput from './ChatInput';\nexport default ChatInput;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Chat input component\nimport { useState, useRef, useEffect } from 'react';\nimport './ChatInput.scss';\n// No need to import unused types\nimport { useChatStore } from '@/store/index';\nconst ChatInput = ({ onSendMessage, placeholder = 'Type a message...', disabled = false, primaryColor }) => {\n    const [message, setMessage] = useState('');\n    const inputRef = useRef(null);\n    const { isLoading } = useChatStore();\n    // Auto-focus the input when component mounts\n    useEffect(() => {\n        if (inputRef.current) {\n            inputRef.current.focus();\n        }\n    }, []);\n    // Auto-resize textarea based on content\n    useEffect(() => {\n        if (inputRef.current) {\n            inputRef.current.style.height = 'auto';\n            inputRef.current.style.height = `${Math.min(inputRef.current.scrollHeight, 120)}px`;\n        }\n    }, [message]);\n    const handleChange = (e) => {\n        setMessage(e.target.value);\n    };\n    const handleKeyDown = (e) => {\n        // Send message on Enter key (without Shift)\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            handleSendMessage();\n        }\n    };\n    const handleSendMessage = () => {\n        const trimmedMessage = message.trim();\n        if (trimmedMessage && !disabled && !isLoading) {\n            onSendMessage(trimmedMessage);\n            setMessage('');\n            // Reset textarea height\n            if (inputRef.current) {\n                inputRef.current.style.height = 'auto';\n            }\n        }\n    };\n    const sendButtonStyle = {\n        backgroundColor: primaryColor || undefined\n    };\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-chat-input\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-chat-input__container\" }, { children: _jsx(\"textarea\", { ref: inputRef, className: \"stylist-chat-input__textarea\", placeholder: placeholder, value: message, onChange: handleChange, onKeyDown: handleKeyDown, disabled: disabled || isLoading, rows: 1, \"aria-label\": \"Message input\" }) })), _jsx(\"button\", Object.assign({ className: \"stylist-chat-input__send-button\", onClick: handleSendMessage, disabled: !message.trim() || disabled || isLoading, style: sendButtonStyle, \"aria-label\": \"Send message\" }, { children: _jsx(\"svg\", Object.assign({ xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", width: \"20\", height: \"20\", fill: \"currentColor\" }, { children: _jsx(\"path\", { d: \"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\" }) })) }))] })));\n};\nexport default ChatInput;\n","// src/services/chatService.ts\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { MessageSender, MessageType } from '@/types/index';\nimport { v4 as uuidv4 } from 'uuid';\nimport { trackMessageSent } from '@/services/analytics/analyticsService';\nimport { ANTHROPIC_API_KEY, CLAUDE_API_URL, CLAUDE_MODEL, FORCE_DEMO_MODE, USE_CLAUDE_DEMO } from '@/utils/environment';\nexport class ChatService {\n    constructor(recommendationApi, userId) {\n        this.conversationContext = [];\n        this.recommendationApi = recommendationApi;\n        this.userId = userId;\n        // Initialize Claude configuration\n        this.claudeConfig = {\n            apiKey: ANTHROPIC_API_KEY,\n            baseUrl: CLAUDE_API_URL,\n            modelName: CLAUDE_MODEL,\n            // Use fallback mode if API key is missing or demo mode is forced\n            fallbackMode: !ANTHROPIC_API_KEY || FORCE_DEMO_MODE\n        };\n        // Add initial context for the conversation\n        this.conversationContext = [\n            `You are an AI style assistant for a fashion recommendation platform called \"The Stylist\". \n      The current date is ${new Date().toLocaleDateString()}.\n      You help users discover clothing items and outfits that match their personal style.\n      Keep responses concise, helpful, and focus on providing personalized fashion advice.\n      When you recommend items, focus on why they would work for the user.\n      If you don't know something specific about fashion, you can suggest general style principles.`\n        ];\n        // For demo purposes, print helpful info about Claude status\n        if (USE_CLAUDE_DEMO) {\n            console.info(' Claude demo mode is ENABLED - will provide realistic AI responses without API key');\n        }\n        if (FORCE_DEMO_MODE) {\n            console.info(' Forced demo mode is ENABLED - using fallback for Claude API despite keys');\n        }\n        else if (ANTHROPIC_API_KEY) {\n            console.info(' Claude API key present - will attempt to use real Claude API');\n        }\n        else {\n            console.info(' No Claude API key found - using rule-based fallback responses');\n        }\n    }\n    /**\n     * Process a user message and generate appropriate responses\n     */\n    processMessage(text) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Track the message sent\n            trackMessageSent(this.userId, text);\n            // Initialize response messages array\n            const responseMessages = [];\n            // Determine the intent for possible demo responses\n            const intent = this.categorizeIntent(text);\n            // Try to use Claude API if available and not in forced demo mode\n            if (!this.claudeConfig.fallbackMode) {\n                try {\n                    const claudeResponse = yield this.callClaudeAPI(text);\n                    // Add the response from Claude\n                    responseMessages.push(this.createTextMessage(claudeResponse, MessageSender.ASSISTANT));\n                    // Process for special instructions in Claude response\n                    if (this.containsRecommendationIntent(claudeResponse, text)) {\n                        // Add a recommendation message if Claude suggested showing items\n                        yield this.addRecommendationMessage(responseMessages);\n                    }\n                    return responseMessages;\n                }\n                catch (error) {\n                    console.error('Error calling Claude API:', error);\n                    // Fall back to rule-based responses\n                }\n            }\n            // Check for demo response if Claude demo mode is enabled\n            const demoResponse = this.getDemoResponse(intent, text);\n            if (demoResponse) {\n                // This is a simulated Claude response in demo mode\n                responseMessages.push(this.createTextMessage(demoResponse, MessageSender.ASSISTANT));\n                // If it's a wedding dress query, also add recommendations\n                if (intent === 'wedding_dress') {\n                    // Add a recommendation message after the initial response\n                    yield this.addRecommendationMessage(responseMessages, 'wedding');\n                }\n                return responseMessages;\n            }\n            // If no demo response and Claude is not available or failed, use rule-based approach\n            switch (intent) {\n                case 'recommendation':\n                    // Add a simple acknowledgment message\n                    responseMessages.push(this.createTextMessage('I found some items that match your style! Here are my recommendations:', MessageSender.ASSISTANT));\n                    // Get recommendations from API\n                    yield this.addRecommendationMessage(responseMessages, this.extractContext(text));\n                    break;\n                case 'style_quiz':\n                    responseMessages.push(this.createTextMessage('Would you like to take our style quiz? It will help me understand your preferences better so I can make more personalized recommendations.', MessageSender.ASSISTANT));\n                    break;\n                case 'virtual_try_on':\n                    responseMessages.push(this.createTextMessage('You can try on any clothing item by clicking the \"Try On\" button on a recommendation. Upload your photo, and see how the item looks on you!', MessageSender.ASSISTANT));\n                    break;\n                case 'greeting':\n                    responseMessages.push(this.createTextMessage('Hello! I\\'m your personal AI style assistant. I can help you discover clothing that matches your unique style. Would you like some personalized recommendations?', MessageSender.ASSISTANT));\n                    break;\n                case 'help':\n                    responseMessages.push(this.createTextMessage('I can help you with: \\n- Finding clothing recommendations based on your style\\n- Creating complete outfits\\n- Virtual try-on of garments\\n- Style advice and tips\\n\\nJust let me know what you\\'re looking for!', MessageSender.ASSISTANT));\n                    break;\n                case 'wedding_dress':\n                    // Special handling for wedding dress case when not in demo mode\n                    responseMessages.push(this.createTextMessage('I can help you find the perfect wedding dress! Here are some recommendations based on current trends:', MessageSender.ASSISTANT));\n                    // Get wedding dress recommendations\n                    yield this.addRecommendationMessage(responseMessages, 'wedding');\n                    break;\n                default:\n                    responseMessages.push(this.createTextMessage('I can help you discover fashion items that match your style. Would you like to see some personalized recommendations?', MessageSender.ASSISTANT));\n            }\n            return responseMessages;\n        });\n    }\n    /**\n     * Call the Claude API to get a response\n     */\n    callClaudeAPI(userMessage) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                // Add the user message to context\n                this.conversationContext.push(userMessage);\n                // API endpoint - prioritize direct Claude API if we have API key\n                if (this.claudeConfig.apiKey) {\n                    try {\n                        return yield this.callDirectClaudeAPI(userMessage);\n                    }\n                    catch (directError) {\n                        console.error('Direct Claude API call failed, falling back to backend proxy:', directError);\n                        // Fall back to proxy\n                    }\n                }\n                // Fall back to backend proxy\n                const apiUrl = this.recommendationApi.apiClient\n                    ? `${this.recommendationApi.apiClient.baseURL || ''}/chat`\n                    : '/api/chat';\n                console.log('Calling Claude API via backend proxy at:', apiUrl);\n                // Prepare the API request to backend proxy\n                const response = yield fetch(apiUrl, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-API-Key': this.recommendationApi.apiClient.apiKey || '',\n                    },\n                    body: JSON.stringify({\n                        userId: this.userId,\n                        message: userMessage,\n                        context: this.conversationContext.slice(-5) // Keep last 5 messages for context\n                    }),\n                });\n                if (!response.ok) {\n                    console.warn(`Claude API request failed with status: ${response.status}`);\n                    // Don't throw error - return fallback response instead\n                    return \"I'm having trouble connecting to my backend services. Let me show you some recommendations based on your request.\";\n                }\n                const data = yield response.json();\n                // Add the response to context\n                this.conversationContext.push(data.response);\n                return data.response;\n            }\n            catch (error) {\n                console.error('Error calling Claude API via backend:', error);\n                // Return fallback response instead of throwing\n                return \"I'm having trouble connecting right now. Let me show you some recommendations instead.\";\n            }\n        });\n    }\n    /**\n     * Call the Claude API directly from the frontend\n     */\n    callDirectClaudeAPI(userMessage) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.claudeConfig.apiKey) {\n                throw new Error('No Claude API key available');\n            }\n            const apiUrl = this.claudeConfig.baseUrl || 'https://api.anthropic.com';\n            const model = this.claudeConfig.modelName || 'claude-3-haiku-20240307';\n            console.log(`Calling Claude API directly with model: ${model}`);\n            // Prepare the messages array for Claude API\n            const messages = this.conversationContext.slice(-5).map((message, index) => {\n                // First message is system prompt, then alternate between user and assistant\n                if (index === 0) {\n                    return { role: \"system\", content: message };\n                }\n                else {\n                    return {\n                        role: index % 2 === 1 ? \"user\" : \"assistant\",\n                        content: message\n                    };\n                }\n            });\n            // Add the current user message\n            messages.push({ role: \"user\", content: userMessage });\n            // Prepare the request to the Claude API\n            const response = yield fetch(`${apiUrl}/v1/messages`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-api-key': this.claudeConfig.apiKey,\n                    'anthropic-version': '2023-06-01'\n                },\n                body: JSON.stringify({\n                    model,\n                    messages,\n                    max_tokens: 1000\n                }),\n            });\n            if (!response.ok) {\n                const errorText = yield response.text();\n                console.error(`Claude API direct request failed: ${response.status} - ${errorText}`);\n                throw new Error(`Failed to get response from Claude API: ${response.statusText}`);\n            }\n            const data = yield response.json();\n            const assistantResponse = ((_b = (_a = data.content) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.text) || '';\n            // Add the response to context\n            this.conversationContext.push(assistantResponse);\n            return assistantResponse;\n        });\n    }\n    /**\n     * Check if the AI response or user message suggests recommendations\n     */\n    containsRecommendationIntent(aiResponse, userMessage) {\n        const lowerAiResponse = aiResponse.toLowerCase();\n        const lowerUserMessage = userMessage.toLowerCase();\n        // Recommendation phrases in AI response\n        const aiRecommendPhrases = [\n            'here are some recommendations',\n            'i recommend',\n            'would you like to see',\n            'i can show you',\n            'i\\'ll show you some items',\n            'i can recommend'\n        ];\n        // Recommendation phrases in user message\n        const userRecommendPhrases = [\n            'show me',\n            'recommend',\n            'what should i wear',\n            'find me',\n            'can you show',\n            'give me ideas',\n            'what would look good'\n        ];\n        // Check AI response for recommendation intent\n        for (const phrase of aiRecommendPhrases) {\n            if (lowerAiResponse.includes(phrase)) {\n                return true;\n            }\n        }\n        // Check user message for recommendation intent\n        for (const phrase of userRecommendPhrases) {\n            if (lowerUserMessage.includes(phrase)) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Add recommendation message to the response\n     */\n    addRecommendationMessage(responseMessages, context) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                const recommendations = yield this.recommendationApi.getRecommendations({\n                    userId: this.userId,\n                    context: context,\n                    limit: 4\n                });\n                // Add recommendation message\n                if (recommendations.items.length > 0) {\n                    // Convert from Recommendation to Chat format\n                    const chatItems = recommendations.items.map(item => ({\n                        id: item.id,\n                        name: item.name,\n                        brand: item.brand,\n                        category: item.category,\n                        price: item.price,\n                        salePrice: item.salePrice,\n                        imageUrl: item.imageUrls[0] || '',\n                        url: item.url,\n                        matchScore: item.matchScore,\n                        matchReasons: item.matchReasons\n                    }));\n                    responseMessages.push(this.createRecommendationMessage(chatItems));\n                }\n                // If there are outfits, add outfit message\n                if (recommendations.outfits.length > 0) {\n                    responseMessages.push(this.createTextMessage('I also created a complete outfit for you:', MessageSender.ASSISTANT));\n                    // Convert from Recommendation to Chat format\n                    const outfit = recommendations.outfits[0];\n                    const chatOutfit = {\n                        id: outfit.id,\n                        name: outfit.name,\n                        occasion: outfit.occasion,\n                        matchScore: outfit.matchScore,\n                        matchReasons: outfit.matchReasons,\n                        items: outfit.items.map(item => ({\n                            id: item.id,\n                            name: item.name,\n                            brand: item.brand,\n                            category: item.category,\n                            price: item.price,\n                            salePrice: item.salePrice,\n                            imageUrl: item.imageUrls[0] || '',\n                            url: item.url,\n                            matchScore: item.matchScore,\n                            matchReasons: item.matchReasons\n                        }))\n                    };\n                    responseMessages.push(this.createOutfitMessage(chatOutfit));\n                }\n            }\n            catch (error) {\n                console.error('Error getting recommendations:', error);\n                responseMessages.push(this.createTextMessage('Sorry, I had trouble getting recommendations. Please try again.', MessageSender.SYSTEM));\n            }\n        });\n    }\n    /**\n     * Categorize user intent based on message text\n     */\n    categorizeIntent(text) {\n        const lowerText = text.toLowerCase();\n        // Handle the wedding dress case specially for the demo\n        if (lowerText.includes('wedding dress') ||\n            lowerText.includes('bridal') ||\n            (lowerText.includes('wedding') && lowerText.includes('dress'))) {\n            return 'wedding_dress';\n        }\n        if (lowerText.includes('recommend') ||\n            lowerText.includes('suggestion') ||\n            lowerText.includes('find') ||\n            lowerText.includes('show me')) {\n            return 'recommendation';\n        }\n        if (lowerText.includes('quiz') ||\n            lowerText.includes('style profile') ||\n            lowerText.includes('preferences')) {\n            return 'style_quiz';\n        }\n        if (lowerText.includes('try on') ||\n            lowerText.includes('virtual') ||\n            lowerText.includes('how does it look')) {\n            return 'virtual_try_on';\n        }\n        if (lowerText.includes('hello') ||\n            lowerText.includes('hi') ||\n            lowerText.includes('hey')) {\n            return 'greeting';\n        }\n        if (lowerText.includes('help') ||\n            lowerText.includes('what can you do') ||\n            lowerText.includes('how does this work')) {\n            return 'help';\n        }\n        return 'general';\n    }\n    /**\n     * Get a realistic Claude-like response for demo purposes\n     * These responses mock what the real API would return for specific queries\n     */\n    getDemoResponse(intent, query) {\n        // Special demo responses for specific query types\n        switch (intent) {\n            case 'wedding_dress':\n                return `I'd be happy to help you find the perfect wedding dress! Based on current trends and classic styles, here are some suggestions:\n\nFor a traditional look, A-line and ball gown silhouettes create a timeless, romantic appearance. If you prefer something more modern, consider a fitted mermaid or trumpet style that accentuates your curves.\n\nMaterial is important too - delicate lace creates a romantic feel, while silk or satin offers elegant simplicity. For spring/summer weddings, lighter fabrics like chiffon or organza are beautiful options.\n\nWould you like to see specific dress recommendations? I can show you some options across different styles and price points that might match what you're looking for.`;\n            case 'greeting':\n                return `Hello! I'm your personal style assistant. I'm here to help you discover clothing that matches your unique style preferences. I can recommend outfits, help you find specific items, provide style advice, or even let you virtually try on clothes. What kind of fashion help are you looking for today?`;\n            case 'help':\n                return `I'm your AI fashion assistant, and I can help you with:\n\n- Finding personalized clothing recommendations\n- Creating complete outfits for specific occasions\n- Virtually trying on garments with our try-on feature\n- Answering style questions and providing fashion advice\n- Helping you complete our style quiz to better understand your preferences\n\nJust let me know what you're looking for, and I'll guide you through the process!`;\n            default:\n                if (USE_CLAUDE_DEMO) {\n                    return `I'd be happy to help you with \"${query}\". This is a simulated Claude response in demo mode. In a real implementation with an API key, you would get a personalized response from Claude based on your specific query. Would you like to see some clothing recommendations related to this topic?`;\n                }\n                else {\n                    return ''; // Fall back to rule-based responses with empty string instead of null\n                }\n        }\n    }\n    /**\n     * Extract context from message text\n     */\n    extractContext(text) {\n        const lowerText = text.toLowerCase();\n        // Extract clothing categories\n        const categories = [\n            'tops', 'shirts', 't-shirts', 'blouses',\n            'bottoms', 'pants', 'jeans', 'shorts', 'skirts',\n            'dresses', 'gowns',\n            'outerwear', 'jackets', 'coats',\n            'shoes', 'sneakers', 'boots', 'heels',\n            'accessories'\n        ];\n        for (const category of categories) {\n            if (lowerText.includes(category)) {\n                return category;\n            }\n        }\n        // Extract occasions\n        const occasions = [\n            'casual', 'formal', 'business', 'work',\n            'party', 'date', 'wedding', 'weekend',\n            'vacation', 'summer', 'winter', 'spring', 'fall'\n        ];\n        for (const occasion of occasions) {\n            if (lowerText.includes(occasion)) {\n                return occasion;\n            }\n        }\n        return undefined;\n    }\n    /**\n     * Create a text message\n     */\n    createTextMessage(text, sender) {\n        return {\n            id: uuidv4(),\n            type: MessageType.TEXT,\n            sender,\n            text,\n            timestamp: new Date()\n        };\n    }\n    /**\n     * Create a recommendation message\n     */\n    createRecommendationMessage(items) {\n        return {\n            id: uuidv4(),\n            type: MessageType.RECOMMENDATION,\n            sender: MessageSender.ASSISTANT,\n            items,\n            timestamp: new Date()\n        };\n    }\n    /**\n     * Create an outfit message\n     */\n    createOutfitMessage(outfit) {\n        return {\n            id: uuidv4(),\n            type: MessageType.OUTFIT,\n            sender: MessageSender.ASSISTANT,\n            outfit,\n            timestamp: new Date()\n        };\n    }\n}\n","// src/services/analytics/analyticsService.ts\nimport { AnalyticsEventType, trackEvent } from '@utils/analytics';\n// Configure analytics provider\nlet analyticsInitialized = false;\n/**\n * Initialize analytics\n */\nexport const initializeAnalytics = () => {\n    if (analyticsInitialized)\n        return;\n    // Load analytics script\n    const script = document.createElement('script');\n    script.src = 'https://cdn.thestylist.ai/analytics.js';\n    script.async = true;\n    document.head.appendChild(script);\n    // Set initialized flag\n    analyticsInitialized = true;\n};\n/**\n * Track widget open event\n */\nexport const trackWidgetOpen = (userId) => {\n    trackEvent(AnalyticsEventType.WIDGET_OPEN, userId);\n};\n/**\n * Track widget close event\n */\nexport const trackWidgetClose = (userId) => {\n    trackEvent(AnalyticsEventType.WIDGET_CLOSE, userId);\n};\n/**\n * Track message sent event\n */\nexport const trackMessageSent = (userId, text) => {\n    trackEvent(AnalyticsEventType.MESSAGE_SENT, userId, { text });\n};\n/**\n * Track item view event\n */\nexport const trackItemView = (userId, itemId) => {\n    trackEvent(AnalyticsEventType.ITEM_VIEW, userId, { itemId });\n};\n/**\n * Track item feedback event\n */\nexport const trackItemFeedback = (userId, itemId, liked) => {\n    trackEvent(liked ? AnalyticsEventType.ITEM_LIKE : AnalyticsEventType.ITEM_DISLIKE, userId, { itemId });\n};\n/**\n * Track outfit save event\n */\nexport const trackOutfitSave = (userId, outfitId) => {\n    trackEvent(AnalyticsEventType.OUTFIT_SAVE, userId, { outfitId });\n};\n/**\n * Track style quiz events\n */\nexport const trackStyleQuizStart = (userId) => {\n    trackEvent(AnalyticsEventType.STYLE_QUIZ_START, userId);\n};\nexport const trackStyleQuizComplete = (userId) => {\n    trackEvent(AnalyticsEventType.STYLE_QUIZ_COMPLETE, userId);\n};\nexport const trackStyleQuizAbandon = (userId) => {\n    trackEvent(AnalyticsEventType.STYLE_QUIZ_ABANDON, userId);\n};\n/**\n * Track error events\n */\nexport const trackError = (userId, errorMessage, errorCode) => {\n    trackEvent(AnalyticsEventType.ERROR, userId, {\n        errorMessage,\n        errorCode\n    });\n};\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\n// src/components/ChatWidget/ChatWidget.tsx (enhanced implementation)\nimport React, { useEffect, useState, useCallback, lazy, useRef } from 'react';\nimport './ChatWidget.scss';\nimport ChatHeader from '@/components/ChatHeader';\nimport ChatBody from '@/components/ChatBody';\nimport ChatInput from '@/components/ChatInput';\nimport { useChatStore, useUserStore, useRecommendationStore } from '@/store/index';\nimport { useFeedbackStore } from '@/store/feedbackStore';\nimport { MessageSender, MessageType } from '@/types/index';\nimport { createStylistApi } from '@/api/index';\nimport { ChatService } from '@/services/chatService';\nimport { AnalyticsEventType, trackEvent } from '@/utils/analytics';\nimport { getUserId } from '@/utils/localStorage';\nimport AsyncComponentLoader from '@/components/common/AsyncComponentLoader';\nimport { USE_LAZY_LOADING, USE_PARALLEL_INIT } from '@/index';\n// Initialize widget lifecycle log\nconsole.log('[LIFECYCLE:ChatWidget] Module load started');\n// Import non-lazy versions for fallback\nimport TryOnModalRegular from '@/components/TryOnModal';\nimport StyleQuizModalRegular from '@/components/StyleQuiz/StyleQuizModal';\nimport LookbookRegular from '@/components/Lookbook';\n// Create lazy-loaded versions with fallbacks to non-lazy versions\nconst TryOnModalLazy = lazy(() => {\n    console.log('[LIFECYCLE:ChatWidget] TryOnModalLazy import starting');\n    return import('@/components/TryOnModal')\n        .then(module => {\n        console.log('[LIFECYCLE:ChatWidget] TryOnModalLazy successfully loaded');\n        return module;\n    })\n        .catch(error => {\n        console.error('[LIFECYCLE:ChatWidget] Failed to load TryOnModal component:', error);\n        return { default: TryOnModalRegular };\n    });\n});\nconst StyleQuizModalLazy = lazy(() => {\n    console.log('[LIFECYCLE:ChatWidget] StyleQuizModalLazy import starting');\n    return import('@/components/StyleQuiz/StyleQuizModal')\n        .then(module => {\n        console.log('[LIFECYCLE:ChatWidget] StyleQuizModalLazy successfully loaded');\n        return module;\n    })\n        .catch(error => {\n        console.error('[LIFECYCLE:ChatWidget] Failed to load StyleQuizModal component:', error);\n        return { default: StyleQuizModalRegular };\n    });\n});\nconst LookbookLazy = lazy(() => {\n    console.log('[LIFECYCLE:ChatWidget] LookbookLazy import starting');\n    return import('@/components/Lookbook')\n        .then(module => {\n        console.log('[LIFECYCLE:ChatWidget] LookbookLazy successfully loaded');\n        return module;\n    })\n        .catch(error => {\n        console.error('[LIFECYCLE:ChatWidget] Failed to load Lookbook component:', error);\n        return { default: LookbookRegular };\n    });\n});\nconst ChatWidget = ({ apiKey, retailerId, apiUrl, position = 'bottom-right', primaryColor = '#4361ee', greeting = \"Hi there! I'm your AI style assistant. How can I help you today?\", onFirstPaint }) => {\n    // Track initialization status with multiple safeguards\n    const [initialized, setInitialized] = useState(false);\n    const initializationAttemptedRef = useRef(false);\n    const [chatService, setChatService] = useState(null);\n    const [showStyleQuiz, setShowStyleQuiz] = useState(false);\n    // Get state and actions from stores\n    const { messages, isOpen, isMinimized, isLoading, currentView, addTextMessage, addMessage, setLoading, setError, setCurrentView } = useChatStore();\n    const { user, setUser, addLikedItem, addDislikedItem } = useUserStore();\n    const { recommendedItems, recommendedOutfits, savedOutfits, setRecommendedItems, setRecommendedOutfits, addToWishlist, addToCart, saveOutfit } = useRecommendationStore();\n    // Use our feedback store for user feedback\n    const { addMessageThumbsUp } = useFeedbackStore();\n    // Create API client\n    const api = createStylistApi({\n        apiKey,\n        retailerId,\n        apiUrl\n    });\n    // Initialize user profile with useCallback to avoid dependency issues\n    const initializeUser = useCallback(() => __awaiter(void 0, void 0, void 0, function* () {\n        console.log('[LIFECYCLE:ChatWidget] initializeUser starting');\n        try {\n            // Show loading indicator\n            setLoading(true);\n            // Get user ID from localStorage or create a new one\n            const userId = getUserId();\n            console.log('[LIFECYCLE:ChatWidget] Got user ID:', userId);\n            // Get or create user profile\n            let userProfile;\n            try {\n                console.log('[LIFECYCLE:ChatWidget] Attempting to get existing user profile');\n                // Try to get existing user profile\n                userProfile = yield api.user.getUserProfile(userId);\n                console.log('[LIFECYCLE:ChatWidget] Found existing user profile');\n            }\n            catch (e) {\n                console.log('[LIFECYCLE:ChatWidget] No existing profile found, creating new user');\n                // Create a new user profile if not found\n                userProfile = yield api.user.createUser();\n                console.log('[LIFECYCLE:ChatWidget] New user profile created');\n            }\n            // Store user profile in state\n            console.log('[LIFECYCLE:ChatWidget] Setting user profile in store');\n            setUser(userProfile);\n            // Send greeting message\n            if (greeting) {\n                console.log('[LIFECYCLE:ChatWidget] Sending greeting message');\n                addTextMessage(greeting, 'assistant');\n                // Add follow-up message with options\n                console.log('[LIFECYCLE:ChatWidget] Setting timeout for follow-up message (1200ms)');\n                yield new Promise(resolve => setTimeout(resolve, 1200));\n                console.log('[LIFECYCLE:ChatWidget] Sending follow-up message');\n                addTextMessage(\"I can help you with:\\n Finding clothes that match your style\\n Creating complete outfits\\n Virtual try-ons\\n\\nTo get started, would you like to take our quick style quiz or see some recommended items?\", 'assistant');\n            }\n            // Track widget open event\n            console.log('[LIFECYCLE:ChatWidget] Tracking widget open event');\n            trackEvent(AnalyticsEventType.WIDGET_OPEN, userProfile.userId);\n            // For optimized initialization, we'll defer recommendation fetching until after first paint\n            if (USE_PARALLEL_INIT) {\n                console.log('[LIFECYCLE:ChatWidget] Using parallel init, fetching recommendations immediately');\n                // Original behavior: fetch immediately\n                yield fetchInitialRecommendations(userProfile.userId);\n            }\n            else {\n                console.log('[LIFECYCLE:ChatWidget] Using optimized init, deferring recommendation fetch');\n                // Optimized behavior: record initialization data for later\n                // Use type assertion to ensure TypeScript is happy\n                window.__STYLIST_PENDING_INITIALIZATIONS = Object.assign(Object.assign({}, (window.__STYLIST_PENDING_INITIALIZATIONS || {})), { recommendations: {\n                        userId: userProfile.userId\n                    } });\n            }\n            console.log('[LIFECYCLE:ChatWidget] initializeUser completed successfully');\n        }\n        catch (error) {\n            console.error('[LIFECYCLE:ChatWidget] Error initializing user:', error);\n            setError('Sorry, I had trouble connecting. Please try again later.');\n            addTextMessage('Sorry, I had trouble connecting. Please try again later.', 'system');\n        }\n        finally {\n            setLoading(false);\n            console.log('[LIFECYCLE:ChatWidget] initializeUser finished (loading set to false)');\n        }\n    }), [api, greeting, addTextMessage, setUser, setLoading, setError]);\n    // Separated recommendation fetching into its own function for deferred execution\n    const fetchInitialRecommendations = (userId) => __awaiter(void 0, void 0, void 0, function* () {\n        var _a, _b;\n        console.log('[LIFECYCLE:ChatWidget] fetchInitialRecommendations starting for user:', userId);\n        if (recommendedItems.length > 0) {\n            console.log('[LIFECYCLE:ChatWidget] Skipping recommendation fetch - items already loaded');\n            return; // Skip if we already have items\n        }\n        try {\n            console.log('[LIFECYCLE:ChatWidget] Fetching recommendations from API');\n            const recommendations = yield api.recommendation.getRecommendations({\n                userId,\n                limit: 6\n            });\n            console.log('[LIFECYCLE:ChatWidget] Recommendations received:', ((_a = recommendations.items) === null || _a === void 0 ? void 0 : _a.length) || 0, 'items', ((_b = recommendations.outfits) === null || _b === void 0 ? void 0 : _b.length) || 0, 'outfits');\n            // Convert items to proper format\n            console.log('[LIFECYCLE:ChatWidget] Converting recommendation items to proper format');\n            const convertedItems = recommendations.items.map(item => ({\n                id: item.id,\n                retailerId: 'default',\n                name: item.name,\n                brand: item.brand,\n                category: item.category,\n                price: item.price,\n                salePrice: item.salePrice,\n                colors: [],\n                sizes: [],\n                imageUrls: [item.imageUrls[0] || ''],\n                url: item.url,\n                matchScore: item.matchScore,\n                matchReasons: item.matchReasons,\n                inStock: true\n            }));\n            console.log('[LIFECYCLE:ChatWidget] Setting recommendedItems in store');\n            setRecommendedItems(convertedItems);\n            // Convert outfits if available\n            if (recommendations.outfits && recommendations.outfits.length > 0) {\n                console.log('[LIFECYCLE:ChatWidget] Converting recommendation outfits to proper format');\n                const convertedOutfits = recommendations.outfits.map(outfit => ({\n                    id: outfit.id,\n                    name: outfit.name || '',\n                    occasion: outfit.occasion,\n                    matchScore: outfit.matchScore,\n                    matchReasons: outfit.matchReasons,\n                    items: outfit.items.map(item => ({\n                        id: item.id,\n                        retailerId: 'default',\n                        name: item.name,\n                        brand: item.brand,\n                        category: item.category,\n                        price: item.price,\n                        salePrice: item.salePrice,\n                        colors: [],\n                        sizes: [],\n                        imageUrls: [item.imageUrls[0] || ''],\n                        url: item.url,\n                        matchScore: item.matchScore,\n                        matchReasons: item.matchReasons,\n                        inStock: true\n                    }))\n                }));\n                console.log('[LIFECYCLE:ChatWidget] Setting recommendedOutfits in store');\n                setRecommendedOutfits(convertedOutfits);\n            }\n            console.log('[LIFECYCLE:ChatWidget] fetchInitialRecommendations completed successfully');\n        }\n        catch (error) {\n            console.error('[LIFECYCLE:ChatWidget] Error fetching initial recommendations:', error);\n            // Silently fail - we'll show recommendations when the user asks for them\n        }\n    });\n    // Flag to track if first paint was registered\n    const [hasRegisteredFirstPaint, setHasRegisteredFirstPaint] = useState(false);\n    const firstPaintTimeoutRef = useRef(null);\n    const hasFiredFirstPaintRef = useRef(false);\n    // Initialize user and send greeting, with additional safeguards\n    useEffect(() => {\n        console.log('[LIFECYCLE:ChatWidget] Initialization effect running', {\n            initialized,\n            globallyInitialized: window.__STYLIST_CHAT_INITIALIZED === true,\n            attemptedRef: initializationAttemptedRef.current\n        });\n        // Global/window initialization check\n        const isGloballyInitialized = window.__STYLIST_CHAT_INITIALIZED === true;\n        // Skip if either local or global init has happened\n        if (initialized || isGloballyInitialized || initializationAttemptedRef.current) {\n            console.log('[LIFECYCLE:ChatWidget] Initialization skipped - already initialized');\n            return;\n        }\n        // Mark initialization attempted BEFORE async operation\n        initializationAttemptedRef.current = true;\n        console.log('[LIFECYCLE:ChatWidget] Starting user initialization');\n        // Mark as globally initialized to prevent duplicate initialization\n        window.__STYLIST_CHAT_INITIALIZED = true;\n        // Set a safety timeout to ensure widget doesn't get stuck if initialization hangs\n        console.log('[LIFECYCLE:ChatWidget] Setting initialization safety timeout (10s)');\n        const safetyTimeout = setTimeout(() => {\n            if (!initialized) {\n                console.warn('[LIFECYCLE:ChatWidget] Initialization timed out after 10s, forcing completion');\n                setInitialized(true);\n            }\n        }, 10000); // 10 second safety timeout\n        // Run initialization and update state\n        console.log('[LIFECYCLE:ChatWidget] Calling initializeUser()');\n        initializeUser().then(() => {\n            clearTimeout(safetyTimeout);\n            console.log('[LIFECYCLE:ChatWidget] initializeUser resolved successfully');\n            setInitialized(true);\n            console.log('[LIFECYCLE:ChatWidget] Initialization marked as complete');\n            // After initialization is complete, set up the first paint timer\n            // This ensures first paint event happens after base UI renders\n            if (!USE_PARALLEL_INIT && !hasFiredFirstPaintRef.current) {\n                console.log('[LIFECYCLE:ChatWidget] Setting up first paint timer (100ms)');\n                firstPaintTimeoutRef.current = setTimeout(() => {\n                    if (!hasFiredFirstPaintRef.current) {\n                        console.log('[LIFECYCLE:ChatWidget] First paint timer fired, triggering callback');\n                        // Trigger first paint event\n                        triggerFirstPaint();\n                    }\n                }, 100); // Short timeout to allow render to complete\n            }\n        }).catch(error => {\n            clearTimeout(safetyTimeout);\n            console.error('[LIFECYCLE:ChatWidget] Initialization error:', error);\n            // Still mark as initialized to prevent retry loops\n            setInitialized(true);\n            console.log('[LIFECYCLE:ChatWidget] Initialization marked as complete despite error');\n        });\n        // Clean up timeout if component unmounts\n        return () => {\n            console.log('[LIFECYCLE:ChatWidget] Cleaning up initialization timeouts');\n            clearTimeout(safetyTimeout);\n            if (firstPaintTimeoutRef.current) {\n                clearTimeout(firstPaintTimeoutRef.current);\n            }\n        };\n    }, [initialized, initializeUser]);\n    // Function to trigger first paint event and load background items\n    const triggerFirstPaint = () => {\n        var _a;\n        console.log('[LIFECYCLE:ChatWidget] triggerFirstPaint called', {\n            alreadyFired: hasFiredFirstPaintRef.current\n        });\n        if (hasFiredFirstPaintRef.current) {\n            console.log('[LIFECYCLE:ChatWidget] First paint already triggered, skipping');\n            return;\n        }\n        console.log('[LIFECYCLE:ChatWidget] Marking first paint as fired');\n        hasFiredFirstPaintRef.current = true;\n        setHasRegisteredFirstPaint(true);\n        // Call the callback if available\n        if (typeof onFirstPaint === 'function') {\n            console.log('[LIFECYCLE:ChatWidget] Calling onFirstPaint callback');\n            onFirstPaint();\n        }\n        // If we're in optimized initialization mode, start background tasks\n        if (!USE_PARALLEL_INIT && window.__STYLIST_PENDING_INITIALIZATIONS) {\n            console.log('[LIFECYCLE:ChatWidget] Using optimized init, checking for pending initializations');\n            // Load recommendations in background after short delay\n            if ((_a = window.__STYLIST_PENDING_INITIALIZATIONS) === null || _a === void 0 ? void 0 : _a.recommendations) {\n                const { userId } = window.__STYLIST_PENDING_INITIALIZATIONS.recommendations;\n                console.log('[LIFECYCLE:ChatWidget] Setting timeout for background recommendation fetch (1.5s)');\n                setTimeout(() => {\n                    console.log('[LIFECYCLE:ChatWidget] Background recommendation timeout fired');\n                    fetchInitialRecommendations(userId);\n                }, 1500); // 1.5s delay to ensure UI is responsive\n            }\n            // Add any other background tasks here\n        }\n        else {\n            console.log('[LIFECYCLE:ChatWidget] No pending initializations to process');\n        }\n    };\n    // Check for global flags and handle events for the widget\n    useEffect(() => {\n        console.log('[LIFECYCLE:ChatWidget] Global flags and events effect running');\n        // Function to handle style quiz opening\n        const handleStyleQuizOpen = () => {\n            console.log('[LIFECYCLE:ChatWidget] Opening style quiz via global flag or event');\n            setShowStyleQuiz(true);\n        };\n        // Function to handle virtual try-on opening\n        const handleVirtualTryOnOpen = () => {\n            console.log('[LIFECYCLE:ChatWidget] Virtual try-on opening requested');\n            // Open the try-on modal\n            if (recommendedItems.length > 0) {\n                console.log('[LIFECYCLE:ChatWidget] Recommended items available for try-on:', recommendedItems.length);\n                // Auto-select the first item for try-on\n                const item = recommendedItems[0];\n                try {\n                    // Open try-on modal with the first item\n                    console.log('[LIFECYCLE:ChatWidget] Opening try-on with item:', item.id);\n                    addTextMessage(`Let's see how ${item.name} looks on you!`, 'assistant');\n                }\n                catch (error) {\n                    console.error('[LIFECYCLE:ChatWidget] Error opening virtual try-on:', error);\n                }\n            }\n            else {\n                console.log('[LIFECYCLE:ChatWidget] Cannot open virtual try-on - no recommended items available');\n            }\n        };\n        // Initial check for global flags on component mount\n        console.log('[LIFECYCLE:ChatWidget] Checking for global style quiz flag:', !!window.__StylistShowStyleQuiz);\n        if (window.__StylistShowStyleQuiz) {\n            handleStyleQuizOpen();\n            // Don't reset the flag, it could be needed by other components\n        }\n        console.log('[LIFECYCLE:ChatWidget] Checking for global try-on flag:', !!window.__StylistShowVirtualTryOn);\n        if (window.__StylistShowVirtualTryOn) {\n            handleVirtualTryOnOpen();\n            // Don't reset the flag, it could be needed by other components\n        }\n        // Set up event listeners if the event system is available\n        const hasEvents = !!window.__StylistWidgetEvents;\n        console.log('[LIFECYCLE:ChatWidget] Checking for widget events:', hasEvents);\n        if (hasEvents) {\n            console.log('[LIFECYCLE:ChatWidget] Setting up event listeners');\n            window.__StylistWidgetEvents.on('styleQuiz:open', handleStyleQuizOpen);\n            window.__StylistWidgetEvents.on('virtualTryOn:open', handleVirtualTryOnOpen);\n            // Clean up on unmount\n            return () => {\n                console.log('[LIFECYCLE:ChatWidget] Removing event listeners');\n                window.__StylistWidgetEvents.off('styleQuiz:open', handleStyleQuizOpen);\n                window.__StylistWidgetEvents.off('virtualTryOn:open', handleVirtualTryOnOpen);\n            };\n        }\n    }, [recommendedItems, addTextMessage]);\n    // Initialize chat service when user is loaded\n    useEffect(() => {\n        console.log('[LIFECYCLE:ChatWidget] Chat service initialization effect running', {\n            userExists: !!user,\n            apiExists: !!api\n        });\n        if (user && api) {\n            console.log('[LIFECYCLE:ChatWidget] Creating chat service for user:', user.userId);\n            setChatService(new ChatService(api.recommendation, user.userId));\n            console.log('[LIFECYCLE:ChatWidget] Chat service created');\n        }\n    }, [user, api]);\n    // Inject CSS variables for theme colors\n    useEffect(() => {\n        if (primaryColor) {\n            document.documentElement.style.setProperty('--stylist-primary-color', primaryColor);\n            // Generate lighter and darker variants\n            document.documentElement.style.setProperty('--stylist-primary-color-light', lightenColor(primaryColor, 0.2));\n            document.documentElement.style.setProperty('--stylist-primary-color-dark', darkenColor(primaryColor, 0.2));\n        }\n    }, [primaryColor]);\n    // Helper function to lighten a color\n    const lightenColor = (color, amount) => {\n        try {\n            // Remove the # if present\n            color = color.replace('#', '');\n            // Parse the color\n            const r = parseInt(color.substring(0, 2), 16);\n            const g = parseInt(color.substring(2, 4), 16);\n            const b = parseInt(color.substring(4, 6), 16);\n            // Lighten each component\n            const newR = Math.min(255, Math.floor(r + (255 - r) * amount));\n            const newG = Math.min(255, Math.floor(g + (255 - g) * amount));\n            const newB = Math.min(255, Math.floor(b + (255 - b) * amount));\n            // Convert back to hex\n            return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;\n        }\n        catch (_a) {\n            return color;\n        }\n    };\n    // Helper function to darken a color\n    const darkenColor = (color, amount) => {\n        try {\n            // Remove the # if present\n            color = color.replace('#', '');\n            // Parse the color\n            const r = parseInt(color.substring(0, 2), 16);\n            const g = parseInt(color.substring(2, 4), 16);\n            const b = parseInt(color.substring(4, 6), 16);\n            // Darken each component\n            const newR = Math.max(0, Math.floor(r * (1 - amount)));\n            const newG = Math.max(0, Math.floor(g * (1 - amount)));\n            const newB = Math.max(0, Math.floor(b * (1 - amount)));\n            // Convert back to hex\n            return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;\n        }\n        catch (_a) {\n            return color;\n        }\n    };\n    // Handle sending a message\n    const handleSendMessage = (text) => __awaiter(void 0, void 0, void 0, function* () {\n        // Add user message to chat\n        addTextMessage(text, 'user');\n        if (!user || !chatService)\n            return;\n        // Start loading state\n        setLoading(true);\n        // Handle specific commands\n        const lowerText = text.toLowerCase();\n        // Handle \"show lookbook\" command\n        if (lowerText.includes('lookbook') ||\n            lowerText.includes('show recommendations') ||\n            lowerText.includes('show items')) {\n            yield new Promise(resolve => setTimeout(resolve, 500));\n            addTextMessage('Here\\'s your lookbook with all recommended items and outfits!', 'assistant');\n            setCurrentView('lookbook');\n            setLoading(false);\n            return;\n        }\n        // Handle \"back to chat\" command\n        if (lowerText.includes('back to chat') ||\n            lowerText.includes('return to chat')) {\n            yield new Promise(resolve => setTimeout(resolve, 500));\n            addTextMessage('Switching back to chat view. How else can I help you?', 'assistant');\n            setCurrentView('chat');\n            setLoading(false);\n            return;\n        }\n        // Handle style quiz command\n        if (lowerText.includes('quiz') ||\n            lowerText.includes('style profile') ||\n            lowerText.includes('preferences')) {\n            yield new Promise(resolve => setTimeout(resolve, 500));\n            addTextMessage('Let\\'s find out more about your style preferences! Please answer a few quick questions.', 'assistant');\n            // Track quiz start event\n            if (user) {\n                trackEvent(AnalyticsEventType.STYLE_QUIZ_START, user.userId);\n            }\n            setShowStyleQuiz(true);\n            setLoading(false);\n            return;\n        }\n        try {\n            // Process the message with chat service\n            const responses = yield chatService.processMessage(text);\n            // Add responses to the chat with slight delays for a more natural conversation\n            for (let i = 0; i < responses.length; i++) {\n                // Add a small delay between messages\n                if (i > 0) {\n                    yield new Promise(resolve => setTimeout(resolve, 800));\n                }\n                const response = responses[i];\n                // Add message to chat\n                addMessage(response);\n                // If it's a recommendation, store it\n                if (response.type === 'recommendation') {\n                    // Convert from Chat.RecommendationItem to Recommendation.RecommendationItem\n                    const convertedItems = response.items.map(item => ({\n                        id: item.id,\n                        retailerId: 'default',\n                        name: item.name,\n                        brand: item.brand,\n                        category: item.category,\n                        price: item.price,\n                        salePrice: item.salePrice,\n                        colors: [],\n                        sizes: [],\n                        imageUrls: [item.imageUrl || ''],\n                        url: item.url,\n                        matchScore: item.matchScore,\n                        matchReasons: item.matchReasons,\n                        inStock: true\n                    }));\n                    setRecommendedItems(convertedItems);\n                }\n                // If it's an outfit, store it\n                if (response.type === 'outfit') {\n                    // Convert from Chat.Outfit to Recommendation.Outfit\n                    const convertedOutfit = {\n                        id: response.outfit.id,\n                        name: response.outfit.name,\n                        occasion: response.outfit.occasion,\n                        matchScore: response.outfit.matchScore,\n                        matchReasons: response.outfit.matchReasons,\n                        // Convert all items in the outfit\n                        items: response.outfit.items.map(item => ({\n                            id: item.id,\n                            retailerId: 'default',\n                            name: item.name,\n                            brand: item.brand,\n                            category: item.category,\n                            price: item.price,\n                            salePrice: item.salePrice,\n                            colors: [],\n                            sizes: [],\n                            imageUrls: [item.imageUrl || ''],\n                            url: item.url,\n                            matchScore: item.matchScore,\n                            matchReasons: item.matchReasons,\n                            inStock: true\n                        }))\n                    };\n                    // Check if we already have this outfit\n                    const outfitExists = recommendedOutfits.some(outfit => outfit.id === convertedOutfit.id);\n                    if (!outfitExists) {\n                        setRecommendedOutfits([...recommendedOutfits, convertedOutfit]);\n                    }\n                }\n            }\n        }\n        catch (error) {\n            console.error('Error processing message:', error);\n            setError(error instanceof Error ? error.message : String(error));\n            addTextMessage('Sorry, I encountered an error while processing your request. Please try again.', 'system');\n        }\n        finally {\n            // End loading state\n            setLoading(false);\n        }\n    });\n    // Handle item feedback\n    const handleItemFeedback = (itemId, liked) => __awaiter(void 0, void 0, void 0, function* () {\n        if (!user)\n            return;\n        try {\n            if (liked) {\n                addLikedItem(itemId);\n                trackEvent(AnalyticsEventType.ITEM_LIKE, user.userId, { itemId });\n            }\n            else {\n                addDislikedItem(itemId);\n                trackEvent(AnalyticsEventType.ITEM_DISLIKE, user.userId, { itemId });\n            }\n            // Submit feedback to API\n            yield api.recommendation.addItemFeedback({\n                userId: user.userId,\n                itemId,\n                liked,\n                timestamp: new Date()\n            });\n            // Add feedback confirmation message if in chat view\n            if (currentView === 'chat' && liked) {\n                addTextMessage('Great! I\\'ve noted that you like this item. I\\'ll keep this in mind for future recommendations.', MessageSender.ASSISTANT);\n            }\n        }\n        catch (error) {\n            console.error('Error submitting item feedback:', error);\n            setError('Failed to save your feedback. Please try again.');\n        }\n    });\n    // Handle outfit feedback\n    const handleOutfitFeedback = (outfitId, liked) => __awaiter(void 0, void 0, void 0, function* () {\n        if (!user)\n            return;\n        try {\n            trackEvent(liked ? AnalyticsEventType.OUTFIT_LIKE : AnalyticsEventType.OUTFIT_DISLIKE, user.userId, { outfitId });\n            // Submit feedback to API\n            yield api.recommendation.addOutfitFeedback({\n                userId: user.userId,\n                outfitId,\n                liked,\n                timestamp: new Date()\n            });\n            // Provide feedback confirmation if in chat view\n            if (currentView === 'chat' && liked) {\n                addTextMessage('Great! I\\'m glad you like this outfit. I\\'ll remember your preference for future recommendations.', 'assistant');\n            }\n        }\n        catch (error) {\n            console.error('Error submitting outfit feedback:', error);\n            setError('Failed to save your feedback. Please try again.');\n        }\n    });\n    // Handle assistant message feedback (thumbs up)\n    const handleMessageFeedback = (messageId, helpful) => __awaiter(void 0, void 0, void 0, function* () {\n        if (!user || !helpful)\n            return; // We only handle \"helpful\" feedback for now\n        try {\n            // Add to feedback store\n            addMessageThumbsUp(messageId);\n            // Track the event\n            trackEvent(AnalyticsEventType.MESSAGE_THUMBS_UP, user.userId, { messageId });\n            // You could also send this feedback to the backend if needed\n            // await api.recommendation.addMessageFeedback({\n            //   userId: user.userId,\n            //   messageId,\n            //   helpful,\n            //   timestamp: new Date()\n            // });\n            // No response needed as the thumbs up component will show its own feedback\n        }\n        catch (error) {\n            console.error('Error saving message feedback:', error);\n            // Silently fail - local storage will still have the feedback\n        }\n    });\n    // Handle adding item to wishlist\n    const handleAddToWishlist = (item) => {\n        if (!user)\n            return;\n        try {\n            addToWishlist({\n                itemId: item.id,\n                retailerId,\n                addedAt: new Date()\n            });\n            if (currentView === 'chat') {\n                addTextMessage(`I've added ${item.name} to your wishlist!`, 'assistant');\n            }\n            trackEvent(AnalyticsEventType.ADD_TO_WISHLIST, user.userId, { itemId: item.id });\n        }\n        catch (error) {\n            console.error('Error adding to wishlist:', error);\n            setError('Failed to add item to wishlist. Please try again.');\n        }\n    };\n    // Handle adding item to cart\n    const handleAddToCart = (item, quantity = 1, size, color) => {\n        if (!user)\n            return;\n        try {\n            // Add to cart in state\n            addToCart({\n                itemId: item.id,\n                retailerId,\n                quantity,\n                size,\n                color,\n                addedAt: new Date()\n            });\n            // Track purchase for bot-driven sales analytics\n            import('@/services/purchaseTrackingService').then(({ purchaseTrackingService }) => {\n                purchaseTrackingService.trackPurchase({\n                    productId: item.id,\n                    source: 'StylistBot',\n                    timestamp: new Date(),\n                    userId: user.userId,\n                    retailerId\n                });\n            });\n            if (currentView === 'chat') {\n                addTextMessage(`I've added ${item.name} to your shopping cart!`, 'assistant');\n            }\n            trackEvent(AnalyticsEventType.ADD_TO_CART, user.userId, {\n                itemId: item.id,\n                quantity,\n                size,\n                color\n            });\n        }\n        catch (error) {\n            console.error('Error adding to cart:', error);\n            setError('Failed to add item to cart. Please try again.');\n        }\n    };\n    // Handle saving an outfit\n    const handleSaveOutfit = (outfit) => {\n        if (!user)\n            return;\n        try {\n            saveOutfit({\n                outfitId: outfit.id,\n                userId: user.userId,\n                name: outfit.name || `Outfit for ${outfit.occasion}`,\n                items: outfit.items.map(item => item.id),\n                savedAt: new Date(),\n            });\n            if (currentView === 'chat') {\n                addTextMessage(`I've saved this outfit to your lookbook!`, 'assistant');\n            }\n            trackEvent(AnalyticsEventType.OUTFIT_SAVE, user.userId, { outfitId: outfit.id });\n        }\n        catch (error) {\n            console.error('Error saving outfit:', error);\n            setError('Failed to save outfit. Please try again.');\n        }\n    };\n    // Handle style quiz submission\n    const handleQuizSubmit = (answers) => __awaiter(void 0, void 0, void 0, function* () {\n        if (!user)\n            return;\n        try {\n            setLoading(true);\n            // Check if all questions have been answered\n            const TOTAL_QUESTIONS = 25; // We have 25 questions in our quiz\n            if (answers.length < TOTAL_QUESTIONS) {\n                // There are unanswered questions\n                const answeredQuestionIds = answers.map(a => a.questionId);\n                const unansweredQuestions = Array.from({ length: TOTAL_QUESTIONS }, (_, i) => `q${i + 1}`)\n                    .filter(qId => !answeredQuestionIds.includes(qId));\n                // Show warning but allow submission\n                console.warn(`Some questions are unanswered: ${unansweredQuestions.join(', ')}`);\n                // We'll proceed anyway, but log the warning\n                trackEvent(AnalyticsEventType.STYLE_QUIZ_PARTIAL, user.userId, {\n                    unansweredCount: unansweredQuestions.length\n                });\n            }\n            // Clear any saved progress from local storage\n            try {\n                localStorage.removeItem('stylist_quiz_progress_style-quiz-1');\n            }\n            catch (e) {\n                console.error('Error clearing quiz progress:', e);\n            }\n            // Submit quiz answers to API\n            try {\n                yield api.user.submitStyleQuiz(user.userId, answers);\n            }\n            catch (error) {\n                console.error('Error submitting style quiz:', error);\n                // Show error but don't return yet - we have fallback behavior\n                setError('There was an issue saving your style preferences, but we can still provide recommendations.');\n            }\n            // Close quiz modal\n            setShowStyleQuiz(false);\n            // Add confirmation message\n            addTextMessage('Thanks for completing the style quiz! I now have a better understanding of your preferences. Let me show you some recommendations based on your style profile.', 'assistant');\n            // Get recommendations based on updated profile\n            let recommendations;\n            try {\n                recommendations = yield api.recommendation.getRecommendations({\n                    userId: user.userId,\n                    limit: 4,\n                    includeOutfits: true\n                });\n            }\n            catch (error) {\n                console.error('Error fetching recommendations:', error);\n                setError('Sorry, there was an issue getting your personalized recommendations.');\n                setLoading(false);\n                return;\n            }\n            // Add recommendation message\n            yield new Promise(resolve => setTimeout(resolve, 1000));\n            // Cast to appropriate message type to fix type error\n            addMessage({\n                type: MessageType.RECOMMENDATION,\n                sender: MessageSender.ASSISTANT,\n                items: recommendations.items\n            });\n            // Convert items from Chat to Recommendation format\n            // Using type assertion to avoid type errors during build\n            const convertedItems = recommendations.items.map(item => ({\n                id: item.id,\n                retailerId: 'default',\n                name: item.name,\n                brand: item.brand,\n                category: item.category,\n                price: item.price,\n                salePrice: item.salePrice,\n                colors: [],\n                sizes: [],\n                imageUrls: [item.imageUrl || ''],\n                url: item.url,\n                matchScore: item.matchScore,\n                matchReasons: item.matchReasons,\n                inStock: true\n            }));\n            // Store recommendations\n            setRecommendedItems(convertedItems);\n            // Add outfit if available\n            if (recommendations.outfits && recommendations.outfits.length > 0) {\n                yield new Promise(resolve => setTimeout(resolve, 1000));\n                addTextMessage('I\\'ve also created a complete outfit based on your style:', 'assistant');\n                yield new Promise(resolve => setTimeout(resolve, 500));\n                // Cast to appropriate message type to fix type error\n                addMessage({\n                    type: MessageType.OUTFIT,\n                    sender: MessageSender.ASSISTANT,\n                    outfit: recommendations.outfits[0]\n                });\n                // Convert outfit from Chat to Recommendation format\n                // Using type assertion to avoid type errors during build\n                const convertedOutfits = recommendations.outfits.map(outfit => ({\n                    id: outfit.id,\n                    name: outfit.name,\n                    occasion: outfit.occasion,\n                    matchScore: outfit.matchScore,\n                    matchReasons: outfit.matchReasons,\n                    // Convert all items in the outfit\n                    // Type is already asserted in the parent map function\n                    items: outfit.items.map(item => ({\n                        id: item.id,\n                        retailerId: 'default',\n                        name: item.name,\n                        brand: item.brand,\n                        category: item.category,\n                        price: item.price,\n                        salePrice: item.salePrice,\n                        colors: [],\n                        sizes: [],\n                        imageUrls: [item.imageUrl || ''],\n                        url: item.url,\n                        matchScore: item.matchScore,\n                        matchReasons: item.matchReasons,\n                        inStock: true\n                    }))\n                }));\n                // Store outfits\n                setRecommendedOutfits(convertedOutfits);\n            }\n            // Track quiz completion\n            trackEvent(AnalyticsEventType.STYLE_QUIZ_COMPLETE, user.userId);\n            // Suggest viewing the lookbook\n            yield new Promise(resolve => setTimeout(resolve, 1000));\n            addTextMessage('You can see all your recommendations in your lookbook. Would you like to view it now?', 'assistant');\n        }\n        catch (error) {\n            console.error('Unexpected error processing quiz:', error);\n            setError('Failed to process the style quiz. Please try again later.');\n            // Close quiz modal\n            setShowStyleQuiz(false);\n        }\n        finally {\n            setLoading(false);\n        }\n    });\n    // Handle try-on result save\n    const handleTryOnSave = (resultUrl) => {\n        if (!user)\n            return;\n        // Track event\n        trackEvent(AnalyticsEventType.TRY_ON_SAVED, user.userId, { resultUrl });\n        // Add a message with the try-on result\n        addTextMessage('Great! I\\'ve saved your virtual try-on. How does it look?', 'assistant');\n    };\n    // Handle switching views\n    const handleSwitchView = (view) => {\n        // Use the store's setCurrentView instead of local state\n        setCurrentView(view);\n        if (view === 'lookbook') {\n            trackEvent(AnalyticsEventType.VIEW_LOOKBOOK, (user === null || user === void 0 ? void 0 : user.userId) || 'anonymous');\n        }\n    };\n    // Widget position classes\n    const positionClasses = {\n        'bottom-right': 'stylist-chat-widget--bottom-right',\n        'bottom-left': 'stylist-chat-widget--bottom-left',\n        'top-right': 'stylist-chat-widget--top-right',\n        'top-left': 'stylist-chat-widget--top-left'\n    };\n    if (!isOpen)\n        return null;\n    const widgetClasses = `stylist-chat-widget ${positionClasses[position]} ${isMinimized ? 'stylist-chat-widget--minimized' : ''}`;\n    // Determine if we should show the non-essential components based on init strategy\n    const shouldRenderNonEssentialComponents = () => {\n        // In parallel init mode (original), always render everything\n        if (USE_PARALLEL_INIT) {\n            return true;\n        }\n        // In optimized mode, only render after first paint is registered\n        return hasRegisteredFirstPaint || hasFiredFirstPaintRef.current;\n    };\n    // Use React.useEffect with an empty dependency array to trigger first paint\n    // This will run after the component has rendered once\n    useEffect(() => {\n        // If no first paint callback has been triggered yet, trigger it now\n        if (!USE_PARALLEL_INIT && !hasFiredFirstPaintRef.current) {\n            // Very short timeout to ensure we trigger after paint\n            setTimeout(triggerFirstPaint, 0);\n        }\n    }, []);\n    return (_jsxs(_Fragment, { children: [_jsxs(\"div\", Object.assign({ className: widgetClasses, \"data-testid\": \"stylist-chat-widget\" }, { children: [_jsx(ChatHeader, { title: currentView === 'chat' ? \"The Stylist\" : \"Your Lookbook\", primaryColor: primaryColor, onSwitchView: handleSwitchView, currentView: currentView }), _jsx(\"div\", Object.assign({ className: \"stylist-chat-widget__content\" }, { children: currentView === 'chat' ? (_jsxs(_Fragment, { children: [_jsx(ChatBody, { messages: messages, onItemFeedback: handleItemFeedback, onOutfitFeedback: handleOutfitFeedback, onMessageFeedback: handleMessageFeedback, onAddToWishlist: handleAddToWishlist, onAddToCart: handleAddToCart, isLoading: isLoading, primaryColor: primaryColor }), _jsx(ChatInput, { onSendMessage: handleSendMessage, placeholder: \"Type your question here...\", disabled: isLoading, primaryColor: primaryColor })] })) : (\n                        // Only render lookbook if essential or after first paint\n                        shouldRenderNonEssentialComponents() ? (_jsxs(_Fragment, { children: [console.log('[LIFECYCLE:ChatWidget] Rendering Lookbook with AsyncComponentLoader'), _jsx(React.Suspense, Object.assign({ fallback: _jsxs(\"div\", Object.assign({ className: \"stylist-loading-container\" }, { children: [_jsx(\"div\", { className: \"stylist-loading-spinner\" }), _jsx(\"p\", { children: \"Loading lookbook...\" })] })) }, { children: _jsxs(AsyncComponentLoader, Object.assign({ loadingMessage: \"Loading lookbook...\", onLoadStart: () => console.log('[LIFECYCLE:ChatWidget] Lookbook loader starting'), onLoadComplete: () => console.log('[LIFECYCLE:ChatWidget] Lookbook loader completed'), onLoadError: (error) => console.error('[LIFECYCLE:ChatWidget] Lookbook loading error:', error) }, { children: [(() => {\n                                                console.log('[LIFECYCLE:ChatWidget] Before Lookbook render, using lazy:', USE_LAZY_LOADING);\n                                                return null;\n                                            })(), USE_LAZY_LOADING ? (_jsx(LookbookLazy, { items: recommendedItems, outfits: recommendedOutfits, savedOutfits: savedOutfits, onItemFeedback: handleItemFeedback, onOutfitFeedback: handleOutfitFeedback, onAddToWishlist: handleAddToWishlist, onAddToCart: handleAddToCart, onSaveOutfit: handleSaveOutfit, primaryColor: primaryColor })) : (_jsx(LookbookRegular, { items: recommendedItems, outfits: recommendedOutfits, savedOutfits: savedOutfits, onItemFeedback: handleItemFeedback, onOutfitFeedback: handleOutfitFeedback, onAddToWishlist: handleAddToWishlist, onAddToCart: handleAddToCart, onSaveOutfit: handleSaveOutfit, primaryColor: primaryColor })), (() => {\n                                                console.log('[LIFECYCLE:ChatWidget] After Lookbook render');\n                                                return null;\n                                            })()] })) }))] })) : (\n                        // Show loading placeholder before first paint\n                        _jsxs(_Fragment, { children: [(() => {\n                                    console.log('[LIFECYCLE:ChatWidget] Showing lookbook loading placeholder (before first paint)');\n                                    return null;\n                                })(), _jsx(\"div\", Object.assign({ className: \"stylist-chat-widget__loading\" }, { children: _jsx(\"p\", { children: \"Initializing lookbook...\" }) }))] }))) }))] })), console.log('[LIFECYCLE:ChatWidget] Checking if non-essential components should render:', shouldRenderNonEssentialComponents()), shouldRenderNonEssentialComponents() && (_jsxs(_Fragment, { children: [console.log('[LIFECYCLE:ChatWidget] Rendering TryOnModal with AsyncComponentLoader'), _jsx(React.Suspense, Object.assign({ fallback: _jsxs(\"div\", Object.assign({ className: \"stylist-loading-container\" }, { children: [_jsx(\"div\", { className: \"stylist-loading-spinner\" }), _jsx(\"p\", { children: \"Loading virtual try-on...\" })] })) }, { children: _jsxs(AsyncComponentLoader, Object.assign({ loadingMessage: \"Loading virtual try-on...\", onLoadStart: () => console.log('[LIFECYCLE:ChatWidget] TryOnModal loader starting'), onLoadComplete: () => console.log('[LIFECYCLE:ChatWidget] TryOnModal loader completed'), onLoadError: (error) => console.error('[LIFECYCLE:ChatWidget] TryOnModal loading error:', error) }, { children: [(() => {\n                                    console.log('[LIFECYCLE:ChatWidget] Before TryOnModal render');\n                                    return null;\n                                })(), USE_LAZY_LOADING ? (_jsx(TryOnModalLazy, { onSave: handleTryOnSave })) : (_jsx(TryOnModalRegular, { onSave: handleTryOnSave })), (() => {\n                                    console.log('[LIFECYCLE:ChatWidget] After TryOnModal render');\n                                    return null;\n                                })()] })) })), (() => {\n                        console.log('[LIFECYCLE:ChatWidget] Checking if StyleQuizModal should render:', showStyleQuiz);\n                        return null;\n                    })(), showStyleQuiz && (_jsxs(_Fragment, { children: [(() => {\n                                console.log('[LIFECYCLE:ChatWidget] Rendering StyleQuizModal with AsyncComponentLoader');\n                                return null;\n                            })(), _jsx(React.Suspense, Object.assign({ fallback: _jsxs(\"div\", Object.assign({ className: \"stylist-loading-container\" }, { children: [_jsx(\"div\", { className: \"stylist-loading-spinner\" }), _jsx(\"p\", { children: \"Loading style quiz...\" })] })) }, { children: _jsxs(AsyncComponentLoader, Object.assign({ loadingMessage: \"Loading style quiz...\", onLoadStart: () => console.log('[LIFECYCLE:ChatWidget] StyleQuizModal loader starting'), onLoadComplete: () => console.log('[LIFECYCLE:ChatWidget] StyleQuizModal loader completed'), onLoadError: (error) => console.error('[LIFECYCLE:ChatWidget] StyleQuizModal loading error:', error) }, { children: [(() => {\n                                            console.log('[LIFECYCLE:ChatWidget] Before StyleQuizModal render');\n                                            return null;\n                                        })(), USE_LAZY_LOADING ? (_jsx(StyleQuizModalLazy, { onSubmit: handleQuizSubmit, onClose: () => setShowStyleQuiz(false), primaryColor: primaryColor })) : (_jsx(StyleQuizModalRegular, { onSubmit: handleQuizSubmit, onClose: () => setShowStyleQuiz(false), primaryColor: primaryColor })), (() => {\n                                            console.log('[LIFECYCLE:ChatWidget] After StyleQuizModal render');\n                                            return null;\n                                        })()] })) }))] }))] }))] }));\n};\nexport default ChatWidget;\n","import ChatWidget from './ChatWidget';\nexport default ChatWidget;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// Style quiz component for gathering user preferences\nimport { useState, useEffect } from 'react';\nimport './StyleQuiz.scss';\n// Comprehensive 25-question style quiz with additions for shoe size, accessory size, and brand preferences\nconst DEMO_QUESTIONS = [\n    // Overall Style\n    {\n        id: 'q1',\n        questionText: 'How would you describe your overall fashion style?',\n        type: 'image',\n        options: [\n            { id: 'classic', text: 'Classic & Timeless', value: 'classic', imageUrl: 'https://images.unsplash.com/photo-1603189343302-e603f7add05a?w=400&h=300&fit=crop' },\n            { id: 'minimalist', text: 'Minimalist & Clean', value: 'minimalist', imageUrl: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=400&h=300&fit=crop' },\n            { id: 'trendy', text: 'Trendy & Fashion-Forward', value: 'trendy', imageUrl: 'https://images.unsplash.com/photo-1523359346063-d879354c0ea5?w=400&h=300&fit=crop' },\n            { id: 'edgy', text: 'Edgy & Alternative', value: 'edgy', imageUrl: 'https://images.unsplash.com/photo-1536243298747-ea8874136d64?w=400&h=300&fit=crop' },\n            { id: 'sporty', text: 'Sporty & Casual', value: 'sporty', imageUrl: 'https://images.unsplash.com/photo-1517466787929-bc90951d0974?w=400&h=300&fit=crop' },\n            { id: 'bohemian', text: 'Bohemian & Free-Spirited', value: 'bohemian', imageUrl: 'https://images.unsplash.com/photo-1534777620591-29eb7d8d7563?w=400&h=300&fit=crop' }\n        ],\n        category: 'style'\n    },\n    // Color Palette\n    {\n        id: 'q2',\n        questionText: 'Which color palette do you prefer for your wardrobe?',\n        type: 'image',\n        options: [\n            { id: 'neutrals', text: 'Neutrals (Black, White, Grey, Beige)', value: 'neutrals', imageUrl: 'https://images.unsplash.com/photo-1518895949257-7621c3c786d7?w=400&h=300&fit=crop' },\n            { id: 'earthy', text: 'Earthy Tones (Brown, Olive, Rust)', value: 'earthy', imageUrl: 'https://images.unsplash.com/photo-1514362453360-8f94243c9996?w=400&h=300&fit=crop' },\n            { id: 'pastels', text: 'Pastels (Light Pink, Baby Blue, Lavender)', value: 'pastels', imageUrl: 'https://images.unsplash.com/photo-1499781350541-7783f6c6a0c8?w=400&h=300&fit=crop' },\n            { id: 'bold', text: 'Bold & Bright Colors (Red, Yellow, Electric Blue)', value: 'bold', imageUrl: 'https://images.unsplash.com/photo-1535639818669-c059d2f038e6?w=400&h=300&fit=crop' },\n            { id: 'monochrome', text: 'Monochrome or All-Black', value: 'monochrome', imageUrl: 'https://images.unsplash.com/photo-1550330550-36e5c4d9b0c3?w=400&h=300&fit=crop' }\n        ],\n        category: 'color'\n    },\n    // Occasion\n    {\n        id: 'q3',\n        questionText: 'What type of outfits do you need the most recommendations for?',\n        type: 'multiple',\n        options: [\n            { id: 'casual', text: 'Everyday Casual', value: 'casual' },\n            { id: 'work', text: 'Workwear & Business Casual', value: 'work' },\n            { id: 'street', text: 'Streetwear & Trendy Looks', value: 'street' },\n            { id: 'date', text: 'Date Night & Going Out', value: 'date' },\n            { id: 'formal', text: 'Formal & Special Events', value: 'formal' }\n        ],\n        category: 'occasion'\n    },\n    // Pattern Preference\n    {\n        id: 'q4',\n        questionText: 'Which patterns do you typically wear?',\n        type: 'multiple',\n        options: [\n            { id: 'solid', text: 'Solid Colors (No Pattern)', value: 'solid' },\n            { id: 'stripes', text: 'Stripes', value: 'stripes' },\n            { id: 'floral', text: 'Floral', value: 'floral' },\n            { id: 'geometric', text: 'Geometric', value: 'geometric' },\n            { id: 'animal', text: 'Animal Print', value: 'animal' },\n            { id: 'plaid', text: 'Plaid/Check', value: 'plaid' }\n        ],\n        category: 'pattern'\n    },\n    // Top Fit\n    {\n        id: 'q5',\n        questionText: 'How do you prefer your tops to fit?',\n        type: 'image',\n        options: [\n            { id: 'oversized', text: 'Oversized & Relaxed', value: 'oversized', imageUrl: 'https://images.unsplash.com/photo-1542837209-3bd9538b3a96?w=400&h=300&fit=crop' },\n            { id: 'fitted', text: 'Slim & Fitted', value: 'fitted', imageUrl: 'https://images.unsplash.com/photo-1570727624862-3008fe67a6f9?w=400&h=300&fit=crop' },\n            { id: 'cropped', text: 'Cropped', value: 'cropped', imageUrl: 'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=400&h=300&fit=crop' },\n            { id: 'structured', text: 'Boxy & Structured', value: 'structured', imageUrl: 'https://images.unsplash.com/photo-1603252109303-2751441dd157?w=400&h=300&fit=crop' }\n        ],\n        category: 'fit'\n    },\n    // Bottom Fit\n    {\n        id: 'q6',\n        questionText: 'How do you prefer your bottoms to fit?',\n        type: 'image',\n        options: [\n            { id: 'skinny', text: 'Skinny/Slim', value: 'skinny', imageUrl: 'https://images.unsplash.com/photo-1598808503824-9725718f223d?w=400&h=300&fit=crop' },\n            { id: 'relaxed', text: 'Relaxed/Regular', value: 'relaxed', imageUrl: 'https://images.unsplash.com/photo-1581985673473-0784a7a44e39?w=400&h=300&fit=crop' },\n            { id: 'wide', text: 'Wide Leg', value: 'wide', imageUrl: 'https://images.unsplash.com/photo-1593030103066-0093718efeb9?w=400&h=300&fit=crop' },\n            { id: 'straight', text: 'Straight Cut', value: 'straight', imageUrl: 'https://images.unsplash.com/photo-1582418702059-97ebafb35d09?w=400&h=300&fit=crop' }\n        ],\n        category: 'fit'\n    },\n    // Size Profiling\n    {\n        id: 'q7',\n        questionText: 'What size do you typically wear for tops?',\n        type: 'single',\n        options: [\n            { id: 'xs', text: 'XS', value: 'xs' },\n            { id: 's', text: 'S', value: 's' },\n            { id: 'm', text: 'M', value: 'm' },\n            { id: 'l', text: 'L', value: 'l' },\n            { id: 'xl', text: 'XL', value: 'xl' },\n            { id: 'xxl', text: 'XXL+', value: 'xxl' }\n        ],\n        category: 'size'\n    },\n    {\n        id: 'q8',\n        questionText: 'What size do you typically wear for bottoms/pants?',\n        type: 'single',\n        options: [\n            { id: '0-2', text: '0-2', value: '0-2' },\n            { id: '4-6', text: '4-6', value: '4-6' },\n            { id: '8-10', text: '8-10', value: '8-10' },\n            { id: '12-14', text: '12-14', value: '12-14' },\n            { id: '16-18', text: '16-18', value: '16-18' },\n            { id: '20+', text: '20+', value: '20+' }\n        ],\n        category: 'size'\n    },\n    // Budget Range\n    {\n        id: 'q9',\n        questionText: \"What's your typical budget for a single clothing item?\",\n        type: 'single',\n        options: [\n            { id: 'budget_low', text: 'Under $50', value: 'Under $50' },\n            { id: 'budget_medium_low', text: '$50 - $100', value: '$50 - $100' },\n            { id: 'budget_medium_high', text: '$100 - $250', value: '$100 - $250' },\n            { id: 'budget_high', text: '$250+', value: '$250+' }\n        ],\n        category: 'budget'\n    },\n    // Brand Preferences - Casual Wear\n    {\n        id: 'q10',\n        questionText: 'Which casual wear brands do you typically shop?',\n        type: 'multiple',\n        options: [\n            { id: 'zara', text: 'Zara', value: 'zara' },\n            { id: 'hm', text: 'H&M', value: 'hm' },\n            { id: 'uniqlo', text: 'Uniqlo', value: 'uniqlo' },\n            { id: 'gap', text: 'Gap', value: 'gap' },\n            { id: 'jcrew', text: 'J.Crew', value: 'jcrew' },\n            { id: 'madewell', text: 'Madewell', value: 'madewell' },\n            { id: 'everlane', text: 'Everlane', value: 'everlane' },\n            { id: 'aritzia', text: 'Aritzia', value: 'aritzia' },\n            { id: 'mango', text: 'Mango', value: 'mango' },\n            { id: 'urban', text: 'Urban Outfitters', value: 'urban' },\n            { id: 'abercrombie', text: 'Abercrombie & Fitch', value: 'abercrombie' },\n            { id: 'ae', text: 'American Eagle', value: 'ae' },\n            { id: 'other_casual', text: 'Other', value: 'other_casual' }\n        ],\n        category: 'brand'\n    },\n    // Brand Preferences - Athletic Wear\n    {\n        id: 'q10a',\n        questionText: 'Which athletic/athleisure brands do you prefer?',\n        type: 'multiple',\n        options: [\n            { id: 'nike', text: 'Nike', value: 'nike' },\n            { id: 'adidas', text: 'Adidas', value: 'adidas' },\n            { id: 'lululemon', text: 'Lululemon', value: 'lululemon' },\n            { id: 'athleta', text: 'Athleta', value: 'athleta' },\n            { id: 'under_armour', text: 'Under Armour', value: 'under_armour' },\n            { id: 'puma', text: 'Puma', value: 'puma' },\n            { id: 'alo', text: 'Alo Yoga', value: 'alo' },\n            { id: 'new_balance', text: 'New Balance', value: 'new_balance' },\n            { id: 'gymshark', text: 'Gymshark', value: 'gymshark' },\n            { id: 'fabletics', text: 'Fabletics', value: 'fabletics' },\n            { id: 'other_athletic', text: 'Other', value: 'other_athletic' }\n        ],\n        category: 'brand'\n    },\n    // Brand Preferences - Luxury\n    {\n        id: 'q10b',\n        questionText: 'Do you shop any luxury or designer brands?',\n        type: 'multiple',\n        options: [\n            { id: 'none', text: 'None/Not regularly', value: 'none' },\n            { id: 'coach', text: 'Coach', value: 'coach' },\n            { id: 'mk', text: 'Michael Kors', value: 'mk' },\n            { id: 'tory_burch', text: 'Tory Burch', value: 'tory_burch' },\n            { id: 'theory', text: 'Theory', value: 'theory' },\n            { id: 'allsaints', text: 'AllSaints', value: 'allsaints' },\n            { id: 'gucci', text: 'Gucci', value: 'gucci' },\n            { id: 'louis', text: 'Louis Vuitton', value: 'louis' },\n            { id: 'chanel', text: 'Chanel', value: 'chanel' },\n            { id: 'prada', text: 'Prada', value: 'prada' },\n            { id: 'burberry', text: 'Burberry', value: 'burberry' },\n            { id: 'other_luxury', text: 'Other', value: 'other_luxury' }\n        ],\n        category: 'brand'\n    },\n    // Celebrity Style Matching - Option 1\n    {\n        id: 'q11',\n        questionText: \"Which celebrity's style do you most admire? (Modern Icons)\",\n        type: 'image',\n        options: [\n            { id: 'zendaya', text: 'Zendaya (Fashion-Forward)', value: 'zendaya', imageUrl: 'https://www.fillmurray.com/400/301' },\n            { id: 'harry', text: 'Harry Styles (Bold & Eclectic)', value: 'harry', imageUrl: 'https://www.fillmurray.com/401/300' },\n            { id: 'rihanna', text: 'Rihanna (Trendsetter)', value: 'rihanna', imageUrl: 'https://www.fillmurray.com/401/302' },\n            { id: 'timothee', text: 'Timothe Chalamet (Modern Minimal)', value: 'timothee', imageUrl: 'https://www.fillmurray.com/400/302' },\n            { id: 'hailey', text: 'Hailey Bieber (Cool Girl)', value: 'hailey', imageUrl: 'https://www.fillmurray.com/402/301' },\n            { id: 'asap', text: 'A$AP Rocky (Streetwear)', value: 'asap', imageUrl: 'https://www.fillmurray.com/403/300' }\n        ],\n        category: 'inspiration'\n    },\n    // Celebrity Style Matching - Option 2\n    {\n        id: 'q11a',\n        questionText: \"Which celebrity's style do you most admire? (Classic Icons)\",\n        type: 'image',\n        options: [\n            { id: 'audrey', text: 'Audrey Hepburn (Timeless)', value: 'audrey', imageUrl: 'https://www.fillmurray.com/400/300' },\n            { id: 'jlo', text: 'Jennifer Lopez (Glamorous)', value: 'jlo', imageUrl: 'https://www.fillmurray.com/402/300' },\n            { id: 'beyonce', text: 'Beyonc (Bold & Confident)', value: 'beyonce', imageUrl: 'https://www.fillmurray.com/404/300' },\n            { id: 'pharrell', text: 'Pharrell Williams (Streetwear)', value: 'pharrell', imageUrl: 'https://www.fillmurray.com/401/301' },\n            { id: 'blake', text: 'Blake Lively (Classic Chic)', value: 'blake', imageUrl: 'https://www.fillmurray.com/403/302' },\n            { id: 'beckham', text: 'David Beckham (Polished)', value: 'beckham', imageUrl: 'https://www.fillmurray.com/405/300' }\n        ],\n        category: 'inspiration'\n    },\n    // Shoe Preferences\n    {\n        id: 'q12',\n        questionText: 'What types of shoes do you wear most often?',\n        type: 'multiple',\n        options: [\n            { id: 'sneakers', text: 'Sneakers', value: 'sneakers' },\n            { id: 'boots', text: 'Boots', value: 'boots' },\n            { id: 'flats', text: 'Flats/Loafers', value: 'flats' },\n            { id: 'heels', text: 'Heels', value: 'heels' },\n            { id: 'sandals', text: 'Sandals', value: 'sandals' },\n            { id: 'athletic', text: 'Athletic Shoes', value: 'athletic' }\n        ],\n        category: 'footwear'\n    },\n    // Shoe Size\n    {\n        id: 'q12a',\n        questionText: 'What shoe size do you typically wear?',\n        type: 'single',\n        options: [\n            { id: 'us5', text: 'US 5 / EU 35-36', value: 'us5' },\n            { id: 'us6', text: 'US 6 / EU 36-37', value: 'us6' },\n            { id: 'us7', text: 'US 7 / EU 37-38', value: 'us7' },\n            { id: 'us8', text: 'US 8 / EU 38-39', value: 'us8' },\n            { id: 'us9', text: 'US 9 / EU 39-40', value: 'us9' },\n            { id: 'us10', text: 'US 10 / EU 40-41', value: 'us10' },\n            { id: 'us11', text: 'US 11 / EU 41-42', value: 'us11' },\n            { id: 'us12', text: 'US 12+ / EU 42+', value: 'us12' }\n        ],\n        category: 'size'\n    },\n    // Accessory Preferences\n    {\n        id: 'q13',\n        questionText: 'Which accessories do you typically wear?',\n        type: 'multiple',\n        options: [\n            { id: 'none', text: 'Minimal/No Accessories', value: 'none' },\n            { id: 'earrings', text: 'Earrings', value: 'earrings' },\n            { id: 'necklaces', text: 'Necklaces', value: 'necklaces' },\n            { id: 'bracelets', text: 'Bracelets/Watches', value: 'bracelets' },\n            { id: 'rings', text: 'Rings', value: 'rings' },\n            { id: 'scarves', text: 'Scarves/Bandanas', value: 'scarves' },\n            { id: 'hats', text: 'Hats', value: 'hats' },\n            { id: 'belts', text: 'Belts', value: 'belts' }\n        ],\n        category: 'accessories'\n    },\n    // Accessory Sizes\n    {\n        id: 'q13a',\n        questionText: 'What sizes do you typically wear for accessories?',\n        type: 'multiple',\n        options: [\n            { id: 'bracelet_small', text: 'Bracelets: Small (6-7\")', value: 'bracelet_small' },\n            { id: 'bracelet_medium', text: 'Bracelets: Medium (7-8\")', value: 'bracelet_medium' },\n            { id: 'bracelet_large', text: 'Bracelets: Large (8\"+)', value: 'bracelet_large' },\n            { id: 'ring_small', text: 'Rings: Small (5-6)', value: 'ring_small' },\n            { id: 'ring_medium', text: 'Rings: Medium (7-8)', value: 'ring_medium' },\n            { id: 'ring_large', text: 'Rings: Large (9+)', value: 'ring_large' },\n            { id: 'hat_small', text: 'Hats: Small/Medium', value: 'hat_small' },\n            { id: 'hat_large', text: 'Hats: Large/XL', value: 'hat_large' },\n            { id: 'not_sure', text: 'Not sure / Varies', value: 'not_sure' }\n        ],\n        category: 'size'\n    },\n    // Seasonal Preference\n    {\n        id: 'q14',\n        questionText: 'Which season do you most enjoy dressing for?',\n        type: 'image',\n        options: [\n            { id: 'spring', text: 'Spring', value: 'spring', imageUrl: 'https://images.unsplash.com/photo-1497942304796-b8bc2cc898f3?w=400&h=300&fit=crop' },\n            { id: 'summer', text: 'Summer', value: 'summer', imageUrl: 'https://images.unsplash.com/photo-1517206577696-6ce38fb787a3?w=400&h=300&fit=crop' },\n            { id: 'fall', text: 'Fall/Autumn', value: 'fall', imageUrl: 'https://images.unsplash.com/photo-1551843073-4a9a5b6fcd5f?w=400&h=300&fit=crop' },\n            { id: 'winter', text: 'Winter', value: 'winter', imageUrl: 'https://images.unsplash.com/photo-1515311320503-6591cade8414?w=400&h=300&fit=crop' }\n        ],\n        category: 'seasonal'\n    },\n    // Layering Preference\n    {\n        id: 'q15',\n        questionText: 'How do you feel about layering clothes?',\n        type: 'single',\n        options: [\n            { id: 'love', text: 'Love it - the more layers the better', value: 'love' },\n            { id: 'sometimes', text: 'Sometimes - when appropriate for weather', value: 'sometimes' },\n            { id: 'minimal', text: 'Prefer minimal layers', value: 'minimal' },\n            { id: 'avoid', text: 'Avoid layering when possible', value: 'avoid' }\n        ],\n        category: 'styling'\n    },\n    // Shopping Frequency\n    {\n        id: 'q16',\n        questionText: 'How often do you shop for clothes?',\n        type: 'single',\n        options: [\n            { id: 'weekly', text: 'Weekly', value: 'weekly' },\n            { id: 'monthly', text: 'Monthly', value: 'monthly' },\n            { id: 'seasonally', text: 'Seasonally', value: 'seasonally' },\n            { id: 'rarely', text: 'Rarely/As needed', value: 'rarely' }\n        ],\n        category: 'shopping'\n    },\n    // Trend Interest\n    {\n        id: 'q17',\n        questionText: 'How do you approach fashion trends?',\n        type: 'single',\n        options: [\n            { id: 'early', text: 'Early adopter - always trying new trends', value: 'early' },\n            { id: 'selective', text: 'Selective - adopt trends that match my style', value: 'selective' },\n            { id: 'wait', text: 'Wait and see - adopt trends after they\\'re established', value: 'wait' },\n            { id: 'avoid', text: 'Avoid trends - prefer timeless styles', value: 'avoid' }\n        ],\n        category: 'styling'\n    },\n    // Comfort vs Style\n    {\n        id: 'q18',\n        questionText: 'When it comes to choosing clothes, you prioritize:',\n        type: 'slider',\n        minValue: 0,\n        maxValue: 100,\n        step: 1,\n        category: 'priorities'\n    },\n    // Sustainability\n    {\n        id: 'q19',\n        questionText: 'How important is sustainability in your clothing choices?',\n        type: 'single',\n        options: [\n            { id: 'very', text: 'Very important - I prioritize sustainable brands', value: 'very' },\n            { id: 'somewhat', text: 'Somewhat important - I consider it when convenient', value: 'somewhat' },\n            { id: 'neutral', text: 'Neutral - I don\\'t specifically seek it out', value: 'neutral' },\n            { id: 'not', text: 'Not important to me', value: 'not' }\n        ],\n        category: 'values'\n    },\n    // Secondhand Interest\n    {\n        id: 'q20',\n        questionText: 'Do you shop secondhand/vintage clothing?',\n        type: 'single',\n        options: [\n            { id: 'frequently', text: 'Frequently', value: 'frequently' },\n            { id: 'sometimes', text: 'Sometimes', value: 'sometimes' },\n            { id: 'rarely', text: 'Rarely', value: 'rarely' },\n            { id: 'never', text: 'Never', value: 'never' }\n        ],\n        category: 'shopping'\n    },\n    // Work Environment\n    {\n        id: 'q21',\n        questionText: 'What best describes your work environment dress code?',\n        type: 'single',\n        options: [\n            { id: 'formal', text: 'Formal/Business Professional', value: 'formal' },\n            { id: 'business', text: 'Business Casual', value: 'business' },\n            { id: 'casual', text: 'Casual', value: 'casual' },\n            { id: 'creative', text: 'Creative/No Dress Code', value: 'creative' },\n            { id: 'uniform', text: 'Uniform Required', value: 'uniform' },\n            { id: 'na', text: 'Not Applicable', value: 'na' }\n        ],\n        category: 'lifestyle'\n    },\n    // Active Lifestyle\n    {\n        id: 'q22',\n        questionText: 'How active is your lifestyle?',\n        type: 'single',\n        options: [\n            { id: 'very', text: 'Very active - I need clothes for frequent exercise', value: 'very' },\n            { id: 'moderately', text: 'Moderately active - occasional exercise', value: 'moderately' },\n            { id: 'somewhat', text: 'Somewhat active - light activity', value: 'somewhat' },\n            { id: 'not', text: 'Not very active', value: 'not' }\n        ],\n        category: 'lifestyle'\n    },\n    // Fabric Preferences\n    {\n        id: 'q23',\n        questionText: 'Which fabric types do you prefer?',\n        type: 'multiple',\n        options: [\n            { id: 'cotton', text: 'Cotton', value: 'cotton' },\n            { id: 'linen', text: 'Linen', value: 'linen' },\n            { id: 'silk', text: 'Silk', value: 'silk' },\n            { id: 'wool', text: 'Wool', value: 'wool' },\n            { id: 'synthetic', text: 'Synthetic/Technical Fabrics', value: 'synthetic' },\n            { id: 'leather', text: 'Leather', value: 'leather' },\n            { id: 'denim', text: 'Denim', value: 'denim' },\n            { id: 'knit', text: 'Knits', value: 'knit' }\n        ],\n        category: 'fabrics'\n    },\n    // Special Requirements\n    {\n        id: 'q24',\n        questionText: 'Do you have any special clothing requirements or preferences?',\n        type: 'multiple',\n        options: [\n            { id: 'none', text: 'None', value: 'none' },\n            { id: 'pockets', text: 'Must have pockets', value: 'pockets' },\n            { id: 'petite', text: 'Petite sizes', value: 'petite' },\n            { id: 'tall', text: 'Tall sizes', value: 'tall' },\n            { id: 'plus', text: 'Plus sizes', value: 'plus' },\n            { id: 'adaptable', text: 'Adaptable/Accessible clothing', value: 'adaptable' },\n            { id: 'allergy', text: 'Hypoallergenic fabrics', value: 'allergy' }\n        ],\n        category: 'requirements'\n    },\n    // Style Goal\n    {\n        id: 'q25',\n        questionText: \"What's your main style goal right now?\",\n        type: 'single',\n        options: [\n            { id: 'refresh', text: 'Refresh my everyday wardrobe', value: 'refresh' },\n            { id: 'special', text: 'Find outfits for special occasions', value: 'special' },\n            { id: 'transition', text: 'Transition to a new style', value: 'transition' },\n            { id: 'minimize', text: 'Build a capsule wardrobe', value: 'minimize' },\n            { id: 'experiment', text: 'Experiment with new styles', value: 'experiment' },\n            { id: 'confidence', text: 'Gain confidence in my clothing choices', value: 'confidence' }\n        ],\n        category: 'goals'\n    }\n];\nconst STORAGE_KEY = 'stylist_quiz_progress';\nconst StyleQuiz = ({ quizId, title, description, onSubmit, primaryColor }) => {\n    // Using DEMO_QUESTIONS directly, no need to update these\n    const [questions] = useState(DEMO_QUESTIONS);\n    // Try to load saved progress from localStorage\n    const loadSavedProgress = () => {\n        try {\n            const savedProgress = localStorage.getItem(`${STORAGE_KEY}_${quizId}`);\n            if (savedProgress) {\n                const progress = JSON.parse(savedProgress);\n                if (progress.answers && Array.isArray(progress.answers)) {\n                    return {\n                        currentQuestionIndex: progress.currentQuestion || 0,\n                        savedAnswers: progress.answers\n                    };\n                }\n            }\n        }\n        catch (e) {\n            console.error('Error loading saved quiz progress:', e);\n        }\n        return { currentQuestionIndex: 0, savedAnswers: [] };\n    };\n    const { currentQuestionIndex, savedAnswers } = loadSavedProgress();\n    const [currentQuestion, setCurrentQuestion] = useState(currentQuestionIndex);\n    const [answers, setAnswers] = useState(savedAnswers);\n    const [submitting, setSubmitting] = useState(false);\n    const [loading, setLoading] = useState(false);\n    // Save progress to localStorage whenever answers or current question changes\n    useEffect(() => {\n        try {\n            const progress = {\n                currentQuestion,\n                answers\n            };\n            localStorage.setItem(`${STORAGE_KEY}_${quizId}`, JSON.stringify(progress));\n        }\n        catch (e) {\n            console.error('Error saving quiz progress:', e);\n        }\n    }, [currentQuestion, answers, quizId]);\n    // In a real implementation, we would fetch questions from the API\n    // useEffect(() => {\n    //   const fetchQuestions = async () => {\n    //     try {\n    //       setLoading(true);\n    //       const response = await api.user.getStyleQuiz();\n    //       setQuestions(response);\n    //     } catch (error) {\n    //       console.error('Error fetching quiz questions:', error);\n    //     } finally {\n    //       setLoading(false);\n    //     }\n    //   };\n    //   \n    //   fetchQuestions();\n    // }, [quizId]);\n    // Track the quiz progress for analytics but don't trigger the actual submission\n    // We're passing progress to the parent for tracking purposes only\n    useEffect(() => {\n        // Skip empty answers array (initial render)\n        if (answers.length === 0)\n            return;\n        // Skip if we're submitting the final result\n        if (submitting)\n            return;\n        // Inform the parent component about answer updates (useful for tracking abandonment)\n        // The parent will decide whether to treat this as a real submission or just tracking\n        onSubmit(answers);\n    }, [answers, submitting, onSubmit]);\n    // Auto-move to next question for single & image options when selected\n    const handleOptionSelect = (questionId, optionId, type) => {\n        if (type === 'single' || type === 'image') {\n            handleSingleAnswer(questionId, optionId);\n            // For single/image selections, auto-advance to next question after short delay\n            if (currentQuestion < questions.length - 1) {\n                setTimeout(() => {\n                    setCurrentQuestion(currentQuestion + 1);\n                }, 300);\n            }\n        }\n    };\n    const handleSingleAnswer = (questionId, answerId) => {\n        const newAnswers = [...answers];\n        const existingIndex = answers.findIndex(a => a.questionId === questionId);\n        const answer = {\n            questionId,\n            answerId,\n            answered: new Date()\n        };\n        if (existingIndex >= 0) {\n            newAnswers[existingIndex] = answer;\n        }\n        else {\n            newAnswers.push(answer);\n        }\n        setAnswers(newAnswers);\n        // Note: Auto-advancing to next question is now handled in handleOptionSelect\n        // We don't automatically advance here to allow the Next button to work properly\n    };\n    const handleMultipleAnswer = (questionId, answerIds) => {\n        const newAnswers = [...answers];\n        const existingIndex = answers.findIndex(a => a.questionId === questionId);\n        const answer = {\n            questionId,\n            answerIds,\n            answered: new Date()\n        };\n        if (existingIndex >= 0) {\n            newAnswers[existingIndex] = answer;\n        }\n        else {\n            newAnswers.push(answer);\n        }\n        setAnswers(newAnswers);\n    };\n    const handleSliderAnswer = (questionId, value) => {\n        const newAnswers = [...answers];\n        const existingIndex = answers.findIndex(a => a.questionId === questionId);\n        const answer = {\n            questionId,\n            answerValue: value,\n            answered: new Date()\n        };\n        if (existingIndex >= 0) {\n            newAnswers[existingIndex] = answer;\n        }\n        else {\n            newAnswers.push(answer);\n        }\n        setAnswers(newAnswers);\n    };\n    const handleSubmit = () => {\n        if (submitting)\n            return; // Prevent double submission\n        setSubmitting(true);\n        onSubmit(answers);\n    };\n    // If loading show loading state\n    if (loading) {\n        return (_jsx(\"div\", Object.assign({ className: \"stylist-style-quiz stylist-style-quiz--loading\" }, { children: _jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__loader\" }, { children: \"Loading quiz...\" })) })));\n    }\n    if (questions.length === 0) {\n        return (_jsx(\"div\", Object.assign({ className: \"stylist-style-quiz stylist-style-quiz--error\" }, { children: _jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__error\" }, { children: \"Sorry, we couldn't load the style quiz. Please try again later.\" })) })));\n    }\n    const question = questions[currentQuestion];\n    const isLastQuestion = currentQuestion === questions.length - 1;\n    const renderQuestion = () => {\n        var _a, _b, _c;\n        if (!question)\n            return null;\n        // Get current answer for this question\n        const currentAnswer = answers.find(a => a.questionId === question.id);\n        switch (question.type) {\n            case 'single':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__options\" }, { children: (_a = question.options) === null || _a === void 0 ? void 0 : _a.map(option => (_jsx(\"button\", Object.assign({ className: `stylist-style-quiz__option ${(currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerId) === option.id ? 'stylist-style-quiz__option--selected' : ''}`, onClick: () => handleOptionSelect(question.id, option.id, 'single'), style: (currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerId) === option.id ? { borderColor: primaryColor, backgroundColor: `${primaryColor}20` } : undefined }, { children: option.text }), option.id))) })));\n            case 'image':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__image-options\" }, { children: (_b = question.options) === null || _b === void 0 ? void 0 : _b.map(option => (_jsxs(\"button\", Object.assign({ className: `stylist-style-quiz__image-option ${(currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerId) === option.id ? 'stylist-style-quiz__image-option--selected' : ''}`, onClick: () => handleOptionSelect(question.id, option.id, 'image'), style: (currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerId) === option.id ? { borderColor: primaryColor } : undefined }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__image-container\", style: {\n                                    backgroundImage: option.imageUrl ? `url(${option.imageUrl})` : undefined,\n                                } }, { children: !option.imageUrl && _jsx(\"div\", { className: \"stylist-style-quiz__image-placeholder\" }) })), _jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__image-label\", style: (currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerId) === option.id ? { color: primaryColor } : undefined }, { children: option.text }))] }), option.id))) })));\n            case 'multiple':\n                return (_jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__options\" }, { children: (_c = question.options) === null || _c === void 0 ? void 0 : _c.map(option => {\n                        var _a;\n                        const isSelected = (_a = currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerIds) === null || _a === void 0 ? void 0 : _a.includes(option.id);\n                        return (_jsx(\"button\", Object.assign({ className: `stylist-style-quiz__option ${isSelected ? 'stylist-style-quiz__option--selected' : ''}`, onClick: () => {\n                                const currentIds = (currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerIds) || [];\n                                const newIds = isSelected\n                                    ? currentIds.filter(id => id !== option.id)\n                                    : [...currentIds, option.id];\n                                handleMultipleAnswer(question.id, newIds);\n                            }, style: isSelected ? { borderColor: primaryColor, backgroundColor: `${primaryColor}20` } : undefined }, { children: option.text }), option.id));\n                    }) })));\n            case 'slider':\n                const getSliderLabels = (id) => {\n                    // Define labels based on question ID\n                    switch (id) {\n                        case 'q18': // Comfort vs Style priority\n                            return { left: 'Comfort', right: 'Style' };\n                        default:\n                            return { left: 'Low', right: 'High' };\n                    }\n                };\n                const labels = getSliderLabels(question.id);\n                return (_jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__slider\" }, { children: [_jsx(\"input\", { type: \"range\", min: question.minValue || 0, max: question.maxValue || 100, step: question.step || 1, value: (currentAnswer === null || currentAnswer === void 0 ? void 0 : currentAnswer.answerValue) || 50, onChange: (e) => handleSliderAnswer(question.id, parseInt(e.target.value)), style: { accentColor: primaryColor } }), _jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__slider-labels\" }, { children: [_jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__slider-label-left\" }, { children: labels.left })), _jsx(\"div\", Object.assign({ className: \"stylist-style-quiz__slider-label-right\" }, { children: labels.right }))] }))] })));\n            default:\n                return null;\n        }\n    };\n    // Function to check if the current question has been answered\n    const isCurrentQuestionAnswered = () => {\n        return !!answers.find(a => a.questionId === question.id);\n    };\n    // Function to handle going to the next question\n    const handleNextQuestion = () => {\n        var _a;\n        if (currentQuestion < questions.length - 1) {\n            // Animate the transition\n            (_a = document.querySelector('.stylist-style-quiz__question')) === null || _a === void 0 ? void 0 : _a.classList.add('fade-out');\n            setTimeout(() => {\n                var _a, _b;\n                setCurrentQuestion(currentQuestion + 1);\n                (_a = document.querySelector('.stylist-style-quiz__question')) === null || _a === void 0 ? void 0 : _a.classList.remove('fade-out');\n                (_b = document.querySelector('.stylist-style-quiz__question')) === null || _b === void 0 ? void 0 : _b.classList.add('fade-in');\n                setTimeout(() => {\n                    var _a;\n                    (_a = document.querySelector('.stylist-style-quiz__question')) === null || _a === void 0 ? void 0 : _a.classList.remove('fade-in');\n                }, 300);\n            }, 200);\n        }\n    };\n    // Function to handle going to the previous question\n    const handlePreviousQuestion = () => {\n        var _a;\n        if (currentQuestion > 0) {\n            // Animate the transition\n            (_a = document.querySelector('.stylist-style-quiz__question')) === null || _a === void 0 ? void 0 : _a.classList.add('fade-out');\n            setTimeout(() => {\n                var _a, _b;\n                setCurrentQuestion(currentQuestion - 1);\n                (_a = document.querySelector('.stylist-style-quiz__question')) === null || _a === void 0 ? void 0 : _a.classList.remove('fade-out');\n                (_b = document.querySelector('.stylist-style-quiz__question')) === null || _b === void 0 ? void 0 : _b.classList.add('fade-in');\n                setTimeout(() => {\n                    var _a;\n                    (_a = document.querySelector('.stylist-style-quiz__question')) === null || _a === void 0 ? void 0 : _a.classList.remove('fade-in');\n                }, 300);\n            }, 200);\n        }\n    };\n    // Calculate completion percentage\n    const completionPercentage = Math.round((answers.length / questions.length) * 100);\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__header\" }, { children: [_jsx(\"h3\", Object.assign({ className: \"stylist-style-quiz__title\" }, { children: title })), description && (_jsx(\"p\", Object.assign({ className: \"stylist-style-quiz__description\" }, { children: description })))] })), _jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__progress\" }, { children: [_jsx(\"div\", { className: \"stylist-style-quiz__progress-bar\", style: {\n                            width: `${((currentQuestion + 1) / questions.length) * 100}%`,\n                            backgroundColor: primaryColor\n                        } }), _jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__progress-text\" }, { children: [completionPercentage, \"% Complete\"] }))] })), _jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__question\" }, { children: [_jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__question-number\" }, { children: [\"Question \", currentQuestion + 1, \" of \", questions.length] })), _jsx(\"h4\", Object.assign({ className: \"stylist-style-quiz__question-text\" }, { children: question.questionText }))] })), renderQuestion(), _jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz__actions\" }, { children: [currentQuestion > 0 && (_jsx(\"button\", Object.assign({ className: \"stylist-style-quiz__button stylist-style-quiz__button--secondary\", onClick: handlePreviousQuestion }, { children: \"Previous\" }))), isLastQuestion ? (_jsx(\"button\", Object.assign({ className: \"stylist-style-quiz__button stylist-style-quiz__button--primary\", onClick: handleSubmit, style: { backgroundColor: primaryColor }, disabled: !isCurrentQuestionAnswered() || submitting }, { children: submitting ? 'Submitting...' : 'Complete Quiz' }))) : (_jsx(\"button\", Object.assign({ className: \"stylist-style-quiz__button stylist-style-quiz__button--primary\", onClick: handleNextQuestion, style: { backgroundColor: primaryColor }, disabled: !isCurrentQuestionAnswered() }, { children: \"Next\" })))] }))] })));\n};\nexport default StyleQuiz;\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n// src/components/StyleQuiz/StyleQuizModal.tsx\nimport { useState, useEffect } from 'react';\nimport './StyleQuizModal.scss';\nimport StyleQuiz from './StyleQuiz';\nimport { trackEvent, AnalyticsEventType } from '@/utils/analytics';\nimport { getUserId } from '@/utils/localStorage';\nimport useSyncedStore from '@/hooks/useSyncedStore';\nimport { useUserStore } from '@/store/userStore';\nconst StyleQuizModal = ({ onSubmit, onClose, primaryColor }) => {\n    // Store current answers to track abandonment\n    const [currentAnswers, setCurrentAnswers] = useState([]);\n    const [finalSubmission, setFinalSubmission] = useState(false);\n    // Get user and sync service\n    const userStore = useUserStore();\n    const syncedStore = useSyncedStore();\n    // Wrapped onSubmit to track answers before submitting\n    const handleSubmit = (answers) => {\n        setCurrentAnswers(answers);\n        // Only on final submission (from submit button) should we call the parent's onSubmit\n        if (answers.length === 25 || finalSubmission) {\n            setFinalSubmission(true);\n            // Submit through the synced store to ensure data is queued for sync\n            if (userStore.user) {\n                syncedStore.submitStyleQuiz(answers);\n            }\n            // Also pass to parent component for immediate UI updates\n            onSubmit(answers);\n        }\n    };\n    // Wrapped onClose to track abandonment\n    const handleClose = () => {\n        // If we have some answers but not a complete set, track as abandoned\n        if (currentAnswers.length > 0 && currentAnswers.length < 25) {\n            const userId = getUserId();\n            trackEvent(AnalyticsEventType.STYLE_QUIZ_ABANDON, userId, {\n                questionCount: 25,\n                answeredCount: currentAnswers.length,\n                completionRate: Math.round((currentAnswers.length / 25) * 100)\n            });\n        }\n        onClose();\n    };\n    // Handle escape key\n    useEffect(() => {\n        const handleEscapeKey = (e) => {\n            if (e.key === 'Escape') {\n                handleClose();\n            }\n        };\n        document.addEventListener('keydown', handleEscapeKey);\n        return () => {\n            document.removeEventListener('keydown', handleEscapeKey);\n        };\n    }, [onClose, currentAnswers]);\n    // Prevent body scrolling when modal is open\n    useEffect(() => {\n        document.body.style.overflow = 'hidden';\n        return () => {\n            document.body.style.overflow = '';\n        };\n    }, []);\n    return (_jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz-modal\" }, { children: [_jsx(\"div\", { className: \"stylist-style-quiz-modal__overlay\", onClick: handleClose }), _jsxs(\"div\", Object.assign({ className: \"stylist-style-quiz-modal__container\" }, { children: [_jsx(\"button\", { className: \"stylist-style-quiz-modal__close-button\", onClick: handleClose, \"aria-label\": \"Close style quiz\" }), _jsx(StyleQuiz, { quizId: \"style-quiz-1\", title: \"Your Style Profile\", description: \"Help us understand your fashion preferences to create personalized style recommendations just for you.\", onSubmit: handleSubmit, primaryColor: primaryColor })] }))] })));\n};\nexport default StyleQuizModal;\n","// Hook for automatically synchronizing store operations with backend\nimport { useEffect, useCallback } from 'react';\nimport { useUserStore } from '../store/userStore';\nimport useRecommendationStore from '../store/recommendationStore';\nimport { useSyncService } from '../services/syncService';\n/**\n * Hook that connects store operations to sync service\n * Ensures that changes to the store are synchronized with backend\n */\nexport const useSyncedStore = () => {\n    const userStore = useUserStore();\n    const recommendationStore = useRecommendationStore();\n    const syncService = useSyncService();\n    // Sync closet operations\n    const addToCloset = useCallback((item) => {\n        if (!userStore.user)\n            return;\n        // Add to local store first\n        const now = new Date();\n        const id = `item_${now.getTime()}_${Math.random().toString(36).substring(2, 9)}`;\n        const newItem = Object.assign(Object.assign({}, item), { id, dateAdded: now, favorite: item.favorite || false, tags: item.tags || [] });\n        userStore.addToCloset(newItem);\n        // Queue for syncing\n        syncService.addClosetItem(item, userStore.user.userId);\n    }, [userStore, syncService]);\n    const removeFromCloset = useCallback((itemId) => {\n        if (!userStore.user)\n            return;\n        // Update local store first\n        userStore.removeFromCloset(itemId);\n        // Queue for syncing\n        syncService.removeClosetItem(itemId, userStore.user.userId);\n    }, [userStore, syncService]);\n    const toggleItemFavorite = useCallback((itemId, favorite) => {\n        if (!userStore.user)\n            return;\n        // Update local store first\n        userStore.toggleItemFavorite(itemId, favorite);\n        // Queue for syncing\n        syncService.toggleFavorite(itemId, favorite, userStore.user.userId);\n    }, [userStore, syncService]);\n    // Sync user preferences\n    const updatePreferences = useCallback((preferences) => {\n        if (!userStore.user)\n            return;\n        // Update local store first\n        userStore.updateUser({\n            preferences: Object.assign(Object.assign({}, userStore.user.preferences), preferences)\n        });\n        // Queue for syncing\n        syncService.updatePreferences(preferences, userStore.user.userId);\n    }, [userStore, syncService]);\n    // Sync quiz results\n    const submitStyleQuiz = useCallback((answers) => {\n        if (!userStore.user)\n            return;\n        // Submit to server (store update will happen when results are returned)\n        syncService.submitQuiz(answers, userStore.user.userId);\n    }, [userStore, syncService]);\n    // Sync feedback data\n    const addLikedItem = useCallback((itemId) => {\n        if (!userStore.user)\n            return;\n        // Update local store first\n        userStore.addLikedItem(itemId);\n        // No need to queue this specifically, it will be synced with full profile\n    }, [userStore]);\n    const addDislikedItem = useCallback((itemId) => {\n        if (!userStore.user)\n            return;\n        // Update local store first\n        userStore.addDislikedItem(itemId);\n        // No need to queue this specifically, it will be synced with full profile\n    }, [userStore]);\n    const saveOutfit = useCallback((outfit) => {\n        if (!userStore.user)\n            return;\n        // Add to local recommendation store\n        recommendationStore.saveOutfit(outfit);\n        // Queue for syncing\n        syncService.saveOutfit(outfit, userStore.user.userId);\n    }, [userStore, recommendationStore, syncService]);\n    const removeSavedOutfit = useCallback((outfitId) => {\n        if (!userStore.user)\n            return;\n        // Remove from local recommendation store\n        recommendationStore.removeSavedOutfit(outfitId);\n        // Queue for syncing\n        syncService.removeOutfit(outfitId, userStore.user.userId);\n    }, [userStore, recommendationStore, syncService]);\n    // Initial sync when component mounts\n    useEffect(() => {\n        if (userStore.user) {\n            syncService.syncNow();\n        }\n    }, [userStore.user, syncService]);\n    // Return wrapped functions that handle both local state and sync\n    return {\n        // Sync status\n        syncState: syncService.state,\n        syncNow: syncService.syncNow,\n        // Closet operations\n        addToCloset,\n        removeFromCloset,\n        toggleItemFavorite,\n        // Preference operations\n        updatePreferences,\n        // Quiz operations\n        submitStyleQuiz,\n        // Feedback operations\n        addLikedItem,\n        addDislikedItem,\n        // Outfit operations\n        saveOutfit,\n        removeSavedOutfit\n    };\n};\nexport default useSyncedStore;\n","// Diagnostics logging system for Stylist Widget\nimport { useEffect } from 'react';\n// Configuration\nconst LOG_DIAGNOSTICS = process.env.LOG_DIAGNOSTICS !== 'false';\nconst LOG_PATH = process.env.LOG_PATH || './logs';\nconst LOG_FILE = process.env.LOG_FILE || 'diagnostics.log.json';\nconst MAX_LOG_ENTRIES = 1000;\n// Log entry types\nexport var LogEntryType;\n(function (LogEntryType) {\n    LogEntryType[\"COMPONENT_MOUNT\"] = \"COMPONENT_MOUNT\";\n    LogEntryType[\"COMPONENT_UNMOUNT\"] = \"COMPONENT_UNMOUNT\";\n    LogEntryType[\"COMPONENT_RENDER\"] = \"COMPONENT_RENDER\";\n    LogEntryType[\"COMPONENT_ERROR\"] = \"COMPONENT_ERROR\";\n    LogEntryType[\"SUSPENSE_FALLBACK\"] = \"SUSPENSE_FALLBACK\";\n    LogEntryType[\"SUSPENSE_RESOLVED\"] = \"SUSPENSE_RESOLVED\";\n    LogEntryType[\"LAZY_LOAD_START\"] = \"LAZY_LOAD_START\";\n    LogEntryType[\"LAZY_LOAD_COMPLETE\"] = \"LAZY_LOAD_COMPLETE\";\n    LogEntryType[\"LAZY_LOAD_ERROR\"] = \"LAZY_LOAD_ERROR\";\n    LogEntryType[\"HOOK_INIT\"] = \"HOOK_INIT\";\n    LogEntryType[\"EFFECT_START\"] = \"EFFECT_START\";\n    LogEntryType[\"EFFECT_COMPLETE\"] = \"EFFECT_COMPLETE\";\n    LogEntryType[\"EFFECT_CLEANUP\"] = \"EFFECT_CLEANUP\";\n    LogEntryType[\"STORE_INIT\"] = \"STORE_INIT\";\n    LogEntryType[\"STORE_UPDATE\"] = \"STORE_UPDATE\";\n    LogEntryType[\"STORE_SUBSCRIPTION\"] = \"STORE_SUBSCRIPTION\";\n    LogEntryType[\"ERROR_BOUNDARY\"] = \"ERROR_BOUNDARY\";\n    LogEntryType[\"GLOBAL_FLAG\"] = \"GLOBAL_FLAG\";\n    LogEntryType[\"PERFORMANCE_MARK\"] = \"PERFORMANCE_MARK\";\n    LogEntryType[\"APPLICATION_ERROR\"] = \"APPLICATION_ERROR\";\n    LogEntryType[\"CUSTOM\"] = \"CUSTOM\";\n})(LogEntryType || (LogEntryType = {}));\n// Log level enum\nexport var LogLevel;\n(function (LogLevel) {\n    LogLevel[\"DEBUG\"] = \"DEBUG\";\n    LogLevel[\"INFO\"] = \"INFO\";\n    LogLevel[\"WARNING\"] = \"WARNING\";\n    LogLevel[\"ERROR\"] = \"ERROR\";\n    LogLevel[\"CRITICAL\"] = \"CRITICAL\";\n})(LogLevel || (LogLevel = {}));\n// In-memory log storage\nlet inMemoryLog = [];\n// Ensure we're in a browser environment before using window\nconst isBrowser = typeof window !== 'undefined';\n// Initialize the in-memory log on load\nif (isBrowser) {\n    // Store the original console methods\n    const originalConsole = {\n        log: console.log,\n        warn: console.warn,\n        error: console.error,\n        info: console.info,\n        debug: console.debug,\n    };\n    // Add the diagnostics log to the window for debug access\n    window.__STYLIST_DIAGNOSTICS = {\n        logs: inMemoryLog,\n        enabled: LOG_DIAGNOSTICS,\n        originalConsole,\n    };\n}\n/**\n * Adds a diagnostic log entry\n */\nexport const logDiagnostic = (type, message, options = {}) => {\n    if (!LOG_DIAGNOSTICS)\n        return;\n    const { level = LogLevel.INFO, component, data, stack, } = options;\n    const entry = {\n        timestamp: new Date().toISOString(),\n        type,\n        level,\n        message,\n        component,\n        data,\n        stack,\n    };\n    // Add to in-memory log with size limitation\n    inMemoryLog.push(entry);\n    if (inMemoryLog.length > MAX_LOG_ENTRIES) {\n        inMemoryLog = inMemoryLog.slice(-MAX_LOG_ENTRIES);\n    }\n    // Log to console in development with special formatting\n    if (process.env.NODE_ENV === 'development') {\n        const logObject = Object.assign({ type, component: component || 'global', message }, (data ? { data } : {}));\n        console.log(`%c DIAGNOSTICS %c ${type} %c ${component || 'global'} `, 'background: #6610f2; color: white; border-radius: 3px 0 0 3px;', 'background: #fd7e14; color: white;', 'background: #17a2b8; color: white; border-radius: 0 3px 3px 0;', logObject);\n    }\n    // In browser environment, we can't write to disk directly\n    // Instead, we'll signal to any Node.js process reading our logs\n    // that we have new logs via special console output\n    if (process.env.NODE_ENV === 'development') {\n        // Output a special marker that can be picked up by diagnose.js\n        console.log(`__STYLIST_DIAGNOSTIC_LOG_ENTRY__:${JSON.stringify(entry)}`);\n    }\n    // In browser environment, if window.__STYLIST_DIAGNOSTICS_LOG_TO_TEMP is set,\n    // also log to localStorage as a fallback\n    if (isBrowser && window.__STYLIST_DIAGNOSTICS_LOG_TO_TEMP) {\n        try {\n            const storedLogs = localStorage.getItem('__STYLIST_DIAGNOSTICS_LOGS') || '[]';\n            const parsedLogs = JSON.parse(storedLogs);\n            parsedLogs.push(entry);\n            // Limit size\n            const limitedLogs = parsedLogs.slice(-MAX_LOG_ENTRIES);\n            localStorage.setItem('__STYLIST_DIAGNOSTICS_LOGS', JSON.stringify(limitedLogs));\n        }\n        catch (error) {\n            // Silently fail if localStorage is not available\n        }\n    }\n};\n/**\n * Log component rendering lifecycle\n */\nexport const logComponentRender = (component, stage, message, data) => {\n    const typeMap = {\n        mount: LogEntryType.COMPONENT_MOUNT,\n        render: LogEntryType.COMPONENT_RENDER,\n        update: LogEntryType.COMPONENT_RENDER,\n        unmount: LogEntryType.COMPONENT_UNMOUNT,\n        error: LogEntryType.COMPONENT_ERROR,\n        init: LogEntryType.COMPONENT_MOUNT,\n        action: LogEntryType.CUSTOM,\n        debug: LogEntryType.CUSTOM,\n        warning: LogEntryType.CUSTOM, // Warnings are custom\n    };\n    const levelMap = {\n        mount: LogLevel.INFO,\n        render: LogLevel.DEBUG,\n        update: LogLevel.DEBUG,\n        unmount: LogLevel.INFO,\n        error: LogLevel.ERROR,\n        init: LogLevel.INFO,\n        action: LogLevel.INFO,\n        debug: LogLevel.DEBUG,\n        warning: LogLevel.WARNING, // Warnings are warning level\n    };\n    logDiagnostic(typeMap[stage], message, {\n        level: levelMap[stage],\n        component,\n        data,\n    });\n};\n/**\n * Log suspense lifecycle\n */\nexport const logSuspense = (component, state, message, data) => {\n    const type = state === 'fallback'\n        ? LogEntryType.SUSPENSE_FALLBACK\n        : LogEntryType.SUSPENSE_RESOLVED;\n    logDiagnostic(type, message, {\n        component,\n        data,\n    });\n};\n/**\n * Log lazy loading lifecycle\n */\nexport const logLazyLoad = (component, stage, message, data) => {\n    const typeMap = {\n        start: LogEntryType.LAZY_LOAD_START,\n        complete: LogEntryType.LAZY_LOAD_COMPLETE,\n        error: LogEntryType.LAZY_LOAD_ERROR,\n    };\n    const levelMap = {\n        start: LogLevel.INFO,\n        complete: LogLevel.INFO,\n        error: LogLevel.ERROR,\n    };\n    logDiagnostic(typeMap[stage], message, {\n        level: levelMap[stage],\n        component,\n        data,\n    });\n};\n/**\n * Log React hook lifecycle\n */\nexport const logHook = (component, hook, stage, message, data) => {\n    let type = LogEntryType.HOOK_INIT;\n    if (stage === 'update') {\n        type = LogEntryType.EFFECT_START;\n    }\n    else if (stage === 'cleanup') {\n        type = LogEntryType.EFFECT_CLEANUP;\n    }\n    logDiagnostic(type, message, {\n        component,\n        data: Object.assign({ hook }, data),\n    });\n};\n/**\n * Log store operations\n */\nexport const logStore = (store, operation, message, data) => {\n    const typeMap = {\n        init: LogEntryType.STORE_INIT,\n        update: LogEntryType.STORE_UPDATE,\n        subscribe: LogEntryType.STORE_SUBSCRIPTION,\n        unsubscribe: LogEntryType.STORE_SUBSCRIPTION,\n    };\n    logDiagnostic(typeMap[operation], message, {\n        component: store,\n        data: Object.assign({ operation }, data),\n    });\n};\n/**\n * Log error boundary activations\n */\nexport const logErrorBoundary = (component, error, info) => {\n    logDiagnostic(LogEntryType.ERROR_BOUNDARY, `Error boundary triggered in ${component}`, {\n        level: LogLevel.ERROR,\n        component,\n        data: {\n            errorMessage: error.message,\n            componentStack: info === null || info === void 0 ? void 0 : info.componentStack,\n        },\n        stack: error.stack,\n    });\n};\n/**\n * Log global flag changes\n */\nexport const logGlobalFlag = (flag, value, message, data) => {\n    logDiagnostic(LogEntryType.GLOBAL_FLAG, message, {\n        data: Object.assign({ flag,\n            value }, (data || {})),\n    });\n};\n/**\n * Log performance mark\n */\nexport const logPerformance = (name, duration, data) => {\n    logDiagnostic(LogEntryType.PERFORMANCE_MARK, `Performance: ${name}`, {\n        data: Object.assign({ name,\n            duration }, data),\n    });\n};\n/**\n * React hook for component lifecycle logging\n */\nexport const useDiagnosticLifecycle = (componentName) => {\n    useEffect(() => {\n        // Component mounted\n        logComponentRender(componentName, 'mount', `${componentName} mounted`);\n        // Component will unmount\n        return () => {\n            logComponentRender(componentName, 'unmount', `${componentName} unmounted`);\n        };\n    }, [componentName]);\n};\n/**\n * Get all diagnostic logs\n */\nexport const getDiagnosticLogs = () => {\n    // First check in-memory logs\n    if (inMemoryLog.length > 0) {\n        return [...inMemoryLog];\n    }\n    // If we're in the browser, check localStorage\n    if (isBrowser) {\n        try {\n            const storedLogs = localStorage.getItem('__STYLIST_DIAGNOSTICS_LOGS');\n            if (storedLogs) {\n                return JSON.parse(storedLogs);\n            }\n        }\n        catch (error) {\n            console.error('Error retrieving logs from localStorage:', error);\n        }\n    }\n    // In browser context, we can't directly read from disk.\n    // This will be handled by the diagnose.js script in Node.js environment.\n    return [];\n};\n/**\n * Clear diagnostic logs\n */\nexport const clearDiagnosticLogs = () => {\n    inMemoryLog = [];\n    // Clear localStorage logs if we're in the browser\n    if (isBrowser) {\n        try {\n            localStorage.removeItem('__STYLIST_DIAGNOSTICS_LOGS');\n        }\n        catch (error) {\n            // Silently fail if localStorage is not available\n        }\n    }\n    // In browser context, we can't directly write to disk.\n    // File operations will be handled by the diagnose.js script.\n};\nexport default {\n    logDiagnostic,\n    logComponentRender,\n    logSuspense,\n    logLazyLoad,\n    logHook,\n    logStore,\n    logErrorBoundary,\n    logGlobalFlag,\n    logPerformance,\n    useDiagnosticLifecycle,\n    getDiagnosticLogs,\n    clearDiagnosticLogs,\n    LogEntryType,\n    LogLevel,\n};\n","/**\n * Environment variables centralized access\n * This file provides type-safe access to all environment variables used in the frontend\n */\n// Backend API sync service constants\nexport const MAX_RETRY_ATTEMPTS = 3;\nexport const IS_PRODUCTION = process.env.NODE_ENV === 'production';\n// API Setup\nexport const API_URL = 'http://localhost:8000/api/v1';\nexport const API_TIMEOUT = 15000;\n/**\n * Claude AI Configuration\n */\nexport const ANTHROPIC_API_KEY = process.env.REACT_APP_ANTHROPIC_API_KEY || '';\nexport const CLAUDE_API_URL = process.env.REACT_APP_ANTHROPIC_API_URL || 'https://api.anthropic.com';\nexport const CLAUDE_MODEL = process.env.REACT_APP_ANTHROPIC_MODEL || 'claude-3-haiku-20240307';\n// Demo mode can be forced even with API keys\nexport const FORCE_DEMO_MODE = process.env.REACT_APP_FORCE_DEMO_MODE === 'true';\n// Allow Claude demo responses without a real API key\nexport const USE_CLAUDE_DEMO = process.env.REACT_APP_USE_CLAUDE_DEMO === 'true';\n/**\n * Background Removal API Configuration\n */\nexport const REMOVE_BG_API_KEY = process.env.REACT_APP_REMOVE_BG_API_KEY || '';\n/**\n * Shopify Integration Configuration\n */\nexport const SHOPIFY_API_KEY = process.env.REACT_APP_SHOPIFY_API_KEY || '';\nexport const SHOPIFY_API_SECRET = process.env.REACT_APP_SHOPIFY_API_SECRET || '';\nexport const SHOPIFY_STORE_URL = process.env.REACT_APP_SHOPIFY_STORE_URL || '';\n/**\n * WooCommerce Integration Configuration\n */\nexport const WOOCOMMERCE_CONSUMER_KEY = process.env.REACT_APP_WOOCOMMERCE_CONSUMER_KEY || '';\nexport const WOOCOMMERCE_CONSUMER_SECRET = process.env.REACT_APP_WOOCOMMERCE_CONSUMER_SECRET || '';\nexport const WOOCOMMERCE_STORE_URL = process.env.REACT_APP_WOOCOMMERCE_STORE_URL || '';\n/**\n * App Configuration\n */\nexport const STYLIST_DEBUG = process.env.REACT_APP_STYLIST_DEBUG === 'true';\nexport const STYLIST_API_KEY = process.env.REACT_APP_STYLIST_API_KEY || 'development_key';\nexport const USE_MOCK_RETAILER = process.env.REACT_APP_USE_MOCK_RETAILER !== 'false' || true;\n/**\n * Type-safe environment variable accessor\n * @param key - Environment variable name\n * @param defaultValue - Default value if not set\n * @returns The environment variable value or default\n */\nexport function getEnv(key, defaultValue) {\n    const value = process.env[`REACT_APP_${key}`];\n    if (value === undefined) {\n        return defaultValue;\n    }\n    // Handle type conversion based on default value type\n    if (typeof defaultValue === 'boolean') {\n        return (value.toLowerCase() === 'true');\n    }\n    if (typeof defaultValue === 'number') {\n        return Number(value);\n    }\n    return value;\n}\n/**\n * Check if a feature flag is enabled\n * @param featureName - Name of the feature flag\n * @returns true if the feature is enabled\n */\nexport function isFeatureEnabled(featureName) {\n    return getEnv(`FEATURE_${featureName.toUpperCase()}`, false);\n}\n"],"names":["root","factory","exports","module","define","amd","self","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","MOCK_RECOMMENDATIONS","items","id","name","brand","category","price","retailerId","colors","sizes","imageUrls","url","matchScore","matchReasons","inStock","outfits","occasion","completeMockRecommendations","Object","assign","userId","timestamp","Date","RecommendationApi","constructor","apiClient","this","getRecommendations","request","response","post","context","filterByRetailers","Array","isArray","apiResponse","recommended_items","map","item","item_id","retailer_id","split","image_urls","score","match_reasons","in_stock","recommended_outfits","outfit","outfit_id","_a","find","i","Error","error","console","warn","status","statusText","getOutfitRecommendations","limit","params","toString","get","addItemFeedback","feedback","itemId","liked","addOutfitFeedback","outfitId","saveOutfit","notes","getSavedOutfits","deleteSavedOutfit","delete","getSimilarItems","completeOutfit","logItemView","FeedbackApi","syncFeedback","feedbackItems","syncedItemIds","success","message","DEFAULT_API_URL","DEFAULT_TIMEOUT","createStylistApi","config","baseURL","apiUrl","apiKey","timeout","headers","user","recommendation","onFeedback","onAddToWishlist","onAddToCart","onTryOn","onFavorite","onRemove","showDetails","primaryColor","onClick","isClosetItem","isFavorite","salePrice","undefined","showFeedbackText","setShowFeedbackText","useState","animateItem","setAnimateItem","isFavoriteState","setIsFavoriteState","imageUrl","image","length","handleItemClick","window","open","handleFeedback","setTimeout","handleTryOn","stopPropagation","discountPercentage","Math","round","isTryOnCompatible","includes","toLowerCase","productType","lcType","TOP","BOTTOM","DRESS","OUTERWEAR","SHOES","ACCESSORY","mapProductTypeToGarmentType","className","children","src","alt","loading","style","backgroundColor","xmlns","viewBox","width","height","fill","d","color","reason","index","newFavoriteState","FeedbackControls","onLike","onDislike","useDiagnosticLifecycle","componentName","mountedRef","useRef","renderCountRef","renderStartTimeRef","performance","now","current","renderCount","useEffect","mountDuration","toFixed","totalRenderCount","useDiagnosticEffect","effectName","deps","effectFn","effectRunCountRef","runCount","dependencies","startTime","cleanup","duration","hasCleanup","monitoredLazy","loadTime","catch","stack","DiagnosticSuspense","fallback","suspendedRef","resolvedRef","suspenseNameRef","Suspense","DiagnosticErrorBoundary","super","arguments","state","hasError","resetError","setState","getDerivedStateFromError","componentDidCatch","info","onError","props","render","SYNC_LAST_TIMESTAMP","SYNC_QUEUE_KEY","SyncOperationType","useSyncService","isOnline","navigator","onLine","isSyncing","lastSyncTimestamp","Number","localStorage","getItem","pendingOperations","syncQueue","userStore","syncIntervalRef","maxRetries","getAuthHeader","token","Authorization","createSyncApiClient","loadSyncQueue","useCallback","queueStr","JSON","parse","saveSyncQueue","queue","setItem","stringify","prev","filter","resolved","handleOnline","syncData","handleOffline","addEventListener","removeEventListener","queueOperation","operation","data","newItem","random","substring","retryCount","updatedQueue","executeOperation","ADD_CLOSET_ITEM","addClosetItem","REMOVE_CLOSET_ITEM","removeClosetItem","UPDATE_CLOSET_ITEM","updateClosetItem","updates","TOGGLE_FAVORITE","toggleFavoriteItem","favorite","UPDATE_PREFERENCES","updatePreferences","SUBMIT_QUIZ","submitStyleQuiz","SAVE_OUTFIT","log","REMOVE_OUTFIT","ADD_LIKED_ITEM","ADD_DISLIKED_ITEM","REMOVE_LIKED_ITEM","REMOVE_DISLIKED_ITEM","resolveConflicts","localUser","serverUser","localTimestamp","lastActive","getTime","mergedUser","closetMap","Map","closet","forEach","set","localItem","serverItem","dateAdded","from","values","likedItems","Set","dislikedItems","viewedItems","savedOutfits","localOutfit","some","every","push","lastInteraction","max","syncWithServer","getUserProfile","setUser","pendingItems","findIndex","q","clearInterval","setInterval","syncNow","toggleFavorite","preferences","submitQuiz","answers","removeOutfit","loadImage","img","Image","crossOrigin","onload","onerror","getImageDimensions","getFormattedFileSize","sizeInBytes","drawImageToCanvas","ctx","rect","rotation","flipHorizontal","flipVertical","save","centerX","x","centerY","y","translate","rotate","PI","scaleX","scaleY","scale","drawImage","restore","activePosition","HEAD","NECK","UPPER_BODY","WAIST","LOWER_BODY","FEET","FULL_BODY","userImage","setCanvasRef","onGarmentSelect","showBodyGuide","canvasRef","activeGarmentId","setActiveGarmentId","isDragging","setIsDragging","dragStart","setDragStart","canvasWidth","canvasHeight","showGuidelines","settings","updateGarment","canvas","getContext","clearRect","userImg","garments","sortedGarments","sort","a","b","zIndex","garment","garmentImage","dimensions","scaledDimensions","offset","position","compositeImages","lineColor","lineWidth","strokeStyle","beginPath","moveTo","lineTo","stroke","drawGuidelines","handleGlobalMouseUp","document","ref","getBoundingClientRect","clientX","left","clientY","top","scaledWidth","scaledHeight","onMouseDown","onMouseMove","deltaX","deltaY","g","newOffset","onMouseUp","type","onGarmentRemove","onGarmentUpdate","onGarmentAdd","onChangePhoto","disabled","_b","_c","_d","showGarments","setShowGarments","showControls","setShowControls","showAddGarment","setShowAddGarment","fileInputRef","selectedGarmentType","setSelectedGarmentType","activeGarment","handleAddGarment","click","handlePositionChange","axis","marginTop","accept","display","onChange","file","target","files","min","parseFloat","parseInt","garmentId","onSaveNote","isLiked","setIsLiked","showLikeOptions","setShowLikeOptions","note","setNote","showNoteInput","setShowNoteInput","addedToWishlist","setAddedToWishlist","addedToCart","setAddedToCart","noteSaved","setNoteSaved","addToWishlist","addToCart","buttonStyle","role","wishlistItem","addedAt","slice","cartItem","quantity","size","placeholder","autoFocus","trim","onUpload","maxSize","acceptedTypes","title","description","setError","selectedFile","setSelectedFile","preview","setPreview","isUsingWebcam","setIsUsingWebcam","isCameraSupported","setIsCameraSupported","videoRef","mediaDevices","getUserMedia","handleDragOver","preventDefault","handleDragLeave","handleFileSelect","startsWith","isImageFile","join","reader","FileReader","readAsDataURL","handleDrop","dataTransfer","handleFileInputChange","handleButtonClick","handleUpload","startWebcam","stream","video","facingMode","ideal","srcObject","err","stopWebcam","getTracks","track","stop","capturePhoto","videoWidth","videoHeight","toBlob","blob","File","toDataURL","autoPlay","playsInline","onDragOver","onDragLeave","onDrop","t","replace","bodyPixModel","preloadBodyPixModel","tf","ready","backend","getBackend","setBackend","backendError","architecture","outputStride","multiplier","quantBytes","removeBackground","imageSource","options","modelError","URL","createObjectURL","imageElement","source","createImageElement","segmentation","segmentPerson","internalResolution","segmentationThreshold","threshold","bodyPixOptions","segmentationError","mediumError","lowError","foregroundColor","createElement","imageData","getImageData","pixelIndex","floor","fgColor","hexToRgb","r","bgColor","putImageData","processSegmentation","errorMsg","String","hex","bigint","method","REMOVE_BG_API","isApiAvailable","fetch","ok","isRemoveBgAvailable","imageFile","dataUrlToFile","resultUrl","formData","FormData","append","crop","format","body","errorMessage","errorData","json","errors","imageBlob","onloadend","removeBackgroundApi","mapQualityToSize","quality","apiError","TENSORFLOW","dataUrl","MANUAL","fallbackToTensorflow","tfError","extractBodyMeasurements","bodyMeasurements","approximateSize","bodyShape","measureError","filename","res","mimeType","gl","failIfMajorPerformanceCaveat","webglContext","debugInfo","getExtension","vendor","getParameter","UNMASKED_VENDOR_WEBGL","renderer","UNMASKED_RENDERER_WEBGL","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","shaderError","useImageProcessing","isProcessing","setIsProcessing","progress","setProgress","setUserImage","updateUserImage","removeImageBackground","tensorflowSupported","setTensorflowSupported","supported","processingStatus","REMOVING_BACKGROUND","preferredBackgroundRemovalMethod","TIMEOUT_MS","removalPromise","timeoutPromise","_","race","partialImage","backgroundRemoved","COMPLETED","processingWarning","updatedImage","onSuccess","isWebGLError","userFriendlyError","fallbackImage","FAILED","processingError","reset","useBackgroundRemoval","processImage","UPLOADING","fileToDataUrl","processedUrl","processedDimensions","maxWidth","maxHeight","originalWidth","originalHeight","targetWidth","targetHeight","calculateAspectRatioDimensions","originalDimensions","PROCESSING","autoRemoveBackground","removeBackgroundAutomatically","finalImage","onProcessingComplete","onClose","onSave","onAddToLookbook","currentOutfit","isLoading","uploadUserImage","addGarment","removeGarment","updateGarmentProperties","clearUserImage","saveTryOnResult","closeTryOnModal","setCurrentOutfit","addGarmentToOutfit","removeGarmentFromOutfit","setLoading","saveResult","openTryOnModal","createdAt","bodyPosition","layerIndex","defaultGarmentScale","defaultGarmentOffset","properties","resultImageUrl","userImageUrl","garmentIds","startNewTryOn","garmentType","newOutfit","tryOnOutfit","useTryOn","showUploader","setShowUploader","savingToLookbook","setSavingToLookbook","saveSuccess","setSaveSuccess","isVisible","setIsVisible","modelLoaded","webglSupported","setWebglSupported","checkWebGLSupport","garmentElement","getElementById","scrollIntoView","behavior","block","handleClose","handleReset","alert","savedOutfit","toLocaleDateString","savedAt","isTryOnModalOpen","handleEscapeKey","key","overflow","isOpen","animateState","setAnimateState","setStatus","isSlowConnection","effectiveType","lastChecked","updateConnectionQuality","connection","saveData","handleConnectionChange","checkConnection","controller","AbortController","timeoutId","abort","signal","clearTimeout","isConnected","SyncContext","createContext","SyncProvider","syncService","network","isMounted","setIsMounted","backgroundTasksStarted","backgroundTasksCompleted","maxSyncTimeout","hasUser","syncState","__STYLIST_BACKGROUND_INIT_COMPLETE","timer","handleVisibilityChange","visibilityState","toISOString","__STYLIST_WIDGET_RENDER_COMPLETE","Provider","useContext","useSyncContext","cx","cy","strokeWidth","feedbackSyncService","syncIntervalId","syncInterval","isInitialized","apiConfig","initialize","isAlreadyInitialized","apiKeyProvided","retailerIdProvided","bind","startSyncInterval","hasExistingInterval","stopSyncInterval","hasActiveInterval","hasApiConfig","feedbackStore","getState","getPendingSyncItems","setIsSyncing","api","itemCount","syncedCount","markAsSynced","FEEDBACK_SYNCED","count","__STYLIST_WIDGET_INITIALIZED","ChatWidgetLazy","default","ChatWidget","storesReady","setStoresReady","initAttempted","setInitAttempted","chatStore","toggleOpen","componentInitializedRef","chatStoreExists","safetyTimeout","timedOut","alreadyInitialized","locallyInitialized","parallelInit","USE_PARALLEL_INIT","__STYLIST_PENDING_INITIALIZATIONS","feedbackSync","services","documentElement","setProperty","lightenColor","darkenColor","amount","newR","newG","newB","padStart","ChatWidgetComponent","USE_LAZY_LOADING","widgetContent","padding","textAlign","borderRadius","margin","location","reload","border","cursor","flexDirection","alignItems","justifyContent","AsyncComponentLoader","A","loadingMessage","onLoadStart","onLoadComplete","onFirstPaint","monitorExistingStore","storeName","store","subscribe","newState","getSafeStoreValue","selector","defaultValue","initializeStores","__STYLIST_STORES_INITIALIZING","initStartTime","phase","chatInitialState","hasMessages","messages","currentView","userInitialState","recInitialState","recommendedItems","outfitCount","recommendedOutfits","initDuration","__STYLIST_STORES_INITIALIZED","createWidgetContainer","container","appendChild","timeoutDuration","mountStartTime","__STYLIST_WIDGET_DOM_MOUNTED","stylistContainer","elapsedTime","__StylistWidgetConfig","hasConfig","widgetAPI","init","hasApiKey","hasRetailerId","initResult","close","minimize","toggleMinimize","switchView","view","setCurrentView","requestedView","openStyleQuiz","__StylistShowStyleQuiz","setIsOpen","openVirtualTryOn","__StylistShowVirtualTryOn","__debug","addMockItems","recStore","setRecommendedItems","mockItems","mockOutfit","setRecommendedOutfits","getDiagnostics","__STYLIST_DIAGNOSTICS","logs","flags","initialized","mounted","renderComplete","storesInitialized","backgroundInitComplete","clearDiagnostics","removeItem","StylistWidget","onItemFeedback","onItemClick","trendingItems","setTrendingItems","setIsLoading","filterCategory","setFilterCategory","fetchTrendingItems","_e","_f","filters","trending","sizePreferences","stylePreferences","filteredItems","categories","uniqueCategories","cat","charAt","toUpperCase","LoadingIndicator","ItemCard","handleItemFeedback","handleAddToWishlist","handleAddToCart","outfitData","matchingItems","setMatchingItems","fetchMatchingItems","handleEscKey","currentTarget","celebrityName","onRemoveFromWishlist","onMoveToCloset","wishlistItems","wishlistProducts","setWishlistProducts","products","addedToWishlistAt","handleRemoveFromWishlist","handleMoveToCloset","tryOnResults","onOutfitFeedback","onSaveOutfit","onSaveTryOnResult","addTextMessage","activeTab","setActiveTab","setIsTryOnModalOpen","selectedTryOnItem","setSelectedTryOnItem","isSocialProofModalOpen","setIsSocialProofModalOpen","selectedCelebrityOutfit","setSelectedCelebrityOutfit","allSavedItems","tryOnItems","celebrityOutfits","handleSaveOutfit","o","borderBottomColor","productImage","startTryOn","chatOutfit","OutfitDisplay","REACT_APP_API_KEY","REACT_APP_RETAILER_ID","REACT_APP_API_URL","renderTabContent","TryOnModal","tryOnResult","AnalyticsEventType","getSessionId","sessionId","sessionStorage","trackEvent","event","queueEvent","eventQueue","isSending","sendQueuedEvents","batch","events","LoggingSuspenseFallback","componentId","renderStartTime","renderDuration","component","totalDuration","onLoadError","isLoaded","setIsLoaded","hasTimeout","setHasTimeout","suspenseTimeoutRef","safeRenderTimeoutRef","componentKey","setComponentKey","isMountedRef","loadStartTimeRef","handleError","componentStack","prevKey","timeoutLevel","loadDuration","forcedResolution","mode","defaultFallback","errorFallback","timeElapsed","finalFallback","isSaved","label","ApiClient","axiosConfig","headersConfig","client","interceptors","use","logConfig","debug","requestWithRetry","put","retries","lastError","requestConfig","isRetryableError","delay","pow","responseData","createApiClient","UserApi","createUser","email","getStyleQuiz","formatPrice","currency","locale","Intl","NumberFormat","formatDate","date","formatString","dateObj","messageId","onThumbsUp","isActive","setIsActive","addMessageThumbsUp","isMessageThumbedUp","borderColor","propLiked","disliked","propDisliked","setLiked","setDisliked","getItemFeedbackStatus","getOutfitFeedbackStatus","likeStyle","dislikeStyle","text","sizeClass","spinnerStyle","borderTopColor","onClickNotification","notifications","setNotifications","hasUnread","setHasUnread","timerId","randomItem","newNotification","itemName","read","handleNotificationClick","notif","notification","toLocaleTimeString","hour","minute","logo","onSwitchView","isMinimized","sender","feedbackGiven","setFeedbackGiven","isUser","USER","isAssistant","ASSISTANT","isSystem","SYSTEM","shouldShowFeedback","bubbleClasses","contentStyle","line","MESSAGE_THUMBS_UP","messageContent","onMessageFeedback","onQuizSubmit","messagesEndRef","scrollContainerRef","scrollToBottom","recommendationItem","quizId","onSubmit","renderMessage","onSendMessage","setMessage","inputRef","focus","scrollHeight","handleSendMessage","trimmedMessage","sendButtonStyle","onKeyDown","shiftKey","rows","ChatService","recommendationApi","conversationContext","claudeConfig","baseUrl","modelName","fallbackMode","processMessage","MESSAGE_SENT","trackMessageSent","responseMessages","intent","categorizeIntent","claudeResponse","callClaudeAPI","createTextMessage","containsRecommendationIntent","addRecommendationMessage","demoResponse","getDemoResponse","extractContext","userMessage","callDirectClaudeAPI","directError","model","content","max_tokens","errorText","assistantResponse","aiResponse","lowerAiResponse","lowerUserMessage","aiRecommendPhrases","userRecommendPhrases","phrase","recommendations","chatItems","createRecommendationMessage","createOutfitMessage","lowerText","query","occasions","TEXT","RECOMMENDATION","OUTFIT","TryOnModalLazy","lazy","StyleQuizModalLazy","StyleQuizModal","LookbookLazy","Lookbook","greeting","setInitialized","initializationAttemptedRef","chatService","setChatService","showStyleQuiz","setShowStyleQuiz","addMessage","addLikedItem","addDislikedItem","initializeUser","userProfile","WIDGET_OPEN","fetchInitialRecommendations","convertedItems","convertedOutfits","hasRegisteredFirstPaint","setHasRegisteredFirstPaint","firstPaintTimeoutRef","hasFiredFirstPaintRef","globallyInitialized","__STYLIST_CHAT_INITIALIZED","attemptedRef","isGloballyInitialized","triggerFirstPaint","alreadyFired","handleStyleQuizOpen","handleVirtualTryOnOpen","hasEvents","__StylistWidgetEvents","on","off","userExists","apiExists","ITEM_LIKE","ITEM_DISLIKE","handleOutfitFeedback","OUTFIT_LIKE","OUTFIT_DISLIKE","ADD_TO_WISHLIST","purchaseTrackingService","trackPurchase","productId","ADD_TO_CART","OUTFIT_SAVE","handleQuizSubmit","TOTAL_QUESTIONS","answeredQuestionIds","questionId","unansweredQuestions","qId","STYLE_QUIZ_PARTIAL","unansweredCount","includeOutfits","STYLE_QUIZ_COMPLETE","handleTryOnSave","TRY_ON_SAVED","widgetClasses","shouldRenderNonEssentialComponents","VIEW_LOOKBOOK","helpful","STYLE_QUIZ_START","responses","convertedOutfit","DEMO_QUESTIONS","questionText","minValue","maxValue","STORAGE_KEY","questions","currentQuestionIndex","savedAnswers","savedProgress","currentQuestion","loadSavedProgress","setCurrentQuestion","setAnswers","submitting","setSubmitting","handleOptionSelect","optionId","handleSingleAnswer","answerId","newAnswers","existingIndex","answer","answered","question","isLastQuestion","isCurrentQuestionAnswered","completionPercentage","currentAnswer","option","backgroundImage","isSelected","answerIds","currentIds","newIds","handleMultipleAnswer","labels","right","answerValue","handleSliderAnswer","accentColor","renderQuestion","querySelector","classList","add","remove","currentAnswers","setCurrentAnswers","finalSubmission","setFinalSubmission","syncedStore","recommendationStore","addToCloset","tags","removeFromCloset","toggleItemFavorite","updateUser","removeSavedOutfit","STYLE_QUIZ_ABANDON","questionCount","answeredCount","completionRate","StyleQuiz","LOG_DIAGNOSTICS","LogEntryType","LogLevel","inMemoryLog","isBrowser","originalConsole","enabled","logDiagnostic","level","INFO","entry","logObject","__STYLIST_DIAGNOSTICS_LOG_TO_TEMP","storedLogs","parsedLogs","limitedLogs","logComponentRender","stage","typeMap","mount","COMPONENT_MOUNT","COMPONENT_RENDER","update","unmount","COMPONENT_UNMOUNT","COMPONENT_ERROR","action","CUSTOM","warning","levelMap","DEBUG","ERROR","WARNING","logSuspense","SUSPENSE_FALLBACK","SUSPENSE_RESOLVED","logLazyLoad","start","LAZY_LOAD_START","complete","LAZY_LOAD_COMPLETE","LAZY_LOAD_ERROR","logHook","hook","HOOK_INIT","EFFECT_START","EFFECT_CLEANUP","logStore","STORE_INIT","STORE_UPDATE","STORE_SUBSCRIPTION","unsubscribe","logErrorBoundary","ERROR_BOUNDARY","logGlobalFlag","flag","GLOBAL_FLAG","logPerformance","PERFORMANCE_MARK","MAX_RETRY_ATTEMPTS","API_URL","API_TIMEOUT","ANTHROPIC_API_KEY","REACT_APP_ANTHROPIC_API_KEY","CLAUDE_API_URL","REACT_APP_ANTHROPIC_API_URL","CLAUDE_MODEL","REACT_APP_ANTHROPIC_MODEL","FORCE_DEMO_MODE","REACT_APP_FORCE_DEMO_MODE","USE_CLAUDE_DEMO","REACT_APP_USE_CLAUDE_DEMO","REMOVE_BG_API_KEY","REACT_APP_REMOVE_BG_API_KEY"],"sourceRoot":""}